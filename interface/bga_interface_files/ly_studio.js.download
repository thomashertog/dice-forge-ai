require({cache:{"dijit/Dialog":function(){define(["require","dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/Deferred","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/fx","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/ready","dojo/sniff","dojo/touch","dojo/window","dojo/dnd/Moveable","dojo/dnd/TimedMoveable","./focus","./_base/manager","./_Widget","./_TemplatedMixin","./_CssStateMixin","./form/_FormMixin","./_DialogMixin","./DialogUnderlay","./layout/ContentPane","./layout/utils","dojo/text!./templates/Dialog.html","./a11yclick","dojo/i18n!./nls/common"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_,f,v,b,y,w,C,k,x,T,A,j,S,M,E){var N=new o;N.resolve(!0);function D(){}var I=n("dijit._DialogBase"+(g("dojo-bidi")?"_NoBidi":""),[k,T,A,x],{templateString:E,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!1,duration:w.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,draggable:!0,_setDraggableAttr:function(e){this._set("draggable",e)},maxRatio:.9,closable:!0,_setClosableAttr:function(e){this.closeButtonNode.style.display=e?"":"none";this._set("closable",e)},postMixInProperties:function(){var e=c.getLocalization("dijit","common");u.mixin(this,e);this.inherited(arguments)},postCreate:function(){l.set(this.domNode,{display:"none",position:"absolute"});this.ownerDocumentBody.appendChild(this.domNode);this.inherited(arguments);i.after(this,"onExecute",u.hitch(this,"hide"),!0);i.after(this,"onCancel",u.hitch(this,"hide"),!0);p(this.closeButtonNode,_.press,(function(e){e.stopPropagation()}));this._modalconnects=[]},onLoad:function(){this.resize();this._position();if(this.autofocus&&$.isTop(this)){this._getFocusItems();y.focus(this._firstFocusItem)}this.inherited(arguments)},focus:function(){this._getFocusItems();y.focus(this._firstFocusItem)},_endDrag:function(){var e=r.position(this.domNode),t=f.getBox(this.ownerDocument);e.y=Math.min(Math.max(e.y,0),t.h-e.h);e.x=Math.min(Math.max(e.x,0),t.w-e.w);this._relativePosition=e;this._position()},_setup:function(){var e=this.domNode;if(this.titleBar&&this.draggable){this._moveable=new(6==g("ie")?b:v)(e,{handle:this.titleBar});i.after(this._moveable,"onMoveStop",u.hitch(this,"_endDrag"),!0)}else s.add(e,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,class:t.map(this.class.split(/\s/),(function(e){return e+"_underlay"})).join(" "),_onKeyDown:u.hitch(this,"_onKey"),ownerDocument:this.ownerDocument}},_size:function(){this.resize()},_position:function(){if(!s.contains(this.ownerDocumentBody,"dojoMove")){var e=this.domNode,t=f.getBox(this.ownerDocument),i=this._relativePosition,n=r.position(e),o=Math.floor(t.l+(i?Math.min(i.x,t.w-n.w):(t.w-n.w)/2)),a=Math.floor(t.t+(i?Math.min(i.y,t.h-n.h):(t.h-n.h)/2));l.set(e,{left:o+"px",top:a+"px"})}},_onKey:function(e){if(e.keyCode==h.TAB){this._getFocusItems();var t=e.target;if(this._firstFocusItem==this._lastFocusItem){e.stopPropagation();e.preventDefault()}else if(t==this._firstFocusItem&&e.shiftKey){y.focus(this._lastFocusItem);e.stopPropagation();e.preventDefault()}else if(t==this._lastFocusItem&&!e.shiftKey){y.focus(this._firstFocusItem);e.stopPropagation();e.preventDefault()}}else if(this.closable&&e.keyCode==h.ESCAPE){this.onCancel();e.stopPropagation();e.preventDefault()}},show:function(){if(this.open)return N.promise;this._started||this.startup();if(!this._alreadyInitialized){this._setup();this._alreadyInitialized=!0}if(this._fadeOutDeferred){this._fadeOutDeferred.cancel();$.hide(this)}var e,t=f.get(this.ownerDocument);this._modalconnects.push(p(t,"scroll",u.hitch(this,"resize",null)));this._modalconnects.push(p(this.domNode,"keydown",u.hitch(this,"_onKey")));l.set(this.domNode,{opacity:0,display:""});this._set("open",!0);this._onShow();this.resize();this._position();this._fadeInDeferred=new o(u.hitch(this,(function(){e.stop();delete this._fadeInDeferred})));this._fadeInDeferred.then(void 0,D);var i=this._fadeInDeferred.promise;e=d.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:u.hitch(this,(function(){$.show(this,this.underlayAttrs)})),onEnd:u.hitch(this,(function(){if(this.autofocus&&$.isTop(this)){this._getFocusItems();y.focus(this._firstFocusItem)}this._fadeInDeferred.resolve(!0);delete this._fadeInDeferred}))}).play();return i},hide:function(){if(!this._alreadyInitialized||!this.open)return N.promise;this._fadeInDeferred&&this._fadeInDeferred.cancel();var e;this._fadeOutDeferred=new o(u.hitch(this,(function(){e.stop();delete this._fadeOutDeferred})));this._fadeOutDeferred.then(void 0,D);this._fadeOutDeferred.then(u.hitch(this,"onHide"));var t,i=this._fadeOutDeferred.promise;e=d.fadeOut({node:this.domNode,duration:this.duration,onEnd:u.hitch(this,(function(){this.domNode.style.display="none";$.hide(this);this._fadeOutDeferred.resolve(!0);delete this._fadeOutDeferred}))}).play();this._scrollConnected&&(this._scrollConnected=!1);for(;t=this._modalconnects.pop();)t.remove();this._relativePosition&&delete this._relativePosition;this._set("open",!1);return i},resize:function(e){if("none"!=this.domNode.style.display){this._checkIfSingleChild();if(!e){if(this._shrunk){if(this._singleChild&&void 0!==this._singleChildOriginalStyle){this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;delete this._singleChildOriginalStyle}t.forEach([this.domNode,this.containerNode,this.titleBar,this.actionBarNode],(function(e){e&&l.set(e,{position:"static",width:"auto",height:"auto"})}));this.domNode.style.position="absolute"}var i=f.getBox(this.ownerDocument);i.w*=this.maxRatio;i.h*=this.maxRatio;var n=r.position(this.domNode);this._shrunk=!1;if(n.w>=i.w){e={w:i.w};r.setMarginBox(this.domNode,e);n=r.position(this.domNode);this._shrunk=!0}if(n.h>=i.h){e||(e={w:n.w});e.h=i.h;this._shrunk=!0}if(e){e.w||(e.w=n.w);e.h||(e.h=n.h)}}if(e){r.setMarginBox(this.domNode,e);var o=[];this.titleBar&&o.push({domNode:this.titleBar,region:"top"});this.actionBarNode&&o.push({domNode:this.actionBarNode,region:"bottom"});var a={domNode:this.containerNode,region:"center"};o.push(a);var s=M.marginBox2contentBox(this.domNode,e);M.layoutChildren(this.domNode,s,o);if(this._singleChild){var d=M.marginBox2contentBox(this.containerNode,a);this._singleChild.resize({w:d.w,h:d.h})}else{this.containerNode.style.overflow="auto";this._layoutChildren()}}else this._layoutChildren();g("touch")||e||this._position()}},_layoutChildren:function(){t.forEach(this.getChildren(),(function(e){e.resize&&e.resize()}))},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();for(var e;e=this._modalconnects.pop();)e.remove();$.hide(this);this.inherited(arguments)}});g("dojo-bidi")&&(I=n("dijit._DialogBase",I,{_setTitleAttr:function(e){this._set("title",e);this.titleNode.innerHTML=e;this.applyTextDir(this.titleNode)},_setTextDirAttr:function(e){if(this._created&&this.textDir!=e){this._set("textDir",e);this.set("title",this.title)}}}));var L=n("dijit.Dialog",[S,I],{});L._DialogBase=I;var $=L._DialogLevelManager={_beginZIndex:950,show:function(e,t){P[P.length-1].focus=y.curNode;var i=P[P.length-1].dialog?P[P.length-1].zIndex+2:L._DialogLevelManager._beginZIndex;l.set(e.domNode,"zIndex",i);j.show(t,i-1);P.push({dialog:e,underlayAttrs:t,zIndex:i})},hide:function(e){if(P[P.length-1].dialog==e){P.pop();var i=P[P.length-1];1==P.length?j.hide():j.show(i.underlayAttrs,i.zIndex-1);if(e.refocus){var n=i.focus;if(i.dialog&&(!n||!a.isDescendant(n,i.dialog.domNode))){i.dialog._getFocusItems();n=i.dialog._firstFocusItem}if(n)try{n.focus()}catch(s){}}}else{var o=t.indexOf(t.map(P,(function(e){return e.dialog})),e);-1!=o&&P.splice(o,1)}},isTop:function(e){return P[P.length-1].dialog==e}},P=L._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];g("dijit-legacy-requires")&&m(0,(function(){e(["dijit/TooltipDialog"])}));return L}))},"dojo/i18n":function(){define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./_base/xhr","./json","module"],(function(e,t,i,n,o,a,s,r,l){i.add("dojo-preload-i18n-Api",1);var d=e.i18n={},c=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,h={},u=function(t,i,n){n=n?n.toLowerCase():e.locale;t=t.replace(/\./g,"/");i=i.replace(/\./g,"/");return/root/i.test(n)?t+"/nls/"+i:t+"/nls/"+n+"/"+i},p=e.getL10nName=function(e,t,i){return l.id+"!"+u(e,t,i)},m=function(t,s,l){var d=c.exec(t),u=d[1]+"/",p=d[5]||d[4],m=u+p,g=d[5]&&d[4],_=g||e.locale||"",f=m+"/"+_,v=g?[_]:function(e){var t=o.extraLocale||[];(t=a.isArray(t)?t:[t]).push(e);return t}(_),b=v.length,k=function(){--b||l(a.delegate(h[f]))},x=t.split("*"),T="preload"==x[1];if(i("dojo-preload-i18n-Api")){if(T){if(!h[t]){h[t]=1;y(x[2],r.parse(x[3]),1,s)}l(1)}if(T||w(t,s,l)&&!h[f])return}else if(T){l(1);return}n.forEach(v,(function(e){var t=m+"/"+e;i("dojo-preload-i18n-Api")&&C(t);h[t]?k():function(e,t,i,n,o,s){e([t],(function(r){var l=void 0===r.root?r:a.clone(r.root||r.ROOT),d=function(e,t,i,n){for(var o=[i+n],a=t.split("-"),s="",r=0;r<a.length;r++){s+=(s?"-":"")+a[r];if(!e||e[s]){o.push(i+s+"/"+n);o.specificity=s}}return o}(!r._v1x&&r,o,i,n);e(d,(function(){for(var e=1;e<d.length;e++)l=a.mixin(a.clone(l),arguments[e]);h[t+"/"+o]=l;l.$locale=d.specificity;s()}))}))}(s,m,u,p,e,k)}))};i("dojo-preload-i18n-Api");var g,_=d.normalizeLocale=function(t){var i=t?t.toLowerCase():e.locale;return"root"==i?"ROOT":i},f=function(e,i){return i.isXdUrl(t.toUrl(e+".js"))},v=0,b=[],y=d._preloadLocalizations=function(i,o,s,r){r=r||t;function l(e,t){for(var i=e.split("-");i.length;){if(t(i.join("-")))return;i.pop()}t("ROOT")}function d(){v++}function c(){--v;for(;!v&&b.length;)m.apply(null,b.shift())}function u(e,t,i,n){return n.toAbsMid(e+t+"/"+i)}function p(e){l(e=_(e),(function(p){if(n.indexOf(o,p)>=0){var m=i.replace(/\./g,"/")+"_"+p;d();!function(e,t){f(e,r)||s?r([e],t):T([e],t,r)}(m,(function(i){for(var n in i){var o,s,m=i[n],g=n.match(/(.+)\/([^\/]+)$/);if(g){o=g[2];s=g[1]+"/";if(m._localized){var _;if("ROOT"===p){var f=_=m._localized;delete m._localized;f.root=m;h[t.toAbsMid(n)]=f}else{_=m._localized;h[u(s,o,p,t)]=m}if(p!==e){function v(i,n,o,s){var p=[],m=[];l(e,(function(e){if(s[e]){p.push(t.toAbsMid(i+e+"/"+n));m.push(u(i,n,e,t))}}));if(p.length){d();r(p,(function(){for(var s=p.length-1;s>=0;s--){o=a.mixin(a.clone(o),arguments[s]);h[m[s]]=o}h[u(i,n,e,t)]=a.clone(o);c()}))}else h[u(i,n,e,t)]=o}v(s,o,m,_)}}}}c()}));return!0}return!1}))}p();n.forEach(e.config.extraLocale,p)},w=function(e,t,i){v&&b.push([e,t,i]);return v},C=function(){},k={},x={},T=function(e,t,i){var o=[];n.forEach(e,(function(e){var t=i.toUrl(e+".js");function n(i){g||(g=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},\t   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"));var n=g(i,C,e,k);if(n===k)o.push(h[t]=k.result);else{n instanceof Error&&(n={});o.push(h[t]=/nls\/[^\/]+\/[^\/]+$/.test(t)?n:{root:n,_v1x:1})}}if(h[t])o.push(h[t]);else{var a=i.syncLoadNls(e);a||(a=C(e.replace(/nls\/([^\/]*)\/([^\/]*)$/,"nls/$2/$1")));if(a)o.push(a);else if(s)s.get({url:t,sync:!0,load:n,error:function(){o.push(h[t]={})}});else try{i.getText(t,!0,n)}catch(r){o.push(h[t]={})}}}));t&&t.apply(null,o)};C=function(t){for(var i,n=t.split("/"),o=e.global[n[0]],a=1;o&&a<n.length-1;o=o[n[a++]]);if(o){(i=o[n[a]])||(i=o[n[a].replace(/-/g,"_")]);i&&(h[t]=i)}return i};d.getLocalization=function(e,i,n){var o,a=u(e,i,n);if(x[a])return x[a];m(a,f(a,t)?t:function(e,i){T(e,i,t)},(function(e){x[a]=e;o=e}));return o};return a.mixin(d,{dynamic:!0,normalize:function(e,t){return/^\./.test(e)?t(e):e},load:m,cache:h,getL10nName:p})}))},"dojo/touch":function(){define(["./_base/kernel","./aspect","./dom","./dom-class","./_base/lang","./on","./has","./mouse","./domReady","./_base/window"],(function(e,t,i,n,o,a,s,r,l,d){var c,h,u,p,m,g,_,f,v,b,y=s("ios")<5,w=s("pointer-events")||s("MSPointer"),C=function(){var e={};for(var t in{down:1,move:1,up:1,cancel:1,over:1,out:1})e[t]=s("MSPointer")?"MSPointer"+t.charAt(0).toUpperCase()+t.slice(1):"pointer"+t;return e}(),k=s("touch-events"),x=!1;function T(e,t,i){return w&&i?function(e,t){return a(e,i,t)}:k?function(i,n){var o=a(i,t,(function(e){n.call(this,e);v=(new Date).getTime()})),s=a(i,e,(function(e){(!v||(new Date).getTime()>v+1e3)&&n.call(this,e)}));return{remove:function(){o.remove();s.remove()}}}:function(t,i){return a(t,e,i)}}function A(e,t,o){if(!r.isRight(e)){var s=function(e){do{if(void 0!==e.dojoClick)return e}while(e=e.parentNode)}(e.target);if(h=!e.target.disabled&&s&&s.dojoClick){u=(x="useTarget"==h)?s:e.target;x&&e.preventDefault();p=e.changedTouches?e.changedTouches[0].pageX-d.global.pageXOffset:e.clientX;m=e.changedTouches?e.changedTouches[0].pageY-d.global.pageYOffset:e.clientY;g=("object"==typeof h?h.x:"number"==typeof h?h:0)||4;_=("object"==typeof h?h.y:"number"==typeof h?h:0)||4;if(!c){c=!0;function l(e){h=x?i.isDescendant(d.doc.elementFromPoint(e.changedTouches?e.changedTouches[0].pageX-d.global.pageXOffset:e.clientX,e.changedTouches?e.changedTouches[0].pageY-d.global.pageYOffset:e.clientY),u):h&&(e.changedTouches?e.changedTouches[0].target:e.target)==u&&Math.abs((e.changedTouches?e.changedTouches[0].pageX-d.global.pageXOffset:e.clientX)-p)<=g&&Math.abs((e.changedTouches?e.changedTouches[0].pageY-d.global.pageYOffset:e.clientY)-m)<=_}d.doc.addEventListener(t,(function(e){if(!r.isRight(e)){l(e);x&&e.preventDefault()}}),!0);d.doc.addEventListener(o,(function(e){if(!r.isRight(e)){l(e);if(h){f=(new Date).getTime();var t=x?u:e.target;"LABEL"===t.tagName&&(t=i.byId(t.getAttribute("for"))||t);var n=e.changedTouches?e.changedTouches[0]:e;function o(t){var i=document.createEvent("MouseEvents");i._dojo_click=!0;i.initMouseEvent(t,!0,!0,e.view,e.detail,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);return i}var s=o("mousedown"),d=o("mouseup"),c=o("click");setTimeout((function(){a.emit(t,"mousedown",s);a.emit(t,"mouseup",d);a.emit(t,"click",c);f=(new Date).getTime()}),0)}}}),!0);function v(e){d.doc.addEventListener(e,(function(t){var i=t.target;if(h&&!t._dojo_click&&(new Date).getTime()<=f+1e3&&("INPUT"!=i.tagName||!n.contains(i,"dijitOffScreen"))){t.stopPropagation();t.stopImmediatePropagation&&t.stopImmediatePropagation();"click"==e&&("INPUT"!=i.tagName||"radio"==i.type&&(n.contains(i,"dijitCheckBoxInput")||n.contains(i,"mblRadioButton"))||"checkbox"==i.type&&(n.contains(i,"dijitCheckBoxInput")||n.contains(i,"mblCheckBox")))&&"TEXTAREA"!=i.tagName&&"AUDIO"!=i.tagName&&"VIDEO"!=i.tagName&&t.preventDefault()}}),!0)}v("click");v("mousedown");v("mouseup")}}}}s("touch")&&l(w?function(){d.doc.addEventListener(C.down,(function(e){A(e,C.move,C.up)}),!0)}:function(){b=d.body();d.doc.addEventListener("touchstart",(function(e){v=(new Date).getTime();var t=b;b=e.target;a.emit(t,"dojotouchout",{relatedTarget:b,bubbles:!0});a.emit(b,"dojotouchover",{relatedTarget:t,bubbles:!0});A(e,"touchmove","touchend")}),!0);function e(e){var t=o.delegate(e,{bubbles:!0});if(s("ios")>=6){t.touches=e.touches;t.altKey=e.altKey;t.changedTouches=e.changedTouches;t.ctrlKey=e.ctrlKey;t.metaKey=e.metaKey;t.shiftKey=e.shiftKey;t.targetTouches=e.targetTouches}return t}a(d.doc,"touchmove",(function(t){v=(new Date).getTime();var i=d.doc.elementFromPoint(t.pageX-(y?0:d.global.pageXOffset),t.pageY-(y?0:d.global.pageYOffset));if(i){if(b!==i){a.emit(b,"dojotouchout",{relatedTarget:i,bubbles:!0});a.emit(i,"dojotouchover",{relatedTarget:b,bubbles:!0});b=i}a.emit(i,"dojotouchmove",e(t))||t.preventDefault()}}));a(d.doc,"touchend",(function(t){v=(new Date).getTime();var i=d.doc.elementFromPoint(t.pageX-(y?0:d.global.pageXOffset),t.pageY-(y?0:d.global.pageYOffset))||d.body();a.emit(i,"dojotouchend",e(t))}))});var j={press:T("mousedown","touchstart",C.down),move:T("mousemove","dojotouchmove",C.move),release:T("mouseup","dojotouchend",C.up),cancel:T(r.leave,"touchcancel",w?C.cancel:null),over:T("mouseover","dojotouchover",C.over),out:T("mouseout","dojotouchout",C.out),enter:r._eventHandler(T("mouseover","dojotouchover",C.over)),leave:r._eventHandler(T("mouseout","dojotouchout",C.out))};e.touch=j;return j}))},"dojo/window":function(){define(["./_base/lang","./sniff","./_base/window","./dom","./dom-geometry","./dom-style","./dom-construct"],(function(e,t,i,n,o,a,s){t.add("rtl-adjust-position-for-verticalScrollBar",(function(e,t){var n=i.body(t),a=s.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},n,"last"),r=s.create("div",{style:{overflow:"hidden",direction:"ltr"}},a,"last"),l=0!=o.position(r).x;a.removeChild(r);n.removeChild(a);return l}));t.add("position-fixed-support",(function(e,t){var n=i.body(t),a=s.create("span",{style:{visibility:"hidden",position:"fixed",left:"1px",top:"1px"}},n,"last"),r=s.create("span",{style:{position:"fixed",left:"0",top:"0"}},a,"last"),l=o.position(r).x!=o.position(a).x;a.removeChild(r);n.removeChild(a);return l}));var r={getBox:function(e){var n,a,s="BackCompat"==(e=e||i.doc).compatMode?i.body(e):e.documentElement,l=o.docScroll(e);if(t("touch")){var d=r.get(e);n=d.innerWidth||s.clientWidth;a=d.innerHeight||s.clientHeight}else{n=s.clientWidth;a=s.clientHeight}return{l:l.x,t:l.y,w:n,h:a}},get:function(e){if(t("ie")&&r!==document.parentWindow){e.parentWindow.execScript("document._parentWindow = window;","Javascript");var i=e._parentWindow;e._parentWindow=null;return i}return e.parentWindow||e.defaultView},scrollIntoView:function(e,s){try{var r=(e=n.byId(e)).ownerDocument||i.doc,l=i.body(r),d=r.documentElement||l.parentNode,c=t("ie")||t("trident"),h=t("webkit");if(e==l||e==d)return;if(!(t("mozilla")||c||h||t("opera")||t("trident")||t("edge"))&&"scrollIntoView"in e){e.scrollIntoView(!1);return}var u="BackCompat"==r.compatMode,p=Math.min(l.clientWidth||d.clientWidth,d.clientWidth||l.clientWidth),m=Math.min(l.clientHeight||d.clientHeight,d.clientHeight||l.clientHeight),g=h||u?l:d,_=s||o.position(e),f=e.parentNode,v=function(e){return!(c<=6||7==c&&u)&&(t("position-fixed-support")&&"fixed"==a.get(e,"position").toLowerCase())},b=this,y=function(e,t,i){if("BODY"==e.tagName||"HTML"==e.tagName)b.get(e.ownerDocument).scrollBy(t,i);else{t&&(e.scrollLeft+=t);i&&(e.scrollTop+=i)}};if(v(e))return;for(;f;){f==l&&(f=g);var w=o.position(f),C=v(f),k="rtl"==a.getComputedStyle(f).direction.toLowerCase();if(f==g){w.w=p;w.h=m;g==d&&(c||t("trident"))&&k&&(w.x+=g.offsetWidth-w.w);w.x=0;w.y=0}else{var x=o.getPadBorderExtents(f);w.w-=x.w;w.h-=x.h;w.x+=x.l;w.y+=x.t;var T=f.clientWidth,A=w.w-T;if(T>0&&A>0){k&&t("rtl-adjust-position-for-verticalScrollBar")&&(w.x+=A);w.w=T}T=f.clientHeight;A=w.h-T;T>0&&A>0&&(w.h=T)}if(C){if(w.y<0){w.h+=w.y;w.y=0}if(w.x<0){w.w+=w.x;w.x=0}w.y+w.h>m&&(w.h=m-w.y);w.x+w.w>p&&(w.w=p-w.x)}var j,S,M=_.x-w.x,E=_.y-w.y,N=M+_.w-w.w,D=E+_.h-w.h;if(N*M>0&&(f.scrollLeft||f==g||f.scrollWidth>f.offsetHeight)){j=Math[M<0?"max":"min"](M,N);k&&(8==c&&!u||t("trident")>=5)&&(j=-j);S=f.scrollLeft;y(f,j,0);j=f.scrollLeft-S;_.x-=j}if(D*E>0&&(f.scrollTop||f==g||f.scrollHeight>f.offsetHeight)){j=Math.ceil(Math[E<0?"max":"min"](E,D));S=f.scrollTop;y(f,0,j);j=f.scrollTop-S;_.y-=j}f=f!=g&&!C&&f.parentNode}}catch(I){e.scrollIntoView(!1)}}};e.setObject("dojo.window",r);return r}))},"dojo/dnd/Moveable":function(){define(["../_base/array","../_base/declare","../_base/lang","../dom","../dom-class","../Evented","../has","../on","../topic","../touch","./common","./Mover","../_base/window"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u){var p,m=function(){};s("touch-action")&&(m=function(){"touchAction"in document.body.style?p="touchAction":"msTouchAction"in document.body.style&&(p="msTouchAction");(m=function(e,t){e.style[p]=t})(arguments[0],arguments[1])});return t("dojo.dnd.Moveable",[a],{handle:"",delay:0,skip:!1,constructor:function(e,t){this.node=n.byId(e);m(this.node,"none");t||(t={});this.handle=t.handle?n.byId(t.handle):null;this.handle||(this.handle=this.node);this.delay=t.delay>0?t.delay:0;this.skip=t.skip;this.mover=t.mover?t.mover:h;this.events=[r(this.handle,d.press,i.hitch(this,"onMouseDown")),r(this.handle,"dragstart",i.hitch(this,"onSelectStart")),r(this.handle,"selectstart",i.hitch(this,"onSelectStart"))]},markupFactory:function(e,t,i){return new i(t,e)},destroy:function(){e.forEach(this.events,(function(e){e.remove()}));m(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(e){if(!this.skip||!c.isFormElement(e)){if(this.delay){this.events.push(r(this.handle,d.move,i.hitch(this,"onMouseMove")),r(this.handle.ownerDocument,d.release,i.hitch(this,"onMouseUp")));this._lastX=e.pageX;this._lastY=e.pageY}else this.onDragDetected(e);e.stopPropagation();e.preventDefault()}},onMouseMove:function(e){if(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay){this.onMouseUp(e);this.onDragDetected(e)}e.stopPropagation();e.preventDefault()},onMouseUp:function(e){for(var t=0;t<2;++t)this.events.pop().remove();e.stopPropagation();e.preventDefault()},onSelectStart:function(e){if(!this.skip||!c.isFormElement(e)){e.stopPropagation();e.preventDefault()}},onDragDetected:function(e){new this.mover(this.node,e,this)},onMoveStart:function(e){l.publish("/dnd/move/start",e);o.add(u.body(),"dojoMove");o.add(this.node,"dojoMoveItem")},onMoveStop:function(e){l.publish("/dnd/move/stop",e);o.remove(u.body(),"dojoMove");o.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(e,t){this.onMoving(e,t);var i=e.node.style;i.left=t.l+"px";i.top=t.t+"px";this.onMoved(e,t)},onMoving:function(){},onMoved:function(){}})}))},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],(function(e,t,i,n){var o=i.getObject("dojo.dnd",!0);o.getCopyKeyState=function(t){return t[e("mac")?"metaKey":"ctrlKey"]};o._uniqueId=0;o.getUniqueId=function(){var e;do{e=t._scopeName+"Unique"+ ++o._uniqueId}while(n.byId(e));return e};o._empty={};o.isFormElement=function(e){var t=e.target;3==t.nodeType&&(t=t.parentNode);return" a button textarea input select option ".indexOf(" "+t.tagName.toLowerCase()+" ")>=0};return o}))},"dojo/dnd/Mover":function(){define(["../_base/array","../_base/declare","../_base/lang","../sniff","../_base/window","../dom","../dom-geometry","../dom-style","../Evented","../on","../touch","./common","./autoscroll"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u){return t("dojo.dnd.Mover",[l],{constructor:function(e,t,n){this.node=a.byId(e);this.marginBox={l:t.pageX,t:t.pageY};this.mouseButton=t.button;var o=this.host=n,s=e.ownerDocument;function r(e){e.preventDefault();e.stopPropagation()}this.events=[d(s,c.move,i.hitch(this,"onFirstMove")),d(s,c.move,i.hitch(this,"onMouseMove")),d(s,c.release,i.hitch(this,"onMouseUp")),d(s,"dragstart",r),d(s.body,"selectstart",r)];u.autoScrollStart(s);o&&o.onMoveStart&&o.onMoveStart(this)},onMouseMove:function(e){u.autoScroll(e);var t=this.marginBox;this.host.onMove(this,{l:t.l+e.pageX,t:t.t+e.pageY},e);e.preventDefault();e.stopPropagation()},onMouseUp:function(e){(n("webkit")&&n("mac")&&2==this.mouseButton?0==e.button:this.mouseButton==e.button)&&this.destroy();e.preventDefault();e.stopPropagation()},onFirstMove:function(e){var t,i,n=this.node.style,a=this.host;switch(n.position){case"relative":case"absolute":t=Math.round(parseFloat(n.left))||0;i=Math.round(parseFloat(n.top))||0;break;default:n.position="absolute";var l=s.getMarginBox(this.node),d=o.doc.body,c=r.getComputedStyle(d),h=s.getMarginBox(d,c),u=s.getContentBox(d,c);t=l.l-(u.l-h.l);i=l.t-(u.t-h.t)}this.marginBox.l=t-this.marginBox.l;this.marginBox.t=i-this.marginBox.t;a&&a.onFirstMove&&a.onFirstMove(this,e);this.events.shift().remove()},destroy:function(){e.forEach(this.events,(function(e){e.remove()}));var t=this.host;t&&t.onMoveStop&&t.onMoveStop(this);this.events=this.node=this.host=null}})}))},"dojo/dnd/autoscroll":function(){define(["../_base/lang","../sniff","../_base/window","../dom-geometry","../dom-style","../window"],(function(e,t,i,n,o,a){var s={};e.setObject("dojo.dnd.autoscroll",s);s.getViewport=a.getBox;s.V_TRIGGER_AUTOSCROLL=32;s.H_TRIGGER_AUTOSCROLL=32;s.V_AUTOSCROLL_VALUE=16;s.H_AUTOSCROLL_VALUE=16;var r,l=i.doc,d=1/0,c=1/0;s.autoScrollStart=function(e){l=e;r=a.getBox(l);var t=i.body(l).parentNode;d=Math.max(t.scrollHeight-r.h,0);c=Math.max(t.scrollWidth-r.w,0)};s.autoScroll=function(e){var t=r||a.getBox(l),n=i.body(l).parentNode,o=0,h=0;e.clientX<s.H_TRIGGER_AUTOSCROLL?o=-s.H_AUTOSCROLL_VALUE:e.clientX>t.w-s.H_TRIGGER_AUTOSCROLL&&(o=Math.min(s.H_AUTOSCROLL_VALUE,c-n.scrollLeft));e.clientY<s.V_TRIGGER_AUTOSCROLL?h=-s.V_AUTOSCROLL_VALUE:e.clientY>t.h-s.V_TRIGGER_AUTOSCROLL&&(h=Math.min(s.V_AUTOSCROLL_VALUE,d-n.scrollTop));window.scrollBy(o,h)};s._validNodes={div:1,p:1,td:1};s._validOverflow={auto:1,scroll:1};s.autoScrollNodes=function(e){for(var a,r,l,d,c,h,u=0,p=0,m=e.target;m;){if(1==m.nodeType&&m.tagName.toLowerCase()in s._validNodes){var g=o.getComputedStyle(m),_=g.overflowX.toLowerCase()in s._validOverflow,f=g.overflowY.toLowerCase()in s._validOverflow;if(_||f){a=n.getContentBox(m,g);r=n.position(m,!0)}if(_){l=Math.min(s.H_TRIGGER_AUTOSCROLL,a.w/2);c=e.pageX-r.x;(t("webkit")||t("opera"))&&(c+=i.body().scrollLeft);u=0;if(c>0&&c<a.w){c<l?u=-l:c>a.w-l&&(u=l);m.scrollLeft;m.scrollLeft=m.scrollLeft+u}}if(f){d=Math.min(s.V_TRIGGER_AUTOSCROLL,a.h/2);h=e.pageY-r.y;(t("webkit")||t("opera"))&&(h+=i.body().scrollTop);p=0;if(h>0&&h<a.h){h<d?p=-d:h>a.h-d&&(p=d);m.scrollTop;m.scrollTop=m.scrollTop+p}}if(u||p)return}try{m=m.parentNode}catch(v){m=null}}s.autoScroll(e)};return s}))},"dojo/dnd/TimedMoveable":function(){define(["../_base/declare","./Moveable"],(function(e,t){var i=t.prototype.onMove;return e("dojo.dnd.TimedMoveable",t,{timeout:40,constructor:function(e,t){t||(t={});t.timeout&&"number"==typeof t.timeout&&t.timeout>=0&&(this.timeout=t.timeout)},onMoveStop:function(e){if(e._timer){clearTimeout(e._timer);i.call(this,e,e._leftTop)}t.prototype.onMoveStop.apply(this,arguments)},onMove:function(e,t){e._leftTop=t;if(!e._timer){var n=this;e._timer=setTimeout((function(){e._timer=null;i.call(n,e,e._leftTop)}),this.timeout)}}})}))},"dijit/focus":function(){define(["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/domReady","dojo/sniff","dojo/Stateful","dojo/_base/window","dojo/window","./a11y","./registry","./main"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_){var f,v,b=new(t([h,s],{curNode:null,activeStack:[],constructor:function(){var t=r.hitch(this,(function(e){i.isDescendant(this.curNode,e)&&this.set("curNode",null);i.isDescendant(this.prevNode,e)&&this.set("prevNode",null)}));e.before(a,"empty",t);e.before(a,"destroy",t)},registerIframe:function(e){return this.registerWin(e.contentWindow,e)},registerWin:function(e,t){var i=this,n=e.document&&e.document.body;if(n){var o=c("pointer-events")?"pointerdown":c("MSPointer")?"MSPointerDown":c("touch-events")?"mousedown, touchstart":"mousedown",a=l(e.document,o,(function(e){e&&e.target&&null==e.target.parentNode||i._onTouchNode(t||e.target,"mouse")})),s=l(n,"focusin",(function(e){if(e.target.tagName){var n=e.target.tagName.toLowerCase();"#document"!=n&&"body"!=n&&(m.isFocusable(e.target)?i._onFocusNode(t||e.target):i._onTouchNode(t||e.target))}})),r=l(n,"focusout",(function(e){i._onBlurNode(t||e.target)}));return{remove:function(){a.remove();s.remove();r.remove();a=s=r=null;n=null}}}},_onBlurNode:function(e){var t=(new Date).getTime();if(!(t<f+100)){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(r.hitch(this,(function(){this.set("prevNode",this.curNode);this.set("curNode",null)})),0);this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer);t<v+100||(this._clearActiveWidgetsTimer=setTimeout(r.hitch(this,(function(){delete this._clearActiveWidgetsTimer;this._setStack([])})),0))}},_onTouchNode:function(e,t){v=(new Date).getTime();if(this._clearActiveWidgetsTimer){clearTimeout(this._clearActiveWidgetsTimer);delete this._clearActiveWidgetsTimer}o.contains(e,"dijitPopup")&&(e=e.firstChild);var i=[];try{for(;e;){var a=n.get(e,"dijitPopupParent");if(a)e=g.byId(a).domNode;else if(e.tagName&&"body"==e.tagName.toLowerCase()){if(e===u.body())break;e=p.get(e.ownerDocument).frameElement}else{var s=e.getAttribute&&e.getAttribute("widgetId"),r=s&&g.byId(s);!r||"mouse"==t&&r.get("disabled")||i.unshift(s);e=e.parentNode}}}catch(l){}this._setStack(i,t)},_onFocusNode:function(e){if(e&&9!=e.nodeType){f=(new Date).getTime();if(this._clearFocusTimer){clearTimeout(this._clearFocusTimer);delete this._clearFocusTimer}this._onTouchNode(e);if(e!=this.curNode){this.set("prevNode",this.curNode);this.set("curNode",e)}}},_setStack:function(e,t){var i=this.activeStack,n=i.length-1,o=e.length-1;if(e[o]!=i[n]){this.set("activeStack",e);var a,s;for(s=n;s>=0&&i[s]!=e[s];s--)if(a=g.byId(i[s])){a._hasBeenBlurred=!0;a.set("focused",!1);a._focusManager==this&&a._onBlur(t);this.emit("widget-blur",a,t)}for(s++;s<=o;s++)if(a=g.byId(e[s])){a.set("focused",!0);a._focusManager==this&&a._onFocus(t);this.emit("widget-focus",a,t)}}},focus:function(e){if(e)try{e.focus()}catch(t){}}}));d((function(){var e=b.registerWin(p.get(document));c("ie")&&l(window,"unload",(function(){if(e){e.remove();e=null}}))}));_.focus=function(e){b.focus(e)};for(var y in b)/^_/.test(y)||(_.focus[y]="function"==typeof b[y]?r.hitch(b,y):b[y]);b.watch((function(e,t,i){_.focus[e]=i}));return b}))},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],(function(e,t,i,n){return e("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(e){var t=this._attrPairNames;return t[e]?t[e]:t[e]={s:"_"+e+"Setter",g:"_"+e+"Getter"}},postscript:function(e){e&&this.set(e)},_get:function(e,t){return"function"==typeof this[t.g]?this[t.g]():this[e]},get:function(e){return this._get(e,this._getAttrNames(e))},set:function(e,t){if("object"==typeof e){for(var i in e)e.hasOwnProperty(i)&&"_watchCallbacks"!=i&&this.set(i,e[i]);return this}var o,a=this._getAttrNames(e),s=this._get(e,a),r=this[a.s];"function"==typeof r?o=r.apply(this,Array.prototype.slice.call(arguments,1)):this[e]=t;if(this._watchCallbacks){var l=this;n(o,(function(){l._watchCallbacks(e,s,t)}))}return this},_changeAttrValue:function(e,t){var i=this.get(e);this[e]=t;this._watchCallbacks&&this._watchCallbacks(e,i,t);return this},watch:function(e,t){var n=this._watchCallbacks;if(!n){var o=this;n=this._watchCallbacks=function(e,t,i,a){var s=function(n){if(n)for(var a=0,s=(n=n.slice()).length;a<s;a++)n[a].call(o,e,t,i)};s(n["_"+e]);a||s(n["*"])}}if(t||"function"!=typeof e)e="_"+e;else{t=e;e="*"}var a=n[e];"object"!=typeof a&&(a=n[e]=[]);a.push(t);var s={};s.unwatch=s.remove=function(){var e=i.indexOf(a,t);e>-1&&a.splice(e,1)};return s}})}))},"dijit/a11y":function(){define(["dojo/_base/array","dojo/dom","dojo/dom-attr","dojo/dom-style","dojo/_base/lang","dojo/sniff","./main"],(function(e,t,i,n,o,a,s){var r,l={_isElementShown:function(e){var t=n.get(e);return"hidden"!=t.visibility&&"collapsed"!=t.visibility&&"none"!=t.display&&"hidden"!=i.get(e,"type")},hasDefaultTabStop:function(e){switch(e.nodeName.toLowerCase()){case"a":return i.has(e,"href");case"area":case"button":case"input":case"object":case"select":case"textarea":return!0;case"iframe":var t;try{var n=e.contentDocument;if("designMode"in n&&"on"==n.designMode)return!0;t=n.body}catch(o){try{t=e.contentWindow.document.body}catch(a){return!1}}return t&&("true"==t.contentEditable||t.firstChild&&"true"==t.firstChild.contentEditable);default:return"true"==e.contentEditable}},effectiveTabIndex:function(e){return i.get(e,"disabled")?r:i.has(e,"tabIndex")?+i.get(e,"tabIndex"):l.hasDefaultTabStop(e)?0:r},isTabNavigable:function(e){return l.effectiveTabIndex(e)>=0},isFocusable:function(e){return l.effectiveTabIndex(e)>=-1},_getTabNavigable:function(e){var t,n,o,s,r,d,c={};function h(e){return e&&"input"==e.tagName.toLowerCase()&&e.type&&"radio"==e.type.toLowerCase()&&e.name&&e.name.toLowerCase()}var u=l._isElementShown,p=l.effectiveTabIndex,m=function(e){for(var l=e.firstChild;l;l=l.nextSibling)if(!(1!=l.nodeType||a("ie")<=9&&"HTML"!==l.scopeName)&&u(l)){var g=p(l);if(g>=0){if(0==g){t||(t=l);n=l}else if(g>0){if(!o||g<s){s=g;o=l}if(!r||g>=d){d=g;r=l}}var _=h(l);i.get(l,"checked")&&_&&(c[_]=l)}"SELECT"!=l.nodeName.toUpperCase()&&m(l)}};u(e)&&m(e);function g(e){return c[h(e)]||e}return{first:g(t),last:g(n),lowest:g(o),highest:g(r)}},getFirstInTabbingOrder:function(e,i){var n=l._getTabNavigable(t.byId(e,i));return n.lowest?n.lowest:n.first},getLastInTabbingOrder:function(e,i){var n=l._getTabNavigable(t.byId(e,i));return n.last?n.last:n.highest}};o.mixin(s,l);return l}))},"dijit/main":function(){define(["dojo/_base/kernel"],(function(e){return e.dijit}))},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],(function(e,t,i){var n={},o={},a={length:0,add:function(e){if(o[e.id])throw new Error("Tried to register widget with id=="+e.id+" but that id is already registered");o[e.id]=e;this.length++},remove:function(e){if(o[e]){delete o[e];this.length--}},byId:function(e){return"string"==typeof e?o[e]:e},byNode:function(e){return o[e.getAttribute("widgetId")]},toArray:function(){var e=[];for(var t in o)e.push(o[t]);return e},getUniqueId:function(e){var t;do{t=e+"_"+(e in n?++n[e]:n[e]=0)}while(o[t]);return"dijit"==i._scopeName?t:i._scopeName+"_"+t},findWidgets:function(e,t){var i=[];!function e(n){for(var a=n.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var s=a.getAttribute("widgetId");if(s){var r=o[s];r&&i.push(r)}else a!==t&&e(a)}}(e);return i},_destroyAll:function(){i._curFocus=null;i._prevFocus=null;i._activeStack=[];e.forEach(a.findWidgets(t.body()),(function(e){e._destroyed||(e.destroyRecursive?e.destroyRecursive():e.destroy&&e.destroy())}))},getEnclosingWidget:function(e){for(;e;){var t=1==e.nodeType&&e.getAttribute("widgetId");if(t)return o[t];e=e.parentNode}return null},_hash:o};i.registry=a;return a}))},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang","../registry","../main"],(function(e,t,i,n,o){var a={};e.forEach(["byId","getUniqueId","findWidgets","_destroyAll","byNode","getEnclosingWidget"],(function(e){a[e]=n[e]}));i.mixin(a,{defaultDuration:t.defaultDuration||200});i.mixin(o,a);return o}))},"dijit/_Widget":function(){define(["dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/ready","./registry","./_WidgetBase","./_OnDijitClickMixin","./_FocusMixin","dojo/uacss","./hccss"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u){function p(){}function m(e){return function(t,n,o,a){return t&&"string"==typeof n&&t[n]==p?t.on(n.substring(2).toLowerCase(),s.hitch(o,a)):e.apply(i,arguments)}}e.around(i,"connect",m);a.connect&&e.around(a,"connect",m);var g=n("dijit._Widget",[c,h,u],{onClick:p,onDblClick:p,onKeyDown:p,onKeyPress:p,onKeyUp:p,onMouseDown:p,onMouseMove:p,onMouseOut:p,onMouseOver:p,onMouseLeave:p,onMouseEnter:p,onMouseUp:p,constructor:function(e){this._toConnect={};for(var t in e)if(this[t]===p){this._toConnect[t.replace(/^on/,"").toLowerCase()]=e[t];delete e[t]}},postCreate:function(){this.inherited(arguments);for(var e in this._toConnect)this.on(e,this._toConnect[e]);delete this._toConnect},on:function(e,t){return this[this._onMap(e)]===p?i.connect(this.domNode,e.toLowerCase(),this,t):this.inherited(arguments)},_setFocusedAttr:function(e){this._focused=e;this._set("focused",e)},setAttribute:function(e,t){a.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(e,t)},attr:function(e,t){var i=arguments.length;return i>=2||"object"==typeof e?this.set.apply(this,arguments):this.get(e)},getDescendants:function(){a.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?r("[widgetId]",this.containerNode).map(d.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});o("dijit-legacy-requires")&&l(0,(function(){require(["dijit/_base"])}));return g}))},"dijit/_WidgetBase":function(){define(["require","dojo/_base/array","dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/ready","dojo/Stateful","dojo/topic","dojo/_base/window","./Destroyable","dojo/has!dojo-bidi?./_BidiMixin","./registry"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_,f,v,b,y,w,C){u.add("dijit-legacy-requires",!p.isAsync);u.add("dojo-bidi",!1);u("dijit-legacy-requires")&&_(0,(function(){e(["dijit/_base/manager"])}));var k={};function x(e){var t={};for(var i in e)t[i.toLowerCase()]=!0;return t}function T(e){return function(t){r[t?"set":"remove"](this.domNode,e,t);this._set(e,t)}}var A=a("dijit._WidgetBase",[f,y],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:T("lang"),dir:"",_setDirAttr:T("dir"),class:"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(e){this._set("ownerDocument",e)},attributeMap:{},_blankGif:n.blankGif||e.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var e=this.constructor;if(!e._setterAttrs){var t=e.prototype,i=e._setterAttrs=[],n=e._onMap={};for(var o in t.attributeMap)i.push(o);for(o in t){/^on/.test(o)&&(n[o.substring(2).toLowerCase()]=o);if(/^_set[A-Z](.*)Attr$/.test(o)){o=o.charAt(4).toLowerCase()+o.substr(5,o.length-9);t.attributeMap&&o in t.attributeMap||i.push(o)}}}},postscript:function(e,t){this.create(e,t)},create:function(e,t){this._introspect();this.srcNodeRef=s.byId(t);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);if(e){this.params=e;m.mixin(this,e)}this.postMixInProperties();if(!this.id){this.id=C.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.params&&delete this.params.id}this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=b.body(this.ownerDocument);C.add(this);this.buildRendering();var i;if(this.domNode){this._applyAttributes();var n=this.srcNodeRef;if(n&&n.parentNode&&this.domNode!==n){n.parentNode.replaceChild(this.domNode,n);i=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();i&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var e={};for(var i in this.params||{})e[i]=this._get(i);t.forEach(this.constructor._setterAttrs,(function(t){if(!(t in e)){var i=this._get(t);i&&this.set(t,i)}}),this);for(i in e)this.set(i,e[i])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var e=this.baseClass.split(" ");this.isLeftToRight()||(e=e.concat(t.map(e,(function(e){return e+"Rtl"}))));l.add(this.domNode,e)}},postCreate:function(){},startup:function(){if(!this._started){this._started=!0;t.forEach(this.getChildren(),(function(e){if(!e._started&&!e._destroyed&&m.isFunction(e.startup)){e.startup();e._started=!0}}))}},destroyRecursive:function(e){this._beingDestroyed=!0;this.destroyDescendants(e);this.destroy(e)},destroy:function(e){this._beingDestroyed=!0;this.uninitialize();function i(t){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e)}t.forEach(this._connects,m.hitch(this,"disconnect"));t.forEach(this._supportingWidgets,i);this.domNode&&t.forEach(C.findWidgets(this.domNode,this.containerNode),i);this.destroyRendering(e);C.remove(this.id);this._destroyed=!0},destroyRendering:function(e){if(this.bgIframe){this.bgIframe.destroy(e);delete this.bgIframe}if(this.domNode){e?r.remove(this.domNode,"widgetId"):d.destroy(this.domNode);delete this.domNode}if(this.srcNodeRef){e||d.destroy(this.srcNodeRef);delete this.srcNodeRef}},destroyDescendants:function(e){t.forEach(this.getChildren(),(function(t){t.destroyRecursive&&t.destroyRecursive(e)}))},uninitialize:function(){return!1},_setStyleAttr:function(e){var t=this.domNode;m.isObject(e)?h.set(t,e):t.style.cssText?t.style.cssText+="; "+e:t.style.cssText=e;this._set("style",e)},_attrToDom:function(e,i,n){n=arguments.length>=3?n:this.attributeMap[e];t.forEach(m.isArray(n)?n:[n],(function(t){var n=this[t.node||t||"domNode"];switch(t.type||"attribute"){case"attribute":m.isFunction(i)&&(i=m.hitch(this,i));var o=t.attribute?t.attribute:/^on[A-Z][a-zA-Z]*$/.test(e)?e.toLowerCase():e;n.tagName?r.set(n,o,i):n.set(o,i);break;case"innerText":n.innerHTML="";n.appendChild(this.ownerDocument.createTextNode(i));break;case"textContent":n.textContent=i;break;case"innerHTML":n.innerHTML=i;break;case"class":l.replace(n,i,this[e]);break;case"toggleClass":l.toggle(n,t.className||e,i)}}),this)},get:function(e){var t=this._getAttrNames(e);return this[t.g]?this[t.g]():this._get(e)},set:function(e,t){if("object"==typeof e){for(var i in e)this.set(i,e[i]);return this}var n=this._getAttrNames(e),o=this[n.s];if(m.isFunction(o))var a=o.apply(this,Array.prototype.slice.call(arguments,1));else{var s=this.focusNode&&!m.isFunction(this.focusNode)?"focusNode":"domNode",r=this[s]&&this[s].tagName,l=r&&(k[r]||(k[r]=x(this[s]))),d=e in this.attributeMap?this.attributeMap[e]:n.s in this?this[n.s]:l&&n.l in l&&"function"!=typeof t||/^aria-|^data-|^role$/.test(e)?s:null;null!=d&&this._attrToDom(e,t,d);this._set(e,t)}return a||this},_attrPairNames:{},_getAttrNames:function(e){var t=this._attrPairNames;if(t[e])return t[e];var i=e.replace(/^[a-z]|-[a-zA-Z]/g,(function(e){return e.charAt(e.length-1).toUpperCase()}));return t[e]={n:e+"Node",s:"_set"+i+"Attr",g:"_get"+i+"Attr",l:i.toLowerCase()}},_set:function(e,t){var i,n,o=this[e];this[e]=t;if(this._created&&!(i=o,n=t,i===n||i!=i&&n!=n)){this._watchCallbacks&&this._watchCallbacks(e,o,t);this.emit("attrmodified-"+e,{detail:{prevValue:o,newValue:t}})}},_get:function(e){return this[e]},emit:function(e,t,i){void 0===(t=t||{}).bubbles&&(t.bubbles=!0);void 0===t.cancelable&&(t.cancelable=!0);t.detail||(t.detail={});t.detail.widget=this;var n,o=this["on"+e];o&&(n=o.apply(this,i||[t]));this._started&&!this._beingDestroyed&&g.emit(this.domNode,e.toLowerCase(),t);return n},on:function(e,t){var n=this._onMap(e);return n?i.after(this,n,t,!0):this.own(g(this.domNode,e,t))[0]},_onMap:function(e){var t=this.constructor,i=t._onMap;if(!i){i=t._onMap={};for(var n in t.prototype)/^on/.test(n)&&(i[n.replace(/^on/,"").toLowerCase()]=n)}return i["string"==typeof e&&e.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?C.findWidgets(this.containerNode):[]},getParent:function(){return C.getEnclosingWidget(this.domNode.parentNode)},connect:function(e,t,i){return this.own(o.connect(e,t,this,i))[0]},disconnect:function(e){e.remove()},subscribe:function(e,t){return this.own(v.subscribe(e,m.hitch(this,t)))[0]},unsubscribe:function(e){e.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=h.get(this.domNode,"display")},placeAt:function(e,t){var i=!e.tagName&&C.byId(e);if(!i||!i.addChild||t&&"number"!=typeof t){var n=i&&"domNode"in i?i.containerNode&&!/after|before|replace/.test(t||"")?i.containerNode:i.domNode:s.byId(e,this.ownerDocument);d.place(this.domNode,n,t);!this._started&&(this.getParent()||{})._started&&this.startup()}else i.addChild(this,t);return this},defer:function(e,t){var i=setTimeout(m.hitch(this,(function(){if(i){i=null;this._destroyed||m.hitch(this,e)()}})),t||0);return{remove:function(){if(i){clearTimeout(i);i=null}return null}}}});u("dojo-bidi")&&A.extend(w);return A}))},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],(function(e,t,i){return i("dijit.Destroyable",null,{destroy:function(e){this._destroyed=!0},own:function(){var i=["destroyRecursive","destroy","remove"];e.forEach(arguments,(function(n){var o,a=t.before(this,"destroy",(function(e){n[o](e)})),s=[];function r(){a.remove();e.forEach(s,(function(e){e.remove()}))}if(n.then){o="cancel";n.then(r,r)}else e.forEach(i,(function(e){if("function"==typeof n[e]){o||(o=e);s.push(t.after(n,e,r,!0))}}))}),this);return arguments}})}))},"dijit/_OnDijitClickMixin":function(){define(["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","./a11yclick"],(function(e,t,i,n,o,a){var s=n("dijit._OnDijitClickMixin",null,{connect:function(e,t,i){return this.inherited(arguments,[e,"ondijitclick"==t?a:t,i])}});s.a11yclick=a;return s}))},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],(function(e,t,i,n){function o(t){if((t.keyCode===e.ENTER||t.keyCode===e.SPACE)&&!/input|button|textarea/i.test(t.target.nodeName))for(var i=t.target;i;i=i.parentNode)if(i.dojoClick)return!0}var a;i(document,"keydown",(function(e){if(o(e)){a=e.target;e.preventDefault()}else a=null}));i(document,"keyup",(function(e){if(o(e)&&e.target==a){a=null;i.emit(e.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,_origType:e.type})}}));var s=function(e,t){e.dojoClick=!0;return i(e,"click",t)};s.click=s;s.press=function(o,a){var s=i(o,n.press,(function(e){("mousedown"!=e.type||t.isLeft(e))&&a(e)})),r=i(o,"keydown",(function(t){t.keyCode!==e.ENTER&&t.keyCode!==e.SPACE||a(t)}));return{remove:function(){s.remove();r.remove()}}};s.release=function(o,a){var s=i(o,n.release,(function(e){("mouseup"!=e.type||t.isLeft(e))&&a(e)})),r=i(o,"keyup",(function(t){t.keyCode!==e.ENTER&&t.keyCode!==e.SPACE||a(t)}));return{remove:function(){s.remove();r.remove()}}};s.move=n.move;return s}))},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],(function(e,t,i,n){n.extend(t,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return i("dijit._FocusMixin",null,{_focusManager:e})}))},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],(function(e,t,i,n,o){var a=o.doc.documentElement,s=n("ie"),r=n("trident"),l=n("opera"),d=Math.floor,c=n("ff"),h=e.boxModel.replace(/-/,""),u={dj_quirks:n("quirks"),dj_opera:l,dj_khtml:n("khtml"),dj_webkit:n("webkit"),dj_safari:n("safari"),dj_chrome:n("chrome"),dj_edge:n("edge"),dj_gecko:n("mozilla"),dj_ios:n("ios"),dj_android:n("android")};if(s){u.dj_ie=!0;u["dj_ie"+d(s)]=!0;u.dj_iequirks=n("quirks")}if(r){u.dj_trident=!0;u["dj_trident"+d(r)]=!0}c&&(u["dj_ff"+d(c)]=!0);u["dj_"+h]=!0;var p="";for(var m in u)u[m]&&(p+=m+" ");a.className=t.trim(a.className+" "+p);i((function(){if(!e.isBodyLtr()){var i="dj_rtl dijitRtl "+p.replace(/ /g,"-rtl ");a.className=t.trim(a.className+" "+i+"dj_rtl dijitRtl "+p.replace(/ /g,"-rtl "))}}));return n}))},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],(function(e,t,i,n){i((function(){t("highcontrast")&&e.add(n.body(),"dijit_a11y")}));return t}))},"dojo/hccss":function(){define(["require","./_base/config","./dom-class","./dom-style","./has","./domReady","./_base/window"],(function(e,t,i,n,o,a,s){o.add("highcontrast",(function(){var i=s.doc.createElement("div");try{i.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(t.blankGif||e.toUrl("./resources/blank.gif"))+'");';s.body().appendChild(i);var a=n.getComputedStyle(i),r=a.backgroundImage;return a.borderTopColor==a.borderRightColor||r&&("none"==r||"url(invalid-url:)"==r)}catch(l){return!1}finally{o("ie")<=8?i.outerHTML="":s.body().removeChild(i)}}));a((function(){o("highcontrast")&&i.add(s.body(),"dj_a11y")}));return o}))},"dijit/_TemplatedMixin":function(){define(["dojo/cache","dojo/_base/declare","dojo/dom-construct","dojo/_base/lang","dojo/on","dojo/sniff","dojo/string","./_AttachMixin"],(function(e,t,i,n,o,a,s,r){var l=t("dijit._TemplatedMixin",r,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(e){var t=this.declaredClass,i=this;return s.substitute(e,this,(function(e,o){"!"==o.charAt(0)&&(e=n.getObject(o.substr(1),!1,i));if(void 0===e)throw new Error(t+" template:"+o);return null==e?"":"!"==o.charAt(0)?e:this._escapeValue(""+e)}),this)},_escapeValue:function(e){return e.replace(/["'<>&]/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}[e]}))},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=e(this.templatePath,{sanitize:!0}));var t,o=l.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);if(n.isString(o)){if(1!=(t=i.toDom(this._stringRepl(o),this.ownerDocument)).nodeType)throw new Error("Invalid template: "+o)}else t=o.cloneNode(!0);this.domNode=t}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(e){var t=this.containerNode;if(e&&t)for(;e.hasChildNodes();)t.appendChild(e.firstChild)}});l._templateCache={};l.getCachedTemplate=function(e,t,n){var o=l._templateCache,a=e,r=o[a];if(r){try{if(!r.ownerDocument||r.ownerDocument==(n||document))return r}catch(c){}i.destroy(r)}e=s.trim(e);if(t||e.match(/\$\{([^\}]+)\}/g))return o[a]=e;var d=i.toDom(e,n);if(1!=d.nodeType)throw new Error("Invalid template: "+e);return o[a]=d};a("ie")&&o(window,"unload",(function(){var e=l._templateCache;for(var t in e){var n=e[t];"object"==typeof n&&i.destroy(n);delete e[t]}}));return l}))},"dojo/cache":function(){define(["./_base/kernel","./text"],(function(e){return e.cache}))},"dojo/text":function(){define(["./_base/kernel","require","./has","./request"],(function(e,t,i,n){var o;o=function(e,t,i){n(e,{sync:!!t,headers:{"X-Requested-With":null}}).then(i)};var a={},s=function(e){if(e){var t=(e=e.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"")).match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);t&&(e=t[1])}else e="";return e},r={},l={};e.cache=function(e,i,n){var r;if("string"==typeof e)if(/\//.test(e)){r=e;n=i}else r=t.toUrl(e.replace(/\./g,"/")+(i?"/"+i:""));else{r=e+"";n=i}var l=null!=n&&"string"!=typeof n?n.value:n,d=n&&n.sanitize;if("string"==typeof l){a[r]=l;return d?s(l):l}if(null===l){delete a[r];return null}r in a||o(r,!0,(function(e){a[r]=e}));return d?s(a[r]):a[r]};return{dynamic:!0,normalize:function(e,t){var i=e.split("!"),n=i[0];return(/^\./.test(n)?t(n):n)+(i[1]?"!"+i[1]:"")},load:function(e,t,i){var n=e.split("!"),d=n.length>1,c=n[0],h=t.toUrl(n[0]),u="url:"+h,p=r,m=function(e){i(d?s(e):e)};c in a?p=a[c]:t.cache&&u in t.cache?p=t.cache[u]:h in a&&(p=a[h]);if(p===r)if(l[h])l[h].push(m);else{var g=l[h]=[m];o(h,!t.async,(function(e){a[c]=a[h]=e;for(var t=0;t<g.length;)g[t++](e);delete l[h]}))}else m(p)}}}))},"dojo/request":function(){define(["./request/default!"],(function(e){return e}))},"dojo/request/default":function(){define(["exports","require","../has"],(function(e,t,i){var n,o=i("config-requestProvider");n="./xhr";o||(o=n);e.getPlatformDefaultId=function(){return n};e.load=function(e,i,a,s){t(["platform"==e?n:o],(function(e){a(e)}))}}))},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],(function(e,t){var i=/[&<>'"\/]/g,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},o={};t.setObject("dojo.string",o);o.escape=function(e){return e?e.replace(i,(function(e){return n[e]})):""};o.rep=function(e,t){if(t<=0||!e)return"";for(var i=[];;){1&t&&i.push(e);if(!(t>>=1))break;e+=e}return i.join("")};o.pad=function(e,t,i,n){i||(i="0");var a=String(e),s=o.rep(i,Math.ceil((t-a.length)/i.length));return n?a+s:s+a};o.substitute=function(i,n,o,a){a=a||e.global;o=o?t.hitch(a,o):function(e){return e};return i.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(function(e,i,s){if(""==i)return"$";var r=t.getObject(i,!1,n);s&&(r=t.getObject(s,!1,a).call(a,r,i));var l=o(r,i);if(void 0===l)throw new Error('string.substitute could not find key "'+i+'" in template');return l.toString()}))};o.trim=String.prototype.trim?t.trim:function(e){for(var t=(e=e.replace(/^\s+/,"")).length-1;t>=0;t--)if(/\S/.test(e.charAt(t))){e=e.substring(0,t+1);break}return e};return o}))},"dijit/_AttachMixin":function(){define(["require","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/mouse","dojo/on","dojo/touch","./_WidgetBase"],(function(e,t,i,n,o,a,s,r,l){var d,c=o.delegate(r,{mouseenter:a.enter,mouseleave:a.leave,keypress:i._keypress}),h=n("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(e){for(var t=e;;)if(1==t.nodeType&&(this._processTemplateNode(t,(function(e,t){return e.getAttribute(t)}),this._attach)||this.searchContainerNode)&&t.firstChild)t=t.firstChild;else{if(t==e)return;for(;!t.nextSibling;)if((t=t.parentNode)==e)return;t=t.nextSibling}},_processTemplateNode:function(e,t,i){var n=!0,a=this.attachScope||this,s=t(e,"dojoAttachPoint")||t(e,"data-dojo-attach-point");if(s)for(var r,l=s.split(/\s*,\s*/);r=l.shift();){o.isArray(a[r])?a[r].push(e):a[r]=e;n="containerNode"!=r;this._attachPoints.push(r)}var d=t(e,"dojoAttachEvent")||t(e,"data-dojo-attach-event");if(d)for(var c,h=d.split(/\s*,\s*/),u=o.trim;c=h.shift();)if(c){var p=null;if(-1!=c.indexOf(":")){var m=c.split(":");c=u(m[0]);p=u(m[1])}else c=u(c);p||(p=c);this._attachEvents.push(i(e,c,o.hitch(a,p)))}return n},_attach:function(t,i,n){i="dijitclick"==(i=i.replace(/^on/,"").toLowerCase())?d||(d=e("./a11yclick")):c[i]||i;return s(t,i,n)},_detachTemplateNodes:function(){var e=this.attachScope||this;t.forEach(this._attachPoints,(function(t){delete e[t]}));this._attachPoints=[];t.forEach(this._attachEvents,(function(e){e.remove()}));this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});o.extend(l,{dojoAttachEvent:"",dojoAttachPoint:""});return h}))},"dijit/_CssStateMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/has","dojo/_base/lang","dojo/on","dojo/domReady","dojo/touch","dojo/_base/window","./a11yclick","./registry"],(function(e,t,i,n,o,a,s,r,l,d,c,h){var u=t("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);e.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active","_opened"],(function(e){this.watch(e,a.hitch(this,"_setStateClass"))}),this);for(var t in this.cssStateNodes||{})this._trackMouseState(this[t],this.cssStateNodes[t]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(e){if(!this.disabled)switch(e.type){case"mouseover":case"MSPointerOver":case"pointerover":this._set("hovering",!0);this._set("active",this._mouseDown);break;case"mouseout":case"MSPointerOut":case"pointerout":this._set("hovering",!1);this._set("active",!1);break;case"mousedown":case"touchstart":case"MSPointerDown":case"pointerdown":case"keydown":this._set("active",!0);break;case"mouseup":case"dojotouchend":case"MSPointerUp":case"pointerup":case"keyup":this._set("active",!1)}},_setStateClass:function(){var t=this.baseClass.split(" ");function i(i){t=t.concat(e.map(t,(function(e){return e+i})),"dijit"+i)}this.isLeftToRight()||i("Rtl");var n="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&i(n);this.state&&i(this.state);this.selected&&i("Selected");this._opened&&i("Opened");this.disabled?i("Disabled"):this.readOnly?i("ReadOnly"):this.active?i("Active"):this.hovering&&i("Hover");this.focused&&i("Focused");var o=this.stateNode||this.domNode,a={};e.forEach(o.className.split(" "),(function(e){a[e]=!0}));"_stateClasses"in this&&e.forEach(this._stateClasses,(function(e){delete a[e]}));e.forEach(t,(function(e){a[e]=!0}));var s=[];for(var r in a)s.push(r);o.className=s.join(" ");this._stateClasses=t},_subnodeCssMouseEvent:function(e,t,i){if(!this.disabled&&!this.readOnly)switch(i.type){case"mouseover":case"MSPointerOver":case"pointerover":o(!0);break;case"mouseout":case"MSPointerOut":case"pointerout":o(!1);a(!1);break;case"mousedown":case"touchstart":case"MSPointerDown":case"pointerdown":case"keydown":a(!0);break;case"mouseup":case"MSPointerUp":case"pointerup":case"dojotouchend":case"keyup":a(!1);break;case"focus":case"focusin":s(!0);break;case"blur":case"focusout":s(!1)}function o(i){n.toggle(e,t+"Hover",i)}function a(i){n.toggle(e,t+"Active",i)}function s(i){n.toggle(e,t+"Focused",i)}},_trackMouseState:function(e,t){e._cssState=t}});r((function(){function e(e,t,n){if(!n||!i.isDescendant(n,t))for(var o=t;o&&o!=n;o=o.parentNode)if(o._cssState){var a=h.getEnclosingWidget(o);a&&(o==a.domNode?a._cssMouseEvent(e):a._subnodeCssMouseEvent(o,o._cssState,e))}}var t,n=d.body();s(n,l.over,(function(t){e(t,t.target,t.relatedTarget)}));s(n,l.out,(function(t){e(t,t.target,t.relatedTarget)}));s(n,c.press,(function(i){e(i,t=i.target)}));s(n,c.release,(function(i){e(i,t);t=null}));s(n,"focusin, focusout",(function(e){var t=e.target;if(t._cssState&&!t.getAttribute("widgetId")){var i=h.getEnclosingWidget(t);i&&i._subnodeCssMouseEvent(t,t._cssState,e)}}))}));return u}))},"dijit/form/_FormMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/window"],(function(e,t,i,n,o,a){return t("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(t){var i=[];e.forEach(t||this.getChildren(),(function(e){"value"in e?i.push(e):i=i.concat(this._getDescendantFormWidgets(e.getChildren()))}),this);return i},reset:function(){e.forEach(this._getDescendantFormWidgets(),(function(e){e.reset&&e.reset()}))},validate:function(){var t=!1;return e.every(e.map(this._getDescendantFormWidgets(),(function(e){e._hasBeenBlurred=!0;var i=e.disabled||!e.validate||e.validate();if(!i&&!t){a.scrollIntoView(e.containerNode||e.domNode);e.focus();t=!0}return i})),(function(e){return e}))},setValues:function(e){i.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",e)},_setValueAttr:function(t){var i={};e.forEach(this._getDescendantFormWidgets(),(function(e){if(e.name){(i[e.name]||(i[e.name]=[])).push(e)}}));for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],s=n.getObject(o,!1,t);if(void 0!==s){s=[].concat(s);"boolean"==typeof a[0].checked?e.forEach(a,(function(t){t.set("value",-1!=e.indexOf(s,t._get("value")))})):a[0].multiple?a[0].set("value",s):e.forEach(a,(function(e,t){e.set("value",s[t])}))}}},getValues:function(){i.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var t={};e.forEach(this._getDescendantFormWidgets(),(function(e){var i=e.name;if(i&&!e.disabled){var o=e.get("value");if("boolean"==typeof e.checked)if(/Radio/.test(e.declaredClass))!1!==o?n.setObject(i,o,t):void 0===(o=n.getObject(i,!1,t))&&n.setObject(i,null,t);else{var a=n.getObject(i,!1,t);if(!a){a=[];n.setObject(i,a,t)}!1!==o&&a.push(o)}else{var s=n.getObject(i,!1,t);void 0!==s?n.isArray(s)?s.push(o):n.setObject(i,[s,o],t):n.setObject(i,o,t)}}}));return t},isValid:function(){return""==this.state},onValidStateChange:function(){},_getState:function(){var t=e.map(this._descendants,(function(e){return e.get("state")||""}));return e.indexOf(t,"Error")>=0?"Error":e.indexOf(t,"Incomplete")>=0?"Incomplete":""},disconnectChildren:function(){},connectChildren:function(t){this._descendants=this._getDescendantFormWidgets();e.forEach(this._descendants,(function(e){e._started||e.startup()}));t||this._onChildChange()},_onChildChange:function(e){e&&"state"!=e&&"disabled"!=e||this._set("state",this._getState());if(!e||"value"==e||"disabled"==e||"checked"==e){this._onChangeDelayTimer&&this._onChangeDelayTimer.remove();this._onChangeDelayTimer=this.defer((function(){delete this._onChangeDelayTimer;this._set("value",this.get("value"))}),10)}},startup:function(){this.inherited(arguments);this._descendants=this._getDescendantFormWidgets();this.value=this.get("value");this.state=this._getState();var e=this;this.own(o(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",(function(t){t.target!=e.domNode&&e._onChildChange(t.type.replace("attrmodified-",""))})));this.watch("state",(function(e,t,i){this.onValidStateChange(""==i)}))},destroy:function(){this.inherited(arguments)}})}))},"dijit/_DialogMixin":function(){define(["dojo/_base/declare","./a11y"],(function(e,t){return e("dijit._DialogMixin",null,{actionBarTemplate:"",execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var e=t._getTabNavigable(this.domNode);this._firstFocusItem=e.lowest||e.first||this.closeButtonNode||this.domNode;this._lastFocusItem=e.last||e.highest||this._firstFocusItem}})}))},"dijit/DialogUnderlay":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-attr","dojo/dom-style","dojo/on","dojo/window","./_Widget","./_TemplatedMixin","./BackgroundIframe","./Viewport","./main"],(function(e,t,i,n,o,a,s,r,l,d,c,h){var u=e("dijit.DialogUnderlay",[r,l],{templateString:"<div class='dijitDialogUnderlayWrapper'><div class='dijitDialogUnderlay' tabIndex='-1' data-dojo-attach-point='node'></div></div>",dialogId:"",class:"",_modalConnects:[],_setDialogIdAttr:function(e){n.set(this.node,"id",e+"_underlay");this._set("dialogId",e)},_setClassAttr:function(e){this.node.className="dijitDialogUnderlay "+e;this._set("class",e)},postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.own(a(this.domNode,"keydown",t.hitch(this,"_onKeyDown")));this.inherited(arguments)},layout:function(){var e=this.node.style,t=this.domNode.style;t.display="none";var i=s.getBox(this.ownerDocument);t.top=i.t+"px";t.left=i.l+"px";e.width=i.w+"px";e.height=i.h+"px";t.display="block"},show:function(){this.domNode.style.display="block";this.open=!0;this.layout();this.bgIframe=new d(this.domNode);var e=s.get(this.ownerDocument);this._modalConnects=[c.on("resize",t.hitch(this,"layout")),a(e,"scroll",t.hitch(this,"layout"))]},hide:function(){this.bgIframe.destroy();delete this.bgIframe;this.domNode.style.display="none";for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.open=!1},destroy:function(){for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.inherited(arguments)},_onKeyDown:function(){}});u.show=function(e,t){var i=u._singleton;!i||i._destroyed?i=h._underlay=u._singleton=new u(e):e&&i.set(e);o.set(i.domNode,"zIndex",t);i.open||i.show()};u.hide=function(){var e=u._singleton;e&&!e._destroyed&&e.hide()};return u}))},"dijit/BackgroundIframe":function(){define(["require","./main","dojo/_base/config","dojo/dom-construct","dojo/dom-style","dojo/_base/lang","dojo/on","dojo/sniff"],(function(e,t,i,n,o,a,s,r){r.add("config-bgIframe",(r("ie")||r("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var l=new function(){var t=[];this.pop=function(){var a;if(t.length)(a=t.pop()).style.display="";else{if(r("ie")<9){var s="<iframe src='"+(i.dojoBlankHtmlUrl||e.toUrl("dojo/resources/blank.html")||'javascript:""')+"' role='presentation' style='position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity=\"0\");'>";a=document.createElement(s)}else{(a=n.create("iframe")).src='javascript:""';a.className="dijitBackgroundIframe";a.setAttribute("role","presentation");o.set(a,"opacity",.1)}a.tabIndex=-1}return a};this.push=function(e){e.style.display="none";t.push(e)}};t.BackgroundIframe=function(e){if(!e.id)throw new Error("no id");if(r("config-bgIframe")){var t=this.iframe=l.pop();e.appendChild(t);if(r("ie")<7||r("quirks")){this.resize(e);this._conn=s(e,"resize",a.hitch(this,"resize",e))}else o.set(t,{width:"100%",height:"100%"})}};a.extend(t.BackgroundIframe,{resize:function(e){this.iframe&&o.set(this.iframe,{width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},destroy:function(){if(this._conn){this._conn.remove();this._conn=null}if(this.iframe){this.iframe.parentNode.removeChild(this.iframe);l.push(this.iframe);delete this.iframe}}});return t.BackgroundIframe}))},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],(function(e,t,i,n,o){var a,s=new e;i((function(){var e=o.getBox();s._rlh=t(window,"resize",(function(){var t=o.getBox();if(e.h!=t.h||e.w!=t.w){e=t;s.emit("resize")}}));if(8==n("ie")){var i=screen.deviceXDPI;setInterval((function(){if(screen.deviceXDPI!=i){i=screen.deviceXDPI;s.emit("resize")}}),500)}if(n("ios")){t(document,"focusin",(function(e){a=e.target}));t(document,"focusout",(function(e){a=null}))}}));s.getEffectiveBox=function(e){var t=o.getBox(e),i=a&&a.tagName&&a.tagName.toLowerCase();if(n("ios")&&a&&!a.readOnly&&("textarea"==i||"input"==i&&/^(color|email|number|password|search|tel|text|url)$/.test(a.type))){t.h*=0==orientation||180==orientation?.66:.4;var s=a.getBoundingClientRect();t.h=Math.max(t.h,s.top+s.height)}return t};return s}))},"dijit/layout/ContentPane":function(){define(["dojo/_base/kernel","dojo/_base/lang","../_Widget","../_Container","./_ContentPaneResizeMixin","dojo/string","dojo/html","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/_base/xhr","dojo/i18n","dojo/when","dojo/i18n!../nls/loading"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g){return l("dijit.layout.ContentPane",[i,n,o],{href:"",content:"",extractContent:!1,parseOnLoad:!0,parserScope:e._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"<span class='dijitContentPaneLoading'><span class='dijitInline dijitIconLoading'></span>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'><span class='dijitInline dijitIconError'></span>${errorState}</span>",isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(e,t,i){var n=new i(e,t);return!n.href&&n._contentSetter&&n._contentSetter.parseDeferred&&!n._contentSetter.parseDeferred.isFulfilled()?n._contentSetter.parseDeferred.then((function(){return n})):n},create:function(e,i){if((!e||!e.template)&&i&&!("href"in e)&&!("content"in e)){for(var n=(i=c.byId(i)).ownerDocument.createDocumentFragment();i.firstChild;)n.appendChild(i.firstChild);e=t.delegate(e,{content:n})}this.inherited(arguments,[e,i])},postMixInProperties:function(){this.inherited(arguments);var e=m.getLocalization("dijit","loading",this.lang);this.loadingMessage=a.substitute(this.loadingMessage,e);this.errorMessage=a.substitute(this.errorMessage,e)},buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments);this._contentSetter&&r.forEach(this._contentSetter.parseResults,(function(e){if(!e._started&&!e._destroyed&&t.isFunction(e.startup)){e.startup();e._started=!0}}),this)},_startChildren:function(){r.forEach(this.getChildren(),(function(e){if(!e._started&&!e._destroyed&&t.isFunction(e.startup)){e.startup();e._started=!0}}));this._contentSetter&&r.forEach(this._contentSetter.parseResults,(function(e){if(!e._started&&!e._destroyed&&t.isFunction(e.startup)){e.startup();e._started=!0}}),this)},setHref:function(t){e.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.","","2.0");return this.set("href",t)},_setHrefAttr:function(e){this.cancel();this.onLoadDeferred=new d(t.hitch(this,"cancel"));this.onLoadDeferred.then(t.hitch(this,"onLoad"));this._set("href",e);this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0;return this.onLoadDeferred},setContent:function(t){e.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",t)},_setContentAttr:function(e){this._set("href","");this.cancel();this.onLoadDeferred=new d(t.hitch(this,"cancel"));this._created&&this.onLoadDeferred.then(t.hitch(this,"onLoad"));this._setContent(e||"");this._isDownloaded=!1;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},destroy:function(){this.cancel();this.inherited(arguments)},destroyRecursive:function(e){this._beingDestroyed||this.inherited(arguments)},_onShow:function(){this.inherited(arguments);if(this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))return this.refresh()},refresh:function(){this.cancel();this.onLoadDeferred=new d(t.hitch(this,"cancel"));this.onLoadDeferred.then(t.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),!0);var e=this,i={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};t.isObject(this.ioArgs)&&t.mixin(i,this.ioArgs);var n,o=this._xhrDfd=(this.ioMethod||p.get)(i);o.then((function(t){n=t;try{e._isDownloaded=!0;return e._setContent(t,!1)}catch(i){e._onError("Content",i)}}),(function(t){o.canceled||e._onError("Download",t);delete e._xhrDfd;return t})).then((function(){e.onDownloadEnd();delete e._xhrDfd;return n}));delete this._hrefChanged},_onLoadHandler:function(e){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(e)}catch(t){}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(e){}},destroyDescendants:function(e){this.isLoaded&&this._onUnloadHandler();var t=this._contentSetter;r.forEach(this.getChildren(),(function(t){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e);t._destroyed=!0}));if(t){r.forEach(t.parseResults,(function(t){if(!t._destroyed){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e);t._destroyed=!0}}));delete t.parseResults}e||u.empty(this.containerNode);delete this._singleChild},_setContent:function(e,i){e=this.preprocessContent(e);this.destroyDescendants();var n=this._contentSetter;n&&n instanceof s._ContentSetter||(n=this._contentSetter=new s._ContentSetter({node:this.containerNode,_onError:t.hitch(this,this._onError),onContentError:t.hitch(this,(function(e){var t=this.onContentError(e);try{this.containerNode.innerHTML=t}catch(e){}}))}));var o=t.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!e.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{}),a=n.set(t.isObject(e)&&e.domNode?e.domNode:e,o),r=this;return g(a&&a.then?a:n.parseDeferred,(function(){delete r._contentSetterParams;if(!i){if(r._started){r._startChildren();r._scheduleLayout()}r._onLoadHandler(e)}}))},preprocessContent:function(e){return e},_onError:function(e,t,i){this.onLoadDeferred.reject(t);var n=this["on"+e+"Error"].call(this,t);i||n&&this._setContent(n,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})}))},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],(function(e,t,i,n){return t("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(e,t){var n=this.containerNode;if(t>0){n=n.firstChild;for(;t>0;){1==n.nodeType&&t--;n=n.nextSibling}if(n)t="before";else{n=this.containerNode;t="last"}}i.place(e.domNode,n,t);this._started&&!e._started&&e.startup()},removeChild:function(e){"number"==typeof e&&(e=this.getChildren()[e]);if(e){var t=e.domNode;t&&t.parentNode&&t.parentNode.removeChild(t)}},hasChildren:function(){return this.getChildren().length>0},_getSiblingOfChild:function(t,i){var n=this.getChildren();return n[e.indexOf(n,t)+i]},getIndexOfChild:function(t){return e.indexOf(this.getChildren(),t)}})}))},"dijit/layout/_ContentPaneResizeMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang","dojo/query","../registry","../Viewport","./utils"],(function(e,t,i,n,o,a,s,r,l,d){return t("dijit.layout._ContentPaneResizeMixin",null,{doLayout:!0,isLayoutContainer:!0,startup:function(){if(!this._started){var e=this.getParent();this._childOfLayoutWidget=e&&e.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._isShown()&&this._onShow();this._childOfLayoutWidget||this.own(l.on("resize",a.hitch(this,"resize")))}},_checkIfSingleChild:function(){if(this.doLayout){var e=[],t=!1;s("> *",this.containerNode).some((function(i){var n=r.byNode(i);n&&n.resize?e.push(n):!/script|link|style/i.test(i.nodeName)&&i.offsetHeight&&(t=!0)}));this._singleChild=1!=e.length||t?null:e[0];i.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)}},resize:function(e,t){this._resizeCalled=!0;this._scheduleLayout(e,t)},_scheduleLayout:function(e,t){if(this._isShown())this._layout(e,t);else{this._needLayout=!0;this._changeSize=e;this._resultSize=t}},_layout:function(e,t){delete this._needLayout;this._wasShown||!1===this.open||this._onShow();e&&n.setMarginBox(this.domNode,e);var i=this.containerNode;if(i===this.domNode){var o=t||{};a.mixin(o,e||{});"h"in o&&"w"in o||(o=a.mixin(n.getMarginBox(i),o));this._contentBox=d.marginBox2contentBox(i,o)}else this._contentBox=n.getContentBox(i);this._layoutChildren()},_layoutChildren:function(){this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var e=this._contentBox||n.getContentBox(this.containerNode);this._singleChild.resize({w:e.w,h:e.h})}else for(var t,i=this.getChildren(),o=0;t=i[o++];)t.resize&&t.resize()},_isShown:function(){if(this._childOfLayoutWidget)return this._resizeCalled&&"open"in this?this.open:this._resizeCalled;if("open"in this)return this.open;var e=this.domNode,t=this.domNode.parentNode;return"none"!=e.style.display&&"hidden"!=e.style.visibility&&!i.contains(e,"dijitHidden")&&t&&t.style&&"none"!=t.style.display},_onShow:function(){this._wasShown=!0;this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments)}})}))},"dijit/layout/utils":function(){define(["dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang"],(function(e,t,i,n,o){function a(e,t){var n=e.resize?e.resize(t):i.setMarginBox(e.domNode,t);if(n)o.mixin(e,n);else{o.mixin(e,i.getMarginBox(e.domNode));o.mixin(e,t)}}var s={marginBox2contentBox:function(e,t){var o=n.getComputedStyle(e),a=i.getMarginExtents(e,o),s=i.getPadBorderExtents(e,o);return{l:n.toPixelValue(e,o.paddingLeft),t:n.toPixelValue(e,o.paddingTop),w:t.w-(a.w+s.w),h:t.h-(a.h+s.h)}},layoutChildren:function(i,n,s,r,l){n=o.mixin({},n);t.add(i,"dijitLayoutContainer");s=e.filter(s,(function(e){return"center"!=e.region&&"client"!=e.layoutAlign})).concat(e.filter(s,(function(e){return"center"==e.region||"client"==e.layoutAlign})));e.forEach(s,(function(e){var i=e.domNode,o=e.region||e.layoutAlign;if(!o)throw new Error("No region setting for "+e.id);var s,d=i.style;d.left=n.l+"px";d.top=n.t+"px";d.position="absolute";t.add(i,"dijitAlign"+((s=o).substring(0,1).toUpperCase()+s.substring(1)));var c={};r&&r==e.id&&(c["top"==e.region||"bottom"==e.region?"h":"w"]=l);"leading"==o&&(o=e.isLeftToRight()?"left":"right");"trailing"==o&&(o=e.isLeftToRight()?"right":"left");if("top"==o||"bottom"==o){c.w=n.w;a(e,c);n.h-=e.h;"top"==o?n.t+=e.h:d.top=n.t+n.h+"px"}else if("left"==o||"right"==o){c.h=n.h;a(e,c);n.w-=e.w;"left"==o?n.l+=e.w:d.left=n.l+n.w+"px"}else"client"!=o&&"center"!=o||a(e,n)}))}};o.setObject("dijit.layout.utils",s);return s}))},"dojo/html":function(){define(["./_base/kernel","./_base/lang","./_base/array","./_base/declare","./dom","./dom-construct","./parser"],(function(e,t,i,n,o,a,s){var r=0,l={_secureForInnerHtml:function(e){return e.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/gi,"")},_emptyNode:a.empty,_setNodeContent:function(e,i){a.empty(e);if(i){"number"==typeof i&&(i=i.toString());"string"==typeof i&&(i=a.toDom(i,e.ownerDocument));if(!i.nodeType&&t.isArrayLike(i))for(var n=i.length,o=0;o<i.length;o=n==i.length?o+1:0)a.place(i[o],e,"last");else a.place(i,e,"last")}return e},_ContentSetter:n("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:e._scopeName,startup:!0,constructor:function(e,i){t.mixin(this,e||{});i=this.node=o.byId(this.node||i);this.id||(this.id=["Setter",i?i.id||i.tagName:"",r++].join("_"))},set:function(e,t){void 0!==e&&(this.content=e);"number"==typeof e&&(e=e.toString());t&&this._mixin(t);this.onBegin();this.setContent();var i=this.onEnd();return i&&i.then?i:this.node},setContent:function(){var e=this.node;if(!e)throw new Error(this.declaredClass+": setContent given no node");try{e=l._setNodeContent(e,this.content)}catch(i){var t=this.onContentError(i);try{e.innerHTML=t}catch(i){}}this.node=e},empty:function(){if(this.parseDeferred){this.parseDeferred.isResolved()||this.parseDeferred.cancel();delete this.parseDeferred}if(this.parseResults&&this.parseResults.length){i.forEach(this.parseResults,(function(e){e.destroy&&e.destroy()}));delete this.parseResults}a.empty(this.node)},onBegin:function(){var e=this.content;if(t.isString(e)){this.cleanContent&&(e=l._secureForInnerHtml(e));if(this.extractContent){var i=e.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);i&&(e=i[1])}}this.empty();this.content=e;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.parseDeferred;delete this.node;delete this.content},onContentError:function(e){return"Error occurred setting content: "+e},onExecError:function(e){return"Error occurred executing scripts: "+e},_mixin:function(e){var t,i={};for(t in e)t in i||(this[t]=e[t])},_parse:function(){var e=this.node;try{var t={};i.forEach(["dir","lang","textDir"],(function(e){this[e]&&(t[e]=this[e])}),this);var n=this;this.parseDeferred=s.parse({rootNode:e,noStart:!this.startup,inherited:t,scope:this.parserScope}).then((function(e){return n.parseResults=e}),(function(e){n._onError("Content",e,"Error parsing in _ContentSetter#"+n.id)}))}catch(o){this._onError("Content",o,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(e,t,i){var n=this["on"+e+"Error"].call(this,t);i||n&&l._setNodeContent(this.node,n,!0)}}),set:function(e,i,n){null==i&&(i="");"number"==typeof i&&(i=i.toString());if(n){return new l._ContentSetter(t.mixin(n,{content:i,node:e})).set()}return l._setNodeContent(e,i,!0)}};t.setObject("dojo.html",l);return l}))},"dojo/parser":function(){define(["require","./_base/kernel","./_base/lang","./_base/array","./_base/config","./dom","./_base/window","./_base/url","./aspect","./promise/all","./date/stamp","./Deferred","./has","./query","./on","./ready"],(function(require,dojo,dlang,darray,config,dom,dwindow,_Url,aspect,all,dates,Deferred,has,query,don,ready){new Date("X");function myEval(text){return eval("("+text+")")}var extendCnt=0;aspect.after(dlang,"extend",(function(){extendCnt++}),!0);function getNameMap(e){var t=e._nameCaseMap,i=e.prototype;if(!t||t._extendCnt<extendCnt){t=e._nameCaseMap={};for(var n in i)"_"!==n.charAt(0)&&(t[n.toLowerCase()]=n);t._extendCnt=extendCnt}return t}function getCtor(e,t){t||(t=require);var i=t._dojoParserCtorMap||(t._dojoParserCtorMap={}),n=e.join();if(!i[n]){for(var o=[],a=0,s=e.length;a<s;a++){var r=e[a];o[o.length]=i[r]=i[r]||dlang.getObject(r)||~r.indexOf("/")&&t(r)}var l=o.shift();i[n]=o.length?l.createSubclass?l.createSubclass(o):l.extend.apply(l,o):l}return i[n]}var parser={_clearCache:function(){extendCnt++;_ctorMap={}},_functionFromScript:function(e,t){var i="",n="",o=e.getAttribute(t+"args")||e.getAttribute("args"),a=e.getAttribute("with"),s=(o||"").split(/\s*,\s*/);a&&a.length&&darray.forEach(a.split(/\s*,\s*/),(function(e){i+="with("+e+"){";n+="}"}));return new Function(s,i+e.innerHTML+n)},instantiate:function(e,t,i){t=t||{};var n=((i=i||{}).scope||dojo._scopeName)+"Type",o="data-"+(i.scope||dojo._scopeName)+"-",a=o+"type",s=o+"mixins",r=[];darray.forEach(e,(function(e){var i=n in t?t[n]:e.getAttribute(a)||e.getAttribute(n);if(i){var o=e.getAttribute(s),l=o?[i].concat(o.split(/\s*,\s*/)):[i];r.push({node:e,types:l})}}));return this._instantiate(r,t,i)},_instantiate:function(e,t,i,n){var o=darray.map(e,(function(e){var n=e.ctor||getCtor(e.types,i.contextRequire);if(!n)throw new Error("Unable to resolve constructor for: '"+e.types.join()+"'");return this.construct(n,e.node,t,i,e.scripts,e.inherited)}),this);function a(e){t._started||i.noStart||darray.forEach(e,(function(e){"function"!=typeof e.startup||e._started||e.startup()}));return e}return n?all(o).then(a):a(o)},construct:function(e,t,i,n,o,a){var s,r=e&&e.prototype,l={};(n=n||{}).defaults&&dlang.mixin(l,n.defaults);a&&dlang.mixin(l,a);if(has("dom-attributes-explicit"))s=t.attributes;else if(has("dom-attributes-specified-flag"))s=darray.filter(t.attributes,(function(e){return e.specified}));else{var d=(/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,"");s=darray.map(d.split(/\s+/),(function(e){var i=e.toLowerCase();return{name:e,value:"LI"==t.nodeName&&"value"==e||"enctype"==i?t.getAttribute(i):t.getAttributeNode(i).value}}))}var c=n.scope||dojo._scopeName,h="data-"+c+"-",u={};if("dojo"!==c){u[h+"props"]="data-dojo-props";u[h+"type"]="data-dojo-type";u[h+"mixins"]="data-dojo-mixins";u[c+"type"]="dojotype";u[h+"id"]="data-dojo-id"}for(var p,m,g,_=0,f=[];p=s[_++];){var v=p.name,b=v.toLowerCase(),y=p.value;switch(u[b]||b){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":g=y;break;case"data-dojo-id":case"jsid":m=y;break;case"data-dojo-attach-point":case"dojoattachpoint":l.dojoAttachPoint=y;break;case"data-dojo-attach-event":case"dojoattachevent":l.dojoAttachEvent=y;break;case"class":l.class=t.className;break;case"style":l.style=t.style&&t.style.cssText;break;default:if(!(v in r)){v=getNameMap(e)[b]||v}if(v in r)switch(typeof r[v]){case"string":l[v]=y;break;case"number":l[v]=y.length?Number(y):NaN;break;case"boolean":l[v]="false"!=y.toLowerCase();break;case"function":""===y||-1!=y.search(/[^\w\.]+/i)?l[v]=new Function(y):l[v]=dlang.getObject(y,!1)||new Function(y);f.push(v);break;default:var w=r[v];l[v]=w&&"length"in w?y?y.split(/\s*,\s*/):[]:w instanceof Date?""==y?new Date(""):"now"==y?new Date:dates.fromISOString(y):w instanceof _Url?dojo.baseUrl+y:myEval(y)}else l[v]=y}}for(var C=0;C<f.length;C++){var k=f[C].toLowerCase();t.removeAttribute(k);t[k]=null}if(g)try{g=myEval.call(n.propsThis,"{"+g+"}");dlang.mixin(l,g)}catch(O){throw new Error(O.toString()+" in data-dojo-props='"+g+"'")}dlang.mixin(l,i);o||(o=e&&(e._noScript||r._noScript)?[]:query("> script[type^='dojo/']",t));var x=[],T=[],A=[],j=[];if(o)for(_=0;_<o.length;_++){var S=o[_];t.removeChild(S);var M=S.getAttribute(h+"event")||S.getAttribute("event"),E=S.getAttribute(h+"prop"),N=S.getAttribute(h+"method"),D=S.getAttribute(h+"advice"),I=S.getAttribute("type"),L=this._functionFromScript(S,h);M?"dojo/connect"==I?x.push({method:M,func:L}):"dojo/on"==I?j.push({event:M,func:L}):l[M]=L:"dojo/aspect"==I?x.push({method:N,advice:D,func:L}):"dojo/watch"==I?A.push({prop:E,func:L}):T.push(L)}var $=e.markupFactory||r.markupFactory,P=$?$(l,t,e):new e(l,t);function R(e){m&&dlang.setObject(m,e);for(_=0;_<x.length;_++)aspect[x[_].advice||"after"](e,x[_].method,dlang.hitch(e,x[_].func),!0);for(_=0;_<T.length;_++)T[_].call(e);for(_=0;_<A.length;_++)e.watch(A[_].prop,A[_].func);for(_=0;_<j.length;_++)don(e,j[_].event,j[_].func);return e}return P.then?P.then(R):R(P)},scan:function(e,t){var i=[],n=[],o={},a=(t.scope||dojo._scopeName)+"Type",s="data-"+(t.scope||dojo._scopeName)+"-",r=s+"type",l=s+"textdir",d=s+"mixins",c=e.firstChild,h=t.inherited;if(!h){function u(e,t){return e.getAttribute&&e.getAttribute(t)||e.parentNode&&u(e.parentNode,t)}h={dir:u(e,"dir"),lang:u(e,"lang"),textDir:u(e,l)};for(var p in h)h[p]||delete h[p]}var m,g,_={inherited:h};function f(e){if(!e.inherited){e.inherited={};var t=e.node,i=f(e.parent),n={dir:t.getAttribute("dir")||i.dir,lang:t.getAttribute("lang")||i.lang,textDir:t.getAttribute(l)||i.textDir};for(var o in n)n[o]&&(e.inherited[o]=n[o])}return e.inherited}for(;;)if(c)if(1==c.nodeType)if(m&&"script"==c.nodeName.toLowerCase()){(v=c.getAttribute("type"))&&/^dojo\/\w/i.test(v)&&m.push(c);c=c.nextSibling}else if(g)c=c.nextSibling;else{var v=c.getAttribute(r)||c.getAttribute(a),b=c.firstChild;if(v||b&&(3!=b.nodeType||b.nextSibling)){var y,w=null;if(v){var C=c.getAttribute(d),k=C?[v].concat(C.split(/\s*,\s*/)):[v];try{w=getCtor(k,t.contextRequire)}catch(A){}w||darray.forEach(k,(function(e){if(~e.indexOf("/")&&!o[e]){o[e]=!0;n[n.length]=e}}));var x=w&&!w.prototype._noScript?[]:null;(y={types:k,ctor:w,parent:_,node:c,scripts:x}).inherited=f(y);i.push(y)}else y={node:c,scripts:m,parent:_};m=x;g=c.stopParser||w&&w.prototype.stopParser&&!t.template;_=y;c=b}else c=c.nextSibling}else c=c.nextSibling;else{if(!_||!_.node)break;c=_.node.nextSibling;g=!1;m=(_=_.parent).scripts}var T=new Deferred;if(n.length){has("dojo-debug-messages");(t.contextRequire||require)(n,(function(){T.resolve(darray.filter(i,(function(e){if(!e.ctor)try{e.ctor=getCtor(e.types,t.contextRequire)}catch(A){}for(var i=e.parent;i&&!i.types;)i=i.parent;var n=e.ctor&&e.ctor.prototype;e.instantiateChildren=!(n&&n.stopParser&&!t.template);e.instantiate=!i||i.instantiate&&i.instantiateChildren;return e.instantiate})))}))}else T.resolve(i);return T.promise},_require:function(e,t){var i=myEval("{"+e.innerHTML+"}"),n=[],o=[],a=new Deferred,s=t&&t.contextRequire||require;for(var r in i){n.push(r);o.push(i[r])}s(o,(function(){for(var e=0;e<n.length;e++)dlang.setObject(n[e],arguments[e]);a.resolve(arguments)}));return a.promise},_scanAmd:function(e,t){var i=new Deferred,n=i.promise;i.resolve(!0);var o=this;query("script[type='dojo/require']",e).forEach((function(e){n=n.then((function(){return o._require(e,t)}));e.parentNode.removeChild(e)}));return n},parse:function(e,t){e&&"string"!=typeof e&&!("nodeType"in e)&&(e=(t=e).rootNode);var i=e?dom.byId(e):dwindow.body(),n=(t=t||{}).template?{template:!0}:{},o=[],a=this,s=this._scanAmd(i,t).then((function(){return a.scan(i,t)})).then((function(e){return a._instantiate(e,n,t,!0)})).then((function(e){return o=o.concat(e)})).otherwise((function(e){throw e}));dlang.mixin(o,s);return o}};dojo.parser=parser;config.parseOnLoad&&ready(100,parser,"parse");return parser}))},"dojo/_base/url":function(){define(["./kernel"],(function(e){var t=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),i=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$"),n=function(){for(var e=null,o=arguments,a=[o[0]],s=1;s<o.length;s++)if(o[s]){var r=new n(o[s]+""),l=new n(a[0]+"");if(""!=r.path||r.scheme||r.authority||r.query){if(!r.scheme){r.scheme=l.scheme;if(!r.authority){r.authority=l.authority;if("/"!=r.path.charAt(0)){for(var d=l.path.substring(0,l.path.lastIndexOf("/")+1)+r.path,c=d.split("/"),h=0;h<c.length;h++)if("."==c[h])if(h==c.length-1)c[h]="";else{c.splice(h,1);h--}else if(h>0&&(1!=h||""!=c[0])&&".."==c[h]&&".."!=c[h-1])if(h==c.length-1){c.splice(h,1);c[h-1]=""}else{c.splice(h-1,2);h-=2}r.path=c.join("/")}}}}else{r.fragment!=e&&(l.fragment=r.fragment);r=l}a=[];r.scheme&&a.push(r.scheme,":");r.authority&&a.push("//",r.authority);a.push(r.path);r.query&&a.push("?",r.query);r.fragment&&a.push("#",r.fragment)}this.uri=a.join("");var u=this.uri.match(t);this.scheme=u[2]||(u[1]?"":e);this.authority=u[4]||(u[3]?"":e);this.path=u[5];this.query=u[7]||(u[6]?"":e);this.fragment=u[9]||(u[8]?"":e);if(this.authority!=e){u=this.authority.match(i);this.user=u[3]||e;this.password=u[4]||e;this.host=u[6]||u[7];this.port=u[9]||e}};n.prototype.toString=function(){return this.uri};return e._Url=n}))},"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],(function(e,t,i,n){"use strict";var o=e.some;return function(e){var a,s,r;t.isArray(e)?s=e:e&&"object"==typeof e&&(a=e);var l=[];if(a){s=[];for(var d in a)if(Object.hasOwnProperty.call(a,d)){l.push(d);s.push(a[d])}r={}}else s&&(r=[]);if(!s||!s.length)return(new i).resolve(r);var c=new i;c.promise.always((function(){r=l=null}));var h=s.length;o(s,(function(e,t){a||l.push(t);n(e,(function(e){if(!c.isFulfilled()){r[l[t]]=e;0==--h&&c.resolve(r)}}),c.reject);return c.isFulfilled()}));return c.promise}}))},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],(function(e,t){var i={};e.setObject("dojo.date.stamp",i);i.fromISOString=function(e,n){i._isoRegExp||(i._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var o=i._isoRegExp.exec(e),a=null;if(o){o.shift();o[1]&&o[1]--;o[6]&&(o[6]*=1e3);if(n){n=new Date(n);t.forEach(t.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],(function(e){return n["get"+e]()})),(function(e,t){o[t]=o[t]||e}))}a=new Date(o[0]||1970,o[1]||0,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0);o[0]<100&&a.setFullYear(o[0]||1970);var s=0,r=o[7]&&o[7].charAt(0);if("Z"!=r){s=60*(o[8]||0)+(Number(o[9])||0);"-"!=r&&(s*=-1)}r&&(s-=a.getTimezoneOffset());s&&a.setTime(a.getTime()+6e4*s)}return a};i.toISOString=function(e,t){var i=function(e){return e<10?"0"+e:e},n=[],o=(t=t||{}).zulu?"getUTC":"get",a="";if("time"!=t.selector){var s=e[o+"FullYear"]();a=["0000".substr((s+"").length)+s,i(e[o+"Month"]()+1),i(e[o+"Date"]())].join("-")}n.push(a);if("date"!=t.selector){var r=[i(e[o+"Hours"]()),i(e[o+"Minutes"]()),i(e[o+"Seconds"]())].join(":"),l=e[o+"Milliseconds"]();t.milliseconds&&(r+="."+(l<100?"0":"")+i(l));if(t.zulu)r+="Z";else if("time"!=t.selector){var d=e.getTimezoneOffset(),c=Math.abs(d);r+=(d>0?"-":"+")+i(Math.floor(c/60))+":"+i(c%60)}n.push(r)}return n.join("T")};return i}))},"dojox/html/entities":function(){define(["dojo/_base/lang"],(function(e){var t=e.getObject("dojox.html.entities",!0),i=function(e,t){var i,n;if(t._encCache&&t._encCache.regexp&&t._encCache.mapper&&t.length==t._encCache.length){i=t._encCache.mapper;n=t._encCache.regexp}else{i={};n=["["];var o;for(o=0;o<t.length;o++){i[t[o][0]]="&"+t[o][1]+";";n.push(t[o][0])}n.push("]");n=new RegExp(n.join(""),"g");t._encCache={mapper:i,regexp:n,length:t.length}}return e=e.replace(n,(function(e){return i[e]}))},n=function(e,t){var i,n;if(t._decCache&&t._decCache.regexp&&t._decCache.mapper&&t.length==t._decCache.length){i=t._decCache.mapper;n=t._decCache.regexp}else{i={};n=["("];var o;for(o=0;o<t.length;o++){var a="&"+t[o][1]+";";o&&n.push("|");i[a]=t[o][0];n.push(a)}n.push(")");n=new RegExp(n.join(""),"g");t._decCache={mapper:i,regexp:n,length:t.length}}return e=e.replace(n,(function(e){return i[e]}))};t.html=[["&","amp"],['"',"quot"],["<","lt"],[">","gt"],[" ","nbsp"]];t.latin=[["¡","iexcl"],["¢","cent"],["£","pound"],["€","euro"],["¤","curren"],["¥","yen"],["¦","brvbar"],["§","sect"],["¨","uml"],["©","copy"],["ª","ordf"],["«","laquo"],["¬","not"],["­","shy"],["®","reg"],["¯","macr"],["°","deg"],["±","plusmn"],["²","sup2"],["³","sup3"],["´","acute"],["µ","micro"],["¶","para"],["·","middot"],["¸","cedil"],["¹","sup1"],["º","ordm"],["»","raquo"],["¼","frac14"],["½","frac12"],["¾","frac34"],["¿","iquest"],["À","Agrave"],["Á","Aacute"],["Â","Acirc"],["Ã","Atilde"],["Ä","Auml"],["Å","Aring"],["Æ","AElig"],["Ç","Ccedil"],["È","Egrave"],["É","Eacute"],["Ê","Ecirc"],["Ë","Euml"],["Ì","Igrave"],["Í","Iacute"],["Î","Icirc"],["Ï","Iuml"],["Ð","ETH"],["Ñ","Ntilde"],["Ò","Ograve"],["Ó","Oacute"],["Ô","Ocirc"],["Õ","Otilde"],["Ö","Ouml"],["×","times"],["Ø","Oslash"],["Ù","Ugrave"],["Ú","Uacute"],["Û","Ucirc"],["Ü","Uuml"],["Ý","Yacute"],["Þ","THORN"],["ß","szlig"],["à","agrave"],["á","aacute"],["â","acirc"],["ã","atilde"],["ä","auml"],["å","aring"],["æ","aelig"],["ç","ccedil"],["è","egrave"],["é","eacute"],["ê","ecirc"],["ë","euml"],["ì","igrave"],["í","iacute"],["î","icirc"],["ï","iuml"],["ð","eth"],["ñ","ntilde"],["ò","ograve"],["ó","oacute"],["ô","ocirc"],["õ","otilde"],["ö","ouml"],["÷","divide"],["ø","oslash"],["ù","ugrave"],["ú","uacute"],["û","ucirc"],["ü","uuml"],["ý","yacute"],["þ","thorn"],["ÿ","yuml"],["ƒ","fnof"],["Α","Alpha"],["Β","Beta"],["Γ","Gamma"],["Δ","Delta"],["Ε","Epsilon"],["Ζ","Zeta"],["Η","Eta"],["Θ","Theta"],["Ι","Iota"],["Κ","Kappa"],["Λ","Lambda"],["Μ","Mu"],["Ν","Nu"],["Ξ","Xi"],["Ο","Omicron"],["Π","Pi"],["Ρ","Rho"],["Σ","Sigma"],["Τ","Tau"],["Υ","Upsilon"],["Φ","Phi"],["Χ","Chi"],["Ψ","Psi"],["Ω","Omega"],["α","alpha"],["β","beta"],["γ","gamma"],["δ","delta"],["ε","epsilon"],["ζ","zeta"],["η","eta"],["θ","theta"],["ι","iota"],["κ","kappa"],["λ","lambda"],["μ","mu"],["ν","nu"],["ξ","xi"],["ο","omicron"],["π","pi"],["ρ","rho"],["ς","sigmaf"],["σ","sigma"],["τ","tau"],["υ","upsilon"],["φ","phi"],["χ","chi"],["ψ","psi"],["ω","omega"],["ϑ","thetasym"],["ϒ","upsih"],["ϖ","piv"],["•","bull"],["…","hellip"],["′","prime"],["″","Prime"],["‾","oline"],["⁄","frasl"],["℘","weierp"],["ℑ","image"],["ℜ","real"],["™","trade"],["ℵ","alefsym"],["←","larr"],["↑","uarr"],["→","rarr"],["↓","darr"],["↔","harr"],["↵","crarr"],["⇐","lArr"],["⇑","uArr"],["⇒","rArr"],["⇓","dArr"],["⇔","hArr"],["∀","forall"],["∂","part"],["∃","exist"],["∅","empty"],["∇","nabla"],["∈","isin"],["∉","notin"],["∋","ni"],["∏","prod"],["∑","sum"],["−","minus"],["∗","lowast"],["√","radic"],["∝","prop"],["∞","infin"],["∠","ang"],["∧","and"],["∨","or"],["∩","cap"],["∪","cup"],["∫","int"],["∴","there4"],["∼","sim"],["≅","cong"],["≈","asymp"],["≠","ne"],["≡","equiv"],["≤","le"],["≥","ge"],["⊂","sub"],["⊃","sup"],["⊄","nsub"],["⊆","sube"],["⊇","supe"],["⊕","oplus"],["⊗","otimes"],["⊥","perp"],["⋅","sdot"],["⌈","lceil"],["⌉","rceil"],["⌊","lfloor"],["⌋","rfloor"],["〈","lang"],["〉","rang"],["◊","loz"],["♠","spades"],["♣","clubs"],["♥","hearts"],["♦","diams"],["Œ","OElig"],["œ","oelig"],["Š","Scaron"],["š","scaron"],["Ÿ","Yuml"],["ˆ","circ"],["˜","tilde"],[" ","ensp"],[" ","emsp"],[" ","thinsp"],["‌","zwnj"],["‍","zwj"],["‎","lrm"],["‏","rlm"],["–","ndash"],["—","mdash"],["‘","lsquo"],["’","rsquo"],["‚","sbquo"],["“","ldquo"],["”","rdquo"],["„","bdquo"],["†","dagger"],["‡","Dagger"],["‰","permil"],["‹","lsaquo"],["›","rsaquo"]];t.encode=function(e,n){if(e)if(n)e=i(e,n);else{e=i(e,t.html);e=i(e,t.latin)}return e};t.decode=function(e,i){if(e)if(i)e=n(e,i);else{e=n(e,t.html);e=n(e,t.latin)}return e};return t}))},"dojo/fx":function(){define(["./_base/lang","./Evented","./_base/kernel","./_base/array","./aspect","./_base/fx","./dom","./dom-style","./dom-geometry","./ready","require"],(function(e,t,i,n,o,a,s,r,l,d,c){i.isAsync||d(0,(function(){c(["./fx/Toggler"])}));var h=i.fx={},u={_fire:function(e,t){this[e]&&this[e].apply(this,t||[]);return this}},p=function(e){this._index=-1;this._animations=e||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;n.forEach(this._animations,(function(e){if(e){void 0!==e.duration&&(this.duration+=e.duration);e.delay&&(this.duration+=e.delay)}}),this)};p.prototype=new t;e.extend(p,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;if(this._index+1==this._animations.length)this._fire("onEnd");else{this._current=this._animations[++this._index];this._onAnimateCtx=o.after(this._current,"onAnimate",e.hitch(this,"_onAnimate"),!0);this._onEndCtx=o.after(this._current,"onEnd",e.hitch(this,"_onEnd"),!0);this._current.play(0,!0)}},play:function(t,i){this._current||(this._current=this._animations[this._index=0]);if(!i&&"playing"==this._current.status())return this;var n=o.after(this._current,"beforeBegin",e.hitch(this,(function(){this._fire("beforeBegin")})),!0),a=o.after(this._current,"onBegin",e.hitch(this,(function(e){this._fire("onBegin",arguments)})),!0),s=o.after(this._current,"onPlay",e.hitch(this,(function(e){this._fire("onPlay",arguments);n.remove();a.remove();s.remove()})));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=o.after(this._current,"onAnimate",e.hitch(this,"_onAnimate"),!0);this._onEndCtx&&this._onEndCtx.remove();this._onEndCtx=o.after(this._current,"onEnd",e.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var t=o.after(this._current,"onPause",e.hitch(this,(function(e){this._fire("onPause",arguments);t.remove()})),!0);this._current.pause()}return this},gotoPercent:function(e,t){this.pause();var i=this.duration*e;this._current=null;n.some(this._animations,(function(e,t){if(i<=e.duration){this._current=e;this._index=t;return!0}i-=e.duration;return!1}),this);this._current&&this._current.gotoPercent(i/this._current.duration);t&&this.play();return this},stop:function(t){if(this._current){if(t){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var i=o.after(this._current,"onStop",e.hitch(this,(function(e){this._fire("onStop",arguments);i.remove()})),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});e.extend(p,u);h.chain=function(t){return new p(e.isArray(t)?t:Array.prototype.slice.call(t,0))};var m=function(t){this._animations=t||[];this._connects=[];this._finished=0;this.duration=0;n.forEach(t,(function(t){var i=t.duration;t.delay&&(i+=t.delay);this.duration<i&&(this.duration=i);this._connects.push(o.after(t,"onEnd",e.hitch(this,"_onEnd"),!0))}),this);this._pseudoAnimation=new a.Animation({curve:[0,1],duration:this.duration});var i=this;n.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause","onStop","onEnd"],(function(e){i._connects.push(o.after(i._pseudoAnimation,e,(function(){i._fire(e,arguments)}),!0))}))};e.extend(m,{_doAction:function(e,t){n.forEach(this._animations,(function(i){i[e].apply(i,t)}));return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(e,t){var i=this._pseudoAnimation;i[e].apply(i,t)},play:function(e,t){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(e,t){var i=this.duration*e;n.forEach(this._animations,(function(e){e.gotoPercent(e.duration<i?1:i/e.duration,t)}));this._call("gotoPercent",arguments);return this},stop:function(e){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},destroy:function(){this.stop();n.forEach(this._connects,(function(e){e.remove()}))}});e.extend(m,u);h.combine=function(t){return new m(e.isArray(t)?t:Array.prototype.slice.call(t,0))};h.wipeIn=function(t){var i,n=t.node=s.byId(t.node),l=n.style,d=a.animateProperty(e.mixin({properties:{height:{start:function(){i=l.overflow;l.overflow="hidden";if("hidden"==l.visibility||"none"==l.display){l.height="1px";l.display="";l.visibility="";return 1}var e=r.get(n,"height");return Math.max(e,1)},end:function(){return n.scrollHeight}}}},t)),c=function(){l.height="auto";l.overflow=i};o.after(d,"onStop",c,!0);o.after(d,"onEnd",c,!0);return d};h.wipeOut=function(t){var i,n=(t.node=s.byId(t.node)).style,r=a.animateProperty(e.mixin({properties:{height:{end:1}}},t));o.after(r,"beforeBegin",(function(){i=n.overflow;n.overflow="hidden";n.display=""}),!0);var l=function(){n.overflow=i;n.height="auto";n.display="none"};o.after(r,"onStop",l,!0);o.after(r,"onEnd",l,!0);return r};h.slideTo=function(t){var i,n=t.node=s.byId(t.node),d=null,c=null,h=(i=n,function(){var e=r.getComputedStyle(i),t=e.position;d="absolute"==t?i.offsetTop:parseInt(e.top)||0;c="absolute"==t?i.offsetLeft:parseInt(e.left)||0;if("absolute"!=t&&"relative"!=t){var n=l.position(i,!0);d=n.y;c=n.x;i.style.position="absolute";i.style.top=d+"px";i.style.left=c+"px"}});h();var u=a.animateProperty(e.mixin({properties:{top:t.top||0,left:t.left||0}},t));o.after(u,"beforeBegin",h,!0);return u};return h}))},"dojo/io/iframe":function(){define(["../_base/config","../_base/json","../_base/kernel","../_base/lang","../_base/xhr","../sniff","../_base/window","../dom","../dom-construct","../query","require","../aspect","../request/iframe"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u){i.deprecated("dojo/io/iframe","Use dojo/request/iframe.","2.0");var p=u._iframeName;p=p.substring(0,p.lastIndexOf("_"));var m=n.delegate(u,{create:function(){return m._frame=u.create.apply(u,arguments)},get:null,post:null,send:function(n){var a,s=o._ioSetArgs(n,(function(e){a&&a.cancel()}),(function(e){var n=null,o=e.ioArgs;try{var s=o.handleAs;if("xml"===s||"html"===s)n=a.response.data;else{n=a.response.text;"json"===s?n=t.fromJson(n):"javascript"===s&&(n=i.eval(n))}}catch(r){n=r}return n}),(function(e,t){t.ioArgs._hasError=!0;return e})),l=s.ioArgs,d="GET",c=r.byId(n.form);n.method&&"POST"===n.method.toUpperCase()&&c&&(d="POST");var p={method:d,handleAs:"json"===n.handleAs||"javascript"===n.handleAs?"text":n.handleAs,form:n.form,query:c?null:n.content,data:c?n.content:null,timeout:n.timeout,ioArgs:l};p.method&&(p.method=p.method.toUpperCase());if(e.ioPublish&&i.publish&&!1!==l.args.ioPublish)var m=h.after(u,"_notifyStart",(function(e){if(e.options.ioArgs===l){m.remove();o._ioNotifyStart(s)}}),!0);a=u(l.url,p,!0);l._callNext=a._callNext;a.then((function(){s.resolve(s)})).otherwise((function(e){s.ioArgs.error=e;s.reject(e)}));return s},_iframeOnload:s.global[p+"_onload"]});n.setObject("dojo.io.iframe",m);return m}))},"dojo/request/iframe":function(){define(["module","require","./watch","./util","./handlers","../_base/lang","../io-query","../query","../has","../dom","../dom-construct","../_base/window","../NodeList-dom","../NodeList-manipulate"],(function(e,t,i,n,o,a,s,r,l,d,c,h){var u=e.id.replace(/[\/\.\-]/g,"_"),p=u+"_onload";h.global[p]||(h.global[p]=function(){var e=b._currentDfd;if(e){var t=e.response.options,i=d.byId(t.form)||e._tmpForm;if(i){for(var n=e._contentToClean,o=0;o<n.length;o++)for(var a=n[o],s=0;s<i.childNodes.length;s++){var r=i.childNodes[s];if(r.name===a){c.destroy(r);break}}e._originalAction&&i.setAttribute("action",e._originalAction);if(e._originalMethod){i.setAttribute("method",e._originalMethod);i.method=e._originalMethod}if(e._originalTarget){i.setAttribute("target",e._originalTarget);i.target=e._originalTarget}}if(e._tmpForm){c.destroy(e._tmpForm);delete e._tmpForm}e._finished=!0}else b._fireNextRequest()});function m(e){return!this.isFulfilled()}function g(e){return!!this._finished}function _(e,t){if(!t)try{var i=e.options,n=b.doc(b._frame),s=i.handleAs;if("html"!==s){if("xml"===s)if("html"===n.documentElement.tagName.toLowerCase()){r("a",n.documentElement).orphan();var l=n.documentElement.innerText||n.documentElement.textContent;l=l.replace(/>\s+</g,"><");e.text=a.trim(l)}else e.data=n;else e.text=n.getElementsByTagName("textarea")[0].value;o(e)}else e.data=n}catch(d){t=d}t?this.reject(t):this._finished?this.resolve(e):this.reject(new Error("Invalid dojo/request/iframe request state"))}function f(e){this._callNext()}var v={method:"POST"};function b(e,t,o){var a=n.parseArgs(e,n.deepCreate(v,t),!0);e=a.url;if("GET"!==(t=a.options).method&&"POST"!==t.method)throw new Error(t.method+" not supported by dojo/request/iframe");b._frame||(b._frame=b.create(b._iframeName,p+"();"));var s=n.deferred(a,null,m,g,_,f);s._callNext=function(){if(!this._calledNext){this._calledNext=!0;b._currentDfd=null;b._fireNextRequest()}};s._legacy=o;b._dfdQueue.push(s);b._fireNextRequest();i(s);return o?s:s.promise}b.create=function(e,i,n){if(h.global[e])return h.global[e];if(h.global.frames[e])return h.global.frames[e];if(!n){l("config-useXDomain")&&l("config-dojoBlankHtmlUrl");n=l("config-dojoBlankHtmlUrl")||t.toUrl("dojo/resources/blank.html")}var o=c.place('<iframe id="'+e+'" name="'+e+'" src="'+n+'" onload="'+i+'" style="position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden">',h.body());h.global[e]=o;return o};b.doc=function(e){if(e.contentDocument)return e.contentDocument;var t=e.name;if(t){var i=h.doc.getElementsByTagName("iframe");if(e.document&&i[t].contentWindow&&i[t].contentWindow.document)return i[t].contentWindow.document;if(h.doc.frames[t]&&h.doc.frames[t].document)return h.doc.frames[t].document}return null};b.setSrc=function(e,t,i){var n=h.global.frames[e.name];n.contentWindow&&(n=n.contentWindow);try{i?n.location.replace(t):n.location=t}catch(o){}};b._iframeName=u+"_IoIframe";b._notifyStart=function(){};b._dfdQueue=[];b._currentDfd=null;b._fireNextRequest=function(){var e;try{if(b._currentDfd||!b._dfdQueue.length)return;do{e=b._currentDfd=b._dfdQueue.shift()}while(e&&(e.canceled||e.isCanceled&&e.isCanceled())&&b._dfdQueue.length);if(!e||e.canceled||e.isCanceled&&e.isCanceled()){b._currentDfd=null;return}var t,i=e.response,o=i.options,l=e._contentToClean=[],p=d.byId(o.form),m=n.notify,g=o.data||null;if(e._legacy||"POST"!==o.method||p){if("GET"===o.method&&p&&i.url.indexOf("?")>-1){t=i.url.slice(i.url.indexOf("?")+1);g=a.mixin(s.queryToObject(t),g)}}else p=e._tmpForm=c.create("form",{name:u+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},h.body());if(p){if(!e._legacy){var _=p;do{_=_.parentNode}while(_&&_!==h.doc.documentElement);if(!_){p.style.position="absolute";p.style.left="-1000px";p.style.top="-1000px";h.body().appendChild(p)}p.name||(p.name=u+"_form")}if(g){var f=function(e,t){c.create("input",{type:"hidden",name:e,value:t},p);l.push(e)};for(var v in g){var y=g[v];if(a.isArray(y)&&y.length>1)for(var w=0;w<y.length;w++)f(v,y[w]);else{var C=r("input[name='"+v+"']",p);-1==C.indexOf()?f(v,y):C.val(y)}}}var k=p.getAttributeNode("action"),x=p.getAttributeNode("method"),T=p.getAttributeNode("target");if(i.url){e._originalAction=k?k.value:null;k?k.value=i.url:p.setAttribute("action",i.url)}if(e._legacy)x&&x.value||(x?x.value=o.method:p.setAttribute("method",o.method));else{e._originalMethod=x?x.value:null;x?x.value=o.method:p.setAttribute("method",o.method)}e._originalTarget=T?T.value:null;T?T.value=b._iframeName:p.setAttribute("target",b._iframeName);p.target=b._iframeName;m&&m.emit("send",i,e.promise.cancel);b._notifyStart(i);p.submit()}else{var A="";i.options.data&&"string"!=typeof(A=i.options.data)&&(A=s.objectToQuery(A));var j=i.url+(i.url.indexOf("?")>-1?"&":"?")+A;m&&m.emit("send",i,e.promise.cancel);b._notifyStart(i);b.setSrc(b._frame,j,!0)}}catch(S){e.reject(S)}};n.addCommonMethods(b,["GET","POST"]);return b}))},"dojo/NodeList-manipulate":function(){define(["./query","./_base/lang","./_base/array","./dom-construct","./dom-attr","./NodeList-dom"],(function(e,t,i,n,o){var a=e.NodeList;function s(e){for(;e.childNodes[0]&&1==e.childNodes[0].nodeType;)e=e.childNodes[0];return e}function r(e,t){"string"==typeof e?11==(e=n.toDom(e,t&&t.ownerDocument)).nodeType&&(e=e.childNodes[0]):1==e.nodeType&&e.parentNode&&(e=e.cloneNode(!1));return e}t.extend(a,{_placeMultiple:function(t,i){for(var o="string"==typeof t||t.nodeType?e(t):t,a=[],s=0;s<o.length;s++)for(var r,l=o[s],d=this.length,c=d-1;r=this[c];c--){if(s>0){r=this._cloneNode(r);a.unshift(r)}c==d-1?n.place(r,l,i):l.parentNode.insertBefore(r,l);l=r}if(a.length){a.unshift(0);a.unshift(this.length-1);Array.prototype.splice.apply(this,a)}return this},innerHTML:function(e){return arguments.length?this.addContent(e,"only"):this[0].innerHTML},text:function(e){if(arguments.length){for(var t,i=0;t=this[i];i++)1==t.nodeType&&o.set(t,"textContent",e);return this}var n="";for(i=0;t=this[i];i++)n+=o.get(t,"textContent");return n},val:function(e){if(arguments.length){for(var n,o=t.isArray(e),a=0;n=this[a];a++){var s=n.nodeName.toUpperCase(),r=n.type,l=o?e[a]:e;if("SELECT"==s)for(var d=n.options,c=0;c<d.length;c++){var h=d[c];n.multiple?h.selected=-1!=i.indexOf(e,h.value):h.selected=h.value==l}else"checkbox"==r||"radio"==r?n.checked=n.value==l:n.value=l}return this}if((n=this[0])&&1==n.nodeType){e=n.value||"";if("SELECT"==n.nodeName.toUpperCase()&&n.multiple){e=[];d=n.options;for(c=0;c<d.length;c++)(h=d[c]).selected&&e.push(h.value);e.length||(e=null)}return e}},append:function(e){return this.addContent(e,"last")},appendTo:function(e){return this._placeMultiple(e,"last")},prepend:function(e){return this.addContent(e,"first")},prependTo:function(e){return this._placeMultiple(e,"first")},after:function(e){return this.addContent(e,"after")},insertAfter:function(e){return this._placeMultiple(e,"after")},before:function(e){return this.addContent(e,"before")},insertBefore:function(e){return this._placeMultiple(e,"before")},remove:a.prototype.orphan,wrap:function(e){if(this[0]){e=r(e,this[0]);for(var t,i=0;t=this[i];i++){var n=this._cloneNode(e);t.parentNode&&t.parentNode.replaceChild(n,t);s(n).appendChild(t)}}return this},wrapAll:function(e){if(this[0]){e=r(e,this[0]);this[0].parentNode.replaceChild(e,this[0]);for(var t,i=s(e),n=0;t=this[n];n++)i.appendChild(t)}return this},wrapInner:function(e){if(this[0]){e=r(e,this[0]);for(var i=0;i<this.length;i++){var n=this._cloneNode(e);this._wrap(t._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(n)}}return this},replaceWith:function(e){e=this._normalize(e,this[0]);for(var t,i=0;t=this[i];i++){this._place(e,t,"before",i>0);t.parentNode.removeChild(t)}return this},replaceAll:function(t){for(var i,n=e(t),o=this._normalize(this,this[0]),a=0;i=n[a];a++){this._place(o,i,"before",a>0);i.parentNode.removeChild(i)}return this},clone:function(){for(var e=[],t=0;t<this.length;t++)e.push(this._cloneNode(this[t]));return this._wrap(e,this,this._NodeListCtor)}});a.prototype.html||(a.prototype.html=a.prototype.innerHTML);return a}))},"dijit/Tooltip":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/fx","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang","dojo/mouse","dojo/on","dojo/sniff","./_base/manager","./place","./_Widget","./_TemplatedMixin","./BackgroundIframe","dojo/text!./templates/Tooltip.html","./main"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_,f){var v=t("dijit._MasterTooltip",[p,m],{duration:h.defaultDuration,templateString:_,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new g(this.domNode);this.fadeIn=i.fadeIn({node:this.domNode,duration:this.duration,onEnd:r.hitch(this,"_onShow")});this.fadeOut=i.fadeOut({node:this.domNode,duration:this.duration,onEnd:r.hitch(this,"_onHide")})},show:function(e,t,i,n,o,a,l){if(!this.aroundNode||this.aroundNode!==t||this.containerNode.innerHTML!=e)if("playing"!=this.fadeOut.status()){this.containerNode.innerHTML=e;o&&this.set("textDir",o);this.containerNode.align=n?"right":"left";var d=u.around(this.domNode,t,i&&i.length?i:x.defaultPosition,!n,r.hitch(this,"orient")),c=d.aroundNodePos;if("M"==d.corner.charAt(0)&&"M"==d.aroundCorner.charAt(0)){this.connectorNode.style.top=c.y+(c.h-this.connectorNode.offsetHeight>>1)-d.y+"px";this.connectorNode.style.left=""}else if("M"==d.corner.charAt(1)&&"M"==d.aroundCorner.charAt(1))this.connectorNode.style.left=c.x+(c.w-this.connectorNode.offsetWidth>>1)-d.x+"px";else{this.connectorNode.style.left="";this.connectorNode.style.top=""}s.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=t;this.onMouseEnter=a||k;this.onMouseLeave=l||k}else this._onDeck=arguments},orient:function(e,t,i,n,o){this.connectorNode.style.top="";var s=n.h,r=n.w;e.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[t+"-"+i];this.domNode.style.width="auto";var l=a.position(this.domNode);(c("ie")||c("trident"))&&(l.w+=2);var d=Math.min(Math.max(r,1),l.w);a.setMarginBox(this.domNode,{w:d});if("B"==i.charAt(0)&&"B"==t.charAt(0)){var h=a.position(e),u=this.connectorNode.offsetHeight;if(h.h>s){var p=s-(o.h+u>>1);this.connectorNode.style.top=p+"px";this.connectorNode.style.bottom=""}else{this.connectorNode.style.bottom=Math.min(Math.max(o.h/2-u/2,0),h.h-u)+"px";this.connectorNode.style.top=""}}else{this.connectorNode.style.top="";this.connectorNode.style.bottom=""}return Math.max(0,l.w-r)},_onShow:function(){c("ie")&&(this.domNode.style.filter="")},hide:function(e){if(this._onDeck&&this._onDeck[1]==e)this._onDeck=null;else if(this.aroundNode===e){this.fadeIn.stop();this.isShowingNow=!1;this.aroundNode=null;this.fadeOut.play()}this.onMouseEnter=this.onMouseLeave=k},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";if(this._onDeck){this.show.apply(this,this._onDeck);this._onDeck=null}}});c("dojo-bidi")&&v.extend({_setAutoTextDir:function(t){this.applyTextDir(t);e.forEach(t.children,(function(e){this._setAutoTextDir(e)}),this)},_setTextDirAttr:function(e){this._set("textDir",e);"auto"==e?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});f.showTooltip=function(t,i,n,o,a,s,r){n&&(n=e.map(n,(function(e){return{after:"after-centered",before:"before-centered"}[e]||e})));x._masterTT||(f._masterTT=x._masterTT=new v);return x._masterTT.show(t,i,n,o,a,s,r)};f.hideTooltip=function(e){return x._masterTT&&x._masterTT.hide(e)};var b="DORMANT",y="SHOW TIMER",w="SHOWING",C="HIDE TIMER";function k(){}var x=t("dijit.Tooltip",p,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(t){e.forEach(this._connections||[],(function(t){e.forEach(t,(function(e){e.remove()}))}),this);this._connectIds=e.filter(r.isArrayLike(t)?t:t?[t]:[],(function(e){return n.byId(e,this.ownerDocument)}),this);this._connections=e.map(this._connectIds,(function(e){var t=n.byId(e,this.ownerDocument),i=this.selector,o=i?function(e){return d.selector(i,e)}:function(e){return e},a=this;return[d(t,o(l.enter),(function(){a._onHover(this)})),d(t,o("focusin"),(function(){a._onHover(this)})),d(t,o(l.leave),r.hitch(a,"_onUnHover")),d(t,o("focusout"),r.hitch(a,"set","state",b))]}),this);this._set("connectId",t)},addTarget:function(t){var i=t.id||t;-1==e.indexOf(this._connectIds,i)&&this.set("connectId",this._connectIds.concat(i))},removeTarget:function(t){var i=t.id||t,n=e.indexOf(this._connectIds,i);if(n>=0){this._connectIds.splice(n,1);this.set("connectId",this._connectIds)}},buildRendering:function(){this.inherited(arguments);o.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var t=this.connectId;e.forEach(r.isArrayLike(t)?t:[t],this.addTarget,this)},getContent:function(e){return this.label||this.domNode.innerHTML},state:b,_setStateAttr:function(e){if(!(this.state==e||e==y&&this.state==w||e==C&&this.state==b)){if(this._hideTimer){this._hideTimer.remove();delete this._hideTimer}if(this._showTimer){this._showTimer.remove();delete this._showTimer}switch(e){case b:if(this._connectNode){x.hide(this._connectNode);delete this._connectNode;this.onHide()}break;case y:this.state!=w&&(this._showTimer=this.defer((function(){this.set("state",w)}),this.showDelay));break;case w:var t=this.getContent(this._connectNode);if(!t){this.set("state",b);return}x.show(t,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,r.hitch(this,"set","state",w),r.hitch(this,"set","state",C));this.onShow(this._connectNode,this.position);break;case C:this._hideTimer=this.defer((function(){this.set("state",b)}),this.hideDelay)}this._set("state",e)}},_onHover:function(e){this._connectNode&&e!=this._connectNode&&this.set("state",b);this._connectNode=e;this.set("state",y)},_onUnHover:function(e){this.set("state",C)},open:function(e){this.set("state",b);this._connectNode=e;this.set("state",w)},close:function(){this.set("state",b)},onShow:function(){},onHide:function(){},destroy:function(){this.set("state",b);e.forEach(this._connections||[],(function(t){e.forEach(t,(function(e){e.remove()}))}),this);this.inherited(arguments)}});x._MasterTooltip=v;x.show=f.showTooltip;x.hide=f.hideTooltip;x.defaultPosition=["after-centered","before-centered"];return x}))},"dijit/place":function(){define(["dojo/_base/array","dojo/dom-geometry","dojo/dom-style","dojo/_base/kernel","dojo/_base/window","./Viewport","./main"],(function(e,t,i,n,o,a,s){function r(n,s,r,l){var d=a.getEffectiveBox(n.ownerDocument);n.parentNode&&"body"==String(n.parentNode.tagName).toLowerCase()||o.body(n.ownerDocument).appendChild(n);var c=null;e.some(s,(function(e){var i=e.corner,o=e.pos,a=0,s={w:{L:d.l+d.w-o.x,R:o.x-d.l,M:d.w}[i.charAt(1)],h:{T:d.t+d.h-o.y,B:o.y-d.t,M:d.h}[i.charAt(0)]},h=n.style;h.left=h.right="auto";if(r){var u=r(n,e.aroundCorner,i,s,l);a=void 0===u?0:u}var p=n.style,m=p.display,g=p.visibility;if("none"==p.display){p.visibility="hidden";p.display=""}var _=t.position(n);p.display=m;p.visibility=g;var f={L:o.x,R:o.x-_.w,M:Math.max(d.l,Math.min(d.l+d.w,o.x+(_.w>>1))-_.w)}[i.charAt(1)],v={T:o.y,B:o.y-_.h,M:Math.max(d.t,Math.min(d.t+d.h,o.y+(_.h>>1))-_.h)}[i.charAt(0)],b=Math.max(d.l,f),y=Math.max(d.t,v),w=Math.min(d.l+d.w,f+_.w)-b,C=Math.min(d.t+d.h,v+_.h)-y;a+=_.w-w+(_.h-C);(null==c||a<c.overflow)&&(c={corner:i,aroundCorner:e.aroundCorner,x:b,y:y,w:w,h:C,overflow:a,spaceAvailable:s});return!a}));c.overflow&&r&&r(n,c.aroundCorner,c.corner,c.spaceAvailable,l);var h=c.y,u=c.x,p=o.body(n.ownerDocument);if(/relative|absolute/.test(i.get(p,"position"))){h-=i.get(p,"marginTop");u-=i.get(p,"marginLeft")}var m=n.style;m.top=h+"px";m.left=u+"px";m.right="auto";return c}var l={TL:"BR",TR:"BL",BL:"TR",BR:"TL"},d={at:function(t,i,n,o,a){return r(t,e.map(n,(function(e){var t={corner:e,aroundCorner:l[e],pos:{x:i.x,y:i.y}};if(o){t.pos.x+="L"==e.charAt(1)?o.x:-o.x;t.pos.y+="T"==e.charAt(0)?o.y:-o.y}return t})),a)},around:function(o,a,s,l,d){var c;if("string"==typeof a||"offsetWidth"in a||"ownerSVGElement"in a){c=t.position(a,!0);if(/^(above|below)/.test(s[0])){var h=t.getBorderExtents(a),u=a.firstChild?t.getBorderExtents(a.firstChild):{t:0,l:0,b:0,r:0},p=t.getBorderExtents(o),m=o.firstChild?t.getBorderExtents(o.firstChild):{t:0,l:0,b:0,r:0};c.y+=Math.min(h.t+u.t,p.t+m.t);c.h-=Math.min(h.t+u.t,p.t+m.t)+Math.min(h.b+u.b,p.b+m.b)}}else c=a;if(a.parentNode)for(var g="absolute"==i.getComputedStyle(a).position,_=a.parentNode;_&&1==_.nodeType&&"BODY"!=_.nodeName;){var f=t.position(_,!0),v=i.getComputedStyle(_);/relative|absolute/.test(v.position)&&(g=!1);if(!g&&/hidden|auto|scroll/.test(v.overflow)){var b=Math.min(c.y+c.h,f.y+f.h),y=Math.min(c.x+c.w,f.x+f.w);c.x=Math.max(c.x,f.x);c.y=Math.max(c.y,f.y);c.h=b-c.y;c.w=y-c.x}"absolute"==v.position&&(g=!0);_=_.parentNode}var w=c.x,C=c.y,k="w"in c?c.w:c.w=c.width,x="h"in c?c.h:(n.deprecated("place.around: dijit/place.__Rectangle: { x:"+w+", y:"+C+", height:"+c.height+", width:"+k+" } has been deprecated.  Please use { x:"+w+", y:"+C+", h:"+c.height+", w:"+k+" }","","2.0"),c.h=c.height),T=[];function A(e,t){T.push({aroundCorner:e,corner:t,pos:{x:{L:w,R:w+k,M:w+(k>>1)}[e.charAt(1)],y:{T:C,B:C+x,M:C+(x>>1)}[e.charAt(0)]}})}e.forEach(s,(function(e){var t=l;switch(e){case"above-centered":A("TM","BM");break;case"below-centered":A("BM","TM");break;case"after-centered":t=!t;case"before-centered":A(t?"ML":"MR",t?"MR":"ML");break;case"after":t=!t;case"before":A(t?"TL":"TR",t?"TR":"TL");A(t?"BL":"BR",t?"BR":"BL");break;case"below-alt":t=!t;case"below":A(t?"BL":"BR",t?"TL":"TR");A(t?"BR":"BL",t?"TR":"TL");break;case"above-alt":t=!t;case"above":A(t?"TL":"TR",t?"BL":"BR");A(t?"TR":"TL",t?"BR":"BL");break;default:A(e.aroundCorner,e.corner)}}));var j=r(o,T,d,{w:k,h:x});j.aroundNodePos=c;return j}};return s.place=d}))},"dojox/uuid/generateRandomUuid":function(){define(["./_base"],(function(){dojox.uuid.generateRandomUuid=function(){function e(){for(var e=Math.floor(Math.random()%1*Math.pow(2,32)).toString(16);e.length<8;)e="0"+e;return e}var t="-",i=e(),n=e();n=n.substring(0,4)+t+"4"+n.substring(5,8);var o=e(),a=i+t+n+t+(o="8"+o.substring(1,4)+t+o.substring(4,8))+e();return a=a.toLowerCase()};return dojox.uuid.generateRandomUuid}))},"dojox/uuid/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang"],(function(e){e.getObject("uuid",!0,dojox);dojox.uuid.NIL_UUID="00000000-0000-0000-0000-000000000000";dojox.uuid.version={UNKNOWN:0,TIME_BASED:1,DCE_SECURITY:2,NAME_BASED_MD5:3,RANDOM:4,NAME_BASED_SHA1:5};dojox.uuid.variant={NCS:"0",DCE:"10",MICROSOFT:"110",UNKNOWN:"111"};dojox.uuid.assert=function(e,t){if(!e){t||(t="An assert statement failed.\nThe method dojox.uuid.assert() was called with a 'false' value.\n");throw new Error(t)}};dojox.uuid.generateNilUuid=function(){return dojox.uuid.NIL_UUID};dojox.uuid.isValid=function(t){t=t.toString();var i=e.isString(t)&&36==t.length&&t==t.toLowerCase();if(i){var n=t.split("-");i=5==n.length&&8==n[0].length&&4==n[1].length&&4==n[2].length&&4==n[3].length&&12==n[4].length;for(var o in n){var a=n[o],s=parseInt(a,16);i=i&&isFinite(s)}}return i};dojox.uuid.getVariant=function(e){if(!dojox.uuid._ourVariantLookupTable){var t=dojox.uuid.variant,i=[];i[0]=t.NCS;i[1]=t.NCS;i[2]=t.NCS;i[3]=t.NCS;i[4]=t.NCS;i[5]=t.NCS;i[6]=t.NCS;i[7]=t.NCS;i[8]=t.DCE;i[9]=t.DCE;i[10]=t.DCE;i[11]=t.DCE;i[12]=t.MICROSOFT;i[13]=t.MICROSOFT;i[14]=t.UNKNOWN;i[15]=t.UNKNOWN;dojox.uuid._ourVariantLookupTable=i}var n=(e=e.toString()).charAt(19),o=parseInt(n,16);dojox.uuid.assert(o>=0&&o<=16);return dojox.uuid._ourVariantLookupTable[o]};dojox.uuid.getVersion=function(e){dojox.uuid.assert(dojox.uuid.getVariant(e)==dojox.uuid.variant.DCE,"dojox.uuid.getVersion() was not passed a DCE Variant UUID.");var t=(e=e.toString()).charAt(14);return parseInt(t,16)};dojox.uuid.getNode=function(e){dojox.uuid.assert(dojox.uuid.getVersion(e)==dojox.uuid.version.TIME_BASED,"dojox.uuid.getNode() was not passed a TIME_BASED UUID.");return(e=e.toString()).split("-")[4]};dojox.uuid.getTimestamp=function(e,t){dojox.uuid.assert(dojox.uuid.getVersion(e)==dojox.uuid.version.TIME_BASED,"dojox.uuid.getTimestamp() was not passed a TIME_BASED UUID.");e=e.toString();t||(t=null);switch(t){case"string":case String:return dojox.uuid.getTimestamp(e,Date).toUTCString();case"hex":var i=e.split("-"),n=i[0],o=i[1],a=i[2],s=(a=a.slice(1))+o+n;dojox.uuid.assert(15==s.length);return s;case null:case"date":case Date:var r=e.split("-"),l=parseInt(r[0],16),d=parseInt(r[1],16),c=4095&parseInt(r[2],16);c<<=16;c+=d;c*=4294967296;c+=l;return new Date(c/1e4-122192928e5);default:dojox.uuid.assert(!1,"dojox.uuid.getTimestamp was not passed a valid returnType: "+t)}};return dojox.uuid}))},"dojo/back":function(){define(["./_base/config","./_base/lang","./sniff","./dom","./dom-construct","./_base/window","require"],(function(e,t,i,n,o,a,s){var r={};t.setObject("dojo.back",r);var l=r.getHash=function(){var e=window.location.hash;"#"==e.charAt(0)&&(e=e.substring(1));return i("mozilla")?e:decodeURIComponent(e)},d=r.setHash=function(e){e||(e="");window.location.hash=encodeURIComponent(e);history.length},c="undefined"!=typeof window?window.location.href:"",h="undefined"!=typeof window?l():"",u=null,p=null,m=null,g=null,_=[],f=[],v=!1,b=!1;function y(){var e=f.pop();if(e){var t=f[f.length-1];t||0!=f.length||(t=u);t&&(t.kwArgs.back?t.kwArgs.back():t.kwArgs.backButton?t.kwArgs.backButton():t.kwArgs.handle&&t.kwArgs.handle("back"));_.push(e)}}r.goBack=y;function w(){var e=_.pop();if(e){e.kwArgs.forward?e.kwArgs.forward():e.kwArgs.forwardButton?e.kwArgs.forwardButton():e.kwArgs.handle&&e.kwArgs.handle("forward");f.push(e)}}r.goForward=w;function C(e,t,i){return{url:e,kwArgs:t,urlHash:i}}function k(e){var t=e.split("?");return t.length<2?null:t[1]}function x(){var t=(e.dojoIframeHistoryUrl||s.toUrl("./resources/iframe_history.html"))+"?"+(new Date).getTime();v=!0;g&&(i("webkit")?g.location=t:window.frames[g.name].location=t);return t}function T(){if(!b){var e=f.length,t=l();if((t===h||window.location.href==c)&&1==e){y();return}if(_.length>0&&_[_.length-1].urlHash===t){w();return}e>=2&&f[e-2]&&f[e-2].urlHash===t&&y()}}r.init=function(){if(!n.byId("dj_history")){var t=e.dojoIframeHistoryUrl||s.toUrl("./resources/iframe_history.html");e.afterOnLoad||document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+t+'"></iframe>')}};r.setInitialState=function(e){u=C(c,e,h)};r.addToHistory=function(t){_=[];var n=null,s=null;if(!g){e.useXDomain&&e.dojoIframeHistoryUrl;g=window.frames.dj_history}m||(m=o.create("a",{style:{display:"none"}},a.body()));if(t.changeUrl){n=""+(!0!==t.changeUrl?t.changeUrl:(new Date).getTime());if(0==f.length&&u.urlHash==n){u=C(s,t,n);return}if(f.length>0&&f[f.length-1].urlHash==n){f[f.length-1]=C(s,t,n);return}b=!0;setTimeout((function(){d(n);b=!1}),1);m.href=n;if(i("ie")){s=x();var r=t.back||t.backButton||t.handle,c=function(e){""!=l()&&setTimeout((function(){d(n)}),1);r.apply(this,[e])};t.back?t.back=c:t.backButton?t.backButton=c:t.handle&&(t.handle=c);var h=t.forward||t.forwardButton||t.handle,v=function(e){""!=l()&&d(n);h&&h.apply(this,[e])};t.forward?t.forward=v:t.forwardButton?t.forwardButton=v:t.handle&&(t.handle=v)}else i("ie")||p||(p=setInterval(T,200))}else s=x();f.push(C(s,t,n))};r._iframeLoaded=function(e,t){var i=k(t.href);null!=i?v?v=!1:f.length>=2&&i==k(f[f.length-2].url)?y():_.length>0&&i==k(_[_.length-1].url)&&w():1==f.length&&y()};return r}))},"dojo/hash":function(){define(["./_base/kernel","require","./_base/config","./aspect","./_base/lang","./topic","./domReady","./sniff"],(function(e,t,i,n,o,a,s,r){e.hash=function(e,t){if(!arguments.length)return p();"#"==e.charAt(0)&&(e=e.substring(1));t?_(e):location.hash="#"+e;return e};var l,d,c,h=i.hashPollFrequency||100;function u(e,t){var i=e.indexOf(t);return i>=0?e.substring(i+1):""}function p(){return u(location.href,"#")}function m(){a.publish("/dojo/hashchange",p())}function g(){if(p()!==l){l=p();m()}}function _(e){if(d){if(d.isTransitioning()){setTimeout(o.hitch(null,_,e),h);return}var t=(i=d.iframe.location.href).indexOf("?");d.iframe.location.replace(i.substring(0,t)+"?"+e)}else{var i=location.href.replace(/#.*/,"");location.replace(i+"#"+e);!c&&g()}}function f(){var n=document.createElement("iframe"),a="dojo-hash-iframe",s=i.dojoBlankHtmlUrl||t.toUrl("./resources/blank.html");i.useXDomain&&i.dojoBlankHtmlUrl;n.id=a;n.src=s+"?"+p();n.style.display="none";document.body.appendChild(n);this.iframe=e.global[a];var r,d,c,g,_,f=this.iframe.location;function v(){l=p();r=_?l:u(f.href,"?");d=!1;c=null}this.isTransitioning=function(){return d};this.pollLocation=function(){if(!_)try{var e=u(f.href,"?");document.title!=g&&(g=this.iframe.document.title=document.title)}catch(i){_=!0}var t=p();if(d&&l===t){if(!_&&e!==c){setTimeout(o.hitch(this,this.pollLocation),0);return}v();m()}else if(l!==t||!_&&r!==e){if(l!==t){l=t;d=!0;c=t;n.src=s+"?"+c;_=!1;setTimeout(o.hitch(this,this.pollLocation),0);return}if(!_){location.href="#"+f.search.substring(1);v();m()}}else;setTimeout(o.hitch(this,this.pollLocation),h)};v();setTimeout(o.hitch(this,this.pollLocation),h)}s((function(){if("onhashchange"in e.global&&(!r("ie")||r("ie")>=8&&"BackCompat"!=document.compatMode))c=n.after(e.global,"onhashchange",m,!0);else if(document.addEventListener){l=p();setInterval(g,h)}else document.attachEvent&&(d=new f)}));return e.hash}))},"dojox/dtl/filter/strings":function(){define(["dojo/_base/lang","dojo/_base/array","dojox/string/tokenize","dojox/string/sprintf","../filter/htmlstrings","../_base"],(function(e,t,i,n,o,a){var s=e.getObject("filter.strings",!0,a);e.mixin(s,{_urlquote:function(e,t){t||(t="/");return i(e,/([^\w-_.])/g,(function(e){if(-1==t.indexOf(e)){if(" "==e)return"+";for(var i=e.charCodeAt(0).toString(16).toUpperCase();i.length<2;)i="0"+i;return"%"+i}return e})).join("")},addslashes:function(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'")},capfirst:function(e){return(e=""+e).charAt(0).toUpperCase()+e.substring(1)},center:function(e,t){var i=(t=t||e.length)-(e+="").length;if(i%2){e+=" ";i-=1}for(var n=0;n<i;n+=2)e=" "+e+" ";return e},cut:function(e,t){t=t+""||"";return(e+="").replace(new RegExp(t,"g"),"")},_fix_ampersands:/&(?!(\w+|#\d+);)/g,fix_ampersands:function(e){return e.replace(s._fix_ampersands,"&amp;")},floatformat:function(e,t){t=parseInt(t||-1,10);if(!((e=parseFloat(e))-e.toFixed(0))&&t<0)return e.toFixed();e=e.toFixed(Math.abs(t));return t<0?parseFloat(e)+"":e},iriencode:function(e){return s._urlquote(e,"/#%[]=:;$&()+,!")},linenumbers:function(e){for(var t,i=dojox.dtl.filter,n=e.split("\n"),o=[],a=(n.length+"").length,s=0;s<n.length;s++){t=n[s];o.push(i.strings.ljust(s+1,a)+". "+dojox.dtl._base.escape(t))}return o.join("\n")},ljust:function(e,t){e+="";t=parseInt(t,10);for(;e.length<t;)e+=" ";return e},lower:function(e){return(e+"").toLowerCase()},make_list:function(e){var t=[];"number"==typeof e&&(e+="");if(e.charAt){for(var i=0;i<e.length;i++)t.push(e.charAt(i));return t}if("object"==typeof e){for(var n in e)t.push(e[n]);return t}return[]},rjust:function(e,t){e+="";t=parseInt(t,10);for(;e.length<t;)e=" "+e;return e},slugify:function(e){return(e=e.replace(/[^\w\s-]/g,"").toLowerCase()).replace(/[\-\s]+/g,"-")},_strings:{},stringformat:function(e,t){t=""+t;var i=s._strings;i[t]||(i[t]=new n.Formatter("%"+t));return i[t].format(e)},title:function(e){for(var t,i,n="",o=0;o<e.length;o++){i=e.charAt(o);n+=" "!=t&&"\n"!=t&&"\t"!=t&&t?i.toLowerCase():i.toUpperCase();t=i}return n},_truncatewords:/[ \n\r\t]/,truncatewords:function(e,t){if(!(t=parseInt(t,10)))return e;for(var i,n,o=0,a=e.length,r=0;o<e.length;o++){i=e.charAt(o);if(s._truncatewords.test(n)){if(!s._truncatewords.test(i)&&++r==t)return e.substring(0,a+1)+" ..."}else s._truncatewords.test(i)||(a=o);n=i}return e},_truncate_words:/(&.*?;|<.*?>|(\w[\w\-]*))/g,_truncate_tag:/<(\/)?([^ ]+?)(?: (\/)| .*?)?>/,_truncate_singlets:{br:!0,col:!0,link:!0,base:!0,img:!0,param:!0,area:!0,hr:!0,input:!0},truncatewords_html:function(e,n){if((n=parseInt(n,10))<=0)return"";var o=0,a=[],r=i(e,s._truncate_words,(function(e,i){if(i){if(++o<n)return i;if(o==n)return i+" ..."}var r=e.match(s._truncate_tag);if(r&&!(o>=n)){var l=r[1],d=r[2].toLowerCase();r[3];if(l||s._truncate_singlets[d]);else if(l){var c=t.indexOf(a,d);-1!=c&&(a=a.slice(c+1))}else a.unshift(d);return e}})).join("");r=r.replace(/\s+$/g,"");for(var l,d=0;l=a[d];d++)r+="</"+l+">";return r},upper:function(e){return e.toUpperCase()},urlencode:function(e){return s._urlquote(e)},_urlize:/^((?:[(>]|&lt;)*)(.*?)((?:[.,)>\n]|&gt;)*)$/,_urlize2:/^\S+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/,urlize:function(e){return s.urlizetrunc(e)},urlizetrunc:function(e,t){t=parseInt(t);return i(e,/(\S+)/g,(function(e){var i=s._urlize.exec(e);if(!i)return e;i[1];var n=i[2],o=(i[3],0==n.indexOf("www.")),a=-1!=n.indexOf("@"),r=-1!=n.indexOf(":"),l=0==n.indexOf("http://"),d=0==n.indexOf("https://"),c=/[a-zA-Z0-9]/.test(n.charAt(0)),h=n.substring(n.length-4),u=n;t>3&&(u=u.substring(0,t-3)+"...");return o||!a&&!l&&n.length&&c&&(".org"==h||".net"==h||".com"==h)?'<a href="http://'+n+'" rel="nofollow">'+u+"</a>":l||d?'<a href="'+n+'" rel="nofollow">'+u+"</a>":a&&!o&&!r&&s._urlize2.test(n)?'<a href="mailto:'+n+'">'+n+"</a>":e})).join("")},wordcount:function(t){return(t=e.trim(t))?t.split(/\s+/g).length:0},wordwrap:function(e,t){t=parseInt(t);var i=[],n=e.split(/\s+/g);if(n.length){var o=n.shift();i.push(o);for(var a=o.length-o.lastIndexOf("\n")-1,s=0;s<n.length;s++){if(-1!=(o=n[s]).indexOf("\n"))var r=o.split(/\n/g);else r=[o];a+=r[0].length+1;if(t&&a>t){i.push("\n");a=r[r.length-1].length}else{i.push(" ");r.length>1&&(a=r[r.length-1].length)}i.push(o)}}return i.join("")}});return s}))},"dojox/string/tokenize":function(){define(["dojo/_base/lang","dojo/_base/sniff"],(function(e,t){e.getObject("dojox.string",!0).tokenize;return function(e,i,n,o){for(var a,s,r=[],l=0;a=i.exec(e);){(s=e.slice(l,i.lastIndex-a[0].length)).length&&r.push(s);if(n){if(t("opera")){for(var d=a.slice(0);d.length<a.length;)d.push(null);a=d}var c=n.apply(o,a.slice(1).concat(r.length));void 0!==c&&r.push(c)}l=i.lastIndex}(s=e.slice(l)).length&&r.push(s);return r}}))},"dojox/string/sprintf":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/sniff","./tokenize"],(function(e,t,i,n){var o=t.getObject("string",!0,dojox);o.sprintf=function(e,t){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var a=new o.sprintf.Formatter(e);return a.format.apply(a,i)};o.sprintf.Formatter=function(e){this._mapped=!1;this._format=e;this._tokens=n(e,this._re,this._parseDelim,this)};t.extend(o.sprintf.Formatter,{_re:/\%(?:\(([\w_]+)\)|([1-9]\d*)\$)?([0 +\-\#]*)(\*|\d+)?(\.)?(\*|\d+)?[hlL]?([\%scdeEfFgGiouxX])/g,_parseDelim:function(e,t,i,n,o,a,s){e&&(this._mapped=!0);return{mapping:e,intmapping:t,flags:i,_minWidth:n,period:o,_precision:a,specifier:s}},_specifiers:{b:{base:2,isInt:!0},o:{base:8,isInt:!0},x:{base:16,isInt:!0},X:{extend:["x"],toUpper:!0},d:{base:10,isInt:!0},i:{extend:["d"]},u:{extend:["d"],isUnsigned:!0},c:{setArg:function(e){if(!isNaN(e.arg)){var t=parseInt(e.arg);if(t<0||t>127)throw new Error("invalid character code passed to %c in sprintf");e.arg=isNaN(t)?""+t:String.fromCharCode(t)}}},s:{setMaxWidth:function(e){e.maxWidth="."==e.period?e.precision:-1}},e:{isDouble:!0,doubleNotation:"e"},E:{extend:["e"],toUpper:!0},f:{isDouble:!0,doubleNotation:"f"},F:{extend:["f"]},g:{isDouble:!0,doubleNotation:"g"},G:{extend:["g"],toUpper:!0}},format:function(e){if(this._mapped&&"object"!=typeof e)throw new Error("format requires a mapping");for(var i,n="",o=0,a=0;a<this._tokens.length;a++)if("string"==typeof(i=this._tokens[a]))n+=i;else{if(this._mapped){if(void 0===e[i.mapping])throw new Error("missing key "+i.mapping);i.arg=e[i.mapping]}else{if(i.intmapping)o=parseInt(i.intmapping)-1;if(o>=arguments.length)throw new Error("got "+arguments.length+" printf arguments, insufficient for '"+this._format+"'");i.arg=arguments[o++]}if(!i.compiled){i.compiled=!0;i.sign="";i.zeroPad=!1;i.rightJustify=!1;i.alternative=!1;for(var s={},r=i.flags.length;r--;){var l=i.flags.charAt(r);s[l]=!0;switch(l){case" ":i.sign=" ";break;case"+":i.sign="+";break;case"0":i.zeroPad=!s["-"];break;case"-":i.rightJustify=!0;i.zeroPad=!1;break;case"#":i.alternative=!0;break;default:throw Error("bad formatting flag '"+i.flags.charAt(r)+"'")}}i.minWidth=i._minWidth?parseInt(i._minWidth):0;i.maxWidth=-1;i.toUpper=!1;i.isUnsigned=!1;i.isInt=!1;i.isDouble=!1;i.precision=1;"."==i.period&&(i._precision?i.precision=parseInt(i._precision):i.precision=0);var d=this._specifiers[i.specifier];if(void 0===d)throw new Error("unexpected specifier '"+i.specifier+"'");if(d.extend){t.mixin(d,this._specifiers[d.extend]);delete d.extend}t.mixin(i,d)}"function"==typeof i.setArg&&i.setArg(i);"function"==typeof i.setMaxWidth&&i.setMaxWidth(i);if("*"==i._minWidth){if(this._mapped)throw new Error("* width not supported in mapped formats");i.minWidth=parseInt(arguments[o++]);if(isNaN(i.minWidth))throw new Error("the argument for * width at position "+o+" is not a number in "+this._format);if(i.minWidth<0){i.rightJustify=!0;i.minWidth=-i.minWidth}}if("*"==i._precision&&"."==i.period){if(this._mapped)throw new Error("* precision not supported in mapped formats");i.precision=parseInt(arguments[o++]);if(isNaN(i.precision))throw Error("the argument for * precision at position "+o+" is not a number in "+this._format);if(i.precision<0){i.precision=1;i.period=""}}if(i.isInt){"."==i.period&&(i.zeroPad=!1);this.formatInt(i)}else if(i.isDouble){"."!=i.period&&(i.precision=6);this.formatDouble(i)}this.fitField(i);n+=""+i.arg}return n},_zeros10:"0000000000",_spaces10:"          ",formatInt:function(e){var t=parseInt(e.arg);if(!isFinite(t)){if("number"!=typeof e.arg)throw new Error("format argument '"+e.arg+"' not an integer; parseInt returned "+t);t=0}t<0&&(e.isUnsigned||10!=e.base)&&(t=4294967295+t+1);if(t<0){e.arg=(-t).toString(e.base);this.zeroPad(e);e.arg="-"+e.arg}else{e.arg=t.toString(e.base);t||e.precision?this.zeroPad(e):e.arg="";e.sign&&(e.arg=e.sign+e.arg)}if(16==e.base){e.alternative&&(e.arg="0x"+e.arg);e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()}8==e.base&&e.alternative&&"0"!=e.arg.charAt(0)&&(e.arg="0"+e.arg)},formatDouble:function(e){var t=parseFloat(e.arg);if(!isFinite(t)){if("number"!=typeof e.arg)throw new Error("format argument '"+e.arg+"' not a float; parseFloat returned "+t);t=0}switch(e.doubleNotation){case"e":e.arg=t.toExponential(e.precision);break;case"f":e.arg=t.toFixed(e.precision);break;case"g":Math.abs(t)<1e-4?e.arg=t.toExponential(e.precision>0?e.precision-1:e.precision):e.arg=t.toPrecision(e.precision);if(!e.alternative){e.arg=e.arg.replace(/(\..*[^0])0*/,"$1");e.arg=e.arg.replace(/\.0*e/,"e").replace(/\.0$/,"")}break;default:throw new Error("unexpected double notation '"+e.doubleNotation+"'")}e.arg=e.arg.replace(/e\+(\d)$/,"e+0$1").replace(/e\-(\d)$/,"e-0$1");i("opera")&&(e.arg=e.arg.replace(/^\./,"0."));if(e.alternative){e.arg=e.arg.replace(/^(\d+)$/,"$1.");e.arg=e.arg.replace(/^(\d+)e/,"$1.e")}t>=0&&e.sign&&(e.arg=e.sign+e.arg);e.arg=e.toUpper?e.arg.toUpperCase():e.arg.toLowerCase()},zeroPad:function(e,t){t=2==arguments.length?t:e.precision;"string"!=typeof e.arg&&(e.arg=""+e.arg);for(var i=t-10;e.arg.length<i;)e.arg=e.rightJustify?e.arg+this._zeros10:this._zeros10+e.arg;var n=t-e.arg.length;e.arg=e.rightJustify?e.arg+this._zeros10.substring(0,n):this._zeros10.substring(0,n)+e.arg},fitField:function(e){if(e.maxWidth>=0&&e.arg.length>e.maxWidth)return e.arg.substring(0,e.maxWidth);e.zeroPad?this.zeroPad(e,e.minWidth):this.spacePad(e)},spacePad:function(e,t){t=2==arguments.length?t:e.minWidth;"string"!=typeof e.arg&&(e.arg=""+e.arg);for(var i=t-10;e.arg.length<i;)e.arg=e.rightJustify?e.arg+this._spaces10:this._spaces10+e.arg;var n=t-e.arg.length;e.arg=e.rightJustify?e.arg+this._spaces10.substring(0,n):this._spaces10.substring(0,n)+e.arg}});return o.sprintf}))},"dojox/dtl/filter/htmlstrings":function(){define(["dojo/_base/lang","../_base"],(function(e,t){var i=e.getObject("filter.htmlstrings",!0,t);e.mixin(i,{_linebreaksrn:/(\r\n|\n\r)/g,_linebreaksn:/\n{2,}/g,_linebreakss:/(^\s+|\s+$)/g,_linebreaksbr:/\n/g,_removetagsfind:/[a-z0-9]+/g,_striptags:/<[^>]*?>/g,linebreaks:function(e){for(var t=[],n=i,o=(e=e.replace(n._linebreaksrn,"\n")).split(n._linebreaksn),a=0;a<o.length;a++){var s=o[a].replace(n._linebreakss,"").replace(n._linebreaksbr,"<br />");t.push("<p>"+s+"</p>")}return t.join("\n\n")},linebreaksbr:function(e){var t=i;return e.replace(t._linebreaksrn,"\n").replace(t._linebreaksbr,"<br />")},removetags:function(e,t){for(var n,o=i,a=[];n=o._removetagsfind.exec(t);)a.push(n[0]);a="("+a.join("|")+")";return e.replace(new RegExp("</?s*"+a+"s*[^>]*>","gi"),"")},striptags:function(e){return e.replace(dojox.dtl.filter.htmlstrings._striptags,"")}});return i}))},"dojox/dtl/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox/string/tokenize","dojo/_base/json","dojo/dom","dojo/_base/xhr","dojox/string/Builder","dojo/_base/Deferred"],(function(e,t,n,o,a,s,r,l){e.experimental("dojox.dtl");var d=t.getObject("dojox.dtl",!0);d._base={};d.TOKEN_BLOCK=-1;d.TOKEN_VAR=-2;d.TOKEN_COMMENT=-3;d.TOKEN_TEXT=3;d._Context=t.extend((function(e){if(e){t._mixin(this,e);if(e.get){this._getter=e.get;delete this.get}}}),{push:function(){var e=this,i=t.delegate(this);i.pop=function(){return e};return i},pop:function(){throw new Error("pop() called on empty Context")},get:function(e,t){var i=this._normalize;if(this._getter){var n=this._getter(e);if(void 0!==n)return i(n)}return void 0!==this[e]?i(this[e]):t},_normalize:function(e){if(e instanceof Date){e.year=e.getFullYear();e.month=e.getMonth()+1;e.day=e.getDate();e.date=e.year+"-"+("0"+e.month).slice(-2)+"-"+("0"+e.day).slice(-2);e.hour=e.getHours();e.minute=e.getMinutes();e.second=e.getSeconds();e.microsecond=e.getMilliseconds()}return e},update:function(e){var i=this.push();e&&t._mixin(this,e);return i}});var c=/("(?:[^"\\]*(?:\\.[^"\\]*)*)"|'(?:[^'\\]*(?:\\.[^'\\]*)*)'|[^\s]+)/g,h=/\s+/g,u=function(e,t){(e=e||h)instanceof RegExp||(e=new RegExp(e,"g"));if(!e.global)throw new Error("You must use a globally flagged RegExp with split "+e);e.exec("");for(var i,n=[],o=0,a=0;i=e.exec(this);){n.push(this.slice(o,e.lastIndex-i[0].length));o=e.lastIndex;if(t&&++a>t-1)break}n.push(this.slice(o));return n};d.Token=function(e,i){this.token_type=e;this.contents=new String(t.trim(i));this.contents.split=u;this.split=function(){return String.prototype.split.apply(this.contents,arguments)}};d.Token.prototype.split_contents=function(e){var t,i=[],n=0;e=e||999;for(;n++<e&&(t=c.exec(this.contents));)'"'==(t=t[0]).charAt(0)&&'"'==t.slice(-1)?i.push('"'+t.slice(1,-1).replace('\\"','"').replace("\\\\","\\")+'"'):"'"==t.charAt(0)&&"'"==t.slice(-1)?i.push("'"+t.slice(1,-1).replace("\\'","'").replace("\\\\","\\")+"'"):i.push(t);return i};var p=d.text={_get:function(e,i,n){var o=d.register.get(e,i.toLowerCase(),n);if(!o){if(!n)throw new Error("No tag found for "+i);return null}var a,s=o[1],r=o[2];if(-1!=s.indexOf(":")){a=s.split(":");s=a.pop()}var l=r;/\./.test(r)&&(r=r.replace(/\./g,"/"));require([r],(function(){}));var c=t.getObject(l);return c[s||i]||c[i+"_"]||c[s+"_"]},getTag:function(e,t){return p._get("tag",e,t)},getFilter:function(e,t){return p._get("filter",e,t)},getTemplate:function(e){return new d.Template(p.getTemplateString(e))},getTemplateString:function(e){return s._getText(e.toString())||""},_resolveLazy:function(e,t,i){return t?i?i.fromJson(s._getText(e))||{}:d.text.getTemplateString(e):s.get({handleAs:i?"json":"text",url:e})},_resolveTemplateArg:function(e,t){if(p._isTemplate(e)){if(!t){var i=new l;i.callback(e);return i}return e}return p._resolveLazy(e,t)},_isTemplate:function(e){return void 0===e||"string"==typeof e&&(e.match(/^\s*[<{]/)||-1!=e.indexOf(" "))},_resolveContextArg:function(e,t){if(e.constructor==Object){if(!t){var i=new l;i.callback(e);return i}return e}return p._resolveLazy(e,t,!0)},_re:/(?:\{\{\s*(.+?)\s*\}\}|\{%\s*(load\s*)?(.+?)\s*%\})/g,tokenize:function(e){return n(e,p._re,p._parseDelims)},_parseDelims:function(e,i,n){if(e)return[d.TOKEN_VAR,e];if(!i)return[d.TOKEN_BLOCK,n];for(var o,a=t.trim(n).split(/\s+/g),s=0;o=a[s];s++){/\./.test(o)&&(o=o.replace(/\./g,"/"));require([o])}}};d.Template=t.extend((function(e,t){var i=t?e:p._resolveTemplateArg(e,!0)||"",n=p.tokenize(i),o=new d._Parser(n);this.nodelist=o.parse()}),{update:function(e,t){return p._resolveContextArg(t).addCallback(this,(function(t){var i=this.render(new d._Context(t));e.forEach?e.forEach((function(e){e.innerHTML=i})):a.byId(e).innerHTML=i;return this}))},render:function(e,t){t=t||this.getBuffer();e=e||new d._Context({});return this.nodelist.render(e,t)+""},getBuffer:function(){return new r}});var m=/\{\{\s*(.+?)\s*\}\}/g;d.quickFilter=function(e){return e?-1==e.indexOf("{%")?new d._QuickNodeList(n(e,m,(function(e){return new d._Filter(e)}))):void 0:new d._NodeList};d._QuickNodeList=t.extend((function(e){this.contents=e}),{render:function(e,t){for(var i=0,n=this.contents.length;i<n;i++)t=this.contents[i].resolve?t.concat(this.contents[i].resolve(e)):t.concat(this.contents[i]);return t},dummyRender:function(e){return this.render(e,d.Template.prototype.getBuffer()).toString()},clone:function(e){return this}});d._Filter=t.extend((function(e){if(!e)throw new Error("Filter must be called with variable name");this.contents=e;var t=this._cache[e];if(t){this.key=t[0];this.filters=t[1]}else{this.filters=[];n(e,this._re,this._tokenize,this);this._cache[e]=[this.key,this.filters]}}),{_cache:{},_re:/(?:^_\("([^\\"]*(?:\\.[^\\"])*)"\)|^"([^\\"]*(?:\\.[^\\"]*)*)"|^([a-zA-Z0-9_.]+)|\|(\w+)(?::(?:_\("([^\\"]*(?:\\.[^\\"])*)"\)|"([^\\"]*(?:\\.[^\\"]*)*)"|([a-zA-Z0-9_.]+)|'([^\\']*(?:\\.[^\\']*)*)'))?|^'([^\\']*(?:\\.[^\\']*)*)')/g,_values:{0:'"',1:'"',2:"",8:'"'},_args:{4:'"',5:'"',6:"",7:"'"},_tokenize:function(){for(var e,i,n=0,o=[];n<arguments.length;n++)o[n]=void 0!==arguments[n]&&"string"==typeof arguments[n]&&arguments[n];if(this.key){for(e in this._args)if(o[e]){var a=arguments[e];"'"==this._args[e]?a=a.replace(/\\'/g,"'"):'"'==this._args[e]&&(a=a.replace(/\\"/g,'"'));i=[!this._args[e],a];break}var s=p.getFilter(arguments[3]);if(!t.isFunction(s))throw new Error(arguments[3]+" is not registered as a filter");this.filters.push([s,i])}else for(e in this._values)if(o[e]){this.key=this._values[e]+arguments[e]+this._values[e];break}},getExpression:function(){return this.contents},resolve:function(e){if(void 0===this.key)return"";for(var t,i=this.resolvePath(this.key,e),n=0;t=this.filters[n];n++)i=t[1]?t[1][0]?t[0](i,this.resolvePath(t[1][1],e)):t[0](i,t[1][1]):t[0](i);return i},resolvePath:function(e,i){var n,o,a=e.charAt(0),s=e.slice(-1);if(isNaN(parseInt(a)))if('"'==a&&a==s)n=e.slice(1,-1);else{if("true"==e)return!0;if("false"==e)return!1;if("null"==e||"None"==e)return null;o=e.split(".");n=i.get(o[0]);if(t.isFunction(n)){var r=i.getThis&&i.getThis();n=n.alters_data?"":r?n.call(r):""}for(var l=1;l<o.length;l++){var c=o[l];if(!n)return"";var h=n;if(t.isObject(n)&&"items"==c&&void 0===n[c]){var u=[];for(var p in n)u.push([p,n[p]]);n=u}else{if(n.get&&t.isFunction(n.get)&&n.get.safe)n=n.get(c);else{if(void 0===n[c]){n=n[c];break}n=n[c]}t.isFunction(n)?n=n.alters_data?"":n.call(h):n instanceof Date&&(n=d._Context.prototype._normalize(n))}}}else n=-1==e.indexOf(".")?parseInt(e):parseFloat(e);return n}});d._TextNode=d._Node=t.extend((function(e){this.contents=e}),{set:function(e){this.contents=e;return this},render:function(e,t){return t.concat(this.contents)},isEmpty:function(){return!t.trim(this.contents)},clone:function(){return this}});d._NodeList=t.extend((function(e){this.contents=e||[];this.last=""}),{push:function(e){this.contents.push(e);return this},concat:function(e){this.contents=this.contents.concat(e);return this},render:function(e,t){for(var i=0;i<this.contents.length;i++)if(!(t=this.contents[i].render(e,t)))throw new Error("Template must return buffer");return t},dummyRender:function(e){return this.render(e,d.Template.prototype.getBuffer()).toString()},unrender:function(){return arguments[1]},clone:function(){return this},rtrim:function(){for(;;){i=this.contents.length-1;if(!(this.contents[i]instanceof d._TextNode&&this.contents[i].isEmpty()))break;this.contents.pop()}return this}});d._VarNode=t.extend((function(e){this.contents=new d._Filter(e)}),{render:function(e,t){var i=this.contents.resolve(e);null==i&&(i="");i.safe||(i=d._base.escape(""+i));return t.concat(i)}});d._noOpNode=new function(){this.render=this.unrender=function(){return arguments[1]};this.clone=function(){return this}};d._Parser=t.extend((function(e){this.contents=e}),{i:0,parse:function(e){var t,i={};e=e||[];for(var n=0;n<e.length;n++)i[e[n]]=!0;for(var o=new d._NodeList;this.i<this.contents.length;)if("string"==typeof(t=this.contents[this.i++]))o.push(new d._TextNode(t));else{var a=t[0],s=t[1];if(a==d.TOKEN_VAR)o.push(new d._VarNode(s));else if(a==d.TOKEN_BLOCK){if(i[s]){--this.i;return o}var r=s.split(/\s+/g);if(r.length){r=r[0];var l=p.getTag(r);l&&o.push(l(this,new d.Token(a,s)))}}}if(e.length)throw new Error("Could not find closing tag(s): "+e.toString());this.contents.length=0;return o},next_token:function(){var e=this.contents[this.i++];return new d.Token(e[0],e[1])},delete_first_token:function(){this.i++},skip_past:function(e){for(;this.i<this.contents.length;){var t=this.contents[this.i++];if(t[0]==d.TOKEN_BLOCK&&t[1]==e)return}throw new Error("Unclosed tag found when looking for "+e)},create_variable_node:function(e){return new d._VarNode(e)},create_text_node:function(e){return new d._TextNode(e||"")},getTemplate:function(e){return new d.Template(e)}});d.register={_registry:{attributes:[],tags:[],filters:[]},get:function(e,t){for(var i,n=d.register._registry[e+"s"],o=0;i=n[o];o++)if("string"==typeof i[0]){if(i[0]==t)return i}else if(t.match(i[0]))return i},getAttributeTags:function(){for(var e,i=[],n=d.register._registry.attributes,o=0;e=n[o];o++)if(3==e.length)i.push(e);else{var a=t.getObject(e[1]);if(a&&t.isFunction(a)){e.push(a);i.push(e)}}return i},_any:function(e,i,n){for(var o in n)for(var a,s=0;a=n[o][s];s++){var r=a;if(t.isArray(a)){r=a[0];a=a[1]}if("string"==typeof r){if("attr:"==r.substr(0,5)){var l=a;"attr:"==l.substr(0,5)&&(l=l.slice(5));d.register._registry.attributes.push([l.toLowerCase(),i+"."+o+"."+l])}r=r.toLowerCase()}d.register._registry[e].push([r,a,i+"."+o])}},tags:function(e,t){d.register._any("tags",e,t)},filters:function(e,t){d.register._any("filters",e,t)}};var g=/&/g,_=/</g,f=/>/g,v=/'/g,b=/"/g;d._base.escape=function(e){return d.mark_safe(e.replace(g,"&amp;").replace(_,"&lt;").replace(f,"&gt;").replace(b,"&quot;").replace(v,"&#39;"))};d._base.safe=function(e){"string"==typeof e&&(e=new String(e));"object"==typeof e&&(e.safe=!0);return e};d.mark_safe=d._base.safe;d.register.tags("dojox.dtl.tag",{date:["now"],logic:["if","for","ifequal","ifnotequal"],loader:["extends","block","include","load","ssi"],misc:["comment","debug","filter","firstof","spaceless","templatetag","widthratio","with"],loop:["cycle","ifchanged","regroup"]});d.register.filters("dojox.dtl.filter",{dates:["date","time","timesince","timeuntil"],htmlstrings:["linebreaks","linebreaksbr","removetags","striptags"],integers:["add","get_digit"],lists:["dictsort","dictsortreversed","first","join","length","length_is","random","slice","unordered_list"],logic:["default","default_if_none","divisibleby","yesno"],misc:["filesizeformat","pluralize","phone2numeric","pprint"],strings:["addslashes","capfirst","center","cut","fix_ampersands","floatformat","iriencode","linenumbers","ljust","lower","make_list","rjust","slugify","stringformat","title","truncatewords","truncatewords_html","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap"]});d.register.filters("dojox.dtl",{_base:["escape","safe"]});return d}))},"dojox/string/Builder":function(){define(["dojo/_base/lang"],(function(e){var t=e.getObject("string",!0,dojox).Builder=function(e){var t="";this.length=0;this.append=function(e){if(arguments.length>1){var i="",n=arguments.length;switch(n){case 9:i=""+arguments[8]+i;case 8:i=""+arguments[7]+i;case 7:i=""+arguments[6]+i;case 6:i=""+arguments[5]+i;case 5:i=""+arguments[4]+i;case 4:i=""+arguments[3]+i;case 3:i=""+arguments[2]+i;case 2:t+=""+arguments[0]+arguments[1]+i;break;default:for(var o=0;o<arguments.length;)i+=arguments[o++];t+=i}}else t+=e;this.length=t.length;return this};this.concat=function(e){return this.append.apply(this,arguments)};this.appendArray=function(e){return this.append.apply(this,e)};this.clear=function(){t="";this.length=0;return this};this.replace=function(e,i){t=t.replace(e,i);this.length=t.length;return this};this.remove=function(e,i){void 0===i&&(i=t.length);if(0==i)return this;t=t.substr(0,e)+t.substr(e+i);this.length=t.length;return this};this.insert=function(e,i){t=0==e?i+t:t.slice(0,e)+i+t.slice(e);this.length=t.length;return this};this.toString=function(){return t};e&&this.append(e)};return t}))},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],(function(e,t,i,n,o){return e("dijit.form.FilteringSelect",[n,o],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(e,t,i,n){t&&t[this.searchAttr]!==this._lastQuery||!t&&e.length&&this.store.getIdentity(e[0])!=this._lastQuery||(e.length?this.set("item",e[0],n):this.set("value","",n||void 0===n&&!this.focused,this.textbox.value,null))},_openResultList:function(e,t,i){if(t[this.searchAttr]===this._lastQuery){this.inherited(arguments);void 0===this.item&&this.validate(!0)}},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(e,n,o,a){this._onChangeActive||(n=null);if(void 0===a){if(null===e||""===e){e="";if(!t.isString(o)){this._setDisplayedValueAttr(o||"",n);return}}var s=this;this._lastQuery=e;i(this.store.get(e),(function(e){s._callbackSetLabel(e?[e]:[],void 0,void 0,n)}))}else{this.valueNode.value=e;this.inherited(arguments,[e,n,o,a])}},_setItemAttr:function(e,t,i){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(e){return e.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(e,n){null==e&&(e="");if(!this._created){if(!("displayedValue"in this.params))return;n=!1}if(this.store){this.closeDropDown();var o,a=t.clone(this.query),s=this._getDisplayQueryString(e);this.store._oldAPI?o=s:(o=this._patternToRegExp(s)).toString=function(){return s};this._lastQuery=a[this.searchAttr]=o;this.textbox.value=e;this._lastDisplayedValue=e;this._set("displayedValue",e);var r=this,l={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};t.mixin(l,this.fetchProperties);this._fetchHandle=this.store.query(a,l);i(this._fetchHandle,(function(e){r._fetchHandle=null;r._callbackSetLabel(e||[],a,l,n)}),(function(e){r._fetchHandle=null;r._cancelingQuery}))}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})}))},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],(function(e,t,i,n){return e("dijit.form.MappedTextBox",n,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(e){return e.toString?e.toString():""},toString:function(){var e=this.filter(this.get("value"));return null!=e?"string"==typeof e?e:this.serialize(e,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=i.place("<input type='hidden'"+(this.name&&!t("msapp")?' name="'+this.name.replace(/"/g,"&quot;")+'"':"")+"/>",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})}))},"dijit/form/ValidationTextBox":function(){define(["dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/i18n","./TextBox","../Tooltip","dojo/text!./templates/ValidationTextBox.html","dojo/i18n!./nls/validate"],(function(e,t,i,n,o,a,s){var r=e("dijit.form.ValidationTextBox",o,{templateString:s,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(e,i){if(i!=r.prototype[e]){t.deprecated("ValidationTextBox id="+this.id+", set('"+e+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0");this.set("pattern",i)}},_setRegExpGenAttr:function(e){this._deprecateRegExp("regExpGen",e);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(e){this._deprecateRegExp("regExp",e)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(e,t){return new RegExp("^(?:"+this._computeRegexp(t)+")"+(this.required?"":"?")+"$").test(e)&&(!this.required||!this._isEmpty(e))&&(this._isEmpty(e)||void 0!==this.parse(e,t))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(e){return(this.trim?/^\s*$/:/^$/).test(e)},getErrorMessage:function(){var e="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,t="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:e;return this.required&&this._isEmpty(this.textbox.value)?t:e},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(e){var t="",i=this.disabled||this.isValid(e);i&&(this._maskValidSubsetError=!0);var n=this._isEmpty(this.textbox.value),o=!i&&e&&this._isValidSubset();this._set("state",i?"":((!this._hasBeenBlurred||e)&&n||o)&&(this._maskValidSubsetError||o&&!this._hasBeenBlurred&&e)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");if("Error"==this.state){this._maskValidSubsetError=e&&o;t=this.getErrorMessage(e)}else if("Incomplete"==this.state){t=this.getPromptMessage(e);this._maskValidSubsetError=!this._hasBeenBlurred||e}else n&&(t=this.getPromptMessage(e));this.set("message",t);return i},displayMessage:function(e){e&&this.focused?a.show(e,this.domNode,this.tooltipPosition,!this.isLeftToRight()):a.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(e){this.constraints=i.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(e){!e.locale&&this.lang&&(e.locale=this.lang);this._set("constraints",e);this._refreshState()},_setPatternAttr:function(e){this._set("pattern",e);this._refreshState()},_computeRegexp:function(e){var t=this.pattern;"function"==typeof t&&(t=t.call(this,e));if(t!=this._lastRegExp){var i="";this._lastRegExp=t;".*"!=t&&t.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,(function(e){switch(e.charAt(0)){case"{":case"+":case"?":case"*":case"^":case"$":case"|":case"(":i+=e;break;case")":i+="|$)";break;default:i+="(?:"+e+"|$)"}}));try{"".search(i)}catch(n){i=this.pattern}this._partialre="^(?:"+i+")$"}return t},postMixInProperties:function(){this.inherited(arguments);this.messages=n.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(e){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(e){this._set("required",e);this.focusNode.setAttribute("aria-required",e);this._refreshState()},_setMessageAttr:function(e){this._set("message",e);this.displayMessage(e)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){a.hide(this.domNode);this.inherited(arguments)}});return r}))},"dijit/form/TextBox":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/dom-style","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/sniff","./_FormValueWidget","./_TextBoxMixin","dojo/text!./templates/TextBox.html","../main"],(function(e,t,i,n,o,a,s,r,l,d,c){var h=e("dijit.form.TextBox"+(s("dojo-bidi")?"_NoBidi":""),[r,l],{templateString:d,_singleNodeTemplate:'<input class="dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point="textbox,focusNode" autocomplete="off" type="${type}" ${!nameAttrSetting} />',_buttonInputDisabled:s("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var e=this.type.toLowerCase();(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==e||"file"==e)&&this.templateString==this.constructor.prototype.templateString)&&(this.templateString=this._singleNodeTemplate);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);s("ie")<9&&this.defer((function(){try{var e=i.getComputedStyle(this.domNode);if(e){var t=e.fontFamily;if(t){var n=this.domNode.getElementsByTagName("INPUT");if(n)for(var o=0;o<n.length;o++)n[o].style.fontFamily=t}}}catch(a){}}))},_setPlaceHolderAttr:function(e){this._set("placeHolder",e);if(!this._phspan){this._attachPoints.push("_phspan");this._phspan=t.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after");this.own(a(this._phspan,"mousedown",(function(e){e.preventDefault()})),a(this._phspan,"touchend, pointerup, MSPointerUp",o.hitch(this,(function(){this.focus()}))))}this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(e));this._updatePlaceHolder()},_onInput:function(e){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(e,t,i){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){n.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(e){n.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",e)},_onBlur:function(e){if(!this.disabled){this.inherited(arguments);this._updatePlaceHolder();s("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0)}},_onFocus:function(e){if(!this.disabled&&!this.readOnly){this.inherited(arguments);this._updatePlaceHolder()}}});if(s("ie")<9){h.prototype._isTextSelected=function(){var e=this.ownerDocument.selection.createRange();return e.parentElement()==this.textbox&&e.text.length>0};c._setSelectionRange=l._setSelectionRange=function(e,t,i){if(e.createTextRange){var n=e.createTextRange();n.collapse(!0);n.moveStart("character",-99999);n.moveStart("character",t);n.moveEnd("character",i-t);n.select()}}}s("dojo-bidi")&&(h=e("dijit.form.TextBox",h,{_setPlaceHolderAttr:function(e){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return h}))},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],(function(e,t,i,n){return e("dijit.form._FormValueWidget",[i,n],{_layoutHackIE7:function(){if(7==t("ie"))for(var e=this.domNode,i=e.parentNode,n=e.firstChild||e,o=n.style.filter,a=this;i&&0==i.clientHeight;){!function(){var e=a.connect(i,"onscroll",(function(){a.disconnect(e);n.style.filter=(new Date).getMilliseconds();a.defer((function(){n.style.filter=o}))}))}();i=i.parentNode}}})}))},"dijit/form/_FormWidget":function(){define(["dojo/_base/declare","dojo/sniff","dojo/_base/kernel","dojo/ready","../_Widget","../_CssStateMixin","../_TemplatedMixin","./_FormWidgetMixin"],(function(e,t,i,n,o,a,s,r){t("dijit-legacy-requires")&&n(0,(function(){require(["dijit/form/_FormValueWidget"])}));return e("dijit.form._FormWidget",[o,s,a,r],{setDisabled:function(e){i.deprecated("setDisabled("+e+") is deprecated. Use set('disabled',"+e+") instead.","","2.0");this.set("disabled",e)},setValue:function(e){i.deprecated("dijit.form._FormWidget:setValue("+e+") is deprecated.  Use set('value',"+e+") instead.","","2.0");this.set("value",e)},getValue:function(){i.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name&&!t("msapp")?'name="'+this.name.replace(/"/g,"&quot;")+'"':"";this.inherited(arguments)}})}))},"dijit/form/_FormWidgetMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-style","dojo/_base/lang","dojo/mouse","dojo/on","dojo/sniff","dojo/window","../a11y"],(function(e,t,i,n,o,a,s,r,l,d){return t("dijit.form._FormWidgetMixin",null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(t){this._set("disabled",t);if(/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)){i.set(this.focusNode,"disabled",t);r("trident")&&"readOnly"in this&&i.set(this.focusNode,"readonly",t||this.readOnly)}else this.focusNode.setAttribute("aria-disabled",t?"true":"false");this.valueNode&&i.set(this.valueNode,"disabled",t);if(t){this._set("hovering",!1);this._set("active",!1);var n="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode";e.forEach(o.isArray(n)?n:[n],(function(e){var t=this[e];r("webkit")||d.hasDefaultTabStop(t)?t.setAttribute("tabIndex","-1"):t.removeAttribute("tabIndex")}),this)}else""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(e){if("mouse"==e&&this.isFocusable())var t=this.own(s(this.focusNode,"focus",(function(){n.remove();t.remove()})))[0],i=r("pointer-events")?"pointerup":r("MSPointer")?"MSPointerUp":r("touch-events")?"touchend, mouseup":"mouseup",n=this.own(s(this.ownerDocumentBody,i,o.hitch(this,(function(e){n.remove();t.remove();this.focused&&("touchend"==e.type?this.defer("focus"):this.focus())}))))[0];this.scrollOnFocus&&this.defer((function(){l.scrollIntoView(this.domNode)}));this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=n.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(e){}},compare:function(e,t){return"number"==typeof e&&"number"==typeof t?isNaN(e)&&isNaN(t)?0:e-t:e>t?1:e<t?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(e,t){null!=this._lastValueReported||null!==t&&this._onChangeActive||(this._resetValue=this._lastValueReported=e);this._pendingOnChange=this._pendingOnChange||typeof e!=typeof this._lastValueReported||0!=this.compare(e,this._lastValueReported);if((this.intermediateChanges||t||void 0===t)&&this._pendingOnChange){this._lastValueReported=e;this._pendingOnChange=!1;if(this._onChangeActive){this._onChangeHandle&&this._onChangeHandle.remove();this._onChangeHandle=this.defer((function(){this._onChangeHandle=null;this.onChange(e)}))}}},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){if(this._onChangeHandle){this._onChangeHandle.remove();this.onChange(this._lastValueReported)}this.inherited(arguments)}})}))},"dijit/form/_FormValueMixin":function(){define(["dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","./_FormWidgetMixin"],(function(e,t,i,n,o,a,s){return e("dijit.form._FormValueMixin",s,{readOnly:!1,_setReadOnlyAttr:function(e){a("trident")&&"disabled"in this?t.set(this.focusNode,"readOnly",e||this.disabled):t.set(this.focusNode,"readOnly",e);this._set("readOnly",e)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(e,t){this._handleOnChange(e,t)},_handleOnChange:function(e,t){this._set("value",e);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,!0)}})}))},"dijit/form/_TextBoxMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/sniff","dojo/keys","dojo/_base/lang","dojo/on","../main"],(function(e,t,i,n,o,a,s,r){var l=t("dijit.form._TextBoxMixin"+(n("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(e,t,i){var n;if(void 0!==e){n=this.filter(e);if("string"!=typeof i){i=null===n||"number"==typeof n&&isNaN(n)?"":this.filter(this.format(n,this.constraints));0!=this.compare(n,this.filter(this.parse(i,this.constraints)))&&(i=null)}}if(null!=i&&("number"!=typeof i||!isNaN(i))&&this.textbox.value!=i){this.textbox.value=i;this._set("displayedValue",this.get("displayedValue"))}this.inherited(arguments,[n,t])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(e){null==e?e="":"string"!=typeof e&&(e=String(e));this.textbox.value=e;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(e){return null==e?"":e.toString?e.toString():e},parse:function(e){return e},_refreshState:function(){},onInput:function(){},_onInput:function(e){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||e);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);function e(e){var t;if("keydown"==e.type&&229!=e.keyCode){switch(t=e.keyCode){case o.SHIFT:case o.ALT:case o.CTRL:case o.META:case o.CAPS_LOCK:case o.NUM_LOCK:case o.SCROLL_LOCK:return}if(!e.ctrlKey&&!e.metaKey&&!e.altKey){switch(t){case o.NUMPAD_0:case o.NUMPAD_1:case o.NUMPAD_2:case o.NUMPAD_3:case o.NUMPAD_4:case o.NUMPAD_5:case o.NUMPAD_6:case o.NUMPAD_7:case o.NUMPAD_8:case o.NUMPAD_9:case o.NUMPAD_MULTIPLY:case o.NUMPAD_PLUS:case o.NUMPAD_ENTER:case o.NUMPAD_MINUS:case o.NUMPAD_PERIOD:case o.NUMPAD_DIVIDE:return}if(t>=65&&t<=90||t>=48&&t<=57||t==o.SPACE)return;var i=!1;for(var r in o)if(o[r]===e.keyCode){i=!0;break}if(!i)return}}(t=e.charCode>=32?String.fromCharCode(e.charCode):e.charCode)||(t=e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||e.keyCode==o.SPACE?String.fromCharCode(e.keyCode):e.keyCode);t||(t=229);if("keypress"==e.type){if("string"!=typeof t)return;if((t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||" "===t)&&(e.ctrlKey||e.metaKey||e.altKey))return}var l,d={faux:!0};for(l in e)if(!/^(layer[XY]|returnValue|keyLocation)$/.test(l)){var c=e[l];"function"!=typeof c&&void 0!==c&&(d[l]=c)}a.mixin(d,{charOrCode:t,_wasConsumed:!1,preventDefault:function(){d._wasConsumed=!0;e.preventDefault()},stopPropagation:function(){e.stopPropagation()}});this._lastInputProducingEvent=d;if(!1===this.onInput(d)){d.preventDefault();d.stopPropagation()}if(!d._wasConsumed&&n("ie")<=9)switch(e.keyCode){case o.TAB:case o.ESCAPE:case o.DOWN_ARROW:case o.UP_ARROW:case o.LEFT_ARROW:case o.RIGHT_ARROW:break;default:if(e.keyCode==o.ENTER&&"textarea"!=this.textbox.tagName.toLowerCase())break;this.defer((function(){this.textbox.value!==this._lastInputEventValue&&s.emit(this.textbox,"input",{bubbles:!0})}))}}this.own(s(this.textbox,"keydown, keypress, paste, cut, compositionend",a.hitch(this,e)),s(this.textbox,"input",a.hitch(this,"_onInput")),s(this.domNode,"keypress",(function(e){e.stopPropagation()})))},_blankValue:"",filter:function(e){if(null===e)return this._blankValue;if("string"!=typeof e)return e;this.trim&&(e=a.trim(e));this.uppercase&&(e=e.toUpperCase());this.lowercase&&(e=e.toLowerCase());this.propercase&&(e=e.replace(/[^\s]+/g,(function(e){return e.substring(0,1).toUpperCase()+e.substring(1)})));return e},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(e){if(!this.disabled){this._setBlurValue();this.inherited(arguments)}},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(e){if(!this.disabled&&!this.readOnly){if(this.selectOnClick&&"mouse"==e){this._selectOnClickHandle=s.once(this.domNode,"mouseup, touchend",a.hitch(this,(function(e){this._isTextSelected()||l.selectInputText(this.textbox)})));this.own(this._selectOnClickHandle);this.defer((function(){if(this._selectOnClickHandle){this._selectOnClickHandle.remove();this._selectOnClickHandle=null}}),500)}this.inherited(arguments);this._refreshState()}},reset:function(){this.textbox.value="";this.inherited(arguments)}});n("dojo-bidi")&&(l=t("dijit.form._TextBoxMixin",l,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));l._setSelectionRange=r._setSelectionRange=function(e,t,i){e.setSelectionRange&&e.setSelectionRange(t,i)};l.selectInputText=r.selectInputText=function(e,t,n){e=i.byId(e);isNaN(t)&&(t=0);isNaN(n)&&(n=e.value?e.value.length:0);try{e.focus();l._setSelectionRange(e,t,n)}catch(o){}};return l}))},"dijit/form/ComboBoxMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/kernel","dojo/_base/lang","dojo/store/util/QueryResults","./_AutoCompleterMixin","./_ComboBoxMenu","../_HasDropDown","dojo/text!./templates/DropDownBox.html"],(function(e,t,i,n,o,a,s,r,l){return e("dijit.form.ComboBoxMixin",[r,a],{dropDownClass:s,hasDownArrow:!0,templateString:l,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(e){this._set("hasDownArrow",e);this._buttonNode.style.display=e?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(e){e.get||n.mixin(e,{_oldAPI:!0,get:function(e){var i=new t;this.fetchItemByIdentity({identity:e,onItem:function(e){i.resolve(e)},onError:function(e){i.reject(e)}});return i.promise},query:function(e,i){var a=new t((function(){s.abort&&s.abort()}));a.total=new t;var s=this.fetch(n.mixin({query:e,onBegin:function(e){a.total.resolve(e)},onComplete:function(e){a.resolve(e)},onError:function(e){a.reject(e)}},i));return o(a)}});this._set("store",e)},postMixInProperties:function(){var e=this.params.store||this.store;e&&this._setStoreAttr(e);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var t=this.declaredClass;n.mixin(this.store,{getValue:function(e,n){i.deprecated(t+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return e[n]},getLabel:function(e){i.deprecated(t+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return e.name},fetch:function(e){i.deprecated(t+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],n.hitch(this,(function(t){new t({objectStore:this}).fetch(e)})))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})}))},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],(function(e,t,i){var n=function(o){if(!o)return o;var a=!!o.then;a&&(o=t.delegate(o));function s(t){o[t]=function(){var s=arguments,r=i(o,(function(i){Array.prototype.unshift.call(s,i);return n(e[t].apply(e,s))}));if("forEach"!==t||a)return r}}s("forEach");s("filter");s("map");null==o.total&&(o.total=i(o,(function(e){return e.length})));return o};t.setObject("dojo.store.util.QueryResults",n);return n}))},"dijit/form/_AutoCompleterMixin":function(){define(["dojo/aspect","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/query","dojo/regexp","dojo/sniff","./DataList","./_TextBoxMixin","./_SearchMixin"],(function(e,t,i,n,o,a,s,r,l,d,c){var h=t("dijit.form._AutoCompleterMixin",c,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(e){var t=0;if("number"==typeof e.selectionStart)t=e.selectionStart;else if(r("ie")){var i=e.ownerDocument.selection.createRange().duplicate(),n=e.createTextRange();i.move("character",0);n.move("character",0);try{n.setEndPoint("EndToEnd",i);t=String(n.text).replace(/\r/g,"").length}catch(o){}}return t},_setCaretPos:function(e,t){t=parseInt(t);d.selectInputText(e,t,t)},_setDisabledAttr:function(e){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",e?"true":"false")},_onKey:function(e){if(!(e.charCode>=32)){var t=e.charCode||e.keyCode;if(t!=n.ALT&&t!=n.CTRL&&t!=n.META&&t!=n.SHIFT){var i=this.dropDown,o=null;this._abortQuery();this.inherited(arguments);if(!(e.altKey||e.ctrlKey||e.metaKey)){this._opened&&(o=i.getHighlightedOption());switch(t){case n.PAGE_DOWN:case n.DOWN_ARROW:case n.PAGE_UP:case n.UP_ARROW:this._opened&&this._announceOption(o);e.stopPropagation();e.preventDefault();break;case n.ENTER:if(o){if(o==i.nextButton){this._nextSearch(1);e.stopPropagation();e.preventDefault();break}if(o==i.previousButton){this._nextSearch(-1);e.stopPropagation();e.preventDefault();break}e.stopPropagation();e.preventDefault()}else{this._setBlurValue();this._setCaretPos(this.focusNode,this.focusNode.value.length)}case n.TAB:var a=this.get("displayedValue");if(i&&(a==i._messages.previousMessage||a==i._messages.nextMessage))break;o&&this._selectOption(o);case n.ESCAPE:if(this._opened){this._lastQuery=null;this.closeDropDown()}}}}}},_autoCompleteText:function(e){var t=this.focusNode;d.selectInputText(t,t.value.length);var i=this.ignoreCase?"toLowerCase":"substr";if(0==e[i](0).indexOf(this.focusNode.value[i](0))){var n=this.autoComplete?this._getCaretPos(t):t.value.length;if(n+1>t.value.length){t.value=e;d.selectInputText(t,n)}}else{t.value=e;d.selectInputText(t)}},_openResultList:function(e,t,i){var n=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();if(e.length||0!=i.start){this._nextSearch=this.dropDown.onPage=o.hitch(this,(function(t){e.nextPage(-1!==t);this.focus()}));this.dropDown.createOptions(e,i,o.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if("direction"in i){i.direction?this.dropDown.highlightFirstOption():i.direction||this.dropDown.highlightLastOption();n&&this._announceOption(this.dropDown.getHighlightedOption())}else!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(t[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)}else this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();if(this._opened){this.inherited(arguments);this.domNode.setAttribute("aria-expanded","false")}},_setBlurValue:function(){var e=this.get("displayedValue"),t=this.dropDown;if(!t||e!=t._messages.previousMessage&&e!=t._messages.nextMessage)if(void 0===this.item){this.item=null;this.set("displayedValue",e)}else{this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0);this._refreshState()}else this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(e,t,i){var n="";if(e){i||(i=this.store._oldAPI?this.store.getValue(e,this.searchAttr):e[this.searchAttr]);n=this._getValueField()!=this.searchAttr?this.store.getIdentity(e):i}this.set("value",n,t,i,e)},_announceOption:function(e){if(e){var t;if(e==this.dropDown.nextButton||e==this.dropDown.previousButton){t=e.innerHTML;this.item=void 0;this.value=""}else{var n=this.dropDown.items[e.getAttribute("item")];t=(this.store._oldAPI?this.store.getValue(n,this.searchAttr):n[this.searchAttr]).toString();this.set("item",n,!1,t)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",i.get(e,"id"));this._autoCompleteText(t)}},_selectOption:function(e){this.closeDropDown();e&&this._announceOption(e);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(e){if(!this.dropDown){var t=this.id+"_popup",i=o.isString(this.dropDownClass)?o.getObject(this.dropDownClass,!1):this.dropDownClass;this.dropDown=new i({onChange:o.hitch(this,this._selectOption),id:t,dir:this.dir,textDir:this.textDir})}this._lastInput=e;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef){var e=this.srcNodeRef;this.store=new l({},e);if(!("value"in this.params)){var t=this.item=this.store.fetchSelectedItem();if(t){var i=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(t,i):t[i]}}}},postCreate:function(){var t=a('label[for="'+this.id+'"]');if(t.length){t[0].id||(t[0].id=this.id+"_label");this.domNode.setAttribute("aria-labelledby",t[0].id)}this.inherited(arguments);e.after(this,"onSearch",o.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(e){var t=this.labelFunc(e,this.store),i=this.labelType;if("none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput){t=this.doHighlight(t,this._lastInput);i="html"}return{html:"html"==i,label:t}},doHighlight:function(e,t){var i=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),n=this.queryExpr.indexOf("${0}");t=s.escapeString(t);return this._escapeHtml(e.replace(new RegExp((0==n?"^":"")+"("+t+")"+(n==this.queryExpr.length-4?"$":""),i),"￿$1￿")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'<span class="dijitComboBoxHighlightMatch">$1</span>')},_escapeHtml:function(e){return e=String(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(e,t){return(t._oldAPI?t.getValue(e,this.labelAttr||this.searchAttr):e[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(e,t,i,n){this._set("item",n||null);null==e&&(e="");this.inherited(arguments)}});r("dojo-bidi")&&h.extend({_setTextDirAttr:function(e){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",e)}});return h}))},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],(function(e,t){var i={};t.setObject("dojo.regexp",i);i.escapeString=function(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,(function(e){return t&&-1!=t.indexOf(e)?e:"\\"+e}))};i.buildGroupRE=function(e,t,n){if(!(e instanceof Array))return t(e);for(var o=[],a=0;a<e.length;a++)o.push(t(e[a]));return i.group(o.join("|"),n)};i.group=function(e,t){return"("+(t?"?:":"")+e+")"};return i}))},"dijit/form/DataList":function(){define(["dojo/_base/declare","dojo/dom","dojo/_base/lang","dojo/query","dojo/store/Memory","../registry"],(function(e,t,i,n,o,a){function s(e){return{id:e.value,value:e.value,name:i.trim(e.innerText||e.textContent||"")}}return e("dijit.form.DataList",o,{constructor:function(e,o){this.domNode=t.byId(o);i.mixin(this,e);this.id&&a.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:n("option",this.domNode).map(s)}])},destroy:function(){a.remove(this.id)},fetchSelectedItem:function(){var e=n("> option[selected]",this.domNode)[0]||n("> option",this.domNode)[0];return e&&s(e)}})}))},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],(function(e,t,i){return e("dojo.store.Memory",null,{constructor:function(e){for(var t in e)this[t]=e[t];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:i,get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,t){var i=this.data,n=this.index,o=this.idProperty,a=e[o]=t&&"id"in t?t.id:o in e?e[o]:Math.random();if(a in n){if(t&&!1===t.overwrite)throw new Error("Object already exists");i[n[a]]=e}else n[a]=i.push(e)-1;return a},add:function(e,t){(t=t||{}).overwrite=!1;return this.put(e,t)},remove:function(e){var t=this.index,i=this.data;if(e in t){i.splice(t[e],1);this.setData(i);return!0}},query:function(e,i){return t(this.queryEngine(e,i)(this.data))},setData:function(e){if(e.items){this.idProperty=e.identifier||this.idProperty;e=this.data=e.items}else this.data=e;this.index={};for(var t=0,i=e.length;t<i;t++)this.index[e[t][this.idProperty]]=t}})}))},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],(function(e){return function(t,i){switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var n=t;t=function(e){for(var t in n){var i=n[t];if(i&&i.test){if(!i.test(e[t],e))return!1}else if(i!=e[t])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}function o(n){var o=e.filter(n,t),a=i&&i.sort;a&&o.sort("function"==typeof a?a:function(e,t){for(var i,n=0;i=a[n];n++){var o=e[i.attribute],s=t[i.attribute];if((o=null!=o?o.valueOf():o)!=(s=null!=s?s.valueOf():s))return!!i.descending==(null==o||o>s)?-1:1}return 0});if(i&&(i.start||i.count)){var s=o.length;(o=o.slice(i.start||0,(i.start||0)+(i.count||1/0))).total=s}return o}o.matches=t;return o}}))},"dijit/form/_SearchMixin":function(){define(["dojo/_base/declare","dojo/keys","dojo/_base/lang","dojo/query","dojo/string","dojo/when","../registry"],(function(e,t,i,n,o,a,s){return e("dijit.form._SearchMixin",null,{pageSize:1/0,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(e){this._set("list",e)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(e){return new RegExp("^"+e.replace(/(\\.)|(\*)|(\?)|\W/g,(function(e,t,i,n){return i?".*":n?".":t||"\\"+e}))+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());if(this._fetchHandle){if(this._fetchHandle.abort){this._cancelingQuery=!0;this._fetchHandle.abort();this._cancelingQuery=!1}if(this._fetchHandle.cancel){this._cancelingQuery=!0;this._fetchHandle.cancel();this._cancelingQuery=!1}this._fetchHandle=null}},_processInput:function(e){if(!this.disabled&&!this.readOnly){var i=e.charOrCode;this._prev_key_backspace=!1;if(i==t.DELETE||i==t.BACKSPACE){this._prev_key_backspace=!0;this._maskValidSubsetError=!0}this.store?this.searchTimer=this.defer("_startSearchFromInput",1):this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(e){this._abortQuery();var t,n=this,s=i.clone(this.query),r={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},l=o.substitute(this.queryExpr,[e.replace(/([\\\*\?])/g,"\\$1")]),d=function(){var e=n._fetchHandle=n.store.query(s,r);n.disabled||n.readOnly||t!==n._lastQuery||a(e,(function(i){n._fetchHandle=null;n.disabled||n.readOnly||t!==n._lastQuery||a(e.total,(function(e){i.total=e;var t=n.pageSize;(isNaN(t)||t>i.total)&&(t=i.total);i.nextPage=function(e){r.direction=e=!1!==e;r.count=t;if(e){r.start+=i.length;r.start>=i.total&&(r.count=0)}else{r.start-=t;if(r.start<0){r.count=Math.max(t+r.start,0);r.start=0}}if(r.count<=0){i.length=0;n.onSearch(i,s,r)}else d()};n.onSearch(i,s,r)}))}),(function(e){n._fetchHandle=null;n._cancelingQuery}))};i.mixin(r,this.fetchProperties);this.store._oldAPI?t=l:(t=this._patternToRegExp(l)).toString=function(){return l};this._lastQuery=s[this.searchAttr]=t;this._queryDeferHandle=this.defer(d,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var e=this.list;e&&(this.store=s.byId(e))}this.inherited(arguments)}})}))},"dijit/form/_ComboBoxMenu":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-style","dojo/keys","../_WidgetBase","../_TemplatedMixin","./_ComboBoxMenuMixin","./_ListMouseMixin"],(function(e,t,i,n,o,a,s,r){return e("dijit.form._ComboBoxMenu",[o,a,r,s],{templateString:"<div class='dijitReset dijitMenu' data-dojo-attach-point='containerNode' style='overflow: auto; overflow-x: hidden;' role='listbox'><div class='dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point='previousButton' role='option'></div><div class='dijitMenuItem dijitMenuNextButton' data-dojo-attach-point='nextButton' role='option'></div></div>",baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);if(!this.isLeftToRight()){t.add(this.previousButton,"dijitMenuItemRtl");t.add(this.nextButton,"dijitMenuItemRtl")}this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var e=this.ownerDocument.createElement("div");e.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");e.setAttribute("role","option");return e},onHover:function(e){t.add(e,"dijitMenuItemHover")},onUnhover:function(e){t.remove(e,"dijitMenuItemHover")},onSelect:function(e){t.add(e,"dijitMenuItemSelected")},onDeselect:function(e){t.remove(e,"dijitMenuItemSelected")},_page:function(e){var t=0,n=this.domNode.scrollTop,o=i.get(this.domNode,"height");this.getHighlightedOption()||this.selectNextNode();for(;t<o;){var a=this.getHighlightedOption();if(e){if(!a.previousSibling||"none"==a.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!a.nextSibling||"none"==a.nextSibling.style.display)break;this.selectNextNode()}var s=this.domNode.scrollTop;t+=(s-n)*(e?-1:1);n=s}},handleKey:function(e){switch(e.keyCode){case n.DOWN_ARROW:this.selectNextNode();return!1;case n.PAGE_DOWN:this._page(!1);return!1;case n.UP_ARROW:this.selectPreviousNode();return!1;case n.PAGE_UP:this._page(!0);return!1;default:return!0}}})}))},"dijit/form/_ComboBoxMenuMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/has","dojo/i18n","dojo/i18n!./nls/ComboBox"],(function(e,t,i,n,o){var a=t("dijit.form._ComboBoxMenuMixin"+(n("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=o.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(e){this._set("value",e);this.onChange(e)},onClick:function(e){if(e==this.previousButton){this._setSelectedAttr(null);this.onPage(-1)}else if(e==this.nextButton){this._setSelectedAttr(null);this.onPage(1)}else this.onChange(e)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(e,t){var i=this._createMenuItem(),n=t(e);n.html?i.innerHTML=n.label:i.appendChild(i.ownerDocument.createTextNode(n.label));""==i.innerHTML&&(i.innerHTML="&#160;");return i},createOptions:function(t,n,o){this.items=t;this.previousButton.style.display=0==n.start?"none":"";i.set(this.previousButton,"id",this.id+"_prev");e.forEach(t,(function(e,t){var n=this._createOption(e,o);n.setAttribute("item",t);i.set(n,"id",this.id+t);this.nextButton.parentNode.insertBefore(n,this.nextButton)}),this);var a=!1;t.total&&!t.total.then&&-1!=t.total?(n.start+n.count<t.total||n.start+n.count>t.total&&n.count==t.length)&&(a=!0):n.count==t.length&&(a=!0);this.nextButton.style.display=a?"":"none";i.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var e=this.containerNode;e.childNodes.length>2;)e.removeChild(e.childNodes[e.childNodes.length-2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});n("dojo-bidi")&&(a=t("dijit.form._ComboBoxMenuMixin",a,{_createOption:function(){var e=this.inherited(arguments);this.applyTextDir(e);return e}}));return a}))},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],(function(e,t,i,n){return e("dijit.form._ListMouseMixin",n,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover","_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(e,t){this._setSelectedAttr(t,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer((function(){this._deferredClick=null;this.onClick(t)}))},_onMouseDown:function(e,t){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null}this._isDragging=!0;this._setSelectedAttr(t,!1)},_onMouseUp:function(e,t){this._isDragging=!1;var i=this.selected,n=this._hoveredNode;i&&t==i?this.defer((function(){this._onClick(e,i)})):n&&this.defer((function(){this._onClick(e,n)}))},_onMouseOut:function(e,t){if(this._hoveredNode){this.onUnhover(this._hoveredNode);this._hoveredNode=null}this._isDragging&&(this._cancelDrag=(new Date).getTime()+1e3)},_onMouseOver:function(e,t){if(this._cancelDrag){(new Date).getTime()>this._cancelDrag&&(this._isDragging=!1);this._cancelDrag=null}this._hoveredNode=t;this.onHover(t);this._isDragging&&this._setSelectedAttr(t,!1)}})}))},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on","dojo/window"],(function(e,t,i){return e("dijit.form._ListBase",null,{selected:null,_listConnect:function(e,i){var n=this;return n.own(t(n.containerNode,t.selector((function(e,t,i){return e.parentNode==i}),e),(function(e){n[i](e,this)})))},selectFirstNode:function(){for(var e=this.containerNode.firstChild;e&&"none"==e.style.display;)e=e.nextSibling;this._setSelectedAttr(e,!0)},selectLastNode:function(){for(var e=this.containerNode.lastChild;e&&"none"==e.style.display;)e=e.previousSibling;this._setSelectedAttr(e,!0)},selectNextNode:function(){var e=this.selected;if(e){for(var t=e.nextSibling;t&&"none"==t.style.display;)t=t.nextSibling;t?this._setSelectedAttr(t,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var e=this.selected;if(e){for(var t=e.previousSibling;t&&"none"==t.style.display;)t=t.previousSibling;t?this._setSelectedAttr(t,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(e,t){if(this.selected!=e){var n=this.selected;n&&this.onDeselect(n);if(e){t&&i.scrollIntoView(e);this.onSelect(e)}this._set("selected",e)}else e&&this.onSelect(e)}})}))},"dijit/_HasDropDown":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","./registry","./focus","./popup","./_FocusMixin"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g){return e("dijit._HasDropDown",g,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(e){if(!this.disabled&&!this.readOnly){"MSPointerDown"!=e.type&&e.preventDefault();this.own(c.once(this.ownerDocument,h.release,d.hitch(this,"_onDropDownMouseUp")));this.toggleDropDown()}},_onDropDownMouseUp:function(e){var t=this.dropDown,i=!1;if(e&&this._opened){var n=a.position(this._buttonNode,!0);if(!(e.pageX>=n.x&&e.pageX<=n.x+n.w&&e.pageY>=n.y&&e.pageY<=n.y+n.h)){for(var s=e.target;s&&!i;)o.contains(s,"dijitPopup")?i=!0:s=s.parentNode;if(i){s=e.target;if(t.onItemClick){for(var r;s&&!(r=u.byNode(s));)s=s.parentNode;r&&r.onClick&&r.getParent&&r.getParent().onItemClick(r,e)}return}}}this._opened?t.focus&&(!1!==t.autoFocus||"mouseup"==e.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer((function(){t.focus();delete this._focusDropDownTimer}))):this.focus&&this.defer("focus")},_onDropDownClick:function(e){if(this._stopClickEvents){e.stopPropagation();e.preventDefault()}},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var e={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";o.add(this._arrowWrapperNode||this._buttonNode,"dijit"+e+"ArrowButton")},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.own(c(this._buttonNode,h.press,d.hitch(this,"_onDropDownMouseDown")),c(this._buttonNode,"click",d.hitch(this,"_onDropDownClick")),c(e,"keydown",d.hitch(this,"_onKey")),c(e,"keyup",d.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);if(this.dropDown){this.dropDown._destroyed||this.dropDown.destroyRecursive();delete this.dropDown}this.inherited(arguments)},_onKey:function(e){if(!this.disabled&&!this.readOnly){var t=this.dropDown,i=e.target;if(t&&this._opened&&t.handleKey&&!1===t.handleKey(e)){e.stopPropagation();e.preventDefault()}else if(t&&this._opened&&e.keyCode==l.ESCAPE){this.closeDropDown();e.stopPropagation();e.preventDefault()}else if(!this._opened&&(e.keyCode==l.DOWN_ARROW||(e.keyCode==l.ENTER||e.keyCode==l.SPACE&&(!this._searchTimer||e.ctrlKey||e.altKey||e.metaKey))&&("input"!==(i.tagName||"").toLowerCase()||i.type&&"text"!==i.type.toLowerCase()))){this._toggleOnKeyUp=!0;e.stopPropagation();e.preventDefault()}}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var e=this.dropDown;e&&e.focus&&this.defer(d.hitch(e,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(e){e()},loadAndOpenDropDown:function(){var e=new t,i=d.hitch(this,(function(){this.openDropDown();e.resolve(this.dropDown)}));this.isLoaded()?i():this.loadDropDown(i);return e},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var e=this.dropDown,t=e.domNode,i=this._aroundNode||this.domNode,s=this,r=m.open({parent:this,popup:e,around:i,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){s.closeDropDown(!0)},onCancel:function(){s.closeDropDown(!0)},onClose:function(){n.set(s._popupStateNode,"popupActive",!1);o.remove(s._popupStateNode,"dijitHasDropDownOpen");s._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&i.offsetWidth>e._popupWrapper.offsetWidth){var l=i.offsetWidth-e._popupWrapper.offsetWidth,c={w:e.domNode.offsetWidth+l};this._origStyle=t.style.cssText;d.isFunction(e.resize)?e.resize(c):a.setMarginBox(t,c);"R"==r.corner[1]&&(e._popupWrapper.style.left=e._popupWrapper.style.left.replace("px","")-l+"px")}n.set(this._popupStateNode,"popupActive","true");o.add(this._popupStateNode,"dijitHasDropDownOpen");this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",e.id);"presentation"===t.getAttribute("role")||t.getAttribute("aria-labelledby")||t.setAttribute("aria-labelledby",this.id);return r},closeDropDown:function(e){if(this._focusDropDownTimer){this._focusDropDownTimer.remove();delete this._focusDropDownTimer}if(this._opened){this._popupStateNode.setAttribute("aria-expanded","false");e&&this.focus&&this.focus();m.close(this.dropDown);this._opened=!1}if(this._origStyle){this.dropDown.domNode.style.cssText=this._origStyle;delete this._origStyle}}})}))},"dijit/popup":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","./place","./BackgroundIframe","./Viewport","./main","dojo/touch"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g){function _(){if(this._popupWrapper){a.destroy(this._popupWrapper);delete this._popupWrapper}}var f=i(null,{_stack:[],_beginZIndex:1e3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var e=this._firstAroundPosition,t=s.position(this._firstAroundNode,!0),i=t.x-e.x,n=t.y-e.y;if(i||n){this._firstAroundPosition=t;for(var o=0;o<this._stack.length;o++){var a=this._stack[o].wrapper.style;a.top=parseFloat(a.top)+n+"px";"auto"==a.right?a.left=parseFloat(a.left)+i+"px":a.right=parseFloat(a.right)-i+"px"}}this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),i||n?10:50)}},_createWrapper:function(e){var i=e._popupWrapper,n=e.domNode;if(!i){(i=a.create("div",{class:"dijitPopup",style:{display:"none"},role:"region","aria-label":e["aria-label"]||e.label||e.name||e.id},e.ownerDocumentBody)).appendChild(n);var o=n.style;o.display="";o.visibility="";o.position="";o.top="0px";e._popupWrapper=i;t.after(e,"destroy",_,!0);"ontouchend"in document&&h(i,"touchend",(function(e){/^(input|button|textarea)$/i.test(e.target.tagName)||e.preventDefault()}));i.dojoClick=!0}return i},moveOffScreen:function(e){var t=this._createWrapper(e),i=s.isBodyLtr(e.ownerDocument),n={visibility:"hidden",top:"-9999px",display:""};n[i?"left":"right"]="-9999px";n[i?"right":"left"]="auto";r.set(t,n);return t},hide:function(e){var t=this._createWrapper(e);r.set(t,{display:"none",height:"auto",overflowY:"visible",border:""});var i=e.domNode;"_originalStyle"in i&&(i.style.cssText=i._originalStyle)},getTopPopup:function(){for(var e=this._stack,t=e.length-1;t>0&&e[t].parent===e[t-1].widget;t--);return e[t]},open:function(e){for(var t=this._stack,i=e.popup,a=i.domNode,g=e.orient||["below","below-alt","above","above-alt"],_=e.parent?e.parent.isLeftToRight():s.isBodyLtr(i.ownerDocument),f=e.around,v=e.around&&e.around.id?e.around.id+"_dropdown":"popup_"+this._idGen++;t.length&&(!e.parent||!n.isDescendant(e.parent.domNode,t[t.length-1].widget.domNode));)this.close(t[t.length-1].widget);var b=this.moveOffScreen(i);i.startup&&!i._started&&i.startup();var y,w=s.position(a);if("maxHeight"in e&&-1!=e.maxHeight)y=e.maxHeight||1/0;else{var C=m.getEffectiveBox(this.ownerDocument),k=f?s.position(f,!1):{y:e.y-(e.padding||0),h:2*(e.padding||0)};y=Math.floor(Math.max(k.y,C.h-(k.y+k.h)))}if(w.h>y){var x=r.getComputedStyle(a),T=x.borderLeftWidth+" "+x.borderLeftStyle+" "+x.borderLeftColor;r.set(b,{overflowY:"scroll",height:y+"px",border:T});a._originalStyle=a.style.cssText;a.style.border="none"}o.set(b,{id:v,style:{zIndex:this._beginZIndex+t.length},class:"dijitPopup "+(i.baseClass||i.class||"").split(" ")[0]+"Popup",dijitPopupParent:e.parent?e.parent.id:""});if(0==t.length&&f){this._firstAroundNode=f;this._firstAroundPosition=s.position(f,!0);this._aroundMoveListener=setTimeout(c.hitch(this,"_repositionAll"),50)}l("config-bgIframe")&&!i.bgIframe&&(i.bgIframe=new p(b));var A=i.orient?c.hitch(i,"orient"):null,j=f?u.around(b,f,g,_,A):u.at(b,e,"R"==g?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],e.padding,A);b.style.visibility="visible";a.style.visibility="visible";var S=[];S.push(h(b,"keydown",c.hitch(this,(function(t){if(t.keyCode==d.ESCAPE&&e.onCancel){t.stopPropagation();t.preventDefault();e.onCancel()}else if(t.keyCode==d.TAB){t.stopPropagation();t.preventDefault();var i=this.getTopPopup();i&&i.onCancel&&i.onCancel()}}))));i.onCancel&&e.onCancel&&S.push(i.on("cancel",e.onCancel));S.push(i.on(i.onExecute?"execute":"change",c.hitch(this,(function(){var e=this.getTopPopup();e&&e.onExecute&&e.onExecute()}))));t.push({widget:i,wrapper:b,parent:e.parent,onExecute:e.onExecute,onCancel:e.onCancel,onClose:e.onClose,handlers:S});i.onOpen&&i.onOpen(j);return j},close:function(t){for(var i=this._stack;t&&e.some(i,(function(e){return e.widget==t}))||!t&&i.length;){var n,o=i.pop(),a=o.widget,s=o.onClose;if(a.bgIframe){a.bgIframe.destroy();delete a.bgIframe}a.onClose&&a.onClose();for(;n=o.handlers.pop();)n.remove();a&&a.domNode&&this.hide(a);s&&s()}if(0==i.length&&this._aroundMoveListener){clearTimeout(this._aroundMoveListener);this._firstAroundNode=this._firstAroundPosition=this._aroundMoveListener=null}}});return g.popup=new f}))},"dijit/Editor":function(){define(["require","dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/i18n","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/_base/lang","dojo/sniff","dojo/string","dojo/topic","./_Container","./Toolbar","./ToolbarSeparator","./layout/_LayoutWidget","./form/ToggleButton","./_editor/_Plugin","./_editor/plugins/EnterKeyHandling","./_editor/html","./_editor/range","./_editor/RichText","./main","dojo/i18n!./_editor/nls/commands"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_,f,v,b,y,w,C,k,x){var T=i("dijit.Editor",k,{plugins:null,extraPlugins:null,constructor:function(){c.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",y]);this._plugins=[];this._editInterval=1e3*this.editActionInterval;if(h("ie")||h("trident")||h("edge")){this.events.push("onBeforeDeactivate");this.events.push("onBeforeActivate")}},postMixInProperties:function(){this.setValueDeferred=new n;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);c.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=o.getLocalization("dijit._editor","commands",this.lang);h("webkit")&&l.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);if(!this.toolbar){this.toolbar=new g({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id});this.header.appendChild(this.toolbar.domNode)}t.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);s.add(this.iframe.parentNode,"dijitEditorIFrameContainer");s.add(this.iframe,"dijitEditorIFrame");a.set(this.iframe,"allowTransparency",!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){t.forEach(this._plugins,(function(e){e&&e.destroy&&e.destroy()}));this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(t,i){var n=c.isString(t)?{name:t}:c.isFunction(t)?{ctor:t}:t;if(!n.setEditor){var o={args:n,plugin:null,editor:this};n.name&&(b.registry[n.name]?o.plugin=b.registry[n.name](n):p.publish(x._scopeName+".Editor.getPlugin",o));if(!o.plugin)try{var a=n.ctor||c.getObject(n.name)||e(n.name);a&&(o.plugin=new a(n))}catch(s){throw new Error(this.id+": cannot find plugin ["+n.name+"]")}if(!o.plugin)throw new Error(this.id+": cannot find plugin ["+n.name+"]");t=o.plugin}arguments.length>1?this._plugins[i]=t:this._plugins.push(t);t.setEditor(this);c.isFunction(t.setToolbar)&&t.setToolbar(this.toolbar)},resize:function(e){e&&f.prototype.resize.apply(this,arguments)},layout:function(){var e=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+r.getPadBorderExtents(this.iframe.parentNode).h+r.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=e+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(e){var t,i=this.document.body,n=i.clientWidth,o=i.clientHeight,a=i.clientLeft,s=i.offsetWidth,r=i.offsetHeight,l=i.offsetLeft;/^rtl$/i.test(i.dir||"")?n<s&&e.x>n&&e.x<s&&(t=!0):e.x<a&&e.x>l&&(t=!0);t||o<r&&e.y>o&&e.y<r&&(t=!0);if(!t){delete this._cursorToStart;delete this._savedSelection;"BODY"==e.target.tagName&&this.defer("placeCursorAtEnd");this.inherited(arguments)}},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(e){this.customUndo&&this.endEditing(!0);"BODY"!=e.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(e){if(!this._inEditing){this._inEditing=!0;this._beginEditing(e)}if(this.editActionInterval>0){this._editTimer&&this._editTimer.remove();this._editTimer=this.defer("endEditing",this._editInterval)}},_steps:[],_undoedSteps:[],execCommand:function(e){if(!this.customUndo||"undo"!=e&&"redo"!=e){if(this.customUndo){this.endEditing();this._beginEditing()}var t=this.inherited(arguments);this.customUndo&&this._endEditing();return t}return this[e]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(e){var t;try{t=this.document.execCommand(e,!1,null);if(h("webkit")&&!t)throw{}}catch(n){var i=u.substitute;alert(i(this.commands.systemShortcut,[this.commands[e],i(this.commands[h("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[e]])]));t=!1}return t},queryCommandEnabled:function(e){return!this.customUndo||"undo"!=e&&"redo"!=e?this.inherited(arguments):"undo"==e?this._steps.length>1:this._undoedSteps.length>0},_moveToBookmark:function(e){var i,n,o,a,s=e.mark,r=e.mark,l=e.isCollapsed;if(r)if(h("ie")<9||9===h("ie")&&h("quirks")){if(c.isArray(r)){s=[];t.forEach(r,(function(e){s.push(C.getNode(e,this.editNode))}),this);this.selection.moveToBookmark({mark:s,isCollapsed:l})}else if(r.startContainer&&r.endContainer&&(a=C.getSelection(this.window))&&a.removeAllRanges){a.removeAllRanges();i=C.create(this.window);n=C.getNode(r.startContainer,this.editNode);o=C.getNode(r.endContainer,this.editNode);if(n&&o){i.setStart(n,r.startOffset);i.setEnd(o,r.endOffset);a.addRange(i)}}}else if((a=C.getSelection(this.window))&&a.removeAllRanges){a.removeAllRanges();i=C.create(this.window);n=C.getNode(r.startContainer,this.editNode);o=C.getNode(r.endContainer,this.editNode);if(n&&o){i.setStart(n,r.startOffset);i.setEnd(o,r.endOffset);a.addRange(i)}}},_changeToStep:function(e,t){this.setValue(t.text);var i=t.bookmark;i&&this._moveToBookmark(i)},undo:function(){var e=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var t=this._steps.pop();if(t&&this._steps.length>0){this.focus();this._changeToStep(t,this._steps[this._steps.length-1]);this._undoedSteps.push(t);this.onDisplayChanged();delete this._undoRedoActive;e=!0}delete this._undoRedoActive}return e},redo:function(){var e=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var t=this._undoedSteps.pop();if(t&&this._steps.length>0){this.focus();this._changeToStep(this._steps[this._steps.length-1],t);this._steps.push(t);this.onDisplayChanged();e=!0}delete this._undoRedoActive}return e},endEditing:function(e){this._editTimer&&(this._editTimer=this._editTimer.remove());if(this._inEditing){this._endEditing(e);this._inEditing=!1}},_getBookmark:function(){var e=this.selection.getBookmark(),i=[];if(e&&e.mark){var n=e.mark;if(h("ie")<9||9===h("ie")&&h("quirks")){var o=C.getSelection(this.window);if(c.isArray(n)){t.forEach(e.mark,(function(e){i.push(C.getIndex(e,this.editNode).o)}),this);e.mark=i}else if(o){var a;o.rangeCount&&(a=o.getRangeAt(0));e.mark=a?a.cloneRange():this.selection.getBookmark()}}try{if(e.mark&&e.mark.startContainer){i=C.getIndex(e.mark.startContainer,this.editNode).o;e.mark={startContainer:i,startOffset:e.mark.startOffset,endContainer:e.mark.endContainer===e.mark.startContainer?i:C.getIndex(e.mark.endContainer,this.editNode).o,endOffset:e.mark.endOffset}}}catch(s){e.mark=null}}return e},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:w.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var e=w.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:e,bookmark:this._getBookmark()})},onKeyDown:function(e){h("ie")||this.iframe||e.keyCode!=d.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var t=e.keyCode;if(e.ctrlKey&&!e.shiftKey&&!e.altKey){if(90==t||122==t){e.stopPropagation();e.preventDefault();this.undo();return}if(89==t||121==t){e.stopPropagation();e.preventDefault();this.redo();return}}this.inherited(arguments);switch(t){case d.ENTER:case d.BACKSPACE:case d.DELETE:this.beginEditing();break;case 88:case 86:if(e.ctrlKey&&!e.altKey&&!e.metaKey){this.endEditing();88==e.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!e.ctrlKey&&!e.altKey&&!e.metaKey&&(e.keyCode<d.F1||e.keyCode>d.F15)){this.beginEditing();break}case d.ALT:this.endEditing();break;case d.UP_ARROW:case d.DOWN_ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.HOME:case d.END:case d.PAGE_UP:case d.PAGE_DOWN:this.endEditing(!0);case d.CTRL:case d.SHIFT:case d.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(e){}},_restoreSelection:function(){if(this._savedSelection){delete this._cursorToStart;this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection);delete this._savedSelection}},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(e){if(this.customUndo)if(this.isClosed)this.setValue(e);else{this.beginEditing();e||(e="&#160;");this.setValue(e);this.endEditing()}else this.inherited(arguments)},_setDisabledAttr:function(e){this.setValueDeferred.then(c.hitch(this,(function(){!this.disabled&&e||!this._buttonEnabledPlugins&&e?t.forEach(this._plugins,(function(e){e.set("disabled",!0)})):this.disabled&&!e&&t.forEach(this._plugins,(function(e){e.set("disabled",!1)}))})));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments);if(this.document&&this.document.body){l.set(this.document.body,"color",l.get(this.iframe,"color"));l.set(this.document.body,"background-color",l.get(this.iframe,"background-color"))}}catch(e){}}});function A(e){return new b({command:e.name})}function j(e){return new b({buttonClass:v,command:e.name})}c.mixin(b.registry,{undo:A,redo:A,cut:A,copy:A,paste:A,insertOrderedList:A,insertUnorderedList:A,indent:A,outdent:A,justifyCenter:A,justifyFull:A,justifyLeft:A,justifyRight:A,delete:A,selectAll:A,removeFormat:A,unlink:A,insertHorizontalRule:A,bold:j,italic:j,underline:j,strikethrough:j,subscript:j,superscript:j,"|":function(){return new b({setEditor:function(e){this.editor=e;this.button=new _({ownerDocument:e.ownerDocument})}})}});return T}))},"dijit/Toolbar":function(){define(["require","dojo/_base/declare","dojo/has","dojo/keys","dojo/ready","./_Widget","./_KeyNavContainer","./_TemplatedMixin"],(function(e,t,i,n,o,a,s,r){i("dijit-legacy-requires")&&o(0,(function(){e(["dijit/ToolbarSeparator"])}));return t("dijit.Toolbar",[a,r,s],{templateString:'<div class="dijit" role="toolbar" tabIndex="${tabIndex}" data-dojo-attach-point="containerNode"></div>',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})}))},"dijit/_KeyNavContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/_base/kernel","dojo/keys","dojo/_base/lang","./registry","./_Container","./_FocusMixin","./_KeyNavMixin"],(function(e,t,i,n,o,a,s,r,l,d){return t("dijit._KeyNavContainer",[l,d,r],{connectKeyNavHandlers:function(t,i){var n=this._keyNavCodes={},s=a.hitch(this,"focusPrev"),r=a.hitch(this,"focusNext");e.forEach(t,(function(e){n[e]=s}));e.forEach(i,(function(e){n[e]=r}));n[o.HOME]=a.hitch(this,"focusFirstChild");n[o.END]=a.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){n.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);e.forEach(this.getChildren(),a.hitch(this,"_startupChild"))},addChild:function(e,t){this.inherited(arguments);this._startupChild(e)},_startupChild:function(e){e.set("tabIndex","-1")},_getFirst:function(){var e=this.getChildren();return e.length?e[0]:null},_getLast:function(){var e=this.getChildren();return e.length?e[e.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(e){return(e=s.byNode(e))&&e.getParent()==this}})}))},"dijit/_KeyNavMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/on","dijit/registry","dijit/_FocusMixin"],(function(e,t,i,n,o,a,s,r){return t("dijit._KeyNavMixin",r,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);i.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var e=this._keyNavCodes={};e[n.HOME]=o.hitch(this,"focusFirstChild");e[n.END]=o.hitch(this,"focusLastChild");e[this.isLeftToRight()?n.LEFT_ARROW:n.RIGHT_ARROW]=o.hitch(this,"_onLeftArrow");e[this.isLeftToRight()?n.RIGHT_ARROW:n.LEFT_ARROW]=o.hitch(this,"_onRightArrow");e[n.UP_ARROW]=o.hitch(this,"_onUpArrow");e[n.DOWN_ARROW]=o.hitch(this,"_onDownArrow")}var t=this,r="string"==typeof this.childSelector?this.childSelector:o.hitch(this,"childSelector");this.own(a(this.domNode,"keypress",o.hitch(this,"_onContainerKeypress")),a(this.domNode,"keydown",o.hitch(this,"_onContainerKeydown")),a(this.domNode,"focus",o.hitch(this,"_onContainerFocus")),a(this.containerNode,a.selector(r,"focusin"),(function(e){t._onChildFocus(s.getEnclosingWidget(this),e)})))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(e,t){if(e){this.focusedChild&&e!==this.focusedChild&&this._onChildBlur(this.focusedChild);e.set("tabIndex",this.tabIndex);e.focus(t?"end":"start")}},_onContainerFocus:function(e){e.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){i.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(e){i.set(this.domNode,"tabIndex",this.tabIndex);if(this.focusedChild){this.focusedChild.set("tabIndex","-1");this.lastFocusedChild=this.focusedChild;this._set("focusedChild",null)}this.inherited(arguments)},_onChildFocus:function(e){if(e&&e!=this.focusedChild){this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1");e.set("tabIndex",this.tabIndex);this.lastFocused=e;this._set("focusedChild",e)}},_searchString:"",multiCharSearchDuration:1e3,onKeyboardSearch:function(e,t,i,n){e&&this.focusChild(e)},_keyboardSearchCompare:function(e,t){var i=e.domNode,n=(e.label||(i.focusNode?i.focusNode.label:"")||i.innerText||i.textContent||"").replace(/^\s+/,"").substr(0,t.length).toLowerCase();return t.length&&n==t?-1:0},_onContainerKeydown:function(e){var t=this._keyNavCodes[e.keyCode];if(t){t(e,this.focusedChild);e.stopPropagation();e.preventDefault();this._searchString=""}else if(e.keyCode==n.SPACE&&this._searchTimer&&!(e.ctrlKey||e.altKey||e.metaKey)){e.stopImmediatePropagation();e.preventDefault();this._keyboardSearch(e," ")}},_onContainerKeypress:function(e){if(!(e.charCode<=n.SPACE||e.ctrlKey||e.altKey||e.metaKey)){e.preventDefault();e.stopPropagation();this._keyboardSearch(e,String.fromCharCode(e.charCode).toLowerCase())}},_keyboardSearch:function(e,t){var i,n=null,a=0;o.hitch(this,(function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=t;var e=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;i=this._searchString.substr(0,e);this._searchTimer=this.defer((function(){this._searchTimer=null;this._searchString=""}),this.multiCharSearchDuration);var o=this.focusedChild||null;if(1!=e&&o||(o=this._getNextFocusableChild(o,1))){var s=o;do{var r=this._keyboardSearchCompare(o,i);r&&0==a++&&(n=o);if(-1==r){a=-1;break}o=this._getNextFocusableChild(o,1)}while(o&&o!=s)}}))();this.onKeyboardSearch(n,e,i,a)},_onChildBlur:function(){},_getNextFocusableChild:function(e,t){var i=e;do{if(e)e=this._getNext(e,t);else if(!(e=this[t>0?"_getFirst":"_getLast"]()))break;if(null!=e&&e!=i&&e.isFocusable())return e}while(e!=i);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(e,t){if(e){e=e.domNode;for(;e;)if((e=e[t<0?"previousSibling":"nextSibling"])&&"getAttribute"in e){var i=s.byNode(e);if(i)return i}}return null}})}))},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],(function(e,t,i,n){return e("dijit.ToolbarSeparator",[i,n],{templateString:'<div class="dijitToolbarSeparator dijitInline" role="presentation"></div>',buildRendering:function(){this.inherited(arguments);t.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})}))},"dijit/layout/_LayoutWidget":function(){define(["dojo/_base/lang","../_Widget","../_Container","../_Contained","../Viewport","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style"],(function(e,t,i,n,o,a,s,r,l){return a("dijit.layout._LayoutWidget",[t,i,n],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);s.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var t=this.getParent&&this.getParent();if(!t||!t.isLayoutContainer){this.resize();this.own(o.on("resize",e.hitch(this,"resize")))}}},resize:function(t,i){var n=this.domNode;t&&r.setMarginBox(n,t);var o=i||{};e.mixin(o,t||{});"h"in o&&"w"in o||(o=e.mixin(r.getMarginBox(n),o));var a=l.getComputedStyle(n),s=r.getMarginExtents(n,a),d=r.getBorderExtents(n,a),c=this._borderBox={w:o.w-(s.w+d.w),h:o.h-(s.h+d.h)},h=r.getPadExtents(n,a);this._contentBox={l:l.toPixelValue(n,a.paddingLeft),t:l.toPixelValue(n,a.paddingTop),w:c.w-h.w,h:c.h-h.h};this.layout()},layout:function(){},_setupChild:function(e){var t=this.baseClass+"-child "+(e.baseClass?this.baseClass+"-"+e.baseClass:"");s.add(e.domNode,t)},addChild:function(e,t){this.inherited(arguments);this._started&&this._setupChild(e)},removeChild:function(e){var t=this.baseClass+"-child"+(e.baseClass?" "+this.baseClass+"-"+e.baseClass:"");s.remove(e.domNode,t);this.inherited(arguments)}})}))},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],(function(e,t){return e("dijit._Contained",null,{_getSibling:function(e){var t=this.getParent();return t&&t._getSiblingOfChild&&t._getSiblingOfChild(this,"previous"==e?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var e=this.getParent();return e&&e.getIndexOfChild?e.getIndexOfChild(this):-1}})}))},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],(function(e,t,i,n){return e("dijit.form.ToggleButton",[i,n],{baseClass:"dijitToggleButton",setChecked:function(e){t.deprecated("setChecked("+e+") is deprecated. Use set('checked',"+e+") instead.","","2.0");this.set("checked",e)}})}))},"dijit/form/Button":function(){define(["require","dojo/_base/declare","dojo/dom-class","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/ready","./_FormWidget","./_ButtonMixin","dojo/text!./templates/Button.html","../a11yclick"],(function(e,t,i,n,o,a,s,r,l,d){n("dijit-legacy-requires")&&s(0,(function(){e(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])}));var c=t("dijit.form.Button"+(n("dojo-bidi")?"_NoBidi":""),[r,l],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:d,_setValueAttr:"valueNode",_setNameAttr:function(e){this.valueNode&&this.valueNode.setAttribute("name",e)},postCreate:function(){this.inherited(arguments);this._setLabelFromContainer()},_setLabelFromContainer:function(){if(this.containerNode&&!this.label){this.label=a.trim(this.containerNode.innerHTML);this.onLabelSet()}},_setShowLabelAttr:function(e){this.containerNode&&i.toggle(this.containerNode,"dijitDisplayNone",!e);this._set("showLabel",e)},setLabel:function(e){o.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",e)},onLabelSet:function(){this.inherited(arguments);this.showLabel||"title"in this.params||(this.titleNode.title=a.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});n("dojo-bidi")&&(c=t("dijit.form.Button",c,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(e){if(this._created&&this.textDir!=e){this._set("textDir",e);this._setLabelAttr(this.label)}}}));return c}))},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],(function(e,t,i,n){var o=e("dijit.form._ButtonMixin"+(i("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(e){e.stopPropagation();e.preventDefault();this.disabled||this.valueNode.click(e);return!1},_onClick:function(e){if(this.disabled){e.stopPropagation();e.preventDefault();return!1}!1===this.onClick(e)&&e.preventDefault();var t=e.defaultPrevented;if(!t&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var i=this.domNode;i.parentNode;i=i.parentNode){var o=n.byNode(i);if(o&&"function"==typeof o._onSubmit){o._onSubmit(e);e.preventDefault();t=!0;break}}return!t},postCreate:function(){this.inherited(arguments);t.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(e){this._set("label",e);(this.containerNode||this.focusNode).innerHTML=e;this.onLabelSet()},onLabelSet:function(){}});i("dojo-bidi")&&(o=e("dijit.form._ButtonMixin",o,{onLabelSet:function(){this.inherited(arguments);var e=this.containerNode||this.focusNode;this.applyTextDir(e)}}));return o}))},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],(function(e,t){return e("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(e){var t=this.checked;this._set("checked",!t);var i=this.inherited(arguments);this.set("checked",i?this.checked:t);return i},_setCheckedAttr:function(e,i){this._set("checked",e);var n=this.focusNode||this.domNode;this._created&&t.get(n,"checked")!=!!e&&t.set(n,"checked",!!e);n.setAttribute(this._aria_attr,String(e));this._handleOnChange(e,i)},postCreate:function(){this.inherited(arguments);var e=this.focusNode||this.domNode;this.checked&&e.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})}))},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],(function(e,t,i,n,o){var a=t("dijit._editor._Plugin",n,{constructor:function(e){this.params=e||{};i.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",button:null,command:"",useDefaultCommand:!0,buttonClass:o,disabled:!1,getLabel:function(e){return this.editor.commands[e]},_initButton:function(){if(this.command.length){var e=this.getLabel(this.command),t=this.editor,n=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);if(!this.button){var o=i.mixin({label:e,ownerDocument:t.ownerDocument,dir:t.dir,lang:t.lang,showLabel:!1,iconClass:n,dropDown:this.dropDown,tabIndex:"-1"},this.params||{});delete o.name;this.button=new this.buttonClass(o)}}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(t,i,n){this.own(e.connect(t,i,this,n))},updateState:function(){var e,t,i=this.editor,n=this.command;if(i&&i.isLoaded&&n.length){var o=this.get("disabled");if(this.button)try{var a=i._implCommand(n);t=!o&&(this[a]?this[a](n):i.queryCommandEnabled(n));if(this.enabled!==t){this.enabled=t;this.button.set("disabled",!t)}if(t&&"boolean"==typeof this.button.checked){e=i.queryCommandState(n);if(this.checked!==e){this.checked=e;this.button.set("checked",i.queryCommandState(n))}}}catch(i){}}},setEditor:function(e){this.editor=e;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",i.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display="none");this.own(this.editor.on("NormalizedDisplayChanged",i.hitch(this,"updateState")))},setToolbar:function(e){this.button&&e.addChild(this.button)},set:function(e,t){if("object"==typeof e){for(var i in e)this.set(i,e[i]);return this}var n=this._getAttrNames(e);if(this[n.s])var o=this[n.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(e,t);return o||this},get:function(e){var t=this._getAttrNames(e);return this[t.g]?this[t.g]():this[e]},_setDisabledAttr:function(e){this._set("disabled",e);this.updateState()},_getAttrNames:function(e){var t=this._attrPairNames;if(t[e])return t[e];var i=e.charAt(0).toUpperCase()+e.substr(1);return t[e]={s:"_set"+i+"Attr",g:"_get"+i+"Attr"}},_set:function(e,t){this[e]=t}});a.registry={};return a}))},"dijit/_editor/plugins/EnterKeyHandling":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/_base/window","dojo/window","../_Plugin","../RichText","../range"],(function(e,t,i,n,o,a,s,r,l,d,c){return e("dijit._editor.plugins.EnterKeyHandling",l,{blockNodeForEnter:"BR",constructor:function(e){if(e){"blockNodeForEnter"in e&&(e.blockNodeForEnter=e.blockNodeForEnter.toUpperCase());n.mixin(this,e)}},setEditor:function(e){if(this.editor!==e){this.editor=e;if("BR"==this.blockNodeForEnter){this.editor.customUndo=!0;e.onLoadDeferred.then(n.hitch(this,(function(t){this.own(o(e.document,"keydown",n.hitch(this,(function(e){if(e.keyCode==i.ENTER){var t=n.mixin({},e);t.shiftKey=!0;if(!this.handleEnterKey(t)){e.stopPropagation();e.preventDefault()}}}))));a("ie")>=9&&a("ie")<=10&&this.own(o(e.document,"paste",n.hitch(this,(function(e){setTimeout(n.hitch(this,(function(){var e=this.editor.document.selection.createRange();e.move("character",-1);e.select();e.move("character",1);e.select()})),0)}))));return t})))}else if(this.blockNodeForEnter){var t=n.hitch(this,"handleEnterKey");e.addKeyHandler(13,0,0,t);e.addKeyHandler(13,0,1,t);this.own(this.editor.on("KeyPressed",n.hitch(this,"onKeyPressed")))}}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var e=this.editor.selection.getAncestorElement("LI");if(e){a("mozilla")&&"LI"==e.parentNode.parentNode.nodeName&&(e=e.parentNode.parentNode);var t=e.firstChild;if(t&&1==t.nodeType&&("UL"==t.nodeName||"OL"==t.nodeName)){e.insertBefore(t.ownerDocument.createTextNode(" "),t);var i=c.create(this.editor.window);i.setStart(e.firstChild,0);var n=c.getSelection(this.editor.window,!0);n.removeAllRanges();n.addRange(i)}}else{d.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter);var o=this.editor.selection.getAncestorElement(this.blockNodeForEnter);if(o){o.innerHTML=this.bogusHtmlContent;if(a("ie")<=9){var s=this.editor.document.selection.createRange();s.move("character",-1);s.select()}}}}this._checkListLater=!1}if(this._pressedEnterInBlock){this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling);delete this._pressedEnterInBlock}},bogusHtmlContent:"&#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(e){var i,n,o,s,l,h,u,p=this.editor.document;if(e.shiftKey){var m=this.editor.selection.getParentElement(),g=c.getAncestor(m,this.blockNodes);if(g){if("LI"==g.tagName)return!0;if(!(n=(i=c.getSelection(this.editor.window)).getRangeAt(0)).collapsed){n.deleteContents();n=(i=c.getSelection(this.editor.window)).getRangeAt(0)}if(c.atBeginningOfContainer(g,n.startContainer,n.startOffset)){l=p.createElement("br");o=c.create(this.editor.window);g.insertBefore(l,g.firstChild);o.setStartAfter(l);i.removeAllRanges();i.addRange(o)}else{if(!c.atEndOfContainer(g,n.startContainer,n.startOffset)){if((h=n.startContainer)&&3==h.nodeType){u=h.nodeValue;s=p.createTextNode(u.substring(0,n.startOffset));b=p.createTextNode(u.substring(n.startOffset));v=p.createElement("br");""==b.nodeValue&&a("webkit")&&(b=p.createTextNode(" "));t.place(s,h,"after");t.place(v,s,"after");t.place(b,v,"after");t.destroy(h);(o=c.create(this.editor.window)).setStart(b,0);i.removeAllRanges();i.addRange(o);return!1}return!0}o=c.create(this.editor.window);l=p.createElement("br");g.appendChild(l);g.appendChild(p.createTextNode(" "));o.setStart(g.lastChild,0);i.removeAllRanges();i.addRange(o)}}else if((i=c.getSelection(this.editor.window)).rangeCount){if((n=i.getRangeAt(0))&&n.startContainer){if(!n.collapsed){n.deleteContents();n=(i=c.getSelection(this.editor.window)).getRangeAt(0)}if((h=n.startContainer)&&3==h.nodeType){var _=n.startOffset;if(h.length<_){h=(A=this._adjustNodeAndOffset(h,_)).node;_=A.offset}u=h.nodeValue;s=p.createTextNode(u.substring(0,_));b=p.createTextNode(u.substring(_));v=p.createElement("br");b.length||(b=p.createTextNode(" "));s.length?t.place(s,h,"after"):s=h;t.place(v,s,"after");t.place(b,v,"after");t.destroy(h);(o=c.create(this.editor.window)).setStart(b,0);o.setEnd(b,b.length);i.removeAllRanges();i.addRange(o);this.editor.selection.collapse(!0)}else{var f;n.startOffset>=0&&(f=h.childNodes[n.startOffset]);var v=p.createElement("br"),b=p.createTextNode(" ");if(f){t.place(v,f,"before");t.place(b,v,"after")}else{h.appendChild(v);h.appendChild(b)}(o=c.create(this.editor.window)).setStart(b,0);o.setEnd(b,b.length);i.removeAllRanges();i.addRange(o);this.editor.selection.collapse(!0)}}}else d.prototype.execCommand.call(this.editor,"inserthtml","<br>");return!1}var y=!0;if(!(n=(i=c.getSelection(this.editor.window)).getRangeAt(0)).collapsed){n.deleteContents();n=(i=c.getSelection(this.editor.window)).getRangeAt(0)}var w=c.getBlockAncestor(n.endContainer,null,this.editor.editNode),C=w.blockNode;if(this._checkListLater=C&&("LI"==C.nodeName||"LI"==C.parentNode.nodeName)){a("mozilla")&&(this._pressedEnterInBlock=C);if(/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(C.innerHTML)){C.innerHTML="";if(a("webkit")){(o=c.create(this.editor.window)).setStart(C,0);i.removeAllRanges();i.addRange(o)}this._checkListLater=!1}return!0}if(!w.blockNode||w.blockNode===this.editor.editNode){try{d.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch($){}if((w={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode}).blockNode){if(w.blockNode!=this.editor.editNode&&!(w.blockNode.textContent||w.blockNode.innerHTML).replace(/^\s+|\s+$/g,"").length){this.removeTrailingBr(w.blockNode);return!1}}else w.blockNode=this.editor.editNode;n=(i=c.getSelection(this.editor.window)).getRangeAt(0)}var k=p.createElement(this.blockNodeForEnter);k.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(w.blockNode);var x=n.endOffset,T=n.endContainer;if(T.length<x){var A=this._adjustNodeAndOffset(T,x);T=A.node;x=A.offset}if(c.atEndOfContainer(w.blockNode,T,x)){w.blockNode===w.blockContainer?w.blockNode.appendChild(k):t.place(k,w.blockNode,"after");y=!1;(o=c.create(this.editor.window)).setStart(k,0);i.removeAllRanges();i.addRange(o);this.editor.height&&r.scrollIntoView(k)}else if(c.atBeginningOfContainer(w.blockNode,n.startContainer,n.startOffset)){t.place(k,w.blockNode,w.blockNode===w.blockContainer?"first":"before");if(k.nextSibling&&this.editor.height){(o=c.create(this.editor.window)).setStart(k.nextSibling,0);i.removeAllRanges();i.addRange(o);r.scrollIntoView(k.nextSibling)}y=!1}else{w.blockNode===w.blockContainer?w.blockNode.appendChild(k):t.place(k,w.blockNode,"after");y=!1;w.blockNode.style&&k.style&&w.blockNode.style.cssText&&(k.style.cssText=w.blockNode.style.cssText);var j,S;if((h=n.startContainer)&&3==h.nodeType){var M,E;x=n.endOffset;if(h.length<x){h=(A=this._adjustNodeAndOffset(h,x)).node;x=A.offset}u=h.nodeValue;s=p.createTextNode(u.substring(0,x));b=p.createTextNode(u.substring(x,u.length));t.place(s,h,"before");t.place(b,h,"after");t.destroy(h);for(var N=s.parentNode;N!==w.blockNode;){var D=N.tagName,I=p.createElement(D);N.style&&I.style&&N.style.cssText&&(I.style.cssText=N.style.cssText);if("FONT"===N.tagName){N.color&&(I.color=N.color);N.face&&(I.face=N.face);N.size&&(I.size=N.size)}M=b;for(;M;){E=M.nextSibling;I.appendChild(M);M=E}t.place(I,N,"after");s=N;b=I;N=N.parentNode}(1==(M=b).nodeType||3==M.nodeType&&M.nodeValue)&&(k.innerHTML="");j=M;for(;M;){E=M.nextSibling;k.appendChild(M);M=E}}o=c.create(this.editor.window);var L=j;if("BR"!==this.blockNodeForEnter){for(;L;){S=L;L=E=L.firstChild}if(S&&S.parentNode){k=S.parentNode;o.setStart(k,0);i.removeAllRanges();i.addRange(o);this.editor.height&&r.scrollIntoView(k);a("mozilla")&&(this._pressedEnterInBlock=w.blockNode)}else y=!0}else{o.setStart(k,0);i.removeAllRanges();i.addRange(o);this.editor.height&&r.scrollIntoView(k);a("mozilla")&&(this._pressedEnterInBlock=w.blockNode)}}return y},_adjustNodeAndOffset:function(e,t){for(;e.length<t&&e.nextSibling&&3==e.nextSibling.nodeType;){t-=e.length;e=e.nextSibling}return{node:e,offset:t}},removeTrailingBr:function(e){var i=/P|DIV|LI/i.test(e.tagName)?e:this.editor.selection.getParentOfType(e,["P","DIV","LI"]);if(i){i.lastChild&&(i.childNodes.length>1&&3==i.lastChild.nodeType&&/^[\s\xAD]*$/.test(i.lastChild.nodeValue)||"BR"==i.lastChild.tagName)&&t.destroy(i.lastChild);i.childNodes.length||(i.innerHTML=this.bogusHtmlContent)}}})}))},"dijit/_editor/RichText":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/_base/kernel","dojo/keys","dojo/_base/lang","dojo/on","dojo/query","dojo/domReady","dojo/sniff","dojo/string","dojo/topic","dojo/_base/unload","dojo/_base/url","dojo/window","../_Widget","../_CssStateMixin","../selection","./range","./html","../focus","../main"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_,f,v,b,y,w,C,k,x,T,A,j,S){var M=i("dijit._editor.RichText",[C,k],{constructor:function(e){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};e&&u.isString(e.value)&&(this.value=e.value);this.onLoadDeferred=new n},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){this.domNode.tagName.toLowerCase();this.contentPreFilters=[u.trim,u.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);if(_("mozilla")){this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters);this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters)}if(_("webkit")){this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters);this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters)}if(_("ie")||_("trident")){this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters);this.contentDomPostFilters=[u.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters)}this.contentDomPostFilters=[u.hitch(this,"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);v.publish(S._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var e,t=u.hitch(this,(function(e,t){return function(){return!this.execCommand(e,t)}})),i={b:t("bold"),i:t("italic"),u:t("underline"),a:t("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:t("formatblock","h1"),2:t("formatblock","h2"),3:t("formatblock","h3"),4:t("formatblock","h4"),"\\":t("insertunorderedlist")};_("ie")||(i.Z=t("redo"));for(e in i)this.addKeyHandler(e,!0,!1,i[e])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(M._editorCommandsLocalized){this._local2NativeFormatNames=M._local2NativeFormatNames;this._native2LocalFormatNames=M._native2LocalFormatNames}else{M._editorCommandsLocalized=!0;M._local2NativeFormatNames={};M._native2LocalFormatNames={};this._local2NativeFormatNames=M._local2NativeFormatNames;this._native2LocalFormatNames=M._native2LocalFormatNames;for(var e,t=["div","p","pre","h1","h2","h3","h4","h5","h6","ol","ul","address"],i="",n=0;e=t[n++];)"l"!==e.charAt(1)?i+="<"+e+"><span>content</span></"+e+"><br/>":i+="<"+e+"><li>content</li></"+e+"><br/>";var o=r.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:i});this.ownerDocumentBody.appendChild(o);var a=u.hitch(this,(function(){for(var e=o.firstChild;e;)try{this.selection.selectElement(e.firstChild);var t=e.tagName.toLowerCase();this._local2NativeFormatNames[t]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[t]]=t;e=e.nextSibling.nextSibling}catch(i){}r.destroy(o)}));this.defer(a)}},open:function(e){(!this.onLoadDeferred||this.onLoadDeferred.fired>=0)&&(this.onLoadDeferred=new n);this.isClosed||this.close();v.publish(S._scopeName+"._editor.RichText::open",this);1===arguments.length&&e.nodeName&&(this.domNode=e);var i,l=this.domNode;if(u.isString(this.value)){i=this.value;l.innerHTML=""}else if(l.nodeName&&"textarea"==l.nodeName.toLowerCase()){var c=this.textarea=l;this.name=c.name;i=c.value;(l=this.domNode=this.ownerDocument.createElement("div")).setAttribute("widgetId",this.id);c.removeAttribute("widgetId");l.cssText=c.cssText;l.className+=" "+c.className;r.place(l,c,"before");var h=u.hitch(this,(function(){d.set(c,{display:"block",position:"absolute",top:"-1000px"});if(_("ie")){var e=c.style;this.__overflow=e.overflow;e.overflow="hidden"}}));_("ie")?this.defer(h,10):h();if(c.form){var m=c.value;this.reset=function(){this.getValue()!==m&&this.replaceValue(m)};p(c.form,"submit",u.hitch(this,(function(){a.set(c,"disabled",this.disabled);c.value=this.getValue()})))}}else{i=A.getChildrenHtml(l);l.innerHTML=""}this.value=i;l.nodeName&&"LI"===l.nodeName&&(l.innerHTML=" <br>");this.header=l.ownerDocument.createElement("div");l.appendChild(this.header);this.editingArea=l.ownerDocument.createElement("div");l.appendChild(this.editingArea);this.footer=l.ownerDocument.createElement("div");l.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!t.useXDomain||t.allowXdRichTextSave)){var g=o.byId(S._scopeName+"._editor.RichText.value");if(g&&""!==g.value)for(var f,y=g.value.split(this._SEPARATOR),w=0;f=y[w++];){var C=f.split(this._NAME_CONTENT_SEP);if(C[0]===this.name){this.value=C[1];y=y.splice(w,1);g.value=y.join(this._SEPARATOR);break}}if(!M._globalSaveHandler){M._globalSaveHandler={};b.addOnUnload((function(){var e;for(e in M._globalSaveHandler){var t=M._globalSaveHandler[e];u.isFunction(t)&&t()}}))}M._globalSaveHandler[this.id]=u.hitch(this,"_saveContent")}this.isClosed=!1;var k=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");k.id=this.id+"_iframe";k.style.border="none";k.style.width="100%";if(this._layoutMode)k.style.height="100%";else if(_("ie")>=7){this.height&&(k.style.height=this.height);this.minHeight&&(k.style.minHeight=this.minHeight)}else k.style.height=this.height?this.height:this.minHeight;k.frameBorder=0;k._loadFunc=u.hitch(this,(function(e){this.window=e;this.document=e.document;this.selection=new x.SelectionManager(e);_("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))}));var T,j=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");T=_("ie")<11?'javascript:document.open();try{parent.window;}catch(e){document.domain="'+document.domain+"\";}document.write('"+j+"');document.close()":"javascript: '"+j+"'";this.editingArea.appendChild(k);k.src=T;"LI"===l.nodeName&&(l.lastChild.style.marginTop="-1.2em");s.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var e,t=d.getComputedStyle(this.domNode);if(this["aria-label"])e=this["aria-label"];else{var i=m('label[for="'+this.id+'"]',this.ownerDocument)[0]||o.byId(this["aria-labelledby"],this.ownerDocument);i&&(e=i.textContent||i.innerHTML||"")}var n="<div id='dijitEditorBody' role='textbox' aria-multiline='true' "+(e?" aria-label='"+f.escape(e)+"'":"")+"></div>",a=[t.fontWeight,t.fontSize,t.fontFamily].join(" "),s=t.lineHeight;s=s.indexOf("px")>=0?parseFloat(s)/parseFloat(t.fontSize):s.indexOf("em")>=0?parseFloat(s):"normal";var r="",l=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/gi,(function(e){var t=(e=e.replace(/^;/gi,"")+";").split(":")[0];if(t){t=(t=u.trim(t)).toLowerCase();var i,n="";for(i=0;i<t.length;i++){var o=t.charAt(i);if("-"===o){i++;o=t.charAt(i).toUpperCase()}n+=o}d.set(l.domNode,n,"")}r+=e+";"}));this.iframe.setAttribute("title",e);return["<!DOCTYPE html>","<html lang='"+(this.lang||c.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir='rtl'")+">\n","<head>\n","<meta http-equiv='Content-Type' content='text/html'>\n",e?"<title>"+f.escape(e)+"</title>":"","<style>\n","\tbody,html {\n","\t\tbackground:transparent;\n","\t\tpadding: 1px 0 0 0;\n","\t\tmargin: -1px 0 0 0;\n","\t}\n","\tbody,html,#dijitEditorBody { outline: none; }","html { height: 100%; width: 100%; overflow: hidden; }\n",this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n","\t\ttop:0px;\n","\t\tleft:0px;\n","\t\tright:0px;\n","\t\tfont:",a,";\n",this.height||_("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",s,";\n","\t}\n","\tp{ margin: 1em 0; }\n","\tli > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; }\n",_("ie")||_("trident")||_("edge")?"":"\tli{ min-height:1.2em; }\n","</style>\n",this._applyEditingAreaStyleSheets(),"\n","</head>\n<body role='application'",e?" aria-label='"+f.escape(e)+"'":"","onload='try{frameElement && frameElement._loadFunc(window,document)}catch(e){document.domain=\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style='"+r+"'>",n,"</body>\n</html>"].join("")},_applyEditingAreaStyleSheets:function(){var e=[];if(this.styleSheets){e=this.styleSheets.split(";");this.styleSheets=""}e=e.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var t,i="",n=0,o=w.get(this.ownerDocument);t=e[n++];){var a=new y(o.location,t).toString();this.editingAreaStyleSheets.push(a);i+='<link rel="stylesheet" type="text/css" href="'+a+'"/>'}return i},addStyleSheet:function(t){var i=t.toString(),n=w.get(this.ownerDocument);("."===i.charAt(0)||"/"!==i.charAt(0)&&!t.host)&&(i=new y(n.location,i).toString());if(!(e.indexOf(this.editingAreaStyleSheets,i)>-1)){this.editingAreaStyleSheets.push(i);this.onLoadDeferred.then(u.hitch(this,(function(){if(this.document.createStyleSheet)this.document.createStyleSheet(i);else{var e=this.document.getElementsByTagName("head")[0],t=this.document.createElement("link");t.rel="stylesheet";t.type="text/css";t.href=i;e.appendChild(t)}})))}},removeStyleSheet:function(t){var i=t.toString(),n=w.get(this.ownerDocument);("."===i.charAt(0)||"/"!==i.charAt(0)&&!t.host)&&(i=new y(n.location,i).toString());var o=e.indexOf(this.editingAreaStyleSheets,i);if(-1!==o){delete this.editingAreaStyleSheets[o];m('link[href="'+i+'"]',this.window.document).orphan()}},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(e){e=!!e;this._set("disabled",e);if(this.isLoaded){var t=_("ie")&&(this.isLoaded||!this.focusOnLoad);t&&(this.editNode.unselectable="on");this.editNode.contentEditable=!e;this.editNode.tabIndex=e?"-1":this.tabIndex;t&&this.defer((function(){this.editNode&&(this.editNode.unselectable="off")}));if(_("mozilla")&&!e&&this._mozSettingProps){var i,n=this._mozSettingProps;for(i in n)if(n.hasOwnProperty(i))try{this.document.execCommand(i,!1,n[i])}catch(o){}}this._disabledOK=!0}},onLoad:function(t){if(!this.window.__registeredWindow){this.window.__registeredWindow=!0;this._iframeRegHandle=j.registerIframe(this.iframe)}this.editNode=this.document.body.firstChild;var i=this;this.beforeIframeNode=r.place("<div tabIndex=-1></div>",this.iframe,"before");this.afterIframeNode=r.place("<div tabIndex=-1></div>",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){i.editNode.focus()};this.focusNode=this.editNode;var n=this.events.concat(this.captureEvents),o=this.iframe?this.document:this.editNode;this.own.apply(this,e.map(n,(function(e){var t=e.toLowerCase().replace(/^on/,"");return p(o,t,u.hitch(this,e))}),this));this.own(p(o,"mouseup",u.hitch(this,"onClick")));if(_("ie")){this.own(p(this.document,"mousedown",u.hitch(this,"_onIEMouseDown")));this.editNode.style.zoom=1}if(_("webkit")){this._webkitListener=this.own(p(this.document,"mouseup",u.hitch(this,"onDisplayChanged")))[0];this.own(p(this.document,"mousedown",u.hitch(this,(function(e){var t=e.target;!t||t!==this.document.body&&t!==this.document||this.defer("placeCursorAtEnd")}))))}if(_("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(s){}this.isLoaded=!0;this.set("disabled",this.disabled);var a=u.hitch(this,(function(){this.setValue(t);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&g(u.hitch(this,"defer","focus",this.updateInterval));this.value=this.getValue(!0)}));this.setValueDeferred?this.setValueDeferred.then(a):a()},onKeyDown:function(t){if(t.keyCode===h.SHIFT||t.keyCode===h.ALT||t.keyCode===h.META||t.keyCode===h.CTRL)return!0;if(t.keyCode===h.TAB&&this.isTabIndent){t.stopPropagation();t.preventDefault();this.queryCommandEnabled(t.shiftKey?"outdent":"indent")&&this.execCommand(t.shiftKey?"outdent":"indent")}if(t.keyCode==h.TAB&&!this.isTabIndent&&!t.ctrlKey&&!t.altKey){t.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus();return!0}if(_("ie")<9&&t.keyCode===h.BACKSPACE&&"Control"===this.document.selection.type){t.stopPropagation();t.preventDefault();this.execCommand("delete")}_("ff")&&(t.keyCode!==h.PAGE_UP&&t.keyCode!==h.PAGE_DOWN||this.editNode.clientHeight>=this.editNode.scrollHeight&&t.preventDefault());var i=this._keyHandlers[t.keyCode],n=arguments;i&&!t.altKey&&e.some(i,(function(e){if(!(e.shift^t.shiftKey||e.ctrl^(t.ctrlKey||t.metaKey))){e.handler.apply(this,n)||t.preventDefault();return!0}}),this);this.defer("onKeyPressed",1);return!0},onKeyUp:function(){},setDisabled:function(e){c.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",e)},_setValueAttr:function(e){this.setValue(e)},_setDisableSpellCheckAttr:function(e){this.document?a.set(this.document.body,"spellcheck",!e):this.onLoadDeferred.then(u.hitch(this,(function(){a.set(this.document.body,"spellcheck",!e)})));this._set("disableSpellCheck",e)},addKeyHandler:function(e,t,i,n){"string"==typeof e&&(e=e.toUpperCase().charCodeAt(0));u.isArray(this._keyHandlers[e])||(this._keyHandlers[e]=[]);this._keyHandlers[e].push({shift:i||!1,ctrl:t||!1,handler:n})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(e){this.onDisplayChanged(e)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(e){(_("ie")||_("trident"))&&this.defer((function(){j.curNode||this.ownerDocumentBody.focus()}));this.inherited(arguments);var t=this.getValue(!0);t!==this.value&&this.onChange(t);this._set("value",t)},_onFocus:function(e){if(!this.disabled){this._disabledOK||this.set("disabled",!1);this.inherited(arguments)}},blur:function(){!_("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?_("ie")<9?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(e,t){var i=e.toLowerCase();"formatblock"===i?_("safari")&&void 0===t&&(i="heading"):"hilitecolor"!==i||_("mozilla")||(i="backcolor");return i},_implCommand:function(e){return"_"+this._normalizeCommand(e)+"EnabledImpl"},_qcaCache:{},queryCommandAvailable:function(e){var t=this._qcaCache[e];return void 0!==t?t:this._qcaCache[e]=this._queryCommandAvailable(e)},_queryCommandAvailable:function(e){switch(e.toLowerCase()){case"bold":case"italic":case"underline":case"subscript":case"superscript":case"fontname":case"fontsize":case"forecolor":case"hilitecolor":case"justifycenter":case"justifyfull":case"justifyleft":case"justifyright":case"delete":case"selectall":case"toggledir":case"createlink":case"unlink":case"removeformat":case"inserthorizontalrule":case"insertimage":case"insertorderedlist":case"insertunorderedlist":case"indent":case"outdent":case"formatblock":case"inserthtml":case"undo":case"redo":case"strikethrough":case"tabindent":case"cut":case"copy":case"paste":return!0;case"blockdirltr":case"blockdirrtl":case"dirltr":case"dirrtl":case"inlinedirltr":case"inlinedirrtl":return _("ie")||_("trident")||_("edge");case"inserttable":case"insertcell":case"insertcol":case"insertrow":case"deletecells":case"deletecols":case"deleterows":case"mergecells":case"splitcell":return!_("webkit");default:return!1}},execCommand:function(e,t){var i;this.focused&&this.focus();e=this._normalizeCommand(e,t);if(void 0!==t){if("heading"===e)throw new Error("unimplemented");"formatblock"===e&&(_("ie")||_("trident"))&&(t="<"+t+">")}var n="_"+e+"Impl";this[n]?i=this[n](t):((t=arguments.length>1?t:null)||"createlink"!==e)&&(i=this.document.execCommand(e,!1,t));this.onDisplayChanged();return i},queryCommandEnabled:function(e){if(this.disabled||!this._disabledOK)return!1;e=this._normalizeCommand(e);var t=this._implCommand(e);return this[t]?this[t](e):this._browserQueryCommandEnabled(e)},queryCommandState:function(e){if(this.disabled||!this._disabledOK)return!1;e=this._normalizeCommand(e);try{return this.document.queryCommandState(e)}catch(t){return!1}},queryCommandValue:function(e){if(this.disabled||!this._disabledOK)return!1;var t;e=this._normalizeCommand(e);if(_("ie")&&"formatblock"===e)t=this._native2LocalFormatNames[this.document.queryCommandValue(e)];else if(_("mozilla")&&"hilitecolor"===e){var i;try{i=this.document.queryCommandValue("styleWithCSS")}catch(n){i=!1}this.document.execCommand("styleWithCSS",!1,!0);t=this.document.queryCommandValue(e);this.document.execCommand("styleWithCSS",!1,i)}else t=this.document.queryCommandValue(e);return t},_sCall:function(e,t){return this.selection[e].apply(this.selection,t)},placeCursorAtStart:function(){this.focus();var e=!1;if(_("mozilla"))for(var t=this.editNode.firstChild;t;){if(3===t.nodeType){if(t.nodeValue.replace(/^\s+|\s+$/g,"").length>0){e=!0;this.selection.selectElement(t);break}}else if(1===t.nodeType){e=!0;var i=t.tagName?t.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(i)?this.selection.selectElement(t):this.selection.selectElementChildren(t);break}t=t.nextSibling}else{e=!0;this.selection.selectElementChildren(this.editNode)}e&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var e=!1;if(_("mozilla"))for(var t=this.editNode.lastChild;t;){if(3===t.nodeType){if(t.nodeValue.replace(/^\s+|\s+$/g,"").length>0){e=!0;this.selection.selectElement(t);break}}else if(1===t.nodeType){e=!0;this.selection.selectElement(t.lastChild||t);break}t=t.previousSibling}else{e=!0;this.selection.selectElementChildren(this.editNode)}e&&this.selection.collapse(!1)},getValue:function(e){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,e):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(e){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){e=this._preFilterContent(e);var t=this.isClosed?this.domNode:this.editNode;t.innerHTML=e;this._preDomFilterContent(t)}else this.textarea.value=e;this.onDisplayChanged();this._set("value",this.getValue(!0))}else this.onLoadDeferred.then(u.hitch(this,(function(){this.setValue(e)})))},replaceValue:function(e){if(this.isClosed)this.setValue(e);else if(this.window&&this.window.getSelection&&!_("mozilla"))this.setValue(e);else if(this.window&&this.window.getSelection){e=this._preFilterContent(e);this.execCommand("selectall");this.execCommand("inserthtml",e);this._preDomFilterContent(this.editNode)}else this.document&&this.document.selection&&this.setValue(e);this._set("value",this.getValue(!0))},_preFilterContent:function(t){var i=t;e.forEach(this.contentPreFilters,(function(e){e&&(i=e(i))}));return i},_preDomFilterContent:function(t){t=t||this.editNode;e.forEach(this.contentDomPreFilters,(function(e){e&&u.isFunction(e)&&e(t)}),this)},_postFilterContent:function(t,i){var n;if(u.isString(t))n=t;else{t=t||this.editNode;if(this.contentDomPostFilters.length){i&&(t=u.clone(t));e.forEach(this.contentDomPostFilters,(function(e){t=e(t)}))}n=A.getChildrenHtml(t)}u.trim(n.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(n="");e.forEach(this.contentPostFilters,(function(e){n=e(n)}));return n},_saveContent:function(){var e=o.byId(S._scopeName+"._editor.RichText.value");if(e){e.value&&(e.value+=this._SEPARATOR);e.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0)}},escapeXml:function(e,t){e=e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");t||(e=e.replace(/'/gm,"&#39;"));return e},getNodeHtml:function(e){c.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",2);return A.getNodeHtml(e)},getNodeChildrenHtml:function(e){c.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return A.getChildrenHtml(e)},close:function(e){if(!this.isClosed){arguments.length||(e=!0);e&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);if(this._webkitListener){this._webkitListener.remove();delete this._webkitListener}_("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;if(this._iframeRegHandle){this._iframeRegHandle.remove();delete this._iframeRegHandle}if(this.textarea){var t=this.textarea.style;t.position="";t.left=t.top="";if(_("ie")){t.overflow=this.__overflow;this.__overflow=null}this.textarea.value=this.value;r.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;s.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=null);this.window=null;this.document=null;this.editingArea=null;this.editorObject=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);M._globalSaveHandler&&delete M._globalSaveHandler[this.id]},_removeMozBogus:function(e){return e.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(e){return e=(e=(e=e.replace(/\sclass="webkit-block-placeholder"/gi,"")).replace(/\sclass="apple-style-span"/gi,"")).replace(/<meta charset=\"utf-8\" \/>/gi,"")},_normalizeFontStyle:function(e){return e.replace(/<(\/)?strong([ \>])/gi,"<$1b$2").replace(/<(\/)?em([ \>])/gi,"<$1i$2")},_preFixUrlAttributes:function(e){return e.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl=$2$3$5$2")},_browserQueryCommandEnabled:function(e){if(!e)return!1;var t=_("ie")<9?this.document.selection.createRange():this.document;try{return t.queryCommandEnabled(e)}catch(i){return!1}},_createlinkEnabledImpl:function(){var e=!0;if(_("opera")){e=!!this.window.getSelection().isCollapsed||this.document.queryCommandEnabled("createlink")}else e=this._browserQueryCommandEnabled("createlink");return e},_unlinkEnabledImpl:function(){return _("mozilla")||_("webkit")?this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){return!(!_("mozilla")&&!_("webkit"))||this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var e=!0;if(_("webkit")){var t=this.window.getSelection();t&&(t=t.toString());e=!!t}else e=this._browserQueryCommandEnabled("cut");return e},_copyEnabledImpl:function(){var e=!0;if(_("webkit")){var t=this.window.getSelection();t&&(t=t.toString());e=!!t}else e=this._browserQueryCommandEnabled("copy");return e},_pasteEnabledImpl:function(){return!!_("webkit")||this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(e){return _("ie")?this._inserthtmlImpl("<hr>"):this.document.execCommand("inserthorizontalrule",!1,e)},_unlinkImpl:function(e){if(this.queryCommandEnabled("unlink")&&(_("mozilla")||_("webkit"))){var t=this.selection.getAncestorElement("a");this.selection.selectElement(t);return this.document.execCommand("unlink",!1,null)}return this.document.execCommand("unlink",!1,e)},_hilitecolorImpl:function(e){var t;if(!this._handleTextColorOrProperties("hilitecolor",e))if(_("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);t=this.document.execCommand("hilitecolor",!1,e);this.document.execCommand("styleWithCSS",!1,!1)}else t=this.document.execCommand("hilitecolor",!1,e);return t},_backcolorImpl:function(e){_("ie")&&(e=e||null);var t=this._handleTextColorOrProperties("backcolor",e);t||(t=this.document.execCommand("backcolor",!1,e));return t},_forecolorImpl:function(e){_("ie")&&(e=e||null);var t=!1;(t=this._handleTextColorOrProperties("forecolor",e))||(t=this.document.execCommand("forecolor",!1,e));return t},_inserthtmlImpl:function(e){e=this._preFilterContent(e);var t=!0;if(_("ie")<9){var i=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var n=i.item(0);i.length;)i.remove(i.item(0));n.outerHTML=e}else i.pasteHTML(e);i.select()}else if(_("trident")<8){var o=T.getSelection(this.window);if(o&&o.rangeCount&&o.getRangeAt){(i=o.getRangeAt(0)).deleteContents();var a,s,l=r.create("div");l.innerHTML=e;for(n=this.document.createDocumentFragment();a=l.firstChild;)s=n.appendChild(a);i.insertNode(n);if(s){(i=i.cloneRange()).setStartAfter(s);i.collapse(!1);o.removeAllRanges();o.addRange(i)}}}else _("mozilla")&&!e.length?this.selection.remove():t=this.document.execCommand("inserthtml",!1,e);return t},_boldImpl:function(e){var t=!1;if(_("ie")||_("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("bold")}t||(t=this.document.execCommand("bold",!1,e));return t},_italicImpl:function(e){var t=!1;if(_("ie")||_("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("italic")}t||(t=this.document.execCommand("italic",!1,e));return t},_underlineImpl:function(e){var t=!1;if(_("ie")||_("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("underline")}t||(t=this.document.execCommand("underline",!1,e));return t},_strikethroughImpl:function(e){var t=!1;if(_("ie")||_("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("strikethrough")}t||(t=this.document.execCommand("strikethrough",!1,e));return t},_superscriptImpl:function(e){var t=!1;if(_("ie")||_("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("superscript")}t||(t=this.document.execCommand("superscript",!1,e));return t},_subscriptImpl:function(e){var t=!1;if(_("ie")||_("trident")){this._adaptIESelection();t=this._adaptIEFormatAreaAndExec("subscript")}t||(t=this.document.execCommand("subscript",!1,e));return t},_fontnameImpl:function(e){var t;(_("ie")||_("trident"))&&(t=this._handleTextColorOrProperties("fontname",e));t||(t=this.document.execCommand("fontname",!1,e));return t},_fontsizeImpl:function(e){var t;(_("ie")||_("trident"))&&(t=this._handleTextColorOrProperties("fontsize",e));t||(t=this.document.execCommand("fontsize",!1,e));return t},_insertorderedlistImpl:function(e){var t=!1;(_("ie")||_("trident")||_("edge"))&&(t=this._adaptIEList("insertorderedlist",e));t||(t=this.document.execCommand("insertorderedlist",!1,e));return t},_insertunorderedlistImpl:function(e){var t=!1;(_("ie")||_("trident")||_("edge"))&&(t=this._adaptIEList("insertunorderedlist",e));t||(t=this.document.execCommand("insertunorderedlist",!1,e));return t},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(e){var t=0;if(e&&e.childNodes){var i;for(i=0;i<e.childNodes.length;i++){t+=l.position(e.childNodes[i]).h}}return t},_isNodeEmpty:function(e,t){return 1===e.nodeType?!(e.childNodes.length>0)||this._isNodeEmpty(e.childNodes[0],t):3===e.nodeType&&""===e.nodeValue.substring(t)},_removeStartingRangeFromRange:function(e,t){if(e.nextSibling)t.setStart(e.nextSibling,0);else{for(var i=e.parentNode;i&&null==i.nextSibling;)i=i.parentNode;i&&t.setStart(i.nextSibling,0)}return t},_adaptIESelection:function(){var e=T.getSelection(this.window);if(e&&e.rangeCount&&!e.isCollapsed){for(var t=e.getRangeAt(0),i=t.startContainer,n=t.startOffset;3===i.nodeType&&n>=i.length&&i.nextSibling;){n-=i.length;i=i.nextSibling}for(var o=null;this._isNodeEmpty(i,n)&&i!==o;){o=i;i=(t=this._removeStartingRangeFromRange(i,t)).startContainer;n=0}e.removeAllRanges();e.addRange(t)}},_adaptIEFormatAreaAndExec:function(t){var i,n,o,a,s,l,d,c,h=T.getSelection(this.window),u=this.document;if(!(t&&h&&h.isCollapsed))return!1;if(this.queryCommandValue(t)){var p,m=this._tagNamesForCommand(t),g=(o=h.getRangeAt(0)).startContainer;if(3===g.nodeType){var _=o.endOffset;if(g.length<_){g=(n=this._adjustNodeAndOffset(i,_)).node;_=n.offset}}for(;g&&g!==this.editNode;){var f=g.tagName?g.tagName.toLowerCase():"";if(e.indexOf(m,f)>-1){p=g;break}g=g.parentNode}if(p){i=o.startContainer;var v=u.createElement(p.tagName);r.place(v,p,"after");if(i&&3===i.nodeType){var b,y,w=o.endOffset;if(i.length<w){i=(n=this._adjustNodeAndOffset(i,w)).node;w=n.offset}a=i.nodeValue;s=u.createTextNode(a.substring(0,w));(E=a.substring(w,a.length))&&(l=u.createTextNode(E));r.place(s,i,"before");if(l){(d=u.createElement("span")).className="ieFormatBreakerSpan";r.place(d,i,"after");r.place(l,d,"after");l=d}r.destroy(i);for(var C,k=s.parentNode,x=[];k!==p;){var A=k.tagName;C={tagName:A};x.push(C);var j=u.createElement(A);if(k.style&&j.style&&k.style.cssText){j.style.cssText=k.style.cssText;C.cssText=k.style.cssText}if("FONT"===k.tagName){if(k.color){j.color=k.color;C.color=k.color}if(k.face){j.face=k.face;C.face=k.face}if(k.size){j.size=k.size;C.size=k.size}}if(k.className){j.className=k.className;C.className=k.className}if(l){b=l;for(;b;){y=b.nextSibling;j.appendChild(b);b=y}}if(j.tagName==k.tagName){(d=u.createElement("span")).className="ieFormatBreakerSpan";r.place(d,k,"after");r.place(j,d,"after")}else r.place(j,k,"after");s=k;l=j;k=k.parentNode}if(l){(1===(b=l).nodeType||3===b.nodeType&&b.nodeValue)&&(v.innerHTML="");for(;b;){y=b.nextSibling;v.appendChild(b);b=y}}if(x.length){C=x.pop();var S=u.createElement(C.tagName);C.cssText&&S.style&&(S.style.cssText=C.cssText);C.className&&(S.className=C.className);if("FONT"===C.tagName){C.color&&(S.color=C.color);C.face&&(S.face=C.face);C.size&&(S.size=C.size)}r.place(S,v,"before");for(;x.length;){C=x.pop();var M=u.createElement(C.tagName);C.cssText&&M.style&&(M.style.cssText=C.cssText);C.className&&(M.className=C.className);if("FONT"===C.tagName){C.color&&(M.color=C.color);C.face&&(M.face=C.face);C.size&&(M.size=C.size)}S.appendChild(M);S=M}c=u.createTextNode(".");d.appendChild(c);S.appendChild(c);(N=T.create(this.window)).setStart(c,0);N.setEnd(c,c.length);h.removeAllRanges();h.addRange(N);this.selection.collapse(!1);c.parentNode.innerHTML=""}else{(d=u.createElement("span")).className="ieFormatBreakerSpan";c=u.createTextNode(".");d.appendChild(c);r.place(d,v,"before");(N=T.create(this.window)).setStart(c,0);N.setEnd(c,c.length);h.removeAllRanges();h.addRange(N);this.selection.collapse(!1);c.parentNode.innerHTML=""}v.firstChild||r.destroy(v);return!0}}return!1}if((i=(o=h.getRangeAt(0)).startContainer)&&3===i.nodeType){var E,N;_=o.startOffset;if(i.length<_){i=(n=this._adjustNodeAndOffset(i,_)).node;_=n.offset}a=i.nodeValue;s=u.createTextNode(a.substring(0,_));""!==(E=a.substring(_))&&(l=u.createTextNode(a.substring(_)));d=u.createElement("span");c=u.createTextNode(".");d.appendChild(c);s.length?r.place(s,i,"after"):s=i;r.place(d,s,"after");l&&r.place(l,d,"after");r.destroy(i);(N=T.create(this.window)).setStart(c,0);N.setEnd(c,c.length);h.removeAllRanges();h.addRange(N);u.execCommand(t);r.place(d.firstChild,d,"before");r.destroy(d);N.setStart(c,0);N.setEnd(c,c.length);h.removeAllRanges();h.addRange(N);this.selection.collapse(!1);c.parentNode.innerHTML="";return!0}},_adaptIEList:function(e){var t=T.getSelection(this.window);if(t.isCollapsed&&t.rangeCount&&!this.queryCommandValue(e)){var i=t.getRangeAt(0),n=i.startContainer;if(n&&3==n.nodeType&&!i.startOffset){var o="ul";"insertorderedlist"===e&&(o="ol");var a=this.document.createElement(o),s=r.create("li",null,a);r.place(a,n,"before");s.appendChild(n);r.create("br",null,a,"after");var l=T.create(this.window);l.setStart(n,0);l.setEnd(n,n.length);t.removeAllRanges();t.addRange(l);this.selection.collapse(!0);return!0}}return!1},_handleTextColorOrProperties:function(e,t){var i,n,o,a,s,l,c,h,u=T.getSelection(this.window),p=this.document;t=t||null;if(e&&u&&u.isCollapsed&&u.rangeCount&&(i=(o=u.getRangeAt(0)).startContainer)&&3===i.nodeType){var m=o.startOffset;if(i.length<m){i=(n=this._adjustNodeAndOffset(i,m)).node;m=n.offset}a=i.nodeValue;s=p.createTextNode(a.substring(0,m));""!==a.substring(m)&&(l=p.createTextNode(a.substring(m)));c=p.createElement("span");h=p.createTextNode(".");c.appendChild(h);var g=p.createElement("span");c.appendChild(g);s.length?r.place(s,i,"after"):s=i;r.place(c,s,"after");l&&r.place(l,c,"after");r.destroy(i);var f=T.create(this.window);f.setStart(h,0);f.setEnd(h,h.length);u.removeAllRanges();u.addRange(f);if(_("webkit")){var v="color";"hilitecolor"!==e&&"backcolor"!==e||(v="backgroundColor");d.set(c,v,t);this.selection.remove();r.destroy(g);c.innerHTML="&#160;";this.selection.selectElement(c);this.focus()}else{this.execCommand(e,t);r.place(c.firstChild,c,"before");r.destroy(c);f.setStart(h,0);f.setEnd(h,h.length);u.removeAllRanges();u.addRange(f);this.selection.collapse(!1);h.parentNode.removeChild(h)}return!0}return!1},_adjustNodeAndOffset:function(e,t){for(;e.length<t&&e.nextSibling&&3===e.nextSibling.nodeType;){t-=e.length;e=e.nextSibling}return{node:e,offset:t}},_tagNamesForCommand:function(e){return"bold"===e?["b","strong"]:"italic"===e?["i","em"]:"strikethrough"===e?["s","strike"]:"superscript"===e?["sup"]:"subscript"===e?["sub"]:"underline"===e?["u"]:[]},_stripBreakerNodes:function(e){if(this.isLoaded){m(".ieFormatBreakerSpan",e).forEach((function(e){for(;e.firstChild;)r.place(e.firstChild,e,"before");r.destroy(e)}));return e}},_stripTrailingEmptyNodes:function(e){function t(e){return/^(p|div|br)$/i.test(e.nodeName)&&0==e.children.length&&/^[\s\xA0]*$/.test(e.textContent||e.innerText||"")||3===e.nodeType&&/^[\s\xA0]*$/.test(e.nodeValue)}for(;e.lastChild&&t(e.lastChild);)r.destroy(e.lastChild);return e},_setTextDirAttr:function(e){this._set("textDir",e);this.onLoadDeferred.then(u.hitch(this,(function(){this.editNode.dir=e})))}});return M}))},"dijit/selection":function(){define(["dojo/_base/array","dojo/dom","dojo/_base/lang","dojo/sniff","dojo/_base/window","dijit/focus"],(function(e,t,i,n,o,a){var s=function(s){var r=s.document;this.getType=function(){if(r.getSelection){var e,t="text";try{e=s.getSelection()}catch(n){}if(e&&1==e.rangeCount){var i=e.getRangeAt(0);i.startContainer==i.endContainer&&i.endOffset-i.startOffset==1&&3!=i.startContainer.nodeType&&(t="control")}return t}return r.selection.type.toLowerCase()};this.getSelectedText=function(){if(r.getSelection){var e=s.getSelection();return e?e.toString():""}return"control"==this.getType()?null:r.selection.createRange().text};this.getSelectedHtml=function(){if(r.getSelection){var e=s.getSelection();if(e&&e.rangeCount){var t,i="";for(t=0;t<e.rangeCount;t++){var n=e.getRangeAt(t).cloneContents(),o=r.createElement("div");o.appendChild(n);i+=o.innerHTML}return i}return null}return"control"==this.getType()?null:r.selection.createRange().htmlText};this.getSelectedElement=function(){if("control"==this.getType()){if(r.getSelection){var e=s.getSelection();return e.anchorNode.childNodes[e.anchorOffset]}var t=r.selection.createRange();if(t&&t.item)return r.selection.createRange().item(0)}return null};this.getParentElement=function(){if("control"==this.getType()){var e=this.getSelectedElement();if(e)return e.parentNode}else{if(!r.getSelection){var t=r.selection.createRange();t.collapse(!0);return t.parentElement()}var i=r.getSelection();if(i){for(var n=i.anchorNode;n&&1!=n.nodeType;)n=n.parentNode;return n}}return null};this.hasAncestorElement=function(e){return null!=this.getAncestorElement.apply(this,arguments)};this.getAncestorElement=function(e){var t=this.getSelectedElement()||this.getParentElement();return this.getParentOfType(t,arguments)};this.isTag=function(e,t){if(e&&e.tagName)for(var i=e.tagName.toLowerCase(),n=0;n<t.length;n++){var o=String(t[n]).toLowerCase();if(i==o)return o}return""};this.getParentOfType=function(e,t){for(;e;){if(this.isTag(e,t).length)return e;e=e.parentNode}return null};this.collapse=function(e){if(r.getSelection){var t=s.getSelection();t.removeAllRanges?e?t.collapseToStart():t.collapseToEnd():t.collapse(e)}else{var i=r.selection.createRange();i.collapse(e);i.select()}};this.remove=function(){var e=r.selection;if(r.getSelection){(e=s.getSelection()).deleteFromDocument();return e}"none"!=e.type.toLowerCase()&&e.clear();return e};this.selectElementChildren=function(e,i){var o;e=t.byId(e);if(r.getSelection){var a=s.getSelection();if(n("opera")){(o=a.rangeCount?a.getRangeAt(0):r.createRange()).setStart(e,0);o.setEnd(e,3==e.nodeType?e.length:e.childNodes.length);a.addRange(o)}else a.selectAllChildren(e)}else{(o=e.ownerDocument.body.createTextRange()).moveToElementText(e);if(!i)try{o.select()}catch(l){}}};this.selectElement=function(e,i){var a;e=t.byId(e);if(r.getSelection){var s=r.getSelection();a=r.createRange();if(s.removeAllRanges){n("opera")&&s.getRangeAt(0)&&(a=s.getRangeAt(0));a.selectNode(e);s.removeAllRanges();s.addRange(a)}}else try{var l=e.tagName?e.tagName.toLowerCase():"";(a="img"===l||"table"===l?o.body(r).createControlRange():o.body(r).createRange()).addElement(e);i||a.select()}catch(d){this.selectElementChildren(e,i)}};this.inSelection=function(e){if(e){var t,i;if(r.getSelection){var n=s.getSelection();n&&n.rangeCount>0&&(i=n.getRangeAt(0));if(i&&i.compareBoundaryPoints&&r.createRange)try{(t=r.createRange()).setStart(e,0);if(1===i.compareBoundaryPoints(i.START_TO_END,t))return!0}catch(o){}}else{i=r.selection.createRange();try{(t=e.ownerDocument.body.createTextRange()).moveToElementText(e)}catch(a){}if(i&&t&&1===i.compareEndPoints("EndToStart",t))return!0}}return!1};this.getBookmark=function(){var e,t,i,n=r.selection,o=a.curNode;if(r.getSelection){if(n=s.getSelection())if(n.isCollapsed){if((i=o?o.tagName:"")&&("textarea"==(i=i.toLowerCase())||"input"==i&&(!o.type||"text"==o.type.toLowerCase())))return{isCollapsed:(n={start:o.selectionStart,end:o.selectionEnd,node:o,pRange:!0}).end<=n.start,mark:n};e={isCollapsed:!0};n.rangeCount&&(e.mark=n.getRangeAt(0).cloneRange())}else e={isCollapsed:!1,mark:(t=n.getRangeAt(0)).cloneRange()}}else if(n){i=(i=o?o.tagName:"").toLowerCase();if(o&&i&&("button"==i||"textarea"==i||"input"==i))return n.type&&"none"==n.type.toLowerCase()?{isCollapsed:!0,mark:null}:{isCollapsed:!(t=n.createRange()).text||!t.text.length,mark:{range:t,pRange:!0}};e={};try{t=n.createRange();e.isCollapsed=!("Text"==n.type?t.htmlText.length:t.length)}catch(c){e.isCollapsed=!0;return e}if("CONTROL"==n.type.toUpperCase())if(t.length){e.mark=[];for(var l=0,d=t.length;l<d;)e.mark.push(t.item(l++))}else{e.isCollapsed=!0;e.mark=null}else e.mark=t.getBookmark()}return e};this.moveToBookmark=function(t){var n=t.mark;if(n)if(r.getSelection){var o=s.getSelection();if(o&&o.removeAllRanges)if(n.pRange){var a=n.node;a.selectionStart=n.start;a.selectionEnd=n.end}else{o.removeAllRanges();o.addRange(n)}}else if(r.selection&&n){var l;if(n.pRange)l=n.range;else if(i.isArray(n)){l=r.body.createControlRange();e.forEach(n,(function(e){l.addElement(e)}))}else(l=r.body.createTextRange()).moveToBookmark(n);l.select()}};this.isCollapsed=function(){return this.getBookmark().isCollapsed}},r=new s(window);r.SelectionManager=s;return r}))},"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],(function(e,t,i){var n={getIndex:function(e,t){for(var i,n,o=[],a=[],s=e;e!=t;){var r=0;i=e.parentNode;for(;n=i.childNodes[r++];)if(n===e){--r;break}o.unshift(r);a.unshift(r-i.childNodes.length);e=i}if(o.length>0&&3==s.nodeType){n=s.previousSibling;for(;n&&3==n.nodeType;){o[o.length-1]--;n=n.previousSibling}n=s.nextSibling;for(;n&&3==n.nodeType;){a[a.length-1]++;n=n.nextSibling}}return{o:o,r:a}},getNode:function(t,n){if(!i.isArray(t)||0==t.length)return n;var o=n;e.every(t,(function(e){if(!(e>=0&&e<o.childNodes.length)){o=null;return!1}o=o.childNodes[e];return!0}));return o},getCommonAncestor:function(e,t,i){i=i||e.ownerDocument.body;for(var n=function(e){for(var t=[];e;){t.unshift(e);if(e===i)break;e=e.parentNode}return t},o=n(e),a=n(t),s=Math.min(o.length,a.length),r=o[0],l=1;l<s&&o[l]===a[l];l++)r=o[l];return r},getAncestor:function(e,t,i){i=i||e.ownerDocument.body;for(;e&&e!==i;){var n=e.nodeName.toUpperCase();if(t.test(n))return e;e=e.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(e,t,i){i=i||e.ownerDocument.body;t=t||n.BlockTagNames;for(var o,a=null;e&&e!==i;){var s=e.nodeName.toUpperCase();!a&&t.test(s)&&(a=e);!o&&/^(?:BODY|TD|TH|CAPTION)$/.test(s)&&(o=e);e=e.parentNode}return{blockNode:a,blockContainer:o||e.ownerDocument.body}},atBeginningOfContainer:function(e,t,i){var n=!1,o=0==i;o||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(0,i))&&(o=!0);if(o){var a=t;n=!0;for(;a&&a!==e;){if(a.previousSibling){n=!1;break}a=a.parentNode}}return n},atEndOfContainer:function(e,t,i){var n=!1,o=i==(t.length||t.childNodes.length);o||3!=t.nodeType||/^[\s\xA0]+$/.test(t.nodeValue.substr(i))&&(o=!0);if(o){var a=t;n=!0;for(;a&&a!==e;){if(a.nextSibling){n=!1;break}a=a.parentNode}}return n},adjacentNoneTextNode:function(e,t){for(var i=e,n=0-e.length||0,o=t?"nextSibling":"previousSibling";i&&3==i.nodeType;){n+=i.length;i=i[o]}return[i,n]},create:function(e){return(e=e||window).getSelection?e.document.createRange():new a},getSelection:function(e,t){if(e.getSelection)return e.getSelection();var i=new o.selection(e);t||i._getCurrentSelection();return i}};if(!window.getSelection)var o=n.ie={cachedSelection:{},selection:function(e){this._ranges=[];this.addRange=function(e,t){this._ranges.push(e);t||e._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(e){return this._ranges[e]};this._getCurrentSelection=function(){this.removeAllRanges();var t=function(){var t=e.document.selection.createRange(),i=e.document.selection.type.toUpperCase();return new a("CONTROL"==i?o.decomposeControlRange(t):o.decomposeTextRange(t))}();if(t){this.addRange(t,!0);this.isCollapsed=t.collapsed}else this.isCollapsed=!0}},decomposeControlRange:function(e){var t=e.item(0),i=e.item(e.length-1),o=t.parentNode,a=i.parentNode;return[o,n.getIndex(t,o).o[0],a,n.getIndex(i,a).o[0]+1]},getEndPoint:function(t,i){var o=t.duplicate();o.collapse(!i);var a,s,r,l="EndTo"+(i?"End":"Start"),d=o.parentElement();if(d.childNodes.length>0)e.every(d.childNodes,(function(e,i){var c;if(3!=e.nodeType){o.moveToElementText(e);if(o.compareEndPoints(l,t)>0){if(!r||3!=r.nodeType){a=d;s=i;return!1}a=r;c=!0}else if(i==d.childNodes.length-1){a=d;s=d.childNodes.length;return!1}}else if(i==d.childNodes.length-1){a=e;c=!0}if(c&&a){var h=n.adjacentNoneTextNode(a)[0];a=h?h.nextSibling:d.firstChild;var u=n.adjacentNoneTextNode(a);h=u[0];var p=u[1];if(h){o.moveToElementText(h);o.collapse(!1)}else o.moveToElementText(d);o.setEndPoint(l,t);s=o.text.length-p;return!1}r=e;return!0}));else{a=d;s=0}if(!i&&1==a.nodeType&&s==a.childNodes.length){var c=a.nextSibling;if(c&&3==c.nodeType){a=c;s=0}}return[a,s]},setEndPoint:function(e,t,i){var o,a,s=e.duplicate();if(3!=t.nodeType)if(i>0){if(o=t.childNodes[i-1])if(3==o.nodeType){t=o;i=o.length}else if(o.nextSibling&&3==o.nextSibling.nodeType){t=o.nextSibling;i=0}else{s.moveToElementText(o.nextSibling?o:t);var r=o.parentNode,l=r.insertBefore(o.ownerDocument.createTextNode(" "),o.nextSibling);s.collapse(!1);r.removeChild(l)}}else{s.moveToElementText(t);s.collapse(!0)}if(3==t.nodeType){var d=n.adjacentNoneTextNode(t),c=d[0];a=d[1];if(c){s.moveToElementText(c);s.collapse(!1);"inherit"!=c.contentEditable&&a++}else{s.moveToElementText(t.parentNode);s.collapse(!0);s.move("character",1);s.move("character",-1)}(i+=a)>0&&s.move("character",i)}return s},decomposeTextRange:function(e){var t=o.getEndPoint(e),i=t[0],n=t[1],a=t[0],s=t[1];e.htmlText.length&&(e.htmlText==e.text?s=n+e.text.length:(a=(t=o.getEndPoint(e,!0))[0],s=t[1]));return[i,n,a,s]},setRange:function(e,t,i,n,a,s){var r=o.setEndPoint(e,t,i);e.setEndPoint("StartToStart",r);if(!s)var l=o.setEndPoint(e,n,a);e.setEndPoint("EndToEnd",l||r);return e}},a=n.W3CRange=t(null,{constructor:function(){if(arguments.length>0){this.setStart(arguments[0][0],arguments[0][1]);this.setEnd(arguments[0][2],arguments[0][3])}else{this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}},_updateInternal:function(){this.startContainer!==this.endContainer?this.commonAncestorContainer=n.getCommonAncestor(this.startContainer,this.endContainer):this.commonAncestorContainer=this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t){t=parseInt(t);if(this.startContainer!==e||this.startOffset!=t){delete this._cachedBookmark;this.startContainer=e;this.startOffset=t;this.endContainer?this._updateInternal():this.setEnd(e,t)}},setEnd:function(e,t){t=parseInt(t);if(this.endContainer!==e||this.endOffset!=t){delete this._cachedBookmark;this.endContainer=e;this.endOffset=t;this.startContainer?this._updateInternal():this.setStart(e,t)}},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,i,o){var a=n.getIndex(t,t.parentNode).o;this[e](t.parentNode,a.pop()+o)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();o.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return e},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var e=this.startContainer,t=this._getIERange();3!==e.nodeType||this.startOffset||this.setStartBefore(e);t.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var e=new a([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);e._body=this._body;return e},detach:function(){this._body=null;this.commonAncestorContainer=null;this.startContainer=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});i.setObject("dijit.range",n);return n}))},"dijit/_editor/html":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/sniff"],(function(e,t,i){var n={};t.setObject("dijit._editor.html",n);var o=n.escapeXml=function(e,t){e=e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");t||(e=e.replace(/'/gm,"&#39;"));return e};n.getNodeHtml=function(e){var t=[];n.getNodeHtmlHelper(e,t);return t.join("")};n.getNodeHtmlHelper=function(t,a){switch(t.nodeType){case 1:var s=t.nodeName.toLowerCase();if(!s||"/"==s.charAt(0))return"";a.push("<",s);var r,l=[],d={};if(i("dom-attributes-explicit")||i("dom-attributes-specified-flag"))for(var c=0;r=t.attributes[c++];){var h=r.name;if("_dj"!==h.substr(0,3)&&(!i("dom-attributes-specified-flag")||r.specified)&&!(h in d)){var u=r.value;"src"!=h&&"href"!=h||t.getAttribute("_djrealurl")&&(u=t.getAttribute("_djrealurl"));8===i("ie")&&"style"===h&&(u=u.replace("HEIGHT:","height:").replace("WIDTH:","width:"));l.push([h,u]);d[h]=u}}else{var p=(/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1)).outerHTML,m=p.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);p=p.substr(0,p.indexOf(">"));e.forEach(m,(function(e){if(e){var i=e.indexOf("=");if(i>0){var n=e.substring(0,i);if("_dj"!=n.substr(0,3)){if(("src"==n||"href"==n)&&t.getAttribute("_djrealurl")){l.push([n,t.getAttribute("_djrealurl")]);return}var o,a;switch(n){case"style":o=t.style.cssText.toLowerCase();break;case"class":o=t.className;break;case"width":if("img"===s){(a=/width=(\S+)/i.exec(p))&&(o=a[1]);break}case"height":if("img"===s){(a=/height=(\S+)/i.exec(p))&&(o=a[1]);break}default:o=t.getAttribute(n)}null!=o&&l.push([n,o.toString()])}}}}),this)}l.sort((function(e,t){return e[0]<t[0]?-1:e[0]==t[0]?0:1}));for(var g=0;r=l[g++];)a.push(" ",r[0],'="',"string"==typeof r[1]?o(r[1],!0):r[1],'"');switch(s){case"br":case"hr":case"img":case"input":case"base":case"meta":case"area":case"basefont":a.push(" />");break;case"script":a.push(">",t.innerHTML,"</",s,">");break;default:a.push(">");t.hasChildNodes()&&n.getChildrenHtmlHelper(t,a);a.push("</",s,">")}break;case 4:case 3:a.push(o(t.nodeValue,!0));break;case 8:a.push("\x3c!--",o(t.nodeValue,!0),"--\x3e");break;default:a.push("\x3c!-- Element not recognized - Type: ",t.nodeType," Name: ",t.nodeName,"--\x3e")}};n.getChildrenHtml=function(e){var t=[];n.getChildrenHtmlHelper(e,t);return t.join("")};n.getChildrenHtmlHelper=function(e,t){if(e)for(var o,a=e.childNodes||e,s=!i("ie")||a!==e,r=0;o=a[r++];)s&&o.parentNode!=e||n.getNodeHtmlHelper(o,t)};return n}))},"dijit/_editor/plugins/FontChoice":function(){define(["require","dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/i18n","dojo/_base/lang","dojo/string","dojo/store/Memory","../../registry","../../_Widget","../../_TemplatedMixin","../../_WidgetsInTemplateMixin","../../form/FilteringSelect","../_Plugin","../range","dojo/i18n!../nls/FontChoice"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m){var g=i("dijit._editor.plugins._FontDropDown",[d,c,h],{label:"",plainText:!1,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'><label class='dijitLeft dijitInline' for='${selectId}'>${label}</label><input data-dojo-type='../../form/FilteringSelect' required='false' data-dojo-props='labelType:\"html\", labelAttr:\"label\", searchAttr:\"name\"' class='${comboClass}' tabIndex='-1' id='${selectId}' data-dojo-attach-point='select' value=''/></span>",contextRequire:e,postMixInProperties:function(){this.inherited(arguments);this.strings=o.getLocalization("dijit._editor","FontChoice");this.label=this.strings[this.command];this.id=l.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.selectId=this.id+"_select";this.inherited(arguments)},postCreate:function(){this.select.set("store",new r({idProperty:"value",data:t.map(this.values,(function(e){var t=this.strings[e]||e;return{label:this.getLabel(e,t),name:t,value:e}}),this)}));this.select.set("value","",!1);this.disabled=this.select.get("disabled")},_setValueAttr:function(e,i){i=!1!==i;this.select.set("value",t.indexOf(this.values,e)<0?"":e,i);i||(this.select._lastValueReported=null)},_getValueAttr:function(){return this.select.get("value")},focus:function(){this.select.focus()},_setDisabledAttr:function(e){this._set("disabled",e);this.select.set("disabled",e)}}),_=i("dijit._editor.plugins._FontNameDropDown",g,{generic:!1,command:"fontName",comboClass:"dijitFontNameCombo",postMixInProperties:function(){this.values||(this.values=this.generic?["serif","sans-serif","monospace","cursive","fantasy"]:["Arial","Times New Roman","Comic Sans MS","Courier New"]);this.inherited(arguments)},getLabel:function(e,t){return this.plainText?t:"<div style='font-family: "+e+"'>"+t+"</div>"},_normalizeFontName:function(e){var i=this.values;if(!e||!i)return e;var n=e.split(",");if(n.length>1)for(var o=0,a=n.length;o<a;o++){var r=s.trim(n[o]);if(t.indexOf(i,r)>-1)return r}return e},_setValueAttr:function(e,t){t=!1!==t;e=this._normalizeFontName(e);if(this.generic){var i={Arial:"sans-serif",Helvetica:"sans-serif",Myriad:"sans-serif",Times:"serif","Times New Roman":"serif","Comic Sans MS":"cursive","Apple Chancery":"cursive",Courier:"monospace","Courier New":"monospace",Papyrus:"fantasy","Estrangelo Edessa":"cursive",Gabriola:"fantasy"};e=i[e]||e}this.inherited(arguments,[e,t])}}),f=i("dijit._editor.plugins._FontSizeDropDown",g,{command:"fontSize",comboClass:"dijitFontSizeCombo",values:[1,2,3,4,5,6,7],getLabel:function(e,t){return this.plainText?t:"<font size="+e+"'>"+t+"</font>"},_setValueAttr:function(e,t){t=!1!==t;if(e.indexOf&&-1!=e.indexOf("px")){var i=parseInt(e,10);e={10:1,13:2,16:3,18:4,24:5,32:6,48:7}[i]||e}this.inherited(arguments,[e,t])}}),v=i("dijit._editor.plugins._FormatBlockDropDown",g,{command:"formatBlock",comboClass:"dijitFormatBlockCombo",values:["noFormat","p","h1","h2","h3","pre"],postCreate:function(){this.inherited(arguments);this.set("value","noFormat",!1)},getLabel:function(e,t){return this.plainText||"noFormat"==e?t:"<"+e+">"+t+"</"+e+">"},_execCommand:function(e,i,n){if("noFormat"===n){var o,s,r=m.getSelection(e.window);if(r&&r.rangeCount>0){var l,d,c=r.getRangeAt(0);if(c){o=c.startContainer;s=c.endContainer;for(;o&&o!==e.editNode&&o!==e.document.body&&1!==o.nodeType;)o=o.parentNode;for(;s&&s!==e.editNode&&s!==e.document.body&&1!==s.nodeType;)s=s.parentNode;var h=a.hitch(this,(function(i,n){if(i.childNodes&&i.childNodes.length){var o;for(o=0;o<i.childNodes.length;o++){var a=i.childNodes[o];if(1==a.nodeType&&e.selection.inSelection(a)){var s=a.tagName?a.tagName.toLowerCase():"";-1!==t.indexOf(this.values,s)&&n.push(a);h(a,n)}}}})),u=a.hitch(this,(function(t){if(t&&t.length){e.beginEditing();for(;t.length;)this._removeFormat(e,t.pop());e.endEditing()}})),p=[];if(o==s){var g;l=o;for(;l&&l!==e.editNode&&l!==e.document.body;){if(1==l.nodeType){d=l.tagName?l.tagName.toLowerCase():"";if(-1!==t.indexOf(this.values,d)){g=l;break}}l=l.parentNode}h(o,p);g&&(p=[g].concat(p));u(p)}else{l=o;for(;e.selection.inSelection(l);){if(1==l.nodeType){d=l.tagName?l.tagName.toLowerCase():"";-1!==t.indexOf(this.values,d)&&p.push(l);h(l,p)}l=l.nextSibling}u(p)}e.onDisplayChanged()}}}else e.execCommand(i,n)},_removeFormat:function(e,t){if(e.customUndo){for(;t.firstChild;)n.place(t.firstChild,t,"before");t.parentNode.removeChild(t)}else{e.selection.selectElementChildren(t);var i=e.selection.getSelectedHtml();e.selection.selectElement(t);e.execCommand("inserthtml",i||"")}}}),b=i("dijit._editor.plugins.FontChoice",p,{useDefaultCommand:!1,_initButton:function(){var e={fontName:_,fontSize:f,formatBlock:v}[this.command],t=this.params;this.params.custom&&(t.values=this.params.custom);var i=this.editor;this.button=new e(a.delegate({dir:i.dir,lang:i.lang},t));this.own(this.button.select.on("change",a.hitch(this,(function(e){this.editor.focused&&this.editor.focus();"fontName"==this.command&&-1!=e.indexOf(" ")&&(e="'"+e+"'");this.button._execCommand?this.button._execCommand(this.editor,this.command,e):this.editor.execCommand(this.command,e)}))))},updateState:function(){var e=this.editor,i=this.command;if(e&&e.isLoaded&&i.length&&this.button){var n,o=this.get("disabled");this.button.set("disabled",o);if(o)return;try{n=e.queryCommandValue(i)||""}catch(h){n=""}var s=a.isString(n)&&(n.match(/'([^']*)'/)||n.match(/"([^"]*)"/));s&&(n=s[1]);"fontSize"!==i||n||(n=3);if("formatBlock"===i)if(n&&"p"!=n)t.indexOf(this.button.values,n)<0&&(n="noFormat");else{n=null;var r,l=m.getSelection(this.editor.window);if(l&&l.rangeCount>0){var d=l.getRangeAt(0);d&&(r=d.endContainer)}for(;r&&r!==e.editNode&&r!==e.document;){var c=r.tagName?r.tagName.toLowerCase():"";if(c&&t.indexOf(this.button.values,c)>-1){n=c;break}r=r.parentNode}n||(n="noFormat")}n!==this.button.get("value")&&this.button.set("value",n,!1)}}});t.forEach(["fontName","fontSize","formatBlock"],(function(e){p.registry[e]=function(t){return new b({command:e,plainText:t.plainText})}}));b._FontDropDown=g;b._FontNameDropDown=_;b._FontSizeDropDown=f;b._FormatBlockDropDown=v;return b}))},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],(function(e,t,i,n,o){return i("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var e=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);o.parse(e,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(n.hitch(this,(function(e){this._startupWidgets=e;for(var t=0;t<e.length;t++)this._processTemplateNode(e[t],(function(e,t){return e[t]}),(function(e,t,i){return t in e?e.connect(e,t,i):e.on(t,i,!0)}));this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser})));if(!this._startupWidgets)throw new Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.")}},_processTemplateNode:function(e,t,i){return!(!t(e,"dojoType")&&!t(e,"data-dojo-type"))||this.inherited(arguments)},startup:function(){e.forEach(this._startupWidgets,(function(e){e&&!e._started&&e.startup&&e.startup()}));this._startupWidgets=null;this.inherited(arguments)}})}))},"dijit/_editor/plugins/TextColor":function(){define(["require","dojo/colors","dojo/_base/declare","dojo/_base/lang","../_Plugin","../../form/DropDownButton"],(function(e,t,i,n,o,a){var s=i("dijit._editor.plugins.TextColor",o,{buttonClass:a,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;this.inherited(arguments);var t=this;this.button.loadDropDown=function(i){function n(e){t.button.dropDown=new e({dir:t.editor.dir,ownerDocument:t.editor.ownerDocument,value:t.value,onChange:function(e){t.editor.execCommand(t.command,e)},onExecute:function(){t.editor.execCommand(t.command,this.get("value"))}});i()}"string"==typeof t.colorPicker?e([t.colorPicker],n):n(t.colorPicker)}},updateState:function(){var e=this.editor,i=this.command;if(e&&e.isLoaded&&i.length){if(this.button){var n,o=this.get("disabled");this.button.set("disabled",o);if(o)return;try{n=e.queryCommandValue(i)||""}catch(s){n=""}}""==n&&(n="#000000");"transparent"==n&&(n="#ffffff");if("string"==typeof n)n.indexOf("rgb")>-1&&(n=t.fromRgb(n).toHex());else{n=(n=(255&n)<<16|65280&n|(16711680&n)>>>16).toString(16);n="#000000".slice(0,7-n.length)+n}this.value=n;var a=this.button.dropDown;a&&a.get&&n!==a.get("value")&&a.set("value",n,!1)}}});o.registry.foreColor=function(e){return new s(e)};o.registry.hiliteColor=function(e){return new s(e)};return s}))},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],(function(e,t,i,n){var o={};t.setObject("dojo.colors",o);var a=function(e,t,i){i<0&&++i;i>1&&--i;var n=6*i;return n<1?e+(t-e)*n:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e};e.colorFromRgb=i.fromRgb=function(e,t){var o=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(o){var s,r=o[2].split(/\s*,\s*/),l=r.length,d=o[1];if("rgb"==d&&3==l||"rgba"==d&&4==l){var c=r[0];if("%"==c.charAt(c.length-1)){s=n.map(r,(function(e){return 2.56*parseFloat(e)}));4==l&&(s[3]=r[3]);return i.fromArray(s,t)}return i.fromArray(r,t)}if("hsl"==d&&3==l||"hsla"==d&&4==l){var h=(parseFloat(r[0])%360+360)%360/360,u=parseFloat(r[1])/100,p=parseFloat(r[2])/100,m=p<=.5?p*(u+1):p+u-p*u,g=2*p-m;s=[256*a(g,m,h+1/3),256*a(g,m,h),256*a(g,m,h-1/3),1];4==l&&(s[3]=r[3]);return i.fromArray(s,t)}}return null};var s=function(e,t,i){e=Number(e);return isNaN(e)?i:e<t?t:e>i?i:e};i.prototype.sanitize=function(){var e=this;e.r=Math.round(s(e.r,0,255));e.g=Math.round(s(e.g,0,255));e.b=Math.round(s(e.b,0,255));e.a=s(e.a,0,1);return this};o.makeGrey=i.makeGrey=function(e,t){return i.fromArray([e,e,e,t])};t.mixin(i.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return i}))},"dijit/form/DropDownButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/query","../registry","../popup","./Button","../_Container","../_HasDropDown","dojo/text!./templates/DropDownButton.html","../a11yclick"],(function(e,t,i,n,o,a,s,r,l,d){return e("dijit.form.DropDownButton",[s,r,l],{baseClass:"dijitDropDownButton",templateString:d,_fillContent:function(){var e=this.srcNodeRef,i=this.containerNode;if(e&&i)for(;e.hasChildNodes();){var n=e.firstChild;if(n.hasAttribute&&(n.hasAttribute("data-dojo-type")||n.hasAttribute("dojoType")||n.hasAttribute("data-"+t._scopeName+"-type")||n.hasAttribute(t._scopeName+"Type"))){this.dropDownContainer=this.ownerDocument.createElement("div");this.dropDownContainer.appendChild(n)}else i.appendChild(n)}},startup:function(){if(!this._started){if(!this.dropDown&&this.dropDownContainer){this.dropDown=o.byNode(this.dropDownContainer.firstChild);delete this.dropDownContainer}this.dropDown&&a.hide(this.dropDown);this.inherited(arguments)}},isLoaded:function(){var e=this.dropDown;return!!e&&(!e.href||e.isLoaded)},loadDropDown:function(e){var t=this.dropDown,n=t.on("load",i.hitch(this,(function(){n.remove();e()})));t.refresh()},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}})}))},"dijit/_editor/plugins/LinkDialog":function(){define(["require","dojo/_base/declare","dojo/dom-attr","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/query","dojo/string","../_Plugin","../../form/DropDownButton","../range"],(function(e,t,i,n,o,a,s,r,l,d,c,h){var u=t("dijit._editor.plugins.LinkDialog",d,{buttonClass:c,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",emailRegExp:"<?(mailto\\:)([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*>?",htmlTemplate:'<a href="${urlInput}" _djrealurl="${urlInput}" target="${targetSelect}">${textInput}</a>',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,linkDialogTemplate:["<table role='presentation'><tr><td>","<label for='${id}_urlInput'>${url}</label>","</td><td>","<input data-dojo-type='dijit.form.ValidationTextBox' required='true' id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input data-dojo-type='dijit.form.ValidationTextBox' required='true' id='${id}_textInput' name='textInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","<label for='${id}_targetSelect'>${target}</label>","</td><td>","<select id='${id}_targetSelect' name='targetSelect' data-dojo-type='dijit.form.Select'>","<option selected='selected' value='_self'>${currentWindow}</option>","<option value='_blank'>${newWindow}</option>","<option value='_top'>${topWindow}</option>","<option value='_parent'>${parentWindow}</option>","</select>","</td></tr><tr><td colspan='2'>","<button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>","</td></tr></table>"].join(""),_initButton:function(){this.inherited(arguments);this.button.loadDropDown=o.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(t){e(["dojo/i18n","../../TooltipDialog","../../registry","../../form/Button","../../form/Select","../../form/ValidationTextBox","dojo/i18n!../../nls/common","dojo/i18n!../nls/LinkDialog"],o.hitch(this,(function(e,i,s){var r=this;this.tag="insertImage"==this.command?"img":"a";var d=o.delegate(e.getLocalization("dijit","common",this.lang),e.getLocalization("dijit._editor","LinkDialog",this.lang)),c=this.dropDown=this.button.dropDown=new i({title:d[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:o.hitch(this,"setValue"),onOpen:function(){r._onOpenDialog();i.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(o.hitch(r,"_onCloseDialog"),0)}});d.urlRegExp=this.urlRegExp;d.id=s.getUniqueId(this.editor.id);this._uniqueId=d.id;this._setContent(c.title+"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>"+l.substitute(this.linkDialogTemplate,d));c.startup();this._urlInput=s.byId(this._uniqueId+"_urlInput");this._textInput=s.byId(this._uniqueId+"_textInput");this._setButton=s.byId(this._uniqueId+"_setButton");this.own(s.byId(this._uniqueId+"_cancelButton").on("click",o.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",o.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",o.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=o.hitch(this,(function(){var e=this._urlInput.get("value");return this._urlRegExp.test(e)||this._emailRegExp.test(e)}));this.own(a(c.domNode,"keydown",o.hitch(this,o.hitch(this,(function(e){if(e&&e.keyCode==n.ENTER&&!e.shiftKey&&!e.metaKey&&!e.ctrlKey&&!e.altKey&&!this._setButton.get("disabled")){c.onExecute();c.execute(c.get("value"))}})))));t()})))},_checkAndFixInput:function(){var e=this,t=this._urlInput.get("value");if(this._delayedCheck){clearTimeout(this._delayedCheck);this._delayedCheck=null}this._delayedCheck=setTimeout((function(){!function(t){var i=!1,n=!1;t&&t.length>1&&0!==(t=o.trim(t)).indexOf("mailto:")&&(t.indexOf("/")>0?-1===t.indexOf("://")&&"/"!==t.charAt(0)&&t.indexOf("./")&&0!==t.indexOf("../")&&e._hostRxp.test(t)&&(i=!0):e._userAtRxp.test(t)&&(n=!0));i&&e._urlInput.set("value","http://"+t);n&&e._urlInput.set("value","mailto:"+t);e._setButton.set("disabled",!e._isValid())}(t)}),250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(o.hitch(this,(function(){this.own(a(this.editor.editNode,"mouseup",o.hitch(this,"_onMouseUp")));this.own(a(this.editor.editNode,"dblclick",o.hitch(this,"_onDblClick")))})))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(e){this.dropDown.set({parserScope:"dojo",content:e})},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"&quot;"));return e},_createlinkEnabledImpl:function(){return!0},setValue:function(e){this._onCloseDialog();if(s("ie")<9){var t=h.getSelection(this.editor.window).getRangeAt(0).endContainer;3===t.nodeType&&(t=t.parentNode);t&&t.nodeName&&t.nodeName.toLowerCase()!==this.tag&&(t=this.editor.selection.getSelectedElement(this.tag));if(t&&t.nodeName&&t.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")){this.editor.selection.selectElementChildren(t);this.editor.execCommand("unlink")}}e=this._checkValues(e);this.editor.execCommand("inserthtml",l.substitute(this.htmlTemplate,e));r("a",this.editor.document).forEach((function(e){e.innerHTML||i.has(e,"name")||e.parentNode.removeChild(e)}),this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(e){var t,i,n;if(e&&e.tagName.toLowerCase()===this.tag){t=e.getAttribute("_djrealurl")||e.getAttribute("href");n=e.getAttribute("target")||"_self";i=e.textContent||e.innerText;this.editor.selection.selectElement(e,!0)}else i=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:i||"",targetSelect:n||""}},_onOpenDialog:function(){var e,t,i;if(s("ie")){var n=h.getSelection(this.editor.window);if(n.rangeCount){var o=n.getRangeAt(0);3===(e=o.endContainer).nodeType&&(e=e.parentNode);e&&e.nodeName&&e.nodeName.toLowerCase()!==this.tag&&(e=this.editor.selection.getSelectedElement(this.tag));if(!e||e.nodeName&&e.nodeName.toLowerCase()!==this.tag)if((t=this.editor.selection.getAncestorElement(this.tag))&&t.nodeName&&t.nodeName.toLowerCase()==this.tag){e=t;this.editor.selection.selectElement(e)}else if(o.startContainer===o.endContainer&&(i=o.startContainer.firstChild)&&i.nodeName&&i.nodeName.toLowerCase()==this.tag){e=i;this.editor.selection.selectElement(e)}}}else e=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(e))},_onDblClick:function(e){if(e&&e.target){var t=e.target;if((t.tagName?t.tagName.toLowerCase():"")===this.tag&&i.get(t,"href")){var n=this.editor;this.editor.selection.selectElement(t);n.onDisplayChanged();if(n._updateTimer){n._updateTimer.remove();delete n._updateTimer}n.onNormalizedDisplayChanged();var o=this.button;setTimeout((function(){o.set("disabled",!1);o.loadAndOpenDropDown().then((function(){o.dropDown.focus&&o.dropDown.focus()}))}),10)}}},_onMouseUp:function(){if(s("ff")){var e=this.editor.selection.getAncestorElement(this.tag);if(e){var t=h.getSelection(this.editor.window).getRangeAt(0);if(t.collapsed&&e.childNodes.length){var i=t.cloneRange();i.selectNodeContents(e.childNodes[e.childNodes.length-1]);i.setStart(e.childNodes[0],0);1!==t.compareBoundaryPoints(i.START_TO_START,i)?t.setStartBefore(e):-1!==t.compareBoundaryPoints(i.END_TO_START,i)&&t.setStartAfter(e)}}}}}),p=t("dijit._editor.plugins.ImgLinkDialog",[u],{linkDialogTemplate:["<table role='presentation'><tr><td>","<label for='${id}_urlInput'>${url}</label>","</td><td>","<input dojoType='dijit.form.ValidationTextBox' regExp='${urlRegExp}' required='true' id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","<label for='${id}_textInput'>${text}</label>","</td><td>","<input data-dojo-type='dijit.form.ValidationTextBox' required='false' id='${id}_textInput' name='textInput' data-dojo-props='intermediateChanges:true'/>","</td></tr><tr><td>","</td><td>","</td></tr><tr><td colspan='2'>","<button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>","<button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>","</td></tr></table>"].join(""),htmlTemplate:'<img src="${urlInput}" _djrealurl="${urlInput}" alt="${textInput}" />',tag:"img",_getCurrentValues:function(e){var t,i;if(e&&e.tagName.toLowerCase()===this.tag){t=e.getAttribute("_djrealurl")||e.getAttribute("src");i=e.getAttribute("alt");this.editor.selection.selectElement(e,!0)}else i=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:i||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.then(o.hitch(this,(function(){this.own(a(this.editor.editNode,"mousedown",o.hitch(this,"_selectTag")))})))},_selectTag:function(e){if(e&&e.target){var t=e.target;(t.tagName?t.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(t)}},_checkValues:function(e){e&&e.urlInput&&(e.urlInput=e.urlInput.replace(/"/g,"&quot;"));e&&e.textInput&&(e.textInput=e.textInput.replace(/"/g,"&quot;"));return e},_onDblClick:function(e){if(e&&e.target){var t=e.target;if((t.tagName?t.tagName.toLowerCase():"")===this.tag&&i.get(t,"src")){var n=this.editor;this.editor.selection.selectElement(t);n.onDisplayChanged();if(n._updateTimer){n._updateTimer.remove();delete n._updateTimer}n.onNormalizedDisplayChanged();var o=this.button;setTimeout((function(){o.set("disabled",!1);o.loadAndOpenDropDown().then((function(){o.dropDown.focus&&o.dropDown.focus()}))}),10)}}}});d.registry.createLink=function(){return new u({command:"createLink"})};d.registry.insertImage=function(){return new p({command:"insertImage"})};u.ImgLinkDialog=p;return u}))},"dijit/_editor/plugins/ViewSource":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/window","../../focus","../_Plugin","../../form/ToggleButton","../..","../../registry","dojo/i18n!../nls/commands"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_,f){var v=i("dijit._editor.plugins.ViewSource",m,{stripScripts:!0,stripComments:!0,stripIFrames:!0,stripEventHandlers:!0,readOnly:!1,_fsPlugin:null,toggle:function(){h("webkit")&&(this._vsFocused=!0);this.button.set("checked",!this.button.get("checked"))},_initButton:function(){var e=r.getLocalization("dijit._editor","commands"),t=this.editor;this.button=new g({label:e.viewSource,ownerDocument:t.ownerDocument,dir:t.dir,lang:t.lang,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"ViewSource",tabIndex:"-1",onChange:d.hitch(this,"_showSource")});this.button.set("readOnly",!1)},setEditor:function(e){this.editor=e;this._initButton();this.editor.addKeyHandler(l.F12,!0,!0,d.hitch(this,(function(e){this.button.focus();this.toggle();e.stopPropagation();e.preventDefault();setTimeout(d.hitch(this,(function(){this.editor.focused&&this.editor.focus()})),100)})))},_showSource:function(i){var n,o=this.editor,a=o._plugins;this._sourceShown=i;var r=this;try{this.sourceArea||this._createSourceView();if(i){o._sourceQueryCommandEnabled=o.queryCommandEnabled;o.queryCommandEnabled=function(e){return"viewsource"===e.toLowerCase()};this.editor.onDisplayChanged();n=o.get("value");n=this._filter(n);o.set("value",n);e.forEach(a,(function(e){!e||e instanceof v||!e.isInstanceOf(m)||e.set("disabled",!0)}));this._fsPlugin&&(this._fsPlugin._getAltViewNode=function(){return r.sourceArea});this.sourceArea.value=n;this.sourceArea.style.height=o.iframe.style.height;this.sourceArea.style.width=o.iframe.style.width;o.iframe.parentNode.style.position="relative";s.set(o.iframe,{position:"absolute",top:0,visibility:"hidden"});s.set(this.sourceArea,{display:"block"});this._resizeHandle=c(window,"resize",d.hitch(this,(function(){var e=u.getBox(o.ownerDocument);if("_prevW"in this&&"_prevH"in this){if(e.w===this._prevW&&e.h===this._prevH)return;this._prevW=e.w;this._prevH=e.h}else{this._prevW=e.w;this._prevH=e.h}if(this._resizer){clearTimeout(this._resizer);delete this._resizer}this._resizer=setTimeout(d.hitch(this,(function(){delete this._resizer;this._resize()})),10)})));setTimeout(d.hitch(this,this._resize),100);this.editor.onNormalizedDisplayChanged();this.editor.__oldGetValue=this.editor.getValue;this.editor.getValue=d.hitch(this,(function(){var e=this.sourceArea.value;return e=this._filter(e)}));this._setListener=t.after(this.editor,"setValue",d.hitch(this,(function(e){e=e||"";e=this._filter(e);this.sourceArea.value=e})),!0)}else{if(!o._sourceQueryCommandEnabled)return;this._setListener.remove();delete this._setListener;this._resizeHandle.remove();delete this._resizeHandle;if(this.editor.__oldGetValue){this.editor.getValue=this.editor.__oldGetValue;delete this.editor.__oldGetValue}o.queryCommandEnabled=o._sourceQueryCommandEnabled;if(!this._readOnly){n=this.sourceArea.value;n=this._filter(n);o.beginEditing();o.set("value",n);o.endEditing()}e.forEach(a,(function(e){e&&e.isInstanceOf(m)&&e.set("disabled",!1)}));s.set(this.sourceArea,"display","none");s.set(o.iframe,{position:"relative",visibility:"visible"});delete o._sourceQueryCommandEnabled;this.editor.onDisplayChanged()}setTimeout(d.hitch(this,(function(){var e=o.domNode.parentNode;if(e){var t=f.getEnclosingWidget(e);t&&t.resize&&t.resize()}o.resize()})),300)}catch(l){}},updateState:function(){this.button.set("disabled",this.get("disabled"))},_resize:function(){var e=this.editor,t=e.getHeaderHeight(),i=e.getFooterHeight(),n=a.position(e.domNode),o=a.getPadBorderExtents(e.iframe.parentNode),s=a.getMarginExtents(e.iframe.parentNode),r=a.getPadBorderExtents(e.domNode),l={w:n.w-r.w,h:n.h-(t+r.h+i)};if(this._fsPlugin&&this._fsPlugin.isFullscreen){var d=u.getBox(e.ownerDocument);l.w=d.w-r.w;l.h=d.h-(t+r.h+i)}a.setMarginBox(this.sourceArea,{w:Math.round(l.w-(o.w+s.w)),h:Math.round(l.h-(o.h+s.h))})},_createSourceView:function(){var e=this.editor,t=e._plugins;this.sourceArea=o.create("textarea");if(this.readOnly){n.set(this.sourceArea,"readOnly",!0);this._readOnly=!0}s.set(this.sourceArea,{padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});n.set(this.sourceArea,"aria-label",this.editor.id);o.place(this.sourceArea,e.iframe,"before");h("ie")&&e.iframe.parentNode.lastChild!==e.iframe&&s.set(e.iframe.parentNode.lastChild,{width:"0px",height:"0px",padding:"0px",margin:"0px",borderWidth:"0px",borderStyle:"none"});e._viewsource_oldFocus=e.focus;var i,a,r=this;e.focus=function(){if(r._sourceShown)r.setSourceAreaCaret();else try{if(this._vsFocused){delete this._vsFocused;p.focus(e.editNode)}else e._viewsource_oldFocus()}catch(t){}};for(i=0;i<t.length;i++)if((a=t[i])&&("dijit._editor.plugins.FullScreen"===a.declaredClass||a.declaredClass===_._scopeName+"._editor.plugins.FullScreen")){this._fsPlugin=a;break}if(this._fsPlugin){this._fsPlugin._viewsource_getAltViewNode=this._fsPlugin._getAltViewNode;this._fsPlugin._getAltViewNode=function(){return r._sourceShown?r.sourceArea:this._viewsource_getAltViewNode()}}this.own(c(this.sourceArea,"keydown",d.hitch(this,(function(t){if(this._sourceShown&&t.keyCode==l.F12&&t.ctrlKey&&t.shiftKey){this.button.focus();this.button.set("checked",!1);setTimeout(d.hitch(this,(function(){e.focus()})),100);t.stopPropagation();t.preventDefault()}}))))},_stripScripts:function(e){e&&(e=(e=(e=e.replace(/<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>/gi,"")).replace(/<\s*script\b([^<>]|\s)*>?/gi,"")).replace(/<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>/gi,""));return e},_stripComments:function(e){e&&(e=e.replace(/<!--(.|\s){1,}?-->/g,""));return e},_stripIFrames:function(e){e&&(e=e.replace(/<\s*iframe[^>]*>((.|\s)*?)<\\?\/\s*iframe\s*>/gi,""));return e},_stripEventHandlers:function(e){if(e){var t=e.match(/<[a-z]+?\b(.*?on.*?(['"]).*?\2.*?)+>/gim);if(t)for(var i=0,n=t.length;i<n;i++){var o=t[i],a=o.replace(/\s+on[a-z]*\s*=\s*(['"])(.*?)\1/gim,"");e=e.replace(o,a)}}return e},_filter:function(e){if(e){this.stripScripts&&(e=this._stripScripts(e));this.stripComments&&(e=this._stripComments(e));this.stripIFrames&&(e=this._stripIFrames(e));this.stripEventHandlers&&(e=this._stripEventHandlers(e))}return e},setSourceAreaCaret:function(){var e=this.sourceArea;p.focus(e);if(this._sourceShown&&!this.readOnly)if(e.setSelectionRange)e.setSelectionRange(0,0);else if(this.sourceArea.createTextRange){var t=e.createTextRange();t.collapse(!0);t.moveStart("character",-99999);t.moveStart("character",0);t.moveEnd("character",0);t.select()}},destroy:function(){if(this._resizer){clearTimeout(this._resizer);delete this._resizer}if(this._resizeHandle){this._resizeHandle.remove();delete this._resizeHandle}if(this._setListener){this._setListener.remove();delete this._setListener}this.inherited(arguments)}});m.registry.viewSource=m.registry.viewsource=function(e){return new v({readOnly:"readOnly"in e&&e.readOnly,stripComments:!("stripComments"in e)||e.stripComments,stripScripts:!("stripScripts"in e)||e.stripScripts,stripIFrames:!("stripIFrames"in e)||e.stripIFrames,stripEventHandlers:!("stripEventHandlers"in e)||e.stripEventHandlers})};return v}))},"ebg/core/core":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/core/common","dojo/string","dojo/fx","dojo/fx/easing","dojo/parser","dojo/io/iframe","dijit/Tooltip","dojox/uuid/generateRandomUuid","dijit/Dialog","ebg/core/i18n","ebg/webrtc","ebg/webpush","ebg/draggable","ebg/resizable","ebg/popindialog"],(function(e,t,i){e.extend(dijit.Dialog,{attr:function(e,t){this.set(e,t)},set:function(t,i){if("content"==t){this.thisDlg=new ebg.popindialog;this.thisDlg.bCloseIsHiding=!0;this.thisDlg.create("dialog_"+this.id,null!==$("main-content")?"main-content":"left-side");this.thisDlg.setTitle(this.title);this.onHide&&(this.thisDlg.onHide=e.hitch(this,this.onHide));this.thisDlg.setContent(i)}},show:function(){void 0!==this.thisDlg&&this.thisDlg.show()},hide:function(){void 0!==this.thisDlg&&this.thisDlg.hide()},destroyRecursive:function(){void 0!==this.thisDlg&&this.thisDlg.destroy(!1)},destroy:function(){void 0!==this.thisDlg&&this.thisDlg.destroy(!1)}});return t("ebg.core.core",null,{constructor:function(){this.subscriptions=[];this.comet_subscriptions=[];this.unload_in_progress=!1;this.bCancelAllAjax=!1;this.tooltips={};this.tooltipsInfos={};this.screenMinWidth=0;this.currentZoom=1;this.mozScale=1;this.rotateToPosition={};this.connections=[];this.instantaneousMode=!1;this.webrtc=null;this.webrtcmsg_ntf_handle=null;this.room=null;this.already_accepted_room=null;this.rtc_mode=0;this.mediaConstraints={video:!1,audio:!1};this.gameMasculinePlayers=[];this.gameFemininePlayers=[];this.gameNeutralPlayers=[];this.emoticons={":)":"smile",":-)":"smile",":D":"bigsmile",":-D":"bigsmile",":(":"unsmile",":-(":"unsmile",";)":"blink",";-)":"blink",":/":"bad",":-/":"bad",":s":"bad",":-s":"bad",":P":"mischievous",":-P":"mischievous",":p":"mischievous",":-p":"mischievous",":$":"blushing",":-$":"blushing",":o":"surprised",":-o":"surprised",":O":"shocked",":-O":"shocked",o_o:"shocked",O_O:"shocked","8)":"sunglass","8-)":"sunglass"};this.defaultTooltipPosition=["above","below","after","before"];this.webpush=null},ajaxcall:function(t,i,n,o,a,s){g_sitecore.ajaxcall_running++;g_sitecore.updateAjaxCallStatus();if(void 0===i.action)if(void 0===i.module)if(void 0===i.class){if(i.lock){var r=null;"table"==i.lock?r="table":"player"==i.lock&&(r="player");i.lock=dojox.uuid.generateRandomUuid();e.publish("lockInterface",[{status:"outgoing",uuid:i.lock,type:r}])}var l=e.hitch(this,(function(i,s){if(i&&1==i.status){void 0!==i.profilingd&&($("ajax_call_profiling").innerHTML+=i.profilingd);s.args.content.lock&&e.publish("lockInterface",[{status:"recorded",uuid:s.args.content.lock}]);"object"==typeof i.data&&null!==i.data&&"object"==typeof i.data.data&&null!==i.data.data&&void 0!==i.data.data.tbyt&&(this.number_of_tb_table_its_your_turn=i.data.data.tbyt);if(!this.bCancelAllAjax)try{e.hitch(n,o)(i.data);void 0!==a&&e.hitch(n,a)(!1)}catch(l){l.message="Error during callback from url "+t+". "+l.message;throw l}}else{var r="";if(null===i){this.showMessage(__("lang_mainsite","Ajaxcall error: empty answer"),"error");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"info")}else if(800==i.code)e.publish("signalVisitorNotAllowed");else if(801==i.code){this.showMessage(i.error,"error");"undefined"!=typeof gotourl?gotourl("premium?src=notallowed"):void 0!==this.metasiteurl&&setTimeout(e.hitch(this,(function(){document.location.href=this.metasiteurl+"/premium"})),2e3)}else if(806==i.code)this.infoDialog(__("lang_mainsite","Please click the button below to continue."),__("lang_mainsite","Update needed!"),(function(){window.location.reload()}),!0);else if(114==i.code){if("undefined"!=typeof gotourl){gotourl("account?page=newuser");this.showMessage(i.error,"error")}else if(void 0!==this.metasiteurl){this.showMessage(i.error,"error");setTimeout(e.hitch(this,(function(){document.location.href=this.metasiteurl+"/account?page=newuser"})),2e3)}}else if(0===toint(i.expected)){this.showMessage(__("lang_mainsite","Unexpected error: ")+i.error,"error");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"info")}else{this.showMessage(i.error,"error");r=i.error}s.args.content.lock&&e.publish("lockInterface",[{status:"updated",uuid:s.args.content.lock}]);this.bCancelAllAjax||void 0!==a&&e.hitch(n,a)(!0,r,null===i?0:i.code)}})),d=e.hitch(this,(function(t,i){if(i.xhr)if(200==i.xhr.status){var o=i.xhr.responseText;if("{"!=(o=o.replace(/^\s+/g,"").replace(/\s+$/g,""))[0]){this.showMessage(__("lang_mainsite","Server syntax error: ")+i.xhr.responseText,"error");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"info")}else{this.showMessage(__("lang_mainsite","Client error: ")+t+". During "+i.args.url+" Received: "+i.xhr.responseText,"only_to_log");this.showMessage(__("lang_mainsite","If your game interface seems unstable, press F5 or <a href='javascript:location.reload(true)'>click here</a>"),"only_to_log")}}else this.displayUserHttpError(i.xhr.status);else void 0!==i.error&&this.showMessage(i.error.toString(),"error");i.args.content.lock&&e.publish("lockInterface",[{status:"updated",uuid:i.args.content.lock}]);this.bCancelAllAjax||void 0!==a&&e.hitch(n,a)(!0)})),c=e.hitch(this,(function(e,t){g_sitecore.ajaxcall_running--;g_sitecore.updateAjaxCallStatus()})),h=null;if($("debug_output")){var u=t.lastIndexOf("/"),p=t.substring(u+1),m=e.clone(i);m.lock&&delete m.lock;var g="<div>> <b>"+p+"</b>?"+e.objectToQuery(m)+"</div>";e.place(g,"debug_output","first")}if("post"!=s&&"iframe"!=s)e.xhrGet({url:t,handleAs:"json",preventCache:!0,content:i,headers:{"X-Request-Token":bgaConfig.requestToken},load:l,error:d,handle:c,timeout:2e4});else if("post"==s){void 0!==i.form_id&&null!==i.form_id&&(h=i.form_id);e.xhrPost({url:t,handleAs:"json",preventCache:!0,content:i,headers:{"X-Request-Token":bgaConfig.requestToken},form:h,load:l,error:d,handle:c,timeout:2e4})}else if("iframe"==s){null!==i.form_id&&(h=i.form_id);e.io.iframe.send({url:t,handleAs:"json",preventCache:!0,content:i,form:h,load:l,error:d,handle:c,timeout:2e4})}}else this.showMessage("Ajaxcall : sorry you cannot use 'class' argument (reserved keyword)","error");else this.showMessage("Ajaxcall : sorry you cannot use 'module' argument (reserved keyword)","error");else this.showMessage("Ajaxcall : sorry you cannot use 'action' argument (reserved keyword)","error")},ajaxpageload:function(t,i,n,o,a){g_sitecore.ajaxcall_running++;g_sitecore.updateAjaxCallStatus();return e.xhrGet({url:t,handleAs:"text",preventCache:!0,content:i,timeout:2e4,load:e.hitch(this,(function(i,s){if(window.URL){var r=new URL(s.xhr.responseURL),l=new URL(s.url,window.location.href);if(r.pathname!=l.pathname){gotourl(r.pathname+r.search+r.hash);return}}e.empty(n);e.place(i,n);if($("bga_fatal_error")){if(800==toint($("bga_fatal_error_code").innerHTML))e.publish("signalVisitorNotAllowed");else if(802==toint($("bga_fatal_error_code").innerHTML))if(-1!=t.indexOf("preferences?section")||"preferences"===t.substr(-"preferences".length)||"support"===t.substr(-"support".length)||"contact"===t.substr(-"contact".length));else{var d=$("bga_fatal_error_descr").innerHTML.split(":");gotourl(d[1])}}else e.hitch(o,a)(i.data)})),error:e.hitch(this,(function(e,t){if("Request canceled"!=e.message)if(200==t.xhr.status){var i=t.xhr.responseText;"<"!=(i=i.replace(/^\s+/g,"").replace(/\s+$/g,""))[0]?this.showMessage("Server syntax error: "+t.xhr.responseText,"error"):this.showMessage("Callback error: "+e,"error")}else this.displayUserHttpError(t.xhr.status)})),handle:e.hitch(this,(function(e,t){g_sitecore.ajaxcall_running--;g_sitecore.updateAjaxCallStatus()}))})},displayUserHttpError:function(e){if(!g_sitecore.page_is_unloading){var t="";switch(e=toint(e)){case 404:t=__("lang_mainsite","The requested page was not found");break;case 500:t=__("lang_mainsite","The server reported an error.");break;case 407:t=__("lang_mainsite","You need to authenticate with a proxy.");break;case 0:t=__("lang_mainsite","Unable to contact the server. Are you connected ?");break;default:t=__("lang_mainsite","Unknown network error")+" ("+e+")"}this.showMessage(t,"error")}},cancelAjaxCall:function(){this.bCancelAllAjax=!0},format_block:function(t,i){return e.trim(e.string.substitute(e.eval(t),i))},format_string:function(t,i){return e.trim(e.string.substitute(t,i))},format_string_recursive:function(t,i){if(null===t)return"null_tr_string";var n="";if(""!=t){var o,a,s=this.clienttranslate_string(t);if(null===s){this.showMessage("Missing translation for `"+t+"`","error");return""}if(void 0!==i.i18n)for(o in i.i18n)i[a=i.i18n[o]]=this.clienttranslate_string(i[a]);for(a in i)"i18n"!=a&&"object"==typeof i[a]&&null!==i[a]&&void 0!==i[a].log&&void 0!==i[a].args&&(i[a]=this.format_string_recursive(i[a].log,i[a].args));try{n=e.string.substitute(s,i)}catch(r){void 0===this.prevent_error_rentry&&(this.prevent_error_rentry=0);this.prevent_error_rentry++;this.prevent_error_rentry>=10||this.showMessage("Invalid or missing substitution argument for log message: "+s,"error");this.prevent_error_rentry--;n=s}}void 0!==i.type&&("chatmessage"==i.type||"tablechat"==i.type||"privatechat"==i.type||"groupchat"==i.type)||void 0!==i.message&&"${player_name} ${message}"==t||void 0!==i.text&&"${player_name} ${text}"==t||(n=this.applyGenderRegexps(n));return n},applyGenderRegexps:function(t,i){var n=bgaConfig.genderRegexps[e.config.locale.substr(0,2)];if(void 0!==n){var o=n.forMasculine;if(void 0!==o){var a=!1;if(void 0!==i&&1==parseInt(i))a=!0;else for(var s=0;s<this.gameMasculinePlayers.length;s++)t.match(new RegExp(">"+this.gameMasculinePlayers[s]+"<"))&&(a=!0);if(a)for(var r=Object.keys(o),l=Object.values(o),d=0;d<r.length;d++)t=t.replace(new RegExp(replaceAll(r[d],"~",""),"g"),l[d])}var c=n.forFeminine;if(void 0!==c){a=!1;if(void 0!==i&&0==parseInt(i))a=!0;else for(s=0;s<this.gameFemininePlayers.length;s++)t.match(new RegExp(">"+this.gameFemininePlayers[s]+"<"))&&(a=!0);if(a)for(r=Object.keys(c),l=Object.values(c),d=0;d<r.length;d++)t=t.replace(new RegExp(replaceAll(r[d],"~",""),"g"),l[d])}var h=n.forNeutral;if(void 0!==h){a=!1;if(void 0!==i&&null===i)a=!0;else for(s=0;s<this.gameNeutralPlayers.length;s++)t.match(new RegExp(">"+this.gameNeutralPlayers[s]+"<"))&&(a=!0);if(a)for(r=Object.keys(h),l=Object.values(h),d=0;d<r.length;d++)t=t.replace(new RegExp(replaceAll(r[d],"~",""),"g"),l[d])}}return t},clienttranslate_string:function(e){var t=_(e);return t==e?__("lang_mainsite",e):t},translate_client_targets:function(t,i){e.query(".clienttranslatetarget").forEach(e.hitch(this,(function(n){var o=n.innerHTML;o=void 0!==typeof i?__(i,o):_(o);n.innerHTML=e.string.substitute(o,t)})))},register_subs:function(e){this.subscriptions.push(e)},register_cometd_subs:function(e){this.comet_subscriptions.push(e);return e},unsubscribe_all:function(){for(var t=null;this.subscriptions.length>0;){t=this.subscriptions.shift();e.unsubscribe(t)}for(;this.comet_subscriptions.length>0;){sub_id=this.comet_subscriptions.shift();g_sitecore.unsubscribeCometdChannel(sub_id)}},showMessage:function(e,t){g_sitecore.showMessage(e,t)},adaptScreenToMinWidth:function(e){this.interface_min_width=e},adaptScreenToMinWidthWorker:function(){var t=e.position("ebd-body");if(e.isMozilla);else{var i=t.w*this.currentZoom,n=this.screenMinWidth;e.hasClass("ebd-body","game_interface")&&e.hasClass("ebd-body","mobile_version")&&(n-=240);this.currentZoom=i<=n?i/n:1;e.style("ebd-body","zoom",this.currentZoom)}},getObjPosition:function(t){var i=e.oldPosition(t);if(1!=this.mozScale){i.x/=this.mozScale;i.y/=this.mozScale;return i}return i},placeOnObject:function(t,i){if("string"==typeof t)var n=$(t);else n=t;var o=this.disable3dIfNeeded(),a=e.position(i),s=e.position(t),r=e.style(t,"left"),l=e.style(t,"top"),d={x:a.x-s.x+(a.w-s.w)/2,y:a.y-s.y+(a.h-s.h)/2},c=this.getAbsRotationAngle(n.parentNode),h=this.vector_rotate(d,c);r+=h.x;l+=h.y;e.style(t,"top",l+"px");e.style(t,"left",r+"px");this.enable3dIfNeeded(o)},placeOnObjectPos:function(t,i,n,o){if("string"==typeof t)var a=$(t);else a=t;var s=this.disable3dIfNeeded(),r=e.position(i),l=e.position(t),d=e.style(t,"left"),c=e.style(t,"top"),h={x:r.x-l.x+(r.w-l.w)/2+n,y:r.y-l.y+(r.h-l.h)/2+o},u=this.getAbsRotationAngle(a.parentNode),p=this.vector_rotate(h,u);d+=p.x;c+=p.y;e.style(t,"top",c+"px");e.style(t,"left",d+"px");this.enable3dIfNeeded(s)},disable3dIfNeeded:function(){if(e.hasClass("ebd-body","mode_3d")){e.removeClass("ebd-body","enableTransitions");var t=$("game_play_area").style.transform;e.removeClass("ebd-body","mode_3d");e.style("game_play_area","transform","rotatex(0deg) translate(0px,0px) rotateZ(0deg)");return t}return null},enable3dIfNeeded:function(t){if(null!==t){e.style("game_play_area","transform",t);e.addClass("ebd-body","mode_3d")}},getComputedTranslateZ:function(e){if(window.getComputedStyle){var t=getComputedStyle(e),i=(t.transform||t.webkitTransform||t.mozTransform).match(/^matrix3d\((.+)\)$/);return i?~~i[1].split(", ")[14]:0}},transformSlideAnimTo3d:function(t,i,n,o,a,s){if(e.hasClass("ebd-body","mode_3d")){if(void 0===a||void 0===s)var r=50;else{var l=Math.sqrt(a*a+s*s);r=Math.max(20,Math.min(80,Math.round(l/2)))}var d=this.getComputedTranslateZ(i);null==n&&(n=500);null==o&&(o=0);"string"==typeof i&&(i=$(i));var c=new e.Animation({curve:[d,d+r],delay:o,duration:n/2,onAnimate:e.hitch(this,(function(e){i.style.transform="translateZ("+e+"px)"}))}),h=new e.Animation({curve:[d+r,d],delay:o+n/2,duration:n/2,onAnimate:e.hitch(this,(function(e){i.style.transform="translateZ("+e+"px)"}))});return e.fx.combine([t,c,h])}return t},slideToObject:function(t,i,n,o){if("string"==typeof t)var a=$(t);else a=t;var s=this.disable3dIfNeeded(),r=e.position(i),l=e.position(t);void 0===n&&(n=500);void 0===o&&(o=0);if(this.instantaneousMode){o=Math.min(1,o);n=Math.min(1,n)}var d=e.style(t,"left"),c=e.style(t,"top"),h={x:r.x-l.x+(r.w-l.w)/2,y:r.y-l.y+(r.h-l.h)/2},u=this.getAbsRotationAngle(a.parentNode),p=this.vector_rotate(h,u);d+=p.x;c+=p.y;this.enable3dIfNeeded(s);var m=e.fx.slideTo({node:t,top:c,left:d,delay:o,duration:n,unit:"px"});null!==s&&(m=this.transformSlideAnimTo3d(m,a,n,o,p.x,p.y));return m},slideToObjectPos:function(t,i,n,o,a,s){if("string"==typeof t)var r=$(t);else r=t;var l=this.disable3dIfNeeded(),d=e.position(i),c=e.position(t);void 0===a&&(a=500);void 0===s&&(s=0);if(this.instantaneousMode){s=Math.min(1,s);a=Math.min(1,a)}var h=e.style(t,"left"),u=e.style(t,"top"),p={x:d.x-c.x+toint(n),y:d.y-c.y+toint(o)},m=this.getAbsRotationAngle(r.parentNode),g=this.vector_rotate(p,m);h+=g.x;u+=g.y;this.enable3dIfNeeded(l);var _=e.fx.slideTo({node:t,top:u,left:h,delay:s,duration:a,easing:e.fx.easing.cubicInOut,unit:"px"});null!==l&&(_=this.transformSlideAnimTo3d(_,r,a,s,g.x,g.y));return _},slideToObjectPctPos:function(t,i,n,o,a,s){var r=e.position(i),l=Math.round(r.w*n/100),d=Math.round(r.h*o/100);return this.slideToObjectPos(t,i,l,d,a,s)},toRadians:function(e){return e*(Math.PI/180)},vector_rotate:function(e,t){if(0==t)return e;var i=-this.toRadians(t);return{x:e.x*Math.cos(i)-e.y*Math.sin(i),y:e.x*Math.sin(i)+e.y*Math.cos(i)}},attachToNewParent:function(t,i,n){"string"==typeof t&&(t=$(t));"string"==typeof i&&(i=$(i));void 0===n&&(n="last");var o=this.disable3dIfNeeded(),a=e.position(t),s=this.getAbsRotationAngle(t),r=e.clone(t);e.destroy(t);e.place(r,i,n);var l=e.position(r),d=e.style(r,"left"),c=e.style(r,"top"),h=this.getAbsRotationAngle(r),u=this.getAbsRotationAngle(i),p={x:a.x-l.x+(a.w-l.w)/2,y:a.y-l.y+(a.h-l.h)/2},m=this.vector_rotate(p,u);d+=m.x;c+=m.y;e.style(r,"top",c+"px");e.style(r,"left",d+"px");h!=s&&this.rotateInstantDelta(r,s-h);this.enable3dIfNeeded(o);return r},attachToNewParentNoReplace:function(t,i,n){"string"==typeof t&&(t=$(t));"string"==typeof i&&(i=$(i));void 0===n&&(n="last");var o=e.clone(t);e.destroy(t);e.place(o,i,n);return o},slideTemporaryObject:function(t,i,n,o,a,s){var r=e.place(t,i);e.style(r,"position","absolute");e.style(r,"left","0px");e.style(r,"top","0px");this.placeOnObject(r,n);var l=this.slideToObject(r,o,a,s);e.connect(l,"onEnd",(function(t){e.destroy(t)}));l.play();return l},slideToObjectAndDestroy:function(t,i,n,o){e.style(t,"zIndex",100);var a=this.slideToObject(t,i,n,o);e.connect(a,"onEnd",(function(t){e.destroy(t)}));a.play()},fadeOutAndDestroy:function(t,i,n){void 0===i&&(i=500);void 0===n&&(n=0);this.instantaneousMode&&(i=Math.min(1,i));var o=e.fadeOut({node:t,duration:i,delay:n});e.connect(o,"onEnd",(function(t){e.destroy(t)}));o.play()},rotateInstantTo:function(t,i){"string"==typeof t&&(t=$(t));i=tofloat(i);var n=0;void 0!==this.rotateToPosition[t.id]&&(n=this.rotateToPosition[t.id]);if(i!=n){var o;e.forEach(["transform","WebkitTransform","msTransform","MozTransform","OTransform"],(function(t){void 0!==e.body().style[t]&&(o=t)}));this.transform=o;e.style(t,this.transform,"rotate("+i+"deg)");this.rotateToPosition[t.id]=i}},rotateInstantDelta:function(e,t){"string"==typeof e&&(e=$(e));t=tofloat(t);void 0!==this.rotateToPosition[e.id]?this.rotateInstantTo(e,this.rotateToPosition[e.id]+t):this.rotateInstantTo(e,t)},rotateTo:function(t,i){"string"==typeof t&&(t=$(t));i=tofloat(i);var n;e.forEach(["transform","WebkitTransform","msTransform","MozTransform","OTransform"],(function(t){void 0!==e.body().style[t]&&(n=t)}));this.transform=n;var o=0;void 0!==this.rotateToPosition[t.id]&&(o=this.rotateToPosition[t.id]);if(i!=o){for(;i>o+180;)i-=360;for(;i<o-180;)i+=360;this.rotateToPosition[t.id]=i;new e.Animation({curve:[o,i],onAnimate:e.hitch(this,(function(e){t.style[this.transform]="rotate("+e+"deg)"}))}).play()}},getAbsRotationAngle:function(e){var t=0;"string"==typeof e&&(e=$(e));if(null===e)return 0;if(void 0!==e.id){void 0!==this.rotateToPosition[e.id]&&(t=this.rotateToPosition[e.id]);if("overall-content"==typeof e.id)return 0}return void 0!==e.parentNode?t+this.getAbsRotationAngle(e.parentNode):0},addStyleToClass:function(t,i,n){for(var o=e.query("."+t),a=0;a<o.length;a++)e.style(o[a],i,n)},connect:function(t,i,n){null!=t&&this.connections.push({element:t,event:i,handle:e.connect(t,i,this,n)})},disconnect:function(t,i){e.forEach(this.connections,(function(n){n.element==t&&n.event==i&&e.disconnect(n.handle)}))},connectClass:function(e,t,i){this.connectQuery("."+e,t,i)},connectQuery:function(t,i,n){for(var o=e.query(t),a=0;a<o.length;a++){var s=o[a];this.connections.push({element:s,event:i,handle:e.connect(s,i,this,n)})}},addEventToClass:function(e,t,i){this.connectClass(e,t,i)},disconnectAll:function(){e.forEach(this.connections,(function(t){e.disconnect(t.handle)}));this.connections=[]},updateCounters:function(e){if(void 0!==e)for(var t in e){var i=e[t];this.gamedatas.counters[t]&&null!=i.counter_value&&this.setCounter(i.counter_name,i.counter_value)}},setCounter:function(e,t){var i=this.gamedatas.counters[e];i.counter_value=t;$(i.counter_name).innerHTML=i.counter_value},incCounter:function(e,t){var i=this.gamedatas.counters[e];i.counter_value=parseInt(i.counter_value)+parseInt(t);$(i.counter_name).innerHTML=i.counter_value},decrCounter:function(e,t){var i=this.gamedatas.counters[e];i.counter_value=parseInt(i.counter_value)-parseInt(t);i.counter_value<0&&(i.counter_value=0);$(i.counter_name).innerHTML=i.counter_value},getHtmlFromTooltipinfos:function(e,t){var i='<div class="midSizeDialog">';if(""!=e){i+="<img class='imgtext' src='"+getStaticAssetUrl("img/layout/help_info.png")+"' alt='info' /> <span class='tooltiptext'>"+e+"</span>";""!=t&&(i+="<br/>")}""!=t&&(i+="<img class='imgtext' src='"+getStaticAssetUrl("img/layout/help_click.png")+"' alt='action' /> <span class='tooltiptext'>"+t+"</span>");return i+="</div>"},addTooltip:function(t,i,n,o){this.tooltips[t]&&this.tooltips[t].destroy();var a=400;void 0!==o&&(a=o);this.tooltips[t]=new dijit.Tooltip({connectId:[t],label:this.getHtmlFromTooltipinfos(i,n),showDelay:a});e.connect($(t),"onclick",this.tooltips[t],"close");this.tooltipsInfos[t]={hideOnHoverEvt:null};e.connect(this.tooltips[t],"_onHover",e.hitch(this,(function(){null===this.tooltipsInfos[t].hideOnHoverEvt&&$("dijit__MasterTooltip_0")&&(this.tooltipsInfos[t].hideOnHoverEvt=e.connect($("dijit__MasterTooltip_0"),"onmouseenter",this.tooltips[t],"close"))})))},addTooltipHtml:function(t,i,n){i='<div class="midSizeDialog">'+i+"</div>";this.tooltips[t]&&this.tooltips[t].destroy();var o=400;void 0!==n&&(o=n);this.tooltips[t]=new dijit.Tooltip({connectId:[t],label:i,position:this.defaultTooltipPosition,showDelay:o});e.connect($(t),"onclick",this.tooltips[t],"close");this.tooltipsInfos[t]={hideOnHoverEvt:null};e.connect(this.tooltips[t],"_onHover",e.hitch(this,(function(){null===this.tooltipsInfos[t].hideOnHoverEvt&&$("dijit__MasterTooltip_0")&&(this.tooltipsInfos[t].hideOnHoverEvt=e.connect($("dijit__MasterTooltip_0"),"onmouseenter",this.tooltips[t],"close"))})))},removeTooltip:function(e){this.tooltips[e]&&this.tooltips[e].destroy()},switchDisplayTooltips:function(t){if(0!=t)for(var i in this.tooltips)this.tooltips[i].onShow=e.hitch(this.tooltips[i],(function(){this.close()}));else if(0==t)for(var i in this.tooltips)this.tooltips[i].onShow=function(){}},addTooltipToClass:function(t,i,n,o){"."==t[0]&&(t=t.substr(1));for(var a=e.query("."+t),s=0;s<a.length;s++){""==a[s].id&&(a[s].id=dojox.uuid.generateRandomUuid());this.addTooltip(a[s].id,i,n,o)}},addTooltipHtmlToClass:function(t,i,n){"."==t[0]&&(t=t.substr(1));for(var o=e.query("."+t),a=0;a<o.length;a++)""!=o[a].id&&this.addTooltipHtml(o[a].id,i,n)},applyCommentMarkup:function(e){e=e.replace(/\*(.*?)\*/g,"<b>$1</b>");e=replaceAll(e,"---","<hr/>");e=replaceAll(e,"[red]","<span style='color:red'>");e=replaceAll(e,"[/red]","</span>");e=replaceAll(e,"[green]","<span style='color:green'>");e=replaceAll(e,"[/green]","</span>");e=replaceAll(e,"[blue]","<span style='color:blue'>");e=replaceAll(e,"[/blue]","</span>");e=replaceAll(e,"!!!","<i class='fa  fa-exclamation-triangle'></i>");return e=replaceAll(e,"[tip]","<i class='fa  fa-lightbulb-o'></i>")},confirmationDialog:function(t,i,n,o){void 0===o&&(o=null);void 0===this.confirmationDialogUid&&(this.confirmationDialogUid=0);void 0===this.confirmationDialogUid_called&&(this.confirmationDialogUid_called=0);this.confirmationDialogUid++;var a=new ebg.popindialog;a.create("confirmation_dialog_"+this.confirmationDialogUid,null!==$("main-content")?"main-content":"left-side");a.setTitle(__("lang_mainsite","Are you sure ?"));a.setMaxWidth(500);var s="<div id='confirmation_dialog_"+this.confirmationDialogUid+"'>";s+=t;s+="<br/><br/><div style='text-align: center;'>";s+="<a class='bgabutton bgabutton_gray' id='infirm_btn_"+this.confirmationDialogUid+"' href='#'><span>"+__("lang_mainsite","Please, no")+"</span></a> &nbsp; ";s+="<a class='bgabutton bgabutton_blue' id='confirm_btn_"+this.confirmationDialogUid+"' href='#'><span>"+__("lang_mainsite","I confirm")+"</span></a>";s+="</div></div>";a.setContent(s);a.hideCloseIcon();a.show();e.connect($("confirm_btn_"+this.confirmationDialogUid),"onclick",this,(function(e){e.preventDefault();a.destroy();if(this.confirmationDialogUid_called==this.confirmationDialogUid);else{this.confirmationDialogUid_called=this.confirmationDialogUid;i(o)}}));e.connect($("infirm_btn_"+this.confirmationDialogUid),"onclick",this,(function(e){e.preventDefault();a.destroy();if(null!=n)if(this.confirmationDialogUid_called==this.confirmationDialogUid);else{this.confirmationDialogUid_called=this.confirmationDialogUid;n(o)}}))},warningDialog:function(t,i){var n=new ebg.popindialog;n.create("warning_dialog");n.setTitle(__("lang_mainsite","Warning notice"));var o="<div id='warning_dialog'>";o+=t;o+="<br/><br/><div style='text-align: center'>";o+="<a class='bgabutton bgabutton_blue' id='warning_btn' href='#'><span>"+__("lang_mainsite","Duly noted!")+"</span></a>";o+="</div></div>";n.setContent(o);n.show();e.connect($("warning_btn"),"onclick",this,(function(e){e.preventDefault();n.destroy();i()}))},infoDialog:function(t,n,o,a=!1){if(a)i.bgaConfirm({title:n,description:t,noButton:!1,yesButton:_("Ok")}).then(o);else{var s=new ebg.popindialog;s.create("info_dialog");s.setTitle(n);var r="<div id='info_dialog'>";r+=t;r+="<br/><br/><div style='text-align: center'>";r+="<a class='bgabutton bgabutton_blue' id='info_btn' href='#'><span>"+__("lang_mainsite","Ok")+"</span></a>";r+="</div></div>";s.setContent(r);s.show();e.connect($("info_btn"),"onclick",this,(function(e){e.preventDefault();s.destroy();void 0!==o&&o()}))}},multipleChoiceDialog:function(t,i,n){var o=new ebg.popindialog;o.create("multipleChoice_dialog");o.setTitle(t);var a="<div id='multipleChoice_dialog'>";a+="<br/><ul style='text-align:center'>";for(var s in i)a+="<li><a class='multiplechoice_btn bgabutton bgabutton_blue' id='choice_btn_"+s+"' href='#'><span>"+i[s]+"</span></a></li>";a+="</ul>";a+="<br/>";a+="</div>";o.setContent(a);o.show();e.query(".multiplechoice_btn").connect("onclick",this,(function(e){e.preventDefault();o.destroy();var t=e.currentTarget.id.substr(11);n(t)}))},askForValueDialog:function(t,i,n){var o=new ebg.popindialog;o.create("askforvalue_dialog");o.setTitle(t);void 0===n&&(n="");var a="<div id='askforvalue_dialog'>";a+="<p>"+n+"</p>";a+="<br/><input id='choicedlg_value' type='text' style='width:100%;height:30px'>";a+="<br/>";a+="<a class='bgabutton bgabutton_blue' id='ok_btn' href='#'><span>"+__("lang_mainsite","Ok")+"</span></a>";a+="</div>";o.setContent(a);o.show();$("choicedlg_value").focus();e.connect($("ok_btn"),"onclick",this,e.hitch(this,(function(t){e.stopEvent(t);o.destroy();var n=$("choicedlg_value").value;i(n)})))},displayScoring:function(t,i,n,o,a,s){void 0!==o&&null!=o||(o=1e3);var r=e.place(this.format_string('<div class="scorenumber">'+(n>=0?"+":"-")+"${score_number}</div>",{score_id:t,score_number:Math.abs(n)}),t);void 0!==a&&void 0!==s&&null!==a&&null!==s?this.placeOnObjectPos(r,t,a,s):this.placeOnObject(r,t);e.style(r,"color","#"+i);e.addClass(r,"scorenumber_anim");this.fadeOutAndDestroy(r,o,2e3)},showBubble:function(t,i,n,o,a){void 0===this.discussionTimeout&&(this.discussionTimeout={});void 0===n&&(n=0);void 0===o&&(o=3e3);n>0?setTimeout(e.hitch(this,(function(){this.doShowBubble(t,i,a)})),n):this.doShowBubble(t,i,a);if(this.discussionTimeout[t]){clearTimeout(this.discussionTimeout[t]);delete this.discussionTimeout[t]}""!=i&&(this.discussionTimeout[t]=setTimeout(e.hitch(this,(function(){this.doShowBubble(t,"")})),n+o))},doShowBubble:function(t,i,n){if(""==i){this.discussionTimeout[t]&&delete this.discussionTimeout[t];var o=e.fadeOut({node:"discussion_bubble_"+t,duration:100});e.connect(o,"onEnd",(function(){}));o.play()}else{if(!$("discussion_bubble_"+t)){var a=void 0===n?"":n;e.place('<div id="discussion_bubble_'+t+'" class="discussion_bubble '+a+'"></div>',t)}$("discussion_bubble_"+t).innerHTML=i;e.style("discussion_bubble_"+t,"display","block");e.style("discussion_bubble_"+t,"opacity",0);e.fadeIn({node:"discussion_bubble_"+t,duration:100}).play()}},showClick:function(t,i,n,o){void 0===o&&(o="red");void 0===this.showclick_circles_no?this.showclick_circles_no=0:this.showclick_circles_no++;e.place('<div id="showclick_circles_'+this.showclick_circles_no+'" class="concentric-circles" style="background-color:'+o+";left:"+i+"px;top:"+n+'px"></div>',t);var a=this.showclick_circles_no;setTimeout(e.hitch(this,(function(){e.destroy("showclick_circles_"+a)})),2200)},getRankString:function(e,t){if(null===e||""===e)return __("lang_mainsite","not ranked");var i="";1==(e=toint(e))?i=void 0!==t&&t?__("lang_mainsite","Winner"):__("lang_mainsite","1st"):2==e?i=void 0!==t&&t?__("lang_mainsite","Loser"):__("lang_mainsite","2nd"):3==e?i=void 0!==t&&t?__("lang_mainsite","Loser"):__("lang_mainsite","3rd"):e>3&&(i=void 0!==t&&t?__("lang_mainsite","Loser"):e+__("lang_mainsite","th"));return i},getKarmaLabel:function(e){return 100==(e=toint(e))?{label:_("Perfect"),css:"exceptional"}:e>=90?{label:_("Excellent"),css:"perfect"}:e>=80?{label:_("Very good"),css:"verygood"}:e>=75?{label:_("Good"),css:"good"}:e>=65?{label:_("Average"),css:"average"}:e>=50?{label:_("Not good"),css:"notgood"}:e>=25?{label:_("Bad"),css:"bad"}:e>=0?{label:_("Very bad"),css:"verybad"}:void 0},getObjectLength:function(e){var t=0;for(var i in e)t++;return t},getGameNameDisplayed:function(e){var t=__("lang_mainsite",e+"_displayed");return t==e+"_displayed"?e:t},formatReflexionTime:function(e){var t={string:"-- : --",mn:0,s:0,h:0,positive:!0},i=!0;if((e=Math.round(e))<0){e=-e;i=!1}var n=Math.floor(e/60),o=e-60*n;o<10&&(o="0"+o);var a=Math.floor(n/60),s=Math.floor(n/1440);n-=60*a;t.mn=n;t.s=o;t.h=a;t.positive=i;if(isNaN(n)||isNaN(o))t.string="-- : --";else if(0==a)t.string=i?n+":"+o:"-"+n+":"+o;else if(s<2){n<10&&(n="0"+n);t.string=i?a+"h"+n:"-"+a+"h"+n}else t.string=i?s+" "+__("lang_mainsite","days"):"-"+s+" "+__("lang_mainsite","days");return t},strip_tags:function(e,t){var i="",n=!1,o=[],a=[],s="",r=0,l="",d="",c=function(e,t,i){return i.split(e).join(t)};t&&(a=t.match(/([a-zA-Z0-9]+)/gi));o=(e+="").match(/(<\/?[\S][^>]*>)/gi);for(i in o)if(!isNaN(i)){d=o[i].toString();n=!1;for(l in a){s=a[l];(r=-1)&&(r=d.toLowerCase().indexOf("<"+s+">"));r||(r=d.toLowerCase().indexOf("<"+s+" "));r&&(r=d.toLowerCase().indexOf("</"+s));if(!r){n=!0;break}}n||(e=c(d,"",e))}return e},validURL:function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)},nl2br:function(e,t){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(t||void 0===t?"":"<br>")+"$2")},htmlentities:function(e,t,i,n){var o=this.get_html_translation_table("HTML_ENTITIES",t),a="";e=null==e?"":e+"";if(!o)return!1;t&&"ENT_QUOTES"===t&&(o["'"]="&#039;");if(n||null==n)for(a in o)o.hasOwnProperty(a)&&(e=e.split(a).join(o[a]));else e=e.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,(function(e,t,i){for(a in o)o.hasOwnProperty(a)&&(t=t.split(a).join(o[a]));return t+i}));return e},html_entity_decode:function(e,t){var i={},n="",o="",a="";o=e.toString();if(!1===(i=this.get_html_translation_table("HTML_ENTITIES",t)))return!1;delete i["&"];i["&"]="&amp;";for(n in i){a=i[n];o=o.split(a).join(n)}return o=o.split("&#039;").join("'")},get_html_translation_table:function(e,t){var i,n,o,a={},s={},r={},l={};r[0]="HTML_SPECIALCHARS";r[1]="HTML_ENTITIES";l[0]="ENT_NOQUOTES";l[2]="ENT_COMPAT";l[3]="ENT_QUOTES";n=isNaN(e)?e?e.toUpperCase():"HTML_SPECIALCHARS":r[e];o=isNaN(t)?t?t.toUpperCase():"ENT_COMPAT":l[t];if("HTML_SPECIALCHARS"!==n&&"HTML_ENTITIES"!==n)throw new Error("Table: "+n+" not supported");a[38]="&amp;";if("HTML_ENTITIES"===n){a[160]="&nbsp;";a[161]="&iexcl;";a[162]="&cent;";a[163]="&pound;";a[164]="&curren;";a[165]="&yen;";a[166]="&brvbar;";a[167]="&sect;";a[168]="&uml;";a[169]="&copy;";a[170]="&ordf;";a[171]="&laquo;";a[172]="&not;";a[173]="&shy;";a[174]="&reg;";a[175]="&macr;";a[176]="&deg;";a[177]="&plusmn;";a[178]="&sup2;";a[179]="&sup3;";a[180]="&acute;";a[181]="&micro;";a[182]="&para;";a[183]="&middot;";a[184]="&cedil;";a[185]="&sup1;";a[186]="&ordm;";a[187]="&raquo;";a[188]="&frac14;";a[189]="&frac12;";a[190]="&frac34;";a[191]="&iquest;";a[192]="&Agrave;";a[193]="&Aacute;";a[194]="&Acirc;";a[195]="&Atilde;";a[196]="&Auml;";a[197]="&Aring;";a[198]="&AElig;";a[199]="&Ccedil;";a[200]="&Egrave;";a[201]="&Eacute;";a[202]="&Ecirc;";a[203]="&Euml;";a[204]="&Igrave;";a[205]="&Iacute;";a[206]="&Icirc;";a[207]="&Iuml;";a[208]="&ETH;";a[209]="&Ntilde;";a[210]="&Ograve;";a[211]="&Oacute;";a[212]="&Ocirc;";a[213]="&Otilde;";a[214]="&Ouml;";a[215]="&times;";a[216]="&Oslash;";a[217]="&Ugrave;";a[218]="&Uacute;";a[219]="&Ucirc;";a[220]="&Uuml;";a[221]="&Yacute;";a[222]="&THORN;";a[223]="&szlig;";a[224]="&agrave;";a[225]="&aacute;";a[226]="&acirc;";a[227]="&atilde;";a[228]="&auml;";a[229]="&aring;";a[230]="&aelig;";a[231]="&ccedil;";a[232]="&egrave;";a[233]="&eacute;";a[234]="&ecirc;";a[235]="&euml;";a[236]="&igrave;";a[237]="&iacute;";a[238]="&icirc;";a[239]="&iuml;";a[240]="&eth;";a[241]="&ntilde;";a[242]="&ograve;";a[243]="&oacute;";a[244]="&ocirc;";a[245]="&otilde;";a[246]="&ouml;";a[247]="&divide;";a[248]="&oslash;";a[249]="&ugrave;";a[250]="&uacute;";a[251]="&ucirc;";a[252]="&uuml;";a[253]="&yacute;";a[254]="&thorn;";a[255]="&yuml;"}"ENT_NOQUOTES"!==o&&(a[34]="&quot;");"ENT_QUOTES"===o&&(a[39]="&#39;");a[60]="&lt;";a[62]="&gt;";for(i in a)a.hasOwnProperty(i)&&(s[String.fromCharCode(i)]=a[i]);return s},ucFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},setupWebPush:function(){null==this.webpush&&(this.webpush=new ebg.webpush(e.hitch(this,"ajaxcall")));return this.webpush.init()},refreshWebPushWorker:function(){null==this.webpush&&(this.webpush=new ebg.webpush(e.hitch(this,"ajaxcall")));this.webpush.isSupported()&&this.webpush.refresh()},getRTCTemplate:function(e,t,i){var n='<div id="rtc_container_${player_id}" class="rtc_container';if(!e&&!t)return n+'"></div>';t?n+=' rtc_video_container"><div id="videofeed_${player_id}_pulse"></div>'+(i?'<video id="videofeed_${player_id}" class="videofeed" autoplay ${muted}></video>':'<video id="videofeed_${player_id}" class="videofeed videoflipped" autoplay ${muted}></video>')+'<div id="videofeed_${player_id}_name" class="rtc_video_name"></div><div id="videofeed_${player_id}_min" class="rtc_video_control rtc_video_min"></div><div id="videofeed_${player_id}_size" class="rtc_video_control rtc_video_size"></div><div id="videofeed_${player_id}_cam" class="rtc_video_control rtc_video_cam rtc_video_cam_off"></div>':e&&(n+=' rtc_audio_container"><video id="videofeed_${player_id}" class="videofeed" autoplay ${muted}></video>');e&&(n+=i?'<div id="videofeed_${player_id}_spk" class="rtc_video_control rtc_video_spk rtc_video_spk_off"></div>':'<div id="videofeed_${player_id}_mic" class="rtc_video_control rtc_video_mic rtc_video_mic_off"></div>');return n+="</div>"},setupRTCEvents:function(t){var i="undefined"!=typeof current_player_id?current_player_id:this.player_id;if(!1!==this.mediaConstraints.video){e.connect($("rtc_container_"+t),"onclick",this,"onClickRTCVideoMax");e.connect($("videofeed_"+t+"_min"),"onclick",this,"onClickRTCVideoMin");e.connect($("videofeed_"+t+"_size"),"onclick",this,"onClickRTCVideoSize");e.connect($("videofeed_"+t+"_cam"),"onclick",this,"onClickRTCVideoCam");this.addTooltip("videofeed_"+t+"_min","",__("lang_mainsite","Minimize video"));this.addTooltip("videofeed_"+t+"_size","",__("lang_mainsite","Resize video"));t==i?this.addTooltip("videofeed_"+t+"_cam","",__("lang_mainsite","Mute/Unmute your video camera")):this.addTooltip("videofeed_"+t+"_cam","",__("lang_mainsite","Mute/Unmute video"));if($("player_name_"+t)){var n=e.getStyle("player_name_"+t,"color");e.setStyle("videofeed_"+t+"_pulse","borderColor",n);e.setStyle("rtc_container_"+t,"borderColor",n);e.setStyle("rtc_container_"+t,"boxShadow","0px 0px 3px "+n)}if($("player_name_"+t)){n=e.getStyle("player_name_"+t,"color");e.setStyle("videofeed_"+t+"_name","color",n);for(var o="",a=$("player_name_"+t),s=0;s<a.childNodes.length;++s)3===a.childNodes[s].nodeType&&(o+=a.childNodes[s].textContent);$("videofeed_"+t+"_name").innerHTML=o}if($("emblem_"+t)){o=e.getAttr($("emblem_"+t),"alt");$("videofeed_"+t+"_name").innerHTML=o}if(!e.hasClass("ebd-body","mobile_version")){(new ebg.draggable).create(this,"rtc_container_"+t)}}if(!1!==this.mediaConstraints.audio){if(null!=$("videofeed_"+t+"_mic")){e.connect($("videofeed_"+t+"_mic"),"onclick",this,"onClickRTCVideoMic");this.addTooltip("videofeed_"+t+"_mic","",__("lang_mainsite","Mute/Unmute your microphone"))}if(null!=$("videofeed_"+t+"_spk")){e.connect($("videofeed_"+t+"_spk"),"onclick",this,"onClickRTCVideoSpk");this.addTooltip("videofeed_"+t+"_spk","",__("lang_mainsite","Mute/Unmute audio"))}}},getRtcVideoConstraints:function(e){var t=!1;if(2===parseInt(e,10))t={mandatory:{minAspectRatio:1.333,maxAspectRatio:1.334,maxWidth:240,maxFrameRate:30},optional:[]};return t},startRTC:function(){!1===this.mediaConstraints.video&&!1===this.mediaConstraints.audio||require([g_themeurl+"js/webrtcadapter.js"],e.hitch(this,"doStartRTC"))},doStartRTC:function(){this.ajaxcall("/videochat/videochat/getRTCConfig.html",{},this,(function(t){var i="undefined"!=typeof current_player_id?current_player_id:this.player_id;if(null!==$("videofeed_"+i)){webrtcConfig.audioSendCodec="";webrtcConfig.audioReceiveCodec="opus/48000";var n=JSON.parse(JSON.stringify(webrtcConfig.pcConfig));void 0!==t.static_turn&&void 0!==t.static_turn.urls&&""!==t.static_turn.urls&&n.iceServers.push(t.static_turn);if(void 0!==t.dynamic_iceservers)try{dynamicConfig=JSON.parse(t.dynamic_iceservers);"ok"===dynamicConfig.s?n=dynamicConfig.v:alert("Error: failed to retrieve RTC ICE servers dynamic configuration")}catch(o){alert("Error: failed to parse RTC ICE servers dynamic configuration")}this.webrtc=new ebg.webrtc(i,this.room,n,webrtcConfig.pcConstraints,this.mediaConstraints,!1,e.hitch(this,"ajaxcall"),e.hitch(this,"onGetUserMediaSuccess"),e.hitch(this,"onGetUserMediaError"),e.hitch(this,"onJoinRoom"),e.hitch(this,"onLeaveRoomImmediate"));this.webrtc.setLocalFeed($("videofeed_"+i));null===this.webrtcmsg_ntf_handle&&(this.webrtcmsg_ntf_handle=e.subscribe("webrtcmsg",this,"ntf_webrtcmsg"))}}),(function(e){}))},onGetUserMediaSuccess:function(){if(null!==this.room){window.onbeforeunload=e.hitch(this,(function(e){null!==this.room&&this.doLeaveRoom()}));var t="undefined"!=typeof current_player_id?current_player_id:this.player_id;if(null!=$("videofeed_"+t+"_mic")){e.addClass($("videofeed_"+t+"_mic"),"rtc_video_mic_on");e.removeClass($("videofeed_"+t+"_mic"),"rtc_video_mic_off")}if(null!=$("videofeed_"+t+"_cam")){e.addClass($("videofeed_"+t+"_cam"),"rtc_video_cam_on");e.removeClass($("videofeed_"+t+"_cam"),"rtc_video_cam_off")}this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,(function(t){if(1==t.videochat_terms_accepted)if(t.already_in||t.joined)for(var i=0;i<t.in_room.length;i++){var n=t.in_room[i];this.onJoinRoom(n,!1)}else if(this.room===this.already_accepted_room)this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!0,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,(function(e){this.already_accepted_room=null;for(var t=0;t<e.in_room.length;t++){var i=e.in_room[t];this.onJoinRoom(i,!1)}}),(function(e){}));else{var o='<div  class="rtc_dialog"><br />';o+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up a video chat session for this table!"):__("lang_mainsite","A Premium user has set up a video chat session with you!"):this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up an audio chat session for this table!"):__("lang_mainsite","A Premium user has set up an audio chat session with you!"))+"</i></div><br /><br />";o+='<div style="text-align: center; font-weight: bold;">'+__("lang_mainsite","Do you want to join the call?")+"</div><br /><br />";this.room.indexOf("T")>=0&&(o+=__("lang_mainsite",'If you choose "no" then change your mind, just refresh the page (F5) to get this prompt again!'));o+="</div>";this.confirmationDialog(o,e.hitch(this,(function(){null!==this.room&&this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!0,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,(function(e){for(var t=0;t<e.in_room.length;t++){var i=e.in_room[t];this.onJoinRoom(i,!1)}}),(function(e){}))})),e.hitch(this,(function(){if(null!==this.room&&this.room.indexOf("T")>=0)this.doLeaveRoom();else if(null!==this.room&&this.room.indexOf("P")>=0){var e=this.room.substr(1).split("_"),t=e[0]==n?e[1]:e[0];this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:t},this,(function(e){this.doLeaveRoom()})):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:t},this,(function(e){this.doLeaveRoom()}))}})))}else{o='<div  class="rtc_dialog"><br />';o+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up a video chat session for this table!"):__("lang_mainsite","A Premium user has set up a video chat session with you!"):this.room.indexOf("T")>=0?__("lang_mainsite","A Premium user has set up an audio chat session for this table!"):__("lang_mainsite","A Premium user has set up an audio chat session with you!"))+"</i></div><br /><br />";o+="<b>"+__("lang_mainsite","You are about to enter a real time chat room on Board Game Arena for the first time.")+"</b><br /><br />";o+=__("lang_mainsite","Please note that any interaction between players in a real time chat room is private to and the sole responsability of those players.")+"<br /><br />";o+=__("lang_mainsite","Board Game Arena doesn't record real time chat activity, but you should be aware that any player in the chat room has the possibility to make such recordings. Thus, you shouldn't do or say anything that you wouldn't want on record (or on Youtube).")+"<br /><br />";o+=__("lang_mainsite","You should also be aware that real time chat, be it voice or video, consumes more bandwidth than classic web browsing. It is your responsability to monitor your usage and check that it matches your contract with your internet provider so as not to incur unexpected fees.")+"<br /><br />";o+="<b>"+__("lang_mainsite","By accepting to proceed, you state that you are an adult according to the laws of your country or that you received explicit permission to use this service from an adult legally responsible for you, and you recognise and attest that Board Game Arena won't be liable for any inconvenience or damage directly or indirectly linked to the use of this service.")+"</b>";o+="</div>";this.confirmationDialog(o,e.hitch(this,(function(){null!==this.room&&this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!0,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,(function(e){for(var t=0;t<e.in_room.length;t++){var i=e.in_room[t];this.onJoinRoom(i,!1)}}),(function(e){}))})),e.hitch(this,(function(){this.ajaxcall("/videochat/videochat/joinRoom.html",{room:this.room,accept:!1,lock:!1,audio:!1!==this.mediaConstraints.audio,video:!1!==this.mediaConstraints.video},this,(function(e){this.clearRTC()}),(function(e){}))})))}}),(function(e){}))}},onGetUserMediaError:function(){var e='<div class="rtc_dialog"><br />';e+="<b>"+__("lang_mainsite","Sorry, Board Game Arena failed to get access to your local camera/microphone...")+"</b><br /><br />";e+=__("lang_mainsite","If you denied authorisation by mistake, please refresh the page to start over.")+" ";e+=__("lang_mainsite","If that fails, you should check your browser permissions in your browser's <i>%s</i> local configuration.").replace("%s","")+"<br /><br />";e+=__("lang_mainsite","Otherwise, please check that your camera/microphone is correctly plugged in, and that you are using a WebRTC capable browser: ");e+='<a href="http://iswebrtcreadyyet.com/" target="_blank">http://iswebrtcreadyyet.com/</a>';e+="</div>";this.warningDialog(e,(function(){}))},onJoinRoom:function(t,i){null==this.webrtc||this.webrtc.isInRoom(t)||this.webrtc.addToRoom(t);if(this.webrtc.room.indexOf("T")>=0)if(null!==$("rtc_container_"+t)||null===$("emblem_"+t)&&null===$("rtc_placeholder_"+t)){if(null!=$("videofeed_"+t+"_mic")){e.addClass($("videofeed_"+t+"_mic"),"rtc_video_mic_off");e.removeClass($("videofeed_"+t+"_mic"),"rtc_video_mic_on")}if(null!=$("videofeed_"+t+"_cam")){e.addClass($("videofeed_"+t+"_cam"),"rtc_video_cam_off");e.removeClass($("videofeed_"+t+"_cam"),"rtc_video_cam_on")}}else{e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!0),{player_id:t,muted:""}),null!==$("rtc_placeholder_"+t)?$("rtc_placeholder_"+t):$("table_rtc_placeholder"));null!==$("emblem_"+t)&&this.placeOnObject($("rtc_container_"+t),$("emblem_"+t));this.setupRTCEvents(t);void 0!==this.gamedatas&&t==this.gamedatas.gamestate.active_player&&$("videofeed_"+t+"_pulse")&&e.addClass("videofeed_"+t+"_pulse","rtc_video_pulsating")}else if(this.webrtc.room.indexOf("P")>=0&&null==$("rtc_container_"+t)&&null!==$("chatwindowlogs_zone_privatechat_"+t)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!0),{player_id:t,muted:""}),$("chatwindowlogs_privatechat_"+t));if(this.mediaConstraints.video)e.addClass($("rtc_container_"+t),"rtc_video_container_privatechat");else if(this.mediaConstraints.audio){e.style($("rtc_container_"+t),"top","-13px");e.style($("rtc_container_"+t),"left","110px")}this.setupRTCEvents(t)}this.webrtc.maybeConnect(t,i);this.webrtc.isAudioMuted&&this.webrtc.toggleAudioMute()},onClickRTCVideoMax:function(t){e.stopEvent(t);var i=t.currentTarget,n=i.id.split("_")[2];this.maximizeRTCVideo(i,n)},maximizeRTCVideo:function(t,i){if(e.hasClass(t,"rtc_video_container")){e.addClass(t,"rtc_video_container_free");e.removeClass(t,"rtc_video_container");var n=e.hasClass(t,"rtc_video_container_privatechat");if(void 0!==n&&n){e.addClass(t,"rtc_video_container_free_privatechat");e.removeClass(t,"rtc_video_container_privatechat");o=e.marginBox("videofeed_"+i);e.style(t,"width",o.w+"px");e.style(t,"height",o.h+"px")}else{var o=e.marginBox("videofeed_"+i);e.style(t,"width",o.w+"px");e.style(t,"height",o.h+"px")}$("rtc_placeholder_"+i)?e.style("rtc_placeholder_"+i,"zIndex",497):$("rtc_container_"+i)&&e.style("rtc_container_"+i,"zIndex",497);(new ebg.resizable).create(this,"videofeed_"+i,"videofeed_"+i+"_size",!0,!1,!0)}},onClickRTCVideoMin:function(t){e.stopEvent(t);var i=t.currentTarget.parentNode,n=i.id.split("_")[2],o=e.hasClass($("rtc_container_"+n).parentNode,"chatwindowlogs"),a=e.hasClass(i,"rtc_video_container_free_privatechat");e.addClass(i,"rtc_video_container");e.removeClass(i,"rtc_video_container_free");e.style(i,"width","");e.style(i,"height","");e.style(i,"left","");e.style(i,"top","");e.style($("videofeed_"+n),"width","");e.style($("videofeed_"+n),"height","");if(null===$("emblem_"+n)||o||a){if(o&&!a){e.style($("rtc_container_"+n),"top","-6px");e.style($("rtc_container_"+n),"left","115px")}}else this.placeOnObject($("rtc_container_"+n),$("emblem_"+n));null!==$("rtc_placeholder_"+n)?e.style("rtc_placeholder_"+n,"zIndex",""):$("rtc_container_"+n)&&e.style("rtc_container_"+n,"zIndex","");if(a){e.addClass(i,"rtc_video_container_privatechat");e.removeClass(i,"rtc_video_container_free_privatechat")}},onClickRTCVideoSize:function(t){e.stopEvent(t)},onClickRTCVideoMic:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1];if(this.webrtc.toggleAudioMute(i)){e.addClass(t.currentTarget,"rtc_video_mic_off");e.removeClass(t.currentTarget,"rtc_video_mic_on")}else{e.addClass(t.currentTarget,"rtc_video_mic_on");e.removeClass(t.currentTarget,"rtc_video_mic_off")}},onClickRTCVideoSpk:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1];if(this.webrtc.toggleAudioMute(i)){e.addClass(t.currentTarget,"rtc_video_spk_off");e.removeClass(t.currentTarget,"rtc_video_spk_on")}else{e.addClass(t.currentTarget,"rtc_video_spk_on");e.removeClass(t.currentTarget,"rtc_video_spk_off")}},onClickRTCVideoCam:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_")[1];if(this.webrtc.toggleVideoMute(i)){e.addClass(t.currentTarget,"rtc_video_cam_off");e.removeClass(t.currentTarget,"rtc_video_cam_on")}else{e.addClass(t.currentTarget,"rtc_video_cam_on");e.removeClass(t.currentTarget,"rtc_video_cam_off")}},onLeaveRoom:function(t,i){if(null!=this.webrtc&&this.webrtc.isInRoom(t)){var n=$("rtc_container_"+t);if(!0===i)e.destroy(n);else{var o=e.fadeOut({node:n,duration:1e3,delay:500});e.connect(o,"onEnd",(function(t){e.destroy(t)}));o.play()}this.webrtc.removeFromRoom(t)}},onLeaveRoomImmediate:function(e){this.onLeaveRoom(e,!0)},doLeaveRoom:function(e){this.clearRTC();null!=this.room&&this.ajaxcall("/videochat/videochat/leaveRoom.html",{room:this.room,lock:!1},this,(function(t){this.room=null;this.rtc_mode=0;this.mediaConstraints={video:!1,audio:!1};void 0!==e&&e()}),(function(e){}))},clearRTC:function(){null!=this.webrtc&&this.webrtc.hangup();this.webrtc=null;e.unsubscribe(this.webrtcmsg_ntf_handle);this.webrtcmsg_ntf_handle=null;e.query(".rtc_container").forEach((function(t,i,n){e.destroy(t)}));e.query(".audiovideo_active").removeClass("audiovideo_active").addClass("audiovideo_inactive")},ntf_webrtcmsg:function(e){null!=this.webrtc&&void 0!==e.args.message&&this.webrtc.onMessageReceived(e.args)},addSmileyToText:function(e){var t=this.emoticons,i=[],n=/[[\]{}()*+?.\\|^$\-,&#\s]/g;for(var o in t)t.hasOwnProperty(o)&&i.push("(( +|^)"+o.replace(n,"\\$&")+"( +|$|\\s))");return(e=e.replace(new RegExp(i.join("|"),"g"),(function(e){var i=e.trim();return void 0!==t[i]?e.replace(i,'<div class="icon20_textalign"><div class="bgasmiley bgasmiley_'+t[i]+'"></div></div>'):e}))).replace(new RegExp(i.join("|"),"g"),(function(e){var i=e.trim();return void 0!==t[i]?e.replace(i,'<div class="icon20_textalign"><div class="bgasmiley bgasmiley_'+t[i]+'"></div></div>'):e}))},getSmileyClassToCodeTable:function(){var e={};for(var t in this.emoticons)void 0===e[this.emoticons[t]]&&(e[this.emoticons[t]]=t);return e},makeClickableLinks:function(e,t){void 0===t&&(t=!0);if(t){if(-1!=e.indexOf("boardgamearena.com")){var i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*boardgamearena\.com[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;return this.makeBgaLinksLocalLinks(e.replace(i,'<a class="bga-link" href="$1">$1</a>'))}return this.makeBgaLinksLocalLinks(e)}var n=["yucata.de","boiteajeux","tabletopia","happymeeple","dominion.games","wakan.pl","boardspace.net","brettspielwelt.de","littlegolem.net","vassalengine.org","interlude.games","game-park","playwithmeeps.com"],o=["hanab.live","hanabi.live","codenames.marplebot.com","longwave.web.app","setwithfriends.com","oneword.games","boredgames.gg","freeboardgames.org","colonist.io","turnhero.com","citadelsgame.herokuapp.com","berserk-games","tabletopsimulator.com"],a="normal";for(var s in n)-1!=e.toLowerCase().indexOf(n[s])&&(a="spam");for(var s in o)-1!=e.toLowerCase().indexOf(o[s])&&(a="spam_illegal");if("normal"==a){i=/((^|\s)\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;return this.makeBgaLinksLocalLinks(e.replace(i,'<a href="$1" class="bga-link" target="_blank">$1</a>'))}if("spam"==a)return this.makeBgaLinksLocalLinks(e);if("spam_illegal"==a){e+="\n"+_("WARNING: this service is not approved by game designers/publishers. We strongly discourage you to use it or to promote it on BGA. Thanks!");return this.makeBgaLinksLocalLinks(e)}},makeBgaLinksLocalLinks:function(e){return e=(e=(e=(e=(e=(e=e.replace("forum.boardgamearena.com","SAVE_FORUM_URL_FROM_LOCAL")).replace("doc.boardgamearena.com","SAVE_DOC_URL_FROM_LOCAL")).replace(/(https?):\/\/[-a-zA-Z.]*boardgamearena\.com\//gim,"/")).replace(/((https?):\/\/)[-a-zA-Z.]*.([0-9].boardgamearena\.com)/gim,"$1$3")).replace("SAVE_FORUM_URL_FROM_LOCAL","forum.boardgamearena.com")).replace("SAVE_DOC_URL_FROM_LOCAL","doc.boardgamearena.com")},ensureEbgObjectReinit:function(e){"object"==typeof e&&null!==e&&void 0!==e.destroy&&e.destroy()},getRankClassFromElo:function(e){return 1300==(e=parseFloat(e))?__("lang_mainsite","Beginner"):e<1400?__("lang_mainsite","Apprentice"):e<1500?__("lang_mainsite","Average"):e<1600?__("lang_mainsite","Good"):e<1800?__("lang_mainsite","Strong"):e<2e3?__("lang_mainsite","Expert"):__("lang_mainsite","Master")},getColorFromElo:function(e){return 1300==(e=parseFloat(e))||e<1400?"#74bed1":e<1500?"#84b8de":e<1600?"#94acd6":e<1800?"#9ba5d0":e<2e3?"#a99bc9":"#b593c4"},getRankClassFromEloUntranslated:function(e){return 1300==(e=parseFloat(e))?"beginner":e<1400?"apprentice":e<1500?"average":e<1600?"good":e<1800?"strong":e<2e3?"expert":"master"},eloToBarPercentage:function(e){return(e=parseFloat(e))<1400?(e-1300)/4:e>2100?100:Math.min(100,25+(e-1400)/600*75)},formatElo:function(e){return parseInt(Math.round(Math.max(0,parseFloat(e)-1300)))},formatEloDecimal:function(e){return Math.round(100*(e-1300))/100},getEloLabel:function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=!0);return i?'<div class="gamerank gamerank_'+this.getRankClassFromEloUntranslated(e)+(t?" gamerank_mini":"")+'"><span class="icon20 icon20_rankw'+(t?"mini":"")+'"></span> <span class="gamerank_value">'+this.formatElo(e)+"</span></div>":'<div class="gamerank gamerank_'+this.getRankClassFromEloUntranslated(e)+(t?" gamerank_mini":"")+'"><span class="icon20 icon20_rankw'+(t?"mini":"")+'"></span> <span class="gamerank_value">'+this.formatEloDecimal(e)+"</span></div>"},getArenaLabel:function(e,t){var i=this.arenaPointsDetails(e),n='<div class="myarena_league league_'+i.league+'">';if(5!=i.league)n+='<div class="arena_label">'+i.points+"</div>";else if(void 0!==t){n+='<div class="arena_label">'+t+"</div>";n+='<div class="arena_points">'+Math.round(i.arelo)+"</div>"}return n+="</div>"},insertParamIntoCurrentURL:function(e,t){e=escape(e);t=escape(t);var i=document.location.search.substr(1).split("&");if(""==i)document.location.search="?"+e+"="+t;else{for(var n,o=i.length;o--;)if((n=i[o].split("="))[0]==e){n[1]=t;i[o]=n.join("=");break}o<0&&(i[i.length]=[e,t].join("="));document.location.search=i.join("&")}},playerawardsCollapsedAlignement:function(){if(void 0===this.onresizePlayerAwardsEvent){this.onresizePlayerAwardsEvent=e.connect(window,"onresize",this,e.hitch(this,"playerawardsCollapsedAlignement"));e.query(".show_awards_details").connect("onclick",this,(function(t){e.stopEvent(t);for(var i=t.currentTarget.parentNode;null!==i&&!e.hasClass(i,"playerawards");)i=i.parentNode;if(null!==i){e.removeClass(i,"playerawards_collapsed");e.destroy(t.currentTarget)}}))}if(0==e.query(".playerawards_collapsed").length){if(void 0!==this.onresizePlayerAwardsEvent){e.disconnect(this.onresizePlayerAwardsEvent);delete this.onresizePlayerAwardsEvent}}else e.query(".playerawards_collapsed").forEach(e.hitch(this,"playerawardCollapsedAlignement"))},playerawardCollapsedAlignement:function(t){var i=-1,n=!1;""!=t.id&&e.query("#"+t.id+" .trophy_large").forEach(e.hitch(this,(function(t){var o=e.position(t);if(o.y!=i){n=!n;i=o.y}e.removeClass(t,"oddawardline evenawardline");e.addClass(t,n?"oddawardline":"evenawardline")})))},arenaPointsDetails:function(e,t){var i={0:__("lang_mainsite","Bronze league"),1:__("lang_mainsite","Silver league"),2:__("lang_mainsite","Gold league"),3:__("lang_mainsite","Platinum league"),4:__("lang_mainsite","Diamond league"),5:__("lang_mainsite","Elite league")},n={0:__("lang_mainsite","Bronze"),1:__("lang_mainsite","Silver"),2:__("lang_mainsite","Gold"),3:__("lang_mainsite","Platinum"),4:__("lang_mainsite","Diamond"),5:__("lang_mainsite","Elite")},o=toint(Math.floor(e/100)),a=toint(Math.floor(e%100)),s=e%1*1e4,r=void 0===i[o]?"Error: unknow league "+o:i[o],l=void 0===n[o]?"Error: unknow league "+o:n[o],d="?";if(void 0!==t){d=5==o?"":o>=t-2?n[5]:n[toint(o)+1]}null===d&&(d="?");null===r&&(r="?");null===l&&(l="?");return{league:o,league_name:r,league_shortname:l,league_promotion_shortname:d,points:a,arelo:s}},arenaPointsHtml:function(t){var i="",n="",o=(t.league_name,""),a="",s={0:10,1:10,2:10,3:10,4:10,5:0}[t.league];if(0==s){i+=Math.round(t.arelo)+" "+_("points");a=o=30+70*(Math.min(2100,Math.max(1200,t.arelo))-1200)/900;o="width:"+Math.round(o)+"%"}else{for(var r=Math.floor(100/s*100)/100,l=0;l<s;l++)l<t.points?i+='<div class="arena_point_wrap arena_point_wrap_'+l+'" style="width:'+r+'%"><div class="icon32 icon_arena arena_white"  style="opacity:0;"></div><div class="icon32 icon_arena arena_shadow"></div><div class="icon32 icon_arena arena_colored"></div></div>':i+='<div class="arena_point_wrap arena_point_wrap_'+l+'" style="width:'+r+'%"><div class="icon32 icon_arena arena_white"></div><div class="icon32 icon_arena arena_shadow" style="opacity:0;"></div><div class="icon32 icon_arena arena_colored" style="opacity:0;"></div></div>';var d=s-t.points;void 0!==t.league_promotion_shortname&&null!==t.league_promotion_shortname||(t.league_promotion_shortname="?");n=1==d?e.string.substitute(_("1 point to ${league}"),{points:d,league:t.league_promotion_shortname}).replace("1",'<span class="remain_arena_points">1</span>'):e.string.substitute(_("${points} points to ${league}"),{points:'<span class="remain_arena_points">'+d+"</span>",league:t.league_promotion_shortname})}return{bar_content:i,bottom_infos:n,bar_pcent:o,bar_pcent_number:a}}})}))},"ebg/core/common":function(){define(["dojo","dojo/date"],(function(e){getStaticAssetUrl=function(e){var t="./"+e;if(null===g_staticassets)return g_themeurl+e;var i=g_staticassets.find((function(e){return e.file==t}));return void 0!==i?g_themeurl.substr(0,g_themeurl.length-12)+i.version+"/"+e:g_themeurl+e};endnotif=function(){e.publish("notifEnd",null)};bga_format=function(e,t){for(const i in t){if(1!==i.length)continue;const n={"{":"}","[":"]","(":")"}[i]||i,o=e=>["-","[","]","{","}","(",")","*","+","?",".",",","\\","^","$","|","#"," "].includes(e)?"\\"+e:e,a=new RegExp(`${o(i)}(.*?)${o(n)}`,"g");let s=t[i];if("function"!=typeof s){const e=s;s=t=>`<span class="${e}">${t}</span>`}e=e.replace(a,((e,t)=>s(t)))}return e};time_format=function(e){if(e<60)return e+" mn";if(e<75)return"1h";if(e<105)return"1h30";var t=Math.round(e/60);if(t<24)return t+" h";var i=Math.round(t/24);if(1==i)return" "+__("lang_mainsite","one day");if(i<60)return i+" "+__("lang_mainsite","days");if(i<366){return Math.round(i/30.5)+" "+__("lang_mainsite","months")}var n=Math.round(i/365.25);return 1==n?__("lang_mainsite","one year"):n+" "+__("lang_mainsite","years")};time_ago_format=function(e){if(isNaN(e))return"";const t="zh"==dojoConfig.locale?"zh-tw":dojoConfig.locale;if(!Intl||!Intl.RelativeTimeFormat)return new Date(new Date-6e4*e).toLocaleString();const i=new Intl.RelativeTimeFormat(t,{style:"long"});if(e<60)return i.format(-1*e,"minute");if(e<75)return i.format(-1,"hour");if(e<105)return __("lang_mainsite","${hour}h${mn} ago").replace("${hour}","1").replace("${mn}","30");var n=Math.round(e/60);if(n<24)return i.format(-1*n,"hour");var o=Math.round(n/24);if(o<60)return i.format(-1*o,"day");if(o<366){var a=Math.round(o/30.5);return i.format(-1*a,"month")}var s=Math.round(o/365.25);return i.format(-1*s,"year")};date_format=function(t,i,n,o){var a=new Date,s=new Date(1e3*t);void 0===o&&(o=!1);var r=!1;"undefined"!=typeof globalUserInfos&&void 0!==globalUserInfos.date_use_iso&&(r=globalUserInfos.date_use_iso);var l="";o&&(l=" ("+mainsite.timezone.replace("_"," ")+")");var d=Math.abs(a.getTime()-s.getTime())/1e3,c=s.getTime()>=a.getTime();void 0===n&&(n=!1);if(n)return e.string.substitute(r?"${Y}-${M}-${D}":__("lang_mainsite","${M}/${D}/${Y}"),{M:zeroFill(s.getMonth()+1,2),D:zeroFill(s.getDate(),2),Y:1900+s.getYear()});if(d<3600){var h=Math.round(d/60);return c?e.string.substitute(__("lang_mainsite","in ${mn} min"),{mn:h}):e.string.substitute(__("lang_mainsite","${mn} min ago"),{mn:h})}if(d<14400){if(i){var u=Math.floor(d/3600);h=zeroFill(Math.round((d-3600*u)/60),2);return c?e.string.substitute(__("lang_mainsite","in ${hour}h${mn}"),{hour:u,mn:h}):e.string.substitute(__("lang_mainsite","${hour}h${mn} ago"),{hour:u,mn:h})}u=Math.round(d/3600);return c?1==u?__("lang_mainsite","in one hour"):e.string.substitute(__("lang_mainsite","in ${hour} hours"),{hour:u}):1==u?__("lang_mainsite","one hour ago"):e.string.substitute(__("lang_mainsite","${hour} hours ago"),{hour:u})}if(s.getYear()==a.getYear()&&s.getMonth()==a.getMonth()&&s.getDate()==a.getDate())return e.string.substitute(__("lang_mainsite","today at ${H}:${m}"),{H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l;var p=e.date.add(a,"day",1);if(s.getYear()==p.getYear()&&s.getMonth()==p.getMonth()&&s.getDate()==p.getDate())return e.string.substitute(__("lang_mainsite","tomorrow at ${H}:${m}"),{H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l;var m=e.date.add(a,"day",-1);return s.getYear()==m.getYear()&&s.getMonth()==m.getMonth()&&s.getDate()==m.getDate()?e.string.substitute(__("lang_mainsite","yesterday at ${H}:${m}"),{H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l:e.string.substitute(r?__("lang_mainsite","${Y}-${M}-${D} at ${H}:${m}"):__("lang_mainsite","${M}/${D}/${Y} at ${H}:${m}"),{M:zeroFill(s.getMonth()+1,2),D:zeroFill(s.getDate(),2),Y:1900+s.getYear(),H:zeroFill(s.getHours(),2),m:zeroFill(s.getMinutes(),2)})+l};date_format_simple=function(t){var i=new Date(1e3*t),n=!1;"undefined"!=typeof globalUserInfos&&void 0!==globalUserInfos.date_use_iso&&(n=globalUserInfos.date_use_iso);return e.string.substitute(n?__("lang_mainsite","${Y}-${M}-${D} at ${H}:${m}"):__("lang_mainsite","${M}/${D}/${Y} at ${H}:${m}"),{M:zeroFill(i.getMonth()+1,2),D:zeroFill(i.getDate(),2),Y:1900+i.getYear(),H:zeroFill(i.getHours(),2),m:zeroFill(i.getMinutes(),2)})};daytime_format=function(t){var i=new Date(1e3*t);return e.string.substitute("${H}:${m}",{H:zeroFill(i.getHours(),2),m:zeroFill(i.getMinutes(),2)})};isset=function(e){return void 0!==e};toint=function(e){return null===e?null:parseInt(e,10)};tofloat=function(e){return null===e?null:parseFloat(e)};zeroFill=function(e,t){return(t-=e.toString().length)>0?new Array(t+(/\./.test(e)?2:1)).join("0")+e:e};ucFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};format_number=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")};playSound=function(e){if(soundManager.flashMedia&&soundManager.flashMedia.doPlay&&"function"==typeof soundManager.flashMedia.doPlay){if(soundManager.bMuteSound)return;try{void 0!==soundManager.volume?soundManager.doPlay({id:e,volume:soundManager.volume}):soundManager.doPlay({id:e})}catch(t){}}soundManager.html5&&soundManager.doPlay({id:e})};playSoundFile=function(e){soundManager.html5&&soundManager.doPlayFile(e)};stopSound=function(e){if(soundManager.flashMedia&&soundManager.flashMedia.doPlay&&"function"==typeof soundManager.flashMedia.doPlay)try{soundManager.stop({id:e})}catch(t){}soundManager.html5&&soundManager.stop({id:e})};_=function(e){return"undefined"==typeof g_i18n?e:g_i18n.getSimpleTranslation(e)};__=function(e,t){return"undefined"==typeof g_i18n?t:g_i18n.getTranslation(e,t)};getLocationDescriptionFromResult=function(e){var t="";for(var i in e.address_components){""!=t&&(t+=", ");t+=e.address_components[i].long_name}return t};analyseLocationDescriptionFromResult=function(e){var t={city:"",area1:"",area2:"",country:""};for(var i in e.address_components)for(var n in e.address_components[i].types)"administrative_area_level_1"==e.address_components[i].types[n]?t.area1=e.address_components[i].long_name:"administrative_area_level_2"==e.address_components[i].types[n]?t.area2=e.address_components[i].long_name:"locality"==e.address_components[i].types[n]?t.city=e.address_components[i].long_name:"country"==e.address_components[i].types[n]&&(t.country=e.address_components[i].short_name);return t};id_to_path=function(e){return Math.floor(e/1e9)+"/"+Math.floor(e/1e6)+"/"+Math.floor(e/1e3)};playerDeviceToIcon=function(e){return"desktop"==e?"circle":"tablet"==e?"tablet":"mobile"};jzTimezoneDetector={};jzTimezoneDetector.HEMISPHERE_SOUTH="SOUTH";jzTimezoneDetector.HEMISPHERE_NORTH="NORTH";jzTimezoneDetector.HEMISPHERE_UNKNOWN="N/A";jzTimezoneDetector.olson={};jzTimezoneDetector.TimeZone=function(e,t,i){this.utc_offset=e;this.olson_tz=t;this.uses_dst=i};jzTimezoneDetector.TimeZone.prototype.display=function(){this.ambiguity_check();var e="<b>UTC-offset</b>: "+this.utc_offset+"<br/>";e+="<b>Zoneinfo key</b>: "+this.olson_tz+"<br/>";return e+="<b>Zone uses DST</b>: "+(this.uses_dst?"yes":"no")+"<br/>"};jzTimezoneDetector.TimeZone.prototype.ambiguity_check=function(){var e=jzTimezoneDetector.olson.ambiguity_list[this.olson_tz];if(void 0!==e)for(var t=e.length,i=0;i<t;i++){var n=e[i];if(jzTimezoneDetector.date_is_dst(jzTimezoneDetector.olson.dst_start_dates[n])){this.olson_tz=n;return}}};jzTimezoneDetector.date_is_dst=function(e){var t=e.getMonth()>5?jzTimezoneDetector.get_june_offset():jzTimezoneDetector.get_january_offset(),i=jzTimezoneDetector.get_date_offset(e);return 0!==toint(t-i)};jzTimezoneDetector.get_date_offset=function(e){return-e.getTimezoneOffset()};jzTimezoneDetector.get_timezone_info=function(){var e=jzTimezoneDetector.get_january_offset(),t=jzTimezoneDetector.get_june_offset(),i=e-t;return i<0?{utc_offset:e,dst:1,hemisphere:jzTimezoneDetector.HEMISPHERE_NORTH}:i>0?{utc_offset:t,dst:1,hemisphere:jzTimezoneDetector.HEMISPHERE_SOUTH}:{utc_offset:e,dst:0,hemisphere:jzTimezoneDetector.HEMISPHERE_UNKNOWN}};jzTimezoneDetector.get_january_offset=function(){return jzTimezoneDetector.get_date_offset(new Date(2011,0,1,0,0,0,0))};jzTimezoneDetector.get_june_offset=function(){return jzTimezoneDetector.get_date_offset(new Date(2011,5,1,0,0,0,0))};jzTimezoneDetector.determine_timezone=function(){var e=jzTimezoneDetector.get_timezone_info(),t="";e.hemisphere==jzTimezoneDetector.HEMISPHERE_SOUTH&&(t=",s");var i=e.utc_offset+","+e.dst+t;return{timezone:jzTimezoneDetector.olson.timezones[i],key:i}};jzTimezoneDetector.olson.timezones={"-720,0":new jzTimezoneDetector.TimeZone("-12:00","Etc/GMT+12",!1),"-660,0":new jzTimezoneDetector.TimeZone("-11:00","Pacific/Pago_Pago",!1),"-600,1":new jzTimezoneDetector.TimeZone("-11:00","America/Adak",!0),"-660,1,s":new jzTimezoneDetector.TimeZone("-11:00","Pacific/Apia",!0),"-600,0":new jzTimezoneDetector.TimeZone("-10:00","Pacific/Honolulu",!1),"-570,0":new jzTimezoneDetector.TimeZone("-10:30","Pacific/Marquesas",!1),"-540,0":new jzTimezoneDetector.TimeZone("-09:00","Pacific/Gambier",!1),"-540,1":new jzTimezoneDetector.TimeZone("-09:00","America/Anchorage",!0),"-480,1":new jzTimezoneDetector.TimeZone("-08:00","America/Los_Angeles",!0),"-480,0":new jzTimezoneDetector.TimeZone("-08:00","Pacific/Pitcairn",!1),"-420,0":new jzTimezoneDetector.TimeZone("-07:00","America/Phoenix",!1),"-420,1":new jzTimezoneDetector.TimeZone("-07:00","America/Denver",!0),"-360,0":new jzTimezoneDetector.TimeZone("-06:00","America/Guatemala",!1),"-360,1":new jzTimezoneDetector.TimeZone("-06:00","America/Chicago",!0),"-360,1,s":new jzTimezoneDetector.TimeZone("-06:00","Pacific/Easter",!0),"-300,0":new jzTimezoneDetector.TimeZone("-05:00","America/Bogota",!1),"-300,1":new jzTimezoneDetector.TimeZone("-05:00","America/New_York",!0),"-270,0":new jzTimezoneDetector.TimeZone("-04:30","America/Caracas",!1),"-240,1":new jzTimezoneDetector.TimeZone("-04:00","America/Halifax",!0),"-240,0":new jzTimezoneDetector.TimeZone("-04:00","America/Santo_Domingo",!1),"-240,1,s":new jzTimezoneDetector.TimeZone("-04:00","America/Asuncion",!0),"-210,1":new jzTimezoneDetector.TimeZone("-03:30","America/St_Johns",!0),"-180,1":new jzTimezoneDetector.TimeZone("-03:00","America/Godthab",!0),"-180,0":new jzTimezoneDetector.TimeZone("-03:00","America/Argentina/Buenos_Aires",!1),"-180,1,s":new jzTimezoneDetector.TimeZone("-03:00","America/Montevideo",!0),"-120,0":new jzTimezoneDetector.TimeZone("-02:00","America/Noronha",!1),"-120,1":new jzTimezoneDetector.TimeZone("-02:00","Etc/GMT+2",!0),"-60,1":new jzTimezoneDetector.TimeZone("-01:00","Atlantic/Azores",!0),"-60,0":new jzTimezoneDetector.TimeZone("-01:00","Atlantic/Cape_Verde",!1),"0,0":new jzTimezoneDetector.TimeZone("00:00","Etc/UTC",!1),"0,1":new jzTimezoneDetector.TimeZone("00:00","Europe/London",!0),"60,1":new jzTimezoneDetector.TimeZone("+01:00","Europe/Berlin",!0),"60,0":new jzTimezoneDetector.TimeZone("+01:00","Africa/Lagos",!1),"60,1,s":new jzTimezoneDetector.TimeZone("+01:00","Africa/Windhoek",!0),"120,1":new jzTimezoneDetector.TimeZone("+02:00","Asia/Beirut",!0),"120,0":new jzTimezoneDetector.TimeZone("+02:00","Africa/Johannesburg",!1),"180,1":new jzTimezoneDetector.TimeZone("+03:00","Europe/Moscow",!0),"180,0":new jzTimezoneDetector.TimeZone("+03:00","Asia/Baghdad",!1),"210,1":new jzTimezoneDetector.TimeZone("+03:30","Asia/Tehran",!0),"240,0":new jzTimezoneDetector.TimeZone("+04:00","Asia/Dubai",!1),"240,1":new jzTimezoneDetector.TimeZone("+04:00","Asia/Yerevan",!0),"270,0":new jzTimezoneDetector.TimeZone("+04:30","Asia/Kabul",!1),"300,1":new jzTimezoneDetector.TimeZone("+05:00","Asia/Yekaterinburg",!0),"300,0":new jzTimezoneDetector.TimeZone("+05:00","Asia/Karachi",!1),"330,0":new jzTimezoneDetector.TimeZone("+05:30","Asia/Kolkata",!1),"345,0":new jzTimezoneDetector.TimeZone("+05:45","Asia/Kathmandu",!1),"360,0":new jzTimezoneDetector.TimeZone("+06:00","Asia/Dhaka",!1),"360,1":new jzTimezoneDetector.TimeZone("+06:00","Asia/Omsk",!0),"390,0":new jzTimezoneDetector.TimeZone("+06:30","Asia/Rangoon",!1),"420,1":new jzTimezoneDetector.TimeZone("+07:00","Asia/Krasnoyarsk",!0),"420,0":new jzTimezoneDetector.TimeZone("+07:00","Asia/Jakarta",!1),"480,0":new jzTimezoneDetector.TimeZone("+08:00","Asia/Shanghai",!1),"480,1":new jzTimezoneDetector.TimeZone("+08:00","Asia/Irkutsk",!0),"525,0":new jzTimezoneDetector.TimeZone("+08:45","Australia/Eucla",!0),"525,1,s":new jzTimezoneDetector.TimeZone("+08:45","Australia/Eucla",!0),"540,1":new jzTimezoneDetector.TimeZone("+09:00","Asia/Yakutsk",!0),"540,0":new jzTimezoneDetector.TimeZone("+09:00","Asia/Tokyo",!1),"570,0":new jzTimezoneDetector.TimeZone("+09:30","Australia/Darwin",!1),"570,1,s":new jzTimezoneDetector.TimeZone("+09:30","Australia/Adelaide",!0),"600,0":new jzTimezoneDetector.TimeZone("+10:00","Australia/Brisbane",!1),"600,1":new jzTimezoneDetector.TimeZone("+10:00","Asia/Vladivostok",!0),"600,1,s":new jzTimezoneDetector.TimeZone("+10:00","Australia/Sydney",!0),"630,1,s":new jzTimezoneDetector.TimeZone("+10:30","Australia/Lord_Howe",!0),"660,1":new jzTimezoneDetector.TimeZone("+11:00","Asia/Kamchatka",!0),"660,0":new jzTimezoneDetector.TimeZone("+11:00","Pacific/Noumea",!1),"690,0":new jzTimezoneDetector.TimeZone("+11:30","Pacific/Norfolk",!1),"720,1,s":new jzTimezoneDetector.TimeZone("+12:00","Pacific/Auckland",!0),"720,0":new jzTimezoneDetector.TimeZone("+12:00","Pacific/Tarawa",!1),"765,1,s":new jzTimezoneDetector.TimeZone("+12:45","Pacific/Chatham",!0),"780,0":new jzTimezoneDetector.TimeZone("+13:00","Pacific/Tongatapu",!1),"840,0":new jzTimezoneDetector.TimeZone("+14:00","Pacific/Kiritimati",!1)};jzTimezoneDetector.olson.dst_start_dates={"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"Atlantic/Stanley":new Date(2011,8,4,7,0,0,0),"America/Asuncion":new Date(2011,9,2,3,0,0,0),"America/Santiago":new Date(2011,9,9,3,0,0,0),"America/Campo_Grande":new Date(2011,9,16,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2011,2,13,2,0,0,0),"America/New_York":new Date(2011,2,13,7,0,0,0),"Asia/Gaza":new Date(2011,2,26,23,0,0,0),"Asia/Beirut":new Date(2011,2,27,1,0,0,0),"Europe/Minsk":new Date(2011,2,27,3,0,0,0),"Europe/Istanbul":new Date(2011,2,27,7,0,0,0),"Asia/Damascus":new Date(2011,3,1,2,0,0,0),"Asia/Jerusalem":new Date(2011,3,1,6,0,0,0),"Africa/Cairo":new Date(2011,3,29,4,0,0,0),"Asia/Yerevan":new Date(2011,2,27,4,0,0,0),"Asia/Baku":new Date(2011,2,27,8,0,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"Pacific/Fiji":new Date(2010,11,29,23,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0)};jzTimezoneDetector.olson.ambiguity_list={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Asuncion":["Atlantic/Stanley","America/Asuncion","America/Santiago","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Gaza","Asia/Beirut","Europe/Minsk","Europe/Istanbul","Asia/Damascus","Asia/Jerusalem","Africa/Cairo"],"Asia/Yerevan":["Asia/Yerevan","Asia/Baku"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"]};return{}}));setCaretPosition=function(e,t){if(e.setSelectionRange){e.focus();e.setSelectionRange(t,t)}else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}};playerDeviceToIcon=function(e){return"desktop"==e?"circle":"tablet"==e?"tablet":"mobile"};replaceAll=function(e,t,i){var n=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return e.replace(new RegExp(n,"g"),i)};array_unique=function(e){var t={};return e.filter((function(e){return!t.hasOwnProperty(e)&&(t[e]=!0)}))};extractDomain=function(e){return e.indexOf("://")>-1?e.split("/")[0]+"/"+e.split("/")[1]+"/"+e.split("/")[2]:e.split("/")[0]};cookieConsentInit=function(){!function(e){if(!e.hasInitialised){var t={escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},hasClass:function(e,t){var i=" ";return 1===e.nodeType&&(i+e.className+i).replace(/[\n\t]/g,i).indexOf(i+t+i)>=0},addClass:function(e,t){e.className+=" "+t},removeClass:function(e,t){var i=new RegExp("\\b"+this.escapeRegExp(t)+"\\b");e.className=e.className.replace(i,"")},interpolateString:function(e,t){return e.replace(/{{([a-z][a-z0-9\-_]*)}}/gi,(function(e){return t(arguments[1])||""}))},getCookie:function(e){var t=("; "+document.cookie).split("; "+e+"=");return 2!=t.length?void 0:t.pop().split(";").shift()},setCookie:function(e,t,i,n,o){var a=new Date;a.setDate(a.getDate()+(i||365));var s=[e+"="+t,"expires="+a.toUTCString(),"path="+(o||"/")];n&&s.push("domain="+n),document.cookie=s.join(";")},deepExtend:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(i in e&&this.isPlainObject(e[i])&&this.isPlainObject(t[i])?this.deepExtend(e[i],t[i]):e[i]=t[i]);return e},throttle:function(e,t){var i=!1;return function(){i||(e.apply(this,arguments),i=!0,setTimeout((function(){i=!1}),t))}},hash:function(e){var t,i,n=0;if(0===e.length)return n;for(t=0,i=e.length;t<i;++t)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n},normaliseHex:function(e){return"#"==e[0]&&(e=e.substr(1)),3==e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),e},getContrast:function(e){e=this.normaliseHex(e);return(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=128?"#000":"#fff"},getLuminance:function(e){var t=parseInt(this.normaliseHex(e),16),i=38+(t>>16),n=38+(t>>8&255),o=38+(255&t);return"#"+(16777216+65536*(i<255?i<1?0:i:255)+256*(n<255?n<1?0:n:255)+(o<255?o<1?0:o:255)).toString(16).slice(1)},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isPlainObject:function(e){return"object"==typeof e&&null!==e&&e.constructor==Object}};e.status={deny:"deny",allow:"allow",dismiss:"dismiss"},e.transitionEnd=function(){var e=document.createElement("div"),t={t:"transitionend",OT:"oTransitionEnd",msT:"MSTransitionEnd",MozT:"transitionend",WebkitT:"webkitTransitionEnd"};for(var i in t)if(t.hasOwnProperty(i)&&void 0!==e.style[i+"ransition"])return t[i];return""}(),e.hasTransition=!!e.transitionEnd;var i=Object.keys(e.status).map(t.escapeRegExp);e.customStyles={},e.Popup=function(){function n(){this.initialise.apply(this,arguments)}function o(e){this.openingTimeout=null,t.removeClass(e,"cc-invisible")}function a(t){t.style.display="none",t.removeEventListener(e.transitionEnd,this.afterTransition),this.afterTransition=null}function s(){var t=this.options.onInitialise.bind(this);if(!window.navigator.cookieEnabled)return t(e.status.deny),!0;if(window.CookiesOK||window.navigator.CookiesOK)return t(e.status.allow),!0;var i=Object.keys(e.status),n=this.getStatus(),o=i.indexOf(n)>=0;return o&&t(n),o}function r(){var e=this.options.position.split("-"),t=[];return e.forEach((function(e){t.push("cc-"+e)})),t}function l(){var e=this.options,i="top"==e.position||"bottom"==e.position?"banner":"floating";t.isMobile()&&(i="floating");var n=["cc-"+i,"cc-type-"+e.type,"cc-theme-"+e.theme];e.static&&n.push("cc-static"),n.push.apply(n,r.call(this));u.call(this,this.options.palette);return this.customStyleSelector&&n.push(this.customStyleSelector),n}function d(){var e={},i=this.options;i.showLink||(i.elements.link="",i.elements.messagelink=i.elements.message),Object.keys(i.elements).forEach((function(n){e[n]=t.interpolateString(i.elements[n],(function(e){var t=i.content[e];return e&&"string"==typeof t&&t.length?t:""}))}));var n=i.compliance[i.type];n||(n=i.compliance.info),e.compliance=t.interpolateString(n,(function(t){return e[t]}));var o=i.layouts[i.layout];return o||(o=i.layouts.basic),t.interpolateString(o,(function(t){return e[t]}))}function c(i){var n=this.options,o=document.createElement("div"),a=n.container&&1===n.container.nodeType?n.container:document.body;o.innerHTML=i;var s=o.children[0];return s.style.display="none",t.hasClass(s,"cc-window")&&e.hasTransition&&t.addClass(s,"cc-invisible"),this.onButtonClick=h.bind(this),s.addEventListener("click",this.onButtonClick),n.autoAttach&&(a.firstChild?a.insertBefore(s,a.firstChild):a.appendChild(s)),s}function h(n){var o=n.target;if(t.hasClass(o,"cc-btn")){var a=o.className.match(new RegExp("\\bcc-("+i.join("|")+")\\b")),s=a&&a[1]||!1;s&&(this.setStatus(s),this.close(!0))}t.hasClass(o,"cc-close")&&(this.setStatus(e.status.dismiss),this.close(!0)),t.hasClass(o,"cc-revoke")&&this.revokeChoice()}function u(e){var i=t.hash(JSON.stringify(e)),n="cc-color-override-"+i,o=t.isPlainObject(e);return this.customStyleSelector=o?n:null,o&&p(i,e,"."+n),o}function p(i,n,o){if(e.customStyles[i])++e.customStyles[i].references;else{var a={},s=n.popup,r=n.button,l=n.highlight;s&&(s.text=s.text?s.text:t.getContrast(s.background),s.link=s.link?s.link:s.text,a[o+".cc-window"]=["color: "+s.text,"background-color: "+s.background],a[o+".cc-revoke"]=["color: "+s.text,"background-color: "+s.background],a[o+" .cc-link,"+o+" .cc-link:active,"+o+" .cc-link:visited"]=["color: "+s.link],r&&(r.text=r.text?r.text:t.getContrast(r.background),r.border=r.border?r.border:"transparent",a[o+" .cc-btn"]=["color: "+r.text,"border-color: "+r.border,"background-color: "+r.background],"transparent"!=r.background&&(a[o+" .cc-btn:hover, "+o+" .cc-btn:focus"]=["background-color: "+m(r.background)]),l?(l.text=l.text?l.text:t.getContrast(l.background),l.border=l.border?l.border:"transparent",a[o+" .cc-highlight .cc-btn:first-child"]=["color: "+l.text,"border-color: "+l.border,"background-color: "+l.background]):a[o+" .cc-highlight .cc-btn:first-child"]=["color: "+s.text]));var d=document.createElement("style");document.head.appendChild(d),e.customStyles[i]={references:1,element:d.sheet};var c=-1;for(var h in a)a.hasOwnProperty(h)&&d.sheet.insertRule(h+"{"+a[h].join(";")+"}",++c)}}function m(e){return"000000"==(e=t.normaliseHex(e))?"#222":t.getLuminance(e)}function g(e,t){for(var i=0,n=e.length;i<n;++i){var o=e[i];if(o instanceof RegExp&&o.test(t)||"string"==typeof o&&o.length&&o===t)return!0}return!1}function _(){var t=this.setStatus.bind(this),i=this.options.dismissOnTimeout;"number"==typeof i&&i>=0&&(this.dismissTimeout=window.setTimeout((function(){t(e.status.dismiss)}),Math.floor(i)));var n=this.options.dismissOnScroll;if("number"==typeof n&&n>=0){var o=function(i){window.pageYOffset>Math.floor(n)&&(t(e.status.dismiss),window.removeEventListener("scroll",o),this.onWindowScroll=null)};this.onWindowScroll=o,window.addEventListener("scroll",o)}}function f(){if("info"!=this.options.type&&(this.options.revokable=!0),t.isMobile()&&(this.options.animateRevokable=!1),this.options.revokable){var e=r.call(this);this.options.animateRevokable&&e.push("cc-animate"),this.customStyleSelector&&e.push(this.customStyleSelector);var i=this.options.revokeBtn.replace("{{classes}}",e.join(" "));this.revokeBtn=c.call(this,i);var n=this.revokeBtn;if(this.options.animateRevokable){var o=t.throttle((function(e){var i=!1,o=window.innerHeight-20;t.hasClass(n,"cc-top")&&e.clientY<20&&(i=!0),t.hasClass(n,"cc-bottom")&&e.clientY>o&&(i=!0),i?t.hasClass(n,"cc-active")||t.addClass(n,"cc-active"):t.hasClass(n,"cc-active")&&t.removeClass(n,"cc-active")}),200);this.onMouseMove=o,window.addEventListener("mousemove",o)}}}var v={enabled:!0,container:null,cookie:{name:"cookieconsent_status",path:"/",domain:"",expiryDays:365},onPopupOpen:function(){},onPopupClose:function(){},onInitialise:function(e){},onStatusChange:function(e,t){},onRevokeChoice:function(){},content:{header:"Cookies used on the website!",message:"This website uses cookies to ensure you get the best experience on our website.",dismiss:"Got it!",allow:"Allow cookies",deny:"Decline",link:"Learn more",href:"http://cookiesandyou.com",close:"&#x274c;"},elements:{header:'<span class="cc-header">{{header}}</span>&nbsp;',message:'<span id="cookieconsent:desc" class="cc-message">{{message}}</span>',messagelink:'<span id="cookieconsent:desc" class="cc-message">{{message}} <a aria-label="learn more about cookies" role=button tabindex="0" class="cc-link" href="{{href}}" target="_blank">{{link}}</a></span>',dismiss:'<a aria-label="dismiss cookie message" role=button tabindex="0" class="cc-btn cc-dismiss">{{dismiss}}</a>',allow:'<a aria-label="allow cookies" role=button tabindex="0"  class="cc-btn cc-allow">{{allow}}</a>',deny:'<a aria-label="deny cookies" role=button tabindex="0" class="cc-btn cc-deny">{{deny}}</a>',link:'<a aria-label="learn more about cookies" role=button tabindex="0" class="cc-link" href="{{href}}" target="_blank">{{link}}</a>',close:'<span aria-label="dismiss cookie message" role=button tabindex="0" class="cc-close">{{close}}</span>'},window:'<div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window {{classes}}">\x3c!--googleoff: all--\x3e{{children}}\x3c!--googleon: all--\x3e</div>',revokeBtn:'<div class="cc-revoke {{classes}}">Cookie Policy</div>',compliance:{info:'<div class="cc-compliance">{{dismiss}}</div>',"opt-in":'<div class="cc-compliance cc-highlight">{{dismiss}}{{allow}}</div>',"opt-out":'<div class="cc-compliance cc-highlight">{{deny}}{{dismiss}}</div>'},type:"info",layouts:{basic:"{{messagelink}}{{compliance}}","basic-close":"{{messagelink}}{{compliance}}{{close}}","basic-header":"{{header}}{{message}}{{link}}{{compliance}}"},layout:"basic",position:"bottom",theme:"block",static:!1,palette:null,revokable:!1,animateRevokable:!0,showLink:!0,dismissOnScroll:!1,dismissOnTimeout:!1,autoOpen:!0,autoAttach:!0,whitelistPage:[],blacklistPage:[],overrideHTML:null};return n.prototype.initialise=function(e){this.options&&this.destroy(),t.deepExtend(this.options={},v),t.isPlainObject(e)&&t.deepExtend(this.options,e),s.call(this)&&(this.options.enabled=!1),g(this.options.blacklistPage,location.pathname)&&(this.options.enabled=!1),g(this.options.whitelistPage,location.pathname)&&(this.options.enabled=!0);var i=this.options.window.replace("{{classes}}",l.call(this).join(" ")).replace("{{children}}",d.call(this)),n=this.options.overrideHTML;if("string"==typeof n&&n.length&&(i=n),this.options.static){var o=c.call(this,'<div class="cc-grower">'+i+"</div>");o.style.display="",this.element=o.firstChild,this.element.style.display="none",t.addClass(this.element,"cc-invisible")}else this.element=c.call(this,i);_.call(this),f.call(this),this.options.autoOpen&&this.autoOpen()},n.prototype.destroy=function(){this.onButtonClick&&this.element&&(this.element.removeEventListener("click",this.onButtonClick),this.onButtonClick=null),this.dismissTimeout&&(clearTimeout(this.dismissTimeout),this.dismissTimeout=null),this.onWindowScroll&&(window.removeEventListener("scroll",this.onWindowScroll),this.onWindowScroll=null),this.onMouseMove&&(window.removeEventListener("mousemove",this.onMouseMove),this.onMouseMove=null),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.revokeBtn&&this.revokeBtn.parentNode&&this.revokeBtn.parentNode.removeChild(this.revokeBtn),this.revokeBtn=null,function(i){if(t.isPlainObject(i)){var n=t.hash(JSON.stringify(i)),o=e.customStyles[n];if(o&&!--o.references){var a=o.element.ownerNode;a&&a.parentNode&&a.parentNode.removeChild(a),e.customStyles[n]=null}}}(this.options.palette),this.options=null},n.prototype.open=function(t){if(this.element)return this.isOpen()||(e.hasTransition?this.fadeIn():this.element.style.display="",this.options.revokable&&this.toggleRevokeButton(),this.options.onPopupOpen.call(this)),this},n.prototype.close=function(t){if(this.element)return this.isOpen()&&(e.hasTransition?this.fadeOut():this.element.style.display="none",t&&this.options.revokable&&this.toggleRevokeButton(!0),this.options.onPopupClose.call(this)),this},n.prototype.fadeIn=function(){var i=this.element;if(e.hasTransition&&i&&(this.afterTransition&&a.call(this,i),t.hasClass(i,"cc-invisible"))){if(i.style.display="",this.options.static){var n=this.element.clientHeight;this.element.parentNode.style.maxHeight=n+"px"}this.openingTimeout=setTimeout(o.bind(this,i),20)}},n.prototype.fadeOut=function(){var i=this.element;e.hasTransition&&i&&(this.openingTimeout&&(clearTimeout(this.openingTimeout),o.bind(this,i)),t.hasClass(i,"cc-invisible")||(this.options.static&&(this.element.parentNode.style.maxHeight=""),this.afterTransition=a.bind(this,i),i.addEventListener(e.transitionEnd,this.afterTransition),t.addClass(i,"cc-invisible")))},n.prototype.isOpen=function(){return this.element&&""==this.element.style.display&&(!e.hasTransition||!t.hasClass(this.element,"cc-invisible"))},n.prototype.toggleRevokeButton=function(e){this.revokeBtn&&(this.revokeBtn.style.display=e?"":"none")},n.prototype.revokeChoice=function(e){this.options.enabled=!0,this.clearStatus(),this.options.onRevokeChoice.call(this),e||this.autoOpen()},n.prototype.hasAnswered=function(t){return Object.keys(e.status).indexOf(this.getStatus())>=0},n.prototype.hasConsented=function(t){var i=this.getStatus();return i==e.status.allow||i==e.status.dismiss},n.prototype.autoOpen=function(e){!this.hasAnswered()&&this.options.enabled&&this.open()},n.prototype.setStatus=function(i){var n=this.options.cookie,o=t.getCookie(n.name),a=Object.keys(e.status).indexOf(o)>=0;Object.keys(e.status).indexOf(i)>=0?(t.setCookie(n.name,i,n.expiryDays,n.domain,n.path),this.options.onStatusChange.call(this,i,a)):this.clearStatus()},n.prototype.getStatus=function(){return t.getCookie(this.options.cookie.name)},n.prototype.clearStatus=function(){var e=this.options.cookie;t.setCookie(e.name,"",-1,e.domain,e.path)},n}(),e.Location=function(){function e(e){t.deepExtend(this.options={},a),t.isPlainObject(e)&&t.deepExtend(this.options,e),this.currentServiceIndex=-1}function i(e,t,i){var n,o=document.createElement("script");o.type="text/"+(e.type||"javascript"),o.src=e.src||e,o.async=!1,o.onreadystatechange=o.onload=function(){var e=o.readyState;clearTimeout(n),t.done||e&&!/loaded|complete/.test(e)||(t.done=!0,t(),o.onreadystatechange=o.onload=null)},document.body.appendChild(o),n=setTimeout((function(){t.done=!0,t(),o.onreadystatechange=o.onload=null}),i)}function n(e,t,i,n,o){var a=new(window.XMLHttpRequest||window.ActiveXObject)("MSXML2.XMLHTTP.3.0");if(a.open(n?"POST":"GET",e,1),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),Array.isArray(o))for(var s=0,r=o.length;s<r;++s){var l=o[s].split(":",2);a.setRequestHeader(l[0].replace(/^\s+|\s+$/g,""),l[1].replace(/^\s+|\s+$/g,""))}"function"==typeof t&&(a.onreadystatechange=function(){a.readyState>3&&t(a)}),a.send(n)}function o(e){return new Error("Error ["+(e.code||"UNKNOWN")+"]: "+e.error)}var a={timeout:5e3,services:["freegeoip","ipinfo","maxmind"],serviceDefinitions:{freegeoip:function(){return{url:"//freegeoip.net/json/?callback={callback}",isScript:!0,callback:function(e,t){try{var i=JSON.parse(t);return i.error?o(i):{code:i.country_code}}catch(n){return o({error:"Invalid response ("+n+")"})}}}},ipinfo:function(){return{url:"//ipinfo.io",headers:["Accept: application/json"],callback:function(e,t){try{var i=JSON.parse(t);return i.error?o(i):{code:i.country}}catch(n){return o({error:"Invalid response ("+n+")"})}}}},ipinfodb:function(e){return{url:"//api.ipinfodb.com/v3/ip-country/?key={api_key}&format=json&callback={callback}",isScript:!0,callback:function(e,t){try{var i=JSON.parse(t);return"ERROR"==i.statusCode?o({error:i.statusMessage}):{code:i.countryCode}}catch(n){return o({error:"Invalid response ("+n+")"})}}}},maxmind:function(){return{url:"//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js",isScript:!0,callback:function(e){return window.geoip2?void geoip2.country((function(t){try{e({code:t.country.iso_code})}catch(i){e(o(i))}}),(function(t){e(o(t))})):void e(new Error("Unexpected response format. The downloaded script should have exported `geoip2` to the global scope"))}}}}};return e.prototype.getNextService=function(){var e;do{e=this.getServiceByIdx(++this.currentServiceIndex)}while(this.currentServiceIndex<this.options.services.length&&!e);return e},e.prototype.getServiceByIdx=function(e){var i=this.options.services[e];if("function"==typeof i){var n=i();return n.name&&t.deepExtend(n,this.options.serviceDefinitions[n.name](n)),n}return"string"==typeof i?this.options.serviceDefinitions[i]():t.isPlainObject(i)?this.options.serviceDefinitions[i.name](i):null},e.prototype.locate=function(e,t){var i=this.getNextService();return i?(this.callbackComplete=e,this.callbackError=t,void this.runService(i,this.runNextServiceOnError.bind(this))):void t(new Error("No services to run"))},e.prototype.setupUrl=function(e){var t=this.getCurrentServiceOpts();return e.url.replace(/\{(.*?)\}/g,(function(i,n){if("callback"===n){var o="callback"+Date.now();return window[o]=function(t){e.__JSONP_DATA=JSON.stringify(t)},o}if(n in t.interpolateUrl)return t.interpolateUrl[n]}))},e.prototype.runService=function(e,t){var o=this;if(e&&e.url&&e.callback){(e.isScript?i:n)(this.setupUrl(e),(function(i){var n=i?i.responseText:"";e.__JSONP_DATA&&(n=e.__JSONP_DATA,delete e.__JSONP_DATA),o.runServiceCallback.call(o,t,e,n)}),this.options.timeout,e.data,e.headers)}},e.prototype.runServiceCallback=function(e,t,i){var n=this,o=t.callback((function(t){o||n.onServiceResult.call(n,e,t)}),i);o&&this.onServiceResult.call(this,e,o)},e.prototype.onServiceResult=function(e,t){t instanceof Error||t&&t.error?e.call(this,t,null):e.call(this,null,t)},e.prototype.runNextServiceOnError=function(e,t){if(e){this.logError(e);var i=this.getNextService();i?this.runService(i,this.runNextServiceOnError.bind(this)):this.completeService.call(this,this.callbackError,new Error("All services failed"))}else this.completeService.call(this,this.callbackComplete,t)},e.prototype.getCurrentServiceOpts=function(){var e=this.options.services[this.currentServiceIndex];return"string"==typeof e?{name:e}:"function"==typeof e?e():t.isPlainObject(e)?e:{}},e.prototype.completeService=function(e,t){this.currentServiceIndex=-1,e&&e(t)},e.prototype.logError=function(e){var t=this.currentServiceIndex;this.getServiceByIdx(t)},e}(),e.Law=function(){function e(e){this.initialise.apply(this,arguments)}var i={regionalLaw:!0,hasLaw:["AT","BE","BG","HR","CZ","CY","DK","EE","FI","FR","DE","EL","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","SK","SI","ES","SE","GB","UK"],revokable:["HR","CY","DK","EE","FR","DE","LV","LT","NL","PT","ES"],explicitAction:["HR","IT","ES"]};return e.prototype.initialise=function(e){t.deepExtend(this.options={},i),t.isPlainObject(e)&&t.deepExtend(this.options,e)},e.prototype.get=function(e){var t=this.options;return{hasLaw:t.hasLaw.indexOf(e)>=0,revokable:t.revokable.indexOf(e)>=0,explicitAction:t.explicitAction.indexOf(e)>=0}},e.prototype.applyLaw=function(e,t){var i=this.get(t);return i.hasLaw||(e.enabled=!1),this.options.regionalLaw&&(i.revokable&&(e.revokable=!0),i.explicitAction&&(e.dismissOnScroll=!1,e.dismissOnTimeout=!1)),e},e}(),e.initialise=function(t,i,n){var o=new e.Law(t.law);i||(i=function(){}),n||(n=function(){}),e.getCountryCode(t,(function(n){delete t.law,delete t.location,n.code&&(t=o.applyLaw(t,n.code)),i(new e.Popup(t))}),(function(i){delete t.law,delete t.location,n(i,new e.Popup(t))}))},e.getCountryCode=function(t,i,n){if(t.law&&t.law.countryCode)i({code:t.law.countryCode});else if(t.location){new e.Location(t.location).locate((function(e){i(e||{})}),n)}else i({})},e.utils=t,e.hasInitialised=!0,window.cookieconsent=e}}(window.cookieconsent||{})};removeAccents=function(e){for(var t=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}],i=0;i<t.length;i++)e=e.replace(t[i].letters,t[i].base);return e};getPlayerAvatar=function(e,t,i){t||(t="000000");if(!/^[1-9]\d*$/.test(e)){e=0;t="000000"}i||(i=50);var n=t.match(/^_def_(\d+)$/);if(n){var o=n[1];o.length<4&&(o=("0000"+o).slice(-4));return g_themeurl+"../../data/avatar/defaults/default-"+o+({32:"_32",50:"_50",92:"_92",184:""}[i]||"")+".jpg"}return 0===e||"000000"==t||"x00000"==t?g_themeurl+"../../data/avatar/default_"+i+".jpg":g_themeurl+"../../data/avatar/"+id_to_path(e)+"/"+e+"_"+i+".jpg?h="+t};getGroupAvatar=function(e,t,i,n){if(!/^[1-9]\d*$/.test(e)){e=0;t="000000"}n||(n=50);if(t&&"000000"!=t){const i=Math.floor(e/1e3);return g_themeurl+"../../data/grouparms/"+i+"/group_"+e+"_"+n+".jpg?h="+t}return"tournament"==i?g_themeurl+"../../data/grouparms/noimage_tournament_"+n+".png":g_themeurl+"../../data/grouparms/noimage_ "+n+".jpg"};getMediaUrl=function(e,t,i=null,n="default",o=null){let a="";o&&(a="?h="+o);let s="png";["banner","display"].includes(t)&&(s="jpg");let r="";i&&(r="_"+i);n||(n="default");"default"===n&&"box"===t&&(n="en");return g_themeurl+"../../data/gamemedia/"+e+"/"+t+"/"+n+r+"."+s+a}},"dojo/date":function(){define(["./has","./_base/lang"],(function(e,t){var i={getDaysInMonth:function(e){var t=e.getMonth();return 1==t&&i.isLeapYear(e)?29:[31,28,31,30,31,30,31,31,30,31,30,31][t]},isLeapYear:function(e){var t=e.getFullYear();return!(t%400&&(t%4||!(t%100)))},getTimezoneName:function(e){var t,i=e.toString(),n="",o=i.indexOf("(");if(o>-1)n=i.substring(++o,i.indexOf(")"));else{var a=/([A-Z\/]+) \d{4}$/;if(t=i.match(a))n=t[1];else{a=/ ([A-Z\/]+)$/;(t=(i=e.toLocaleString()).match(a))&&(n=t[1])}}return"AM"==n||"PM"==n?"":n},compare:function(e,t,i){e=new Date(+e);t=new Date(+(t||new Date));if("date"==i){e.setHours(0,0,0,0);t.setHours(0,0,0,0)}else if("time"==i){e.setFullYear(0,0,0);t.setFullYear(0,0,0)}return e>t?1:e<t?-1:0},add:function(e,t,i){var n=new Date(+e),o=!1,a="Date";switch(t){case"day":break;case"weekday":var s,r,l=i%5;if(l){s=l;r=parseInt(i/5)}else{s=i>0?5:-5;r=i>0?(i-5)/5:(i+5)/5}var d=e.getDay(),c=0;6==d&&i>0?c=1:0==d&&i<0&&(c=-1);var h=d+s;0!=h&&6!=h||(c=i>0?2:-2);i=7*r+s+c;break;case"year":a="FullYear";o=!0;break;case"week":i*=7;break;case"quarter":i*=3;case"month":o=!0;a="Month";break;default:a="UTC"+t.charAt(0).toUpperCase()+t.substring(1)+"s"}a&&n["set"+a](n["get"+a]()+i);o&&n.getDate()<e.getDate()&&n.setDate(0);return n},difference:function(e,t,n){n=n||"day";var o=(t=t||new Date).getFullYear()-e.getFullYear(),a=1;switch(n){case"quarter":var s=e.getMonth(),r=t.getMonth(),l=Math.floor(s/3)+1,d=Math.floor(r/3)+1;a=(d+=4*o)-l;break;case"weekday":var c=Math.round(i.difference(e,t,"day")),h=parseInt(i.difference(e,t,"week")),u=c%7;if(0==u)c=5*h;else{var p=0,m=e.getDay(),g=t.getDay();h=parseInt(c/7);u=c%7;var _=new Date(e);_.setDate(_.getDate()+7*h);var f=_.getDay();if(c>0)switch(!0){case 6==m:p=-1;break;case 0==m:p=0;break;case 6==g:p=-1;break;case 0==g:case f+u>5:p=-2}else if(c<0)switch(!0){case 6==m:p=0;break;case 0==m:p=1;break;case 6==g:p=2;break;case 0==g:p=1;break;case f+u<0:p=2}c+=p;c-=2*h}a=c;break;case"year":a=o;break;case"month":a=t.getMonth()-e.getMonth()+12*o;break;case"week":a=parseInt(i.difference(e,t,"day")/7);break;case"day":a/=24;case"hour":a/=60;case"minute":a/=60;case"second":a/=1e3;case"millisecond":a*=t.getTime()-e.getTime()}return Math.round(a)}};t.mixin(t.getObject("dojo.date",!0),i);return i}))},"dojo/fx/easing":function(){define(["../_base/lang"],(function(e){var t={linear:function(e){return e},quadIn:function(e){return Math.pow(e,2)},quadOut:function(e){return e*(e-2)*-1},quadInOut:function(e){return(e*=2)<1?Math.pow(e,2)/2:-1*(--e*(e-2)-1)/2},cubicIn:function(e){return Math.pow(e,3)},cubicOut:function(e){return Math.pow(e-1,3)+1},cubicInOut:function(e){if((e*=2)<1)return Math.pow(e,3)/2;e-=2;return(Math.pow(e,3)+2)/2},quartIn:function(e){return Math.pow(e,4)},quartOut:function(e){return-1*(Math.pow(e-1,4)-1)},quartInOut:function(e){if((e*=2)<1)return Math.pow(e,4)/2;e-=2;return-.5*(Math.pow(e,4)-2)},quintIn:function(e){return Math.pow(e,5)},quintOut:function(e){return Math.pow(e-1,5)+1},quintInOut:function(e){if((e*=2)<1)return Math.pow(e,5)/2;e-=2;return(Math.pow(e,5)+2)/2},sineIn:function(e){return-1*Math.cos(e*(Math.PI/2))+1},sineOut:function(e){return Math.sin(e*(Math.PI/2))},sineInOut:function(e){return-1*(Math.cos(Math.PI*e)-1)/2},expoIn:function(e){return 0==e?0:Math.pow(2,10*(e-1))},expoOut:function(e){return 1==e?1:-1*Math.pow(2,-10*e)+1},expoInOut:function(e){if(0==e)return 0;if(1==e)return 1;if((e*=2)<1)return Math.pow(2,10*(e-1))/2;--e;return(-1*Math.pow(2,-10*e)+2)/2},circIn:function(e){return-1*(Math.sqrt(1-Math.pow(e,2))-1)},circOut:function(e){e-=1;return Math.sqrt(1-Math.pow(e,2))},circInOut:function(e){if((e*=2)<1)return-.5*(Math.sqrt(1-Math.pow(e,2))-1);e-=2;return.5*(Math.sqrt(1-Math.pow(e,2))+1)},backIn:function(e){var t=1.70158;return Math.pow(e,2)*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return Math.pow(e,2)*((t+1)*e+t)+1},backInOut:function(e){var t=2.5949095;if((e*=2)<1)return Math.pow(e,2)*((t+1)*e-t)/2;e-=2;return(Math.pow(e,2)*((t+1)*e+t)+2)/2},elasticIn:function(e){if(0==e||1==e)return e;e-=1;return-1*Math.pow(2,10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)},elasticOut:function(e){if(0==e||1==e)return e;return Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1},elasticInOut:function(e){if(0==e)return 0;if(2==(e*=2))return 1;var t=.3*1.5,i=t/4;if(e<1){e-=1;return Math.pow(2,10*e)*Math.sin((e-i)*(2*Math.PI)/t)*-.5}e-=1;return Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/t)*.5+1},bounceIn:function(e){return 1-t.bounceOut(1-e)},bounceOut:function(e){var t,i=7.5625,n=2.75;if(e<1/n)t=i*Math.pow(e,2);else if(e<2/n){e-=1.5/n;t=i*Math.pow(e,2)+.75}else if(e<2.5/n){e-=2.25/n;t=i*Math.pow(e,2)+.9375}else{e-=2.625/n;t=i*Math.pow(e,2)+.984375}return t},bounceInOut:function(e){return e<.5?t.bounceIn(2*e)/2:t.bounceOut(2*e-1)/2+.5}};e.setObject("dojo.fx.easing",t);return t}))},"ebg/core/i18n":function(){define(["dojo","dojo/_base/declare","dojo/i18n"],(function(e,t){return t("ebg.core.i18n",null,{constructor:function(){this.nlsStrings={};this.activeBundle="";this.jsbundlesversion=""},loadBundle:function(t){""!=this.jsbundlesversion&&(t+="-"+this.jsbundlesversion);this.nlsStrings[t]=e.i18n.getLocalization("ebg",t)},getTranslation:function(e,t){""!=this.jsbundlesversion&&(e+="-"+this.jsbundlesversion);if(this.nlsStrings[e]){var i=this.nlsStrings[e][t];return i||t}return t},setActiveBundle:function(e){""!=this.jsbundlesversion&&(e+="-"+this.jsbundlesversion);this.activeBundle=e},getSimpleTranslation:function(e){if(""==this.activeBundle)return e;if(this.nlsStrings[this.activeBundle]){var t=this.nlsStrings[this.activeBundle][e];return t||e}return e}})}))},"ebg/webrtc":function(){define(["dojo","dojo/_base/declare","ebg/peerconnect","ebg/scriptlogger"],(function(e,t){return t("ebg.webrtc",null,{constructor:function(e,t,i,n,o,a,s,r,l,d,c){this.player_id=e;this.room=t;this.in_room=[];this.logger=new ebg.scriptlogger("webrtc",s,"[P"+this.player_id+"@"+this.room+"]");this.logger.log("(ebg.webrtc)      WebRTC object created for player "+this.player_id+" and room "+this.room);this.connections=[];this.pcConfig=i;this.pcConstraints=n;this.mediaConstraints=o;this.stereo=!1;this.ajaxcall_callback=s;this.getUserMediaSuccess_callback=r;this.getUserMediaError_callback=l;this.onJoinRoom_callback=d;this.onLeaveRoom_callback=c;this.localVideo=null;this.localStream=null;this.isAudioMuted=!1;this.isVideoMuted=!1;g_sitecore.recordMediaStats(this.player_id,"start");this.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},isInRoom:function(e){for(var t=0;t<this.in_room.length;t++)if(e==this.in_room[t]){this.logger.log("(ebg.webrtc)      Player "+e+" is in the room");return!0}this.logger.log("(ebg.webrtc)      Player "+e+" is not in the room");return!1},addToRoom:function(e){this.logger.log("(ebg.webrtc)      Player "+e+" is added to the room");this.in_room.push(e)},removeFromRoom:function(e){this.logger.log("(ebg.webrtc)      Player "+e+" is removed from the room");for(var t=0;t<this.in_room.length;t++)if(e==this.in_room[t]){this.in_room.splice(t);return!0}return!1},setMediaConstraints:function(e){this.logger.log("(ebg.webrtc)      Setting the following media constraints "+JSON.stringify(e));this.mediaConstraints=e},setLocalFeed:function(e){this.logger.log("(ebg.webrtc)      Setting the local feed with the following HTML video node: "+e.id);this.localVideo=e;this.doGetUserMedia()},doGetUserMedia:function(){if(!1!==this.mediaConstraints.video||!1!==this.mediaConstraints.audio)try{navigator.getUserMedia(this.mediaConstraints,e.hitch(this,"onUserMediaSuccess"),e.hitch(this,"onUserMediaError"));this.logger.log("(ebg.webrtc)      Requested access to local media with mediaConstraints: "+JSON.stringify(this.mediaConstraints))}catch(t){this.logger.log("(ebg.webrtc)      getUserMedia() call failed with exception "+JSON.stringify(t));this.logger.flush();this.getUserMediaError_callback()}else this.logger.log("(ebg.webrtc)      According to media constraints, no media to get: aborting getUserMedia")},onUserMediaSuccess:function(e){this.logger.log("(ebg.webrtc)      User has granted access to local media");this.localVideo.srcObject=e;!e.stop&&e.getTracks&&(e.stop=function(){this.getTracks().forEach((function(e){e.stop()}))});this.localStream=e;this.getUserMediaSuccess_callback()},onUserMediaError:function(e){this.logger.log("(ebg.webrtc)      Failed to get access to local media with error: "+JSON.stringify(e));this.logger.flush();this.getUserMediaError_callback()},maybeConnect:function(t,i){void 0===this.connections[t]&&(this.connections[t]=new ebg.peerconnect(t,this.pcConfig,this.pcConstraints,this.mediaConstraints,this.stereo,this.localStream,this.logger,e.hitch(this,"sendPlayerMessage")));if(!1===i){this.player_id>t&&this.connections[t].doCall();this.player_id<t&&this.connections[t].requestCall()}},hangup:function(){this.logger.log("(ebg.webrtc)      Hanging up & closing all connections");if(null!=this.localStream){this.localStream.stop();this.localStream=null}for(var e=0;e<this.in_room.length;e++){var t=this.in_room[e];if(void 0!==this.connections[t]){this.logger.log("(ebg.webrtc)      Closing connection with player "+t);g_sitecore.recordMediaStats(t,"stop");this.connections[t].stop();this.connections.splice(t)}else this.logger.log("(ebg.webrtc)      No current connection with player "+t)}g_sitecore.recordMediaStats(this.player_id,"stop");this.sendRoomMessage("bye");this.logger.flush()},handleRemoteHangup:function(e){this.logger.log("(ebg.webrtc)      Player "+e+" signaled remote hang up on his end");if(void 0!==this.connections[e]){this.logger.log("(ebg.webrtc)      Closing connection with player "+e);this.connections[e].stop();this.connections.splice(e)}else this.logger.log("(ebg.webrtc)      No current connection with player "+e);g_sitecore.recordMediaStats(e,"stop");this.onLeaveRoom_callback(e)},toggleVideoMute:function(e){var t=null;e==this.player_id?t=this.localStream:void 0!==this.connections[e]&&(t=this.connections[e].remoteStream);if(null==t){this.logger.log("(ebg.webrtc)      No video stream to mute for player "+e+": aborting");return!0}var n=t.getVideoTracks();if(0===n.length){this.logger.log("(ebg.webrtc)      No local video available: aborting");return!0}if(this.isVideoMuted){for(i=0;i<n.length;i++)n[i].enabled=!0;this.logger.log("(ebg.webrtc)      Video unmuted")}else{for(i=0;i<n.length;i++)n[i].enabled=!1;this.logger.log("(ebg.webrtc)      Video muted")}this.isVideoMuted=!this.isVideoMuted;return this.isVideoMuted},toggleAudioMute:function(e){var t=null;e==this.player_id?t=this.localStream:void 0!==this.connections[e]&&(t=this.connections[e].remoteStream);if(null==t){this.logger.log("(ebg.webrtc)      No audio stream to mute for player "+e+": aborting");return!0}var n=t.getAudioTracks();if(0===n.length){this.logger.log("(ebg.webrtc)      No local audio available: aborting");return!0}if(this.isAudioMuted){for(i=0;i<n.length;i++)n[i].enabled=!0;this.logger.log("(ebg.webrtc)      Audio unmuted")}else{for(i=0;i<n.length;i++)n[i].enabled=!1;this.logger.log("(ebg.webrtc)      Audio muted")}this.isAudioMuted=!this.isAudioMuted;return this.isAudioMuted},sendPlayerMessage:function(e,t){this.logger.log("(ebg.webrtc)      Client sending player message "+JSON.stringify(t));t=JSON.stringify(t);this.ajaxcall_callback("/videochat/videochat/relayPlayerMessage.html",{player_id:e,room:this.room,message:t,lock:!1},this,(function(e){}),(function(e){}),"post")},sendRoomMessage:function(e){this.logger.log("(ebg.webrtc)      Client sending room message "+JSON.stringify(e));e=JSON.stringify(e);this.ajaxcall_callback("/videochat/videochat/relayRoomMessage.html",{room:this.room,message:e,lock:!1},this,(function(e){}),(function(e){}))},onMessageReceived:function(e,t){if(null!=this.localStream)if(this.player_id==e.to){var i=e.from,n=JSON.parse(e.message);this.logger.log("(ebg.webrtc)      Client received message from player "+i+": "+JSON.stringify(n));this.isInRoom(i)||"bye"==n||this.onJoinRoom_callback(i,!0);void 0!==this.connections[i]?"bye"==n?this.handleRemoteHangup(i):this.connections[i].handleMessage(n):this.logger.log("(ebg.webrtc)      Message received but no connection with player "+i+" (should never happen)")}else this.logger.log("(ebg.webrtc)      Received message dropped (destined to another player"+e.to+")");else this.logger.log("(ebg.webrtc)      Received message dropped (no localStream)")}})}))},"ebg/peerconnect":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.peerconnect",null,{constructor:function(e,t,i,n,o,a,s,r){this.peerId=e;this.localStream=a;this.remoteVideo=null;this.remoteStream=null;this.pc=null;this.started=!1;this.logger=s;this.sendPlayerMessage_callback=r;this.pcConfig=t;this.pcConstraints=i;this.mediaConstraints=n;this.stereo=o;this.offerConstraints={mandatory:{},optional:[]};this.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},maybeStart:function(){if(!0!==this.started){this.logger.log("(ebg.peerconnect) Starting peer connection...");this.pc=this.createPeerConnection();if(null!==this.pc){try{this.pc.addStream(this.localStream)}catch(e){this.logger.log("(ebg.peerconnect) PeerConnection.addStream failed with exception: "+e.message+(e.stack?" | "+e.stack:""));this.logger.flush()}this.started=!0;this.logger.log("(ebg.peerconnect) Peer connection started")}else this.logger.log("(ebg.peerconnect) Peer connection failed")}else this.logger.log("(ebg.peerconnect) Peer connection already started")},requestCall:function(){this.logger.log("(ebg.peerconnect) Sending call request to peer "+this.peerId);this.sendPlayerMessage_callback(this.peerId,"new client requesting offer")},doCall:function(){this.maybeStart();if(this.started){var t=this.mergeConstraints(this.offerConstraints,this.sdpConstraints);this.logger.log("(ebg.peerconnect) Sending offer to peer "+this.peerId+", with constraints "+JSON.stringify(t));try{this.pc.createOffer(e.hitch(this,"setLocalSessionDescription"),e.hitch(this,"handleCreateOfferError"),t)}catch(i){this.logger.log("(ebg.peerconnect) PeerConnection.createOffer failed with exception: "+i.message+(i.stack?" | "+i.stack:""));this.logger.flush()}}},mergeConstraints:function(e,t){var i=e;for(var n in t.mandatory)i.mandatory[n]=t.mandatory[n];i.optional.concat(t.optional);return i},handleCreateOfferError:function(e){try{this.logger.log("(ebg.peerconnect) Create offer error: "+JSON.stringify(e))}catch(t){this.logger.log("(ebg.peerconnect) Exception raised while logging handleCreateOfferError: "+t.message)}this.logger.flush()},doAnswer:function(){if(this.started){this.isInitiator=!1;this.logger.log("(ebg.peerconnect) Sending answer to peer "+this.peerId);try{this.pc.createAnswer(e.hitch(this,"setLocalSessionDescription"),e.hitch(this,"onCreateAnswerError"),this.sdpConstraints)}catch(t){this.logger.log("(ebg.peerconnect) PeerConnection.createAnswer failed with exception: "+t.message+(t.stack?" | "+t.stack:""));this.logger.flush()}}else this.logger.log("(ebg.peerconnect) Connection must be started before sending an answer")},onCreateAnswerError:function(e){this.logger.log("(ebg.peerconnect) Create answer error: "+JSON.stringify(e));this.logger.flush()},stop:function(){if(this.started){this.logger.log("(ebg.peerconnect) Closing peer connection...");this.started=!1;this.getConnectionDetails(this.pc).then(e.hitch(this,(function(e){this.logger.log("(ebg.peerconnect) ICE connection details: "+JSON.stringify(e));this.logger.flush()})));try{this.pc.close()}catch(t){this.logger.log("(ebg.peerconnect) PeerConnection.close failed with exception: "+t.message+(t.stack?" | "+t.stack:""));this.logger.flush()}finally{this.pc=null;this.logger.log("(ebg.peerconnect) Peer connection closed")}}else this.logger.log("(ebg.peerconnect) Connection must be started before stopping it")},handleMessage:function(t){this.logger.log("(ebg.peerconnect) Client handling message from player "+this.peerId+": "+JSON.stringify(t));if(null===t)this.logger.log("(ebg.peerconnect) Message is null");else if("new client requesting offer"===t){this.logger.log("(ebg.peerconnect) Request received, sending an offer");this.started&&this.stop();this.maybeStart();this.doCall()}else if("offer"===t.type){this.logger.log("(ebg.peerconnect) Registering offer and sending an answer");this.started&&this.stop();this.maybeStart();if(this.started){if(this.stereo){t.sdp=addStereo(t.sdp);t.sdp=maybePreferAudioSendCodec(t.sdp)}try{this.pc.setRemoteDescription(new RTCSessionDescription(t),e.hitch(this,"onSetRemoteSessionDescriptionSuccess"),e.hitch(this,"onSetRemoteSessionDescriptionError"))}catch(n){this.logger.log("(ebg.peerconnect) PeerConnection.setRemoteDescription failed with exception: "+n.message+(n.stack?" | "+n.stack:""));this.logger.flush()}this.doAnswer()}else this.logger.log("(ebg.peerconnect) No peerconnection available. Aborting.")}else if("answer"===t.type){this.logger.log("(ebg.peerconnect) Registering answer");if(this.started){if(this.stereo){t.sdp=addStereo(t.sdp);t.sdp=maybePreferAudioSendCodec(t.sdp)}try{this.pc.setRemoteDescription(new RTCSessionDescription(t),e.hitch(this,"onSetRemoteSessionDescriptionSuccess"),e.hitch(this,"onSetRemoteSessionDescriptionError"))}catch(n){this.logger.log("(ebg.peerconnect) PeerConnection.setRemoteDescription failed with exception: "+n.message+(n.stack?" | "+n.stack:""));this.logger.flush()}}else this.logger.log("(ebg.peerconnect) No peerconnection available. Aborting.")}else if("candidate"===t.type){this.logger.log("(ebg.peerconnect) Registering candidate");if(this.started){var i=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});try{this.pc.addIceCandidate(i,e.hitch(this,"onAddIceCandidateSuccess"),e.hitch(this,"onAddIceCandidateError"))}catch(n){this.logger.log("(ebg.peerconnect) PeerConnection.addIceCandidate failed with exception: "+n.message+(n.stack?" | "+n.stack:""));this.logger.flush()}}else this.logger.log("(ebg.peerconnect) No peerconnection available. Aborting.")}else this.logger.log("(ebg.peerconnect) Unknown message type")},onSetLocalSessionDescriptionSuccess:function(){this.logger.log("(ebg.peerconnect) Set local session description successfully");!0===webrtcConfig.iceTricklingEnabled&&this.sendLocalSessionDescription()},onSetLocalSessionDescriptionError:function(e){this.logger.log("(ebg.peerconnect) Failed to set local session description with error: "+JSON.stringify(e));this.logger.flush()},onSetRemoteSessionDescriptionSuccess:function(){this.logger.log("(ebg.peerconnect) Set remote session description successfully")},onSetRemoteSessionDescriptionError:function(e){this.logger.log("(ebg.peerconnect) Failed to set remote session description with error: "+JSON.stringify(e));this.logger.flush()},onAddIceCandidateSuccess:function(){this.logger.log("(ebg.peerconnect) Added ice candidate successfully")},onAddIceCandidateError:function(e){this.logger.log("(ebg.peerconnect) Failed to add ice candidate with error: "+JSON.stringify(e));this.logger.flush()},createPeerConnection:function(){var t=null;try{(t=new RTCPeerConnection(this.pcConfig,this.pcConstraints)).onicecandidate=e.hitch(this,"handleIceCandidate");t.onaddstream=e.hitch(this,"handleRemoteStreamAdded");t.onremovestream=e.hitch(this,"handleRemoteStreamRemoved");t.onsignalingstatechange=e.hitch(this,"onSignalingStateChanged");t.oniceconnectionstatechange=e.hitch(this,"onIceConnectionStateChanged");for(var i=JSON.parse(JSON.stringify(this.pcConfig)),n=0;n<i.iceServers.length;n++)if(void 0!==i.iceServers[n].credential){i.iceServers[n].username="********";i.iceServers[n].credential="********"}this.logger.log("(ebg.peerconnect) Created RTCPeerConnnection with config "+JSON.stringify(i)+" and constraints "+JSON.stringify(this.pcConstraints))}catch(o){this.logger.log("(ebg.peerconnect) Failed to create PeerConnection with exception: "+o.message+(o.stack?" | "+o.stack:""));this.logger.flush();alert("Error: failed to create the audio/video connection. Maybe you are using Edge? To use audio/video on BGA, we recommend Firefox or Chrome.")}return t},handleIceCandidate:function(e){if(null===e.candidate){this.logger.log("(ebg.peerconnect) End of candidates");!1===webrtcConfig.iceTricklingEnabled&&this.sendLocalSessionDescription()}else if(!0===webrtcConfig.iceTricklingEnabled){this.logger.log("(ebg.peerconnect) Handling ICE candidate");this.sendPlayerMessage_callback(this.peerId,{type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate})}},handleRemoteStreamAdded:function(e){this.logger.log("(ebg.peerconnect) Remote stream added");this.remoteVideo=$("videofeed_"+this.peerId);if(null!==this.remoteVideo){this.remoteVideo.srcObject=e.stream;this.remoteStream=e.stream}else this.logger.log("(ebg.peerconnect) No remote video object available. Aborting.")},handleRemoteStreamRemoved:function(e){this.logger.log("(ebg.peerconnect) Remote stream removed")},onSignalingStateChanged:function(e){null!==this.pc?this.logger.log("(ebg.peerconnect) Signaling state changed to: "+this.pc.signalingState):this.logger.log("(ebg.peerconnect) onSignalingStateChanged fired, but peerconnect object is null!")},onIceConnectionStateChanged:function(t){if(null!==this.pc){this.logger.log("(ebg.peerconnect) ICE connection state changed to: "+this.pc.iceConnectionState);if("connected"==this.pc.iceConnectionState||"completed"==this.pc.iceConnectionState){this.getConnectionDetails(this.pc).then(e.hitch(this,(function(e){this.logger.log("(ebg.peerconnect) ICE connection details: "+JSON.stringify(e));this.logger.flush()})));if(null!=$("videofeed_"+this.peerId+"_spk")){e.addClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_on");e.removeClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_off")}if(null!=$("videofeed_"+this.peerId+"_cam")){e.addClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_on");e.removeClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_off")}}else{if(null!=$("videofeed_"+this.peerId+"_spk")){e.addClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_off");e.removeClass($("videofeed_"+this.peerId+"_spk"),"rtc_video_spk_on")}if(null!=$("videofeed_"+this.peerId+"_cam")){e.addClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_off");e.removeClass($("videofeed_"+this.peerId+"_cam"),"rtc_video_cam_on")}}}else this.logger.log("(ebg.peerconnect) onIceConnectionStateChanged fired, but peerconnect object is null!")},getConnectionDetails:function(e){var t={};if(window.chrome){var i=["googLocalAddress","googLocalCandidateType","googRemoteAddress","googRemoteCandidateType","bytesReceived","bytesSent"];return new Promise((function(n,o){e.getStats((function(e){var a=e.result().filter((function(e){return"true"==e.stat("googActiveConnection")}))[0];if(!a)return o("Something is wrong...");i.forEach((function(e){t[e.replace("goog","")]=a.stat(e)}));n(t)}))}))}return e.getStats(null).then((function(e){var i=e[Object.keys(e).filter((function(t){return e[t].selected}))[0]],n=e[i.localCandidateId],o=e[i.remoteCandidateId];t.LocalAddress=[n.ipAddress,n.portNumber].join(":");t.RemoteAddress=[o.ipAddress,o.portNumber].join(":");t.LocalCandidateType=n.candidateType;t.RemoteCandidateType=o.candidateType;t.bytesReceived=i.bytesReceived;t.bytesSent=i.bytesSent;return t}))},setLocalSessionDescription:function(t){try{this.pc.setLocalDescription(t,e.hitch(this,"onSetLocalSessionDescriptionSuccess"),e.hitch(this,"onSetLocalSessionDescriptionError"))}catch(i){this.logger.log("(ebg.peerconnect) PeerConnection.setLocalDescription failed with exception: "+i.message+(i.stack?" | "+i.stack:""));this.logger.flush()}},sendLocalSessionDescription:function(){this.logger.log("(ebg.peerconnect) Sending message with session description "+JSON.stringify(this.pc.localDescription));this.sendPlayerMessage_callback(this.peerId,this.pc.localDescription)}})}))},"ebg/scriptlogger":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.scriptlogger",null,{constructor:function(e,t,i){this.logName=e;this.logBuffer=null;this.identifier=i;this.ajaxcall_callback=t;this.log("Client side "+this.logName+" log follows.")},log:function(e){if(null===this.logBuffer)this.logBuffer=e;else{var t=new Date,i=(void 0===this.identifier?"":this.identifier+" ")+t.getUTCFullYear()+("0"+(t.getUTCMonth()+1)).slice(-2)+("0"+t.getUTCDate()).slice(-2)+"-"+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)+":"+("00"+t.getUTCMilliseconds()).slice(-3)+"-UTC";this.logBuffer+="   "+i+" "+e}this.logBuffer+="\n"},flush:function(){this.ajaxcall_callback("/web/scriptlogger/"+this.logName+".html",{log:this.logBuffer,lock:!1},this,(function(e){}),(function(e){}),"post");this.logBuffer=null;this.log("Client side "+this.logName+" log follows.")}})}))},"ebg/webpush":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.webpush",null,{constructor:function(t){this.ajaxcall_callback=t;this.serviceWorkerRegistered=!1;this.permissionAlreadyGranted=!1;this.permissionGranted=!1;this.pushSubscription=null;var i="/data/themereleases/";g_themeurl.substr(g_themeurl.indexOf(i)+i.length,11);this.l_serviceworker_url="/theme/js/bgaserviceworker.js";this.browser="";e.isChrome?this.browser="Google Chrome v"+e.isChrome:e.isIE?this.browser="Internet Explorer v"+e.isIE:e.isFF?this.browser="Mozilla Firefox v"+e.isFF:e.isSafari?this.browser="Safari v"+e.isSafari:e.isMozilla?this.browser="Mozilla v"+e.isMozilla:e.isOpera&&(this.browser="Opera v"+e.isOpera)},init:function(){if(!this.isSupported())return Promise.reject(new Error("Web push is not supported"));this.isAuthorized()&&(this.permissionAlreadyGranted=!0);return this.registerServiceWorker().then(e.hitch(this,(function(){return this.askPermission()}))).then(e.hitch(this,(function(){return this.subscribeUserToPush()}))).then(e.hitch(this,(function(e){return this.savePushSubscription(e)})))},refresh:function(){if(!this.isSupported())return Promise.reject(new Error("Web push is not supported"));var t=location.href.split("/")[2],i=g_sitecore.domain,n="https://"+i+"/";try{navigator.serviceWorker.getRegistrations().then(e.hitch(this,(function(e){for(var o=!1,a=0;a<e.length;++a){var s=e[a];s.scope!=n?s.unregister():o=!0}o||t!=i||this.registerServiceWorker()})))}catch(o){}},revoke:function(){},isSupported:function(){return"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")&&("serviceWorker"in navigator&&("PushManager"in window&&"Notification"in window))},isAuthorized:function(){return"granted"==Notification.permission},registerServiceWorker:function(){return navigator.serviceWorker.register(this.l_serviceworker_url,{scope:"../../"}).then((function(e){this.serviceWorkerRegistered=!0;e.update();return e})).then(null,(function(e){this.serviceWorkerRegistered=!1}))},askPermission:function(){return new Promise((function(e,t){var i=Notification.requestPermission((function(t){e(t)}));i&&i.then(e,t)})).then((function(e){this.permissionGranted="granted"===e}))},subscribeUserToPush:function(){return navigator.serviceWorker.register(this.l_serviceworker_url,{scope:"../../"}).then((function(e){var t={userVisibleOnly:!0,applicationServerKey:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),n=new Uint8Array(i.length),o=0;o<i.length;++o)n[o]=i.charCodeAt(o);return n}("BKh3NNRk5O5wx1_qS_TlvqadCSZ_GmdwpYYfsVMurznZ03mn0wgvh-lK84IMaljkLFfYEQpxN_e4mwrUwYAfbwU")};return e.pushManager.subscribe(t)})).then((function(e){return e}))},savePushSubscription:function(e){this.pushSubscription=JSON.parse(JSON.stringify(e));this.ajaxcall_callback("/player/profile/savePushSubscription.html",{isnewbrowser:!this.permissionAlreadyGranted,browser:this.browser,endpoint:this.pushSubscription.endpoint,auth:this.pushSubscription.keys.auth,p256dh:this.pushSubscription.keys.p256dh,lock:!1},this,(function(e){}),(function(e){}),"post")}})}))},"ebg/draggable":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.draggable",null,{constructor:function(){this.page=null;this.item_id=null;this.item_div=null;this.mouse_x_origin=null;this.mouse_y_origin=null;this.element_x_origin=null;this.element_y_origin=null;this.is_dragging=!1;this.is_disabled=!1;this.dragging_handler=null;this.dragging_handler_touch=null;this.bUseAutomaticZIndex=!0;this.automatic_z_index=!1;this.bGrid=!1;this.bSnap=!1;this.snapCallback=null;this.gridSize=10;this.draggedThisTime=!1;this.zoomFactorOriginalElement=1;this.parentRotation=0;this.event_handlers=[]},create:function(t,i,n){this.page=t;this.item_id=i;this.item_div=$(i);if(n){this.event_handlers.push(e.connect($(n),"onmousedown",this,"onMouseDown"));this.event_handlers.push(e.connect($(n),"ontouchstart",this,"onMouseDown"));e.style($(n),"cursor","move")}else{this.event_handlers.push(e.connect(this.item_div,"onmousedown",this,"onMouseDown"));this.event_handlers.push(e.connect(this.item_div,"ontouchstart",this,"onMouseDown"));e.style(this.item_div,"cursor","move")}this.event_handlers.push(e.connect($("ebd-body"),"onmouseup",this,"onMouseUp"));this.event_handlers.push(e.connect($("ebd-body"),"ontouchend",this,"onMouseUp"))},destroy:function(){for(var t in this.event_handlers)e.disconnect(this.event_handlers[t])},changeDraggableItem:function(e){this.item_id=e;this.item_div=$(e)},onMouseDown:function(t){e.stopEvent(t);if(!this.is_disabled){this.mouse_x_origin=t.pageX;this.mouse_y_origin=t.pageY;this.element_x_origin=e.style(this.item_div,"left");this.element_y_origin=e.style(this.item_div,"top");this.is_dragging=!0;this.parentRotation=this.page.getAbsRotationAngle(this.item_div.parentNode);this.dragging_handler&&e.disconnect(this.dragging_handler);this.dragging_handler_touch&&e.disconnect(this.dragging_handler_touch);this.dragging_handler=e.connect($("ebd-body"),"onmousemove",this,"onMouseMove");this.dragging_handler_touch=e.connect($("ebd-body"),"ontouchmove",this,"onMouseMove");for(var i=1,n=this.item_div;n.parentNode;){var o=e.style(n,"zoom");"number"!=typeof o&&"string"!=typeof o||(i*=o);var a=e.style(n,"transform");if("none"!=a&&"matrix("==a.substr(0,7)){var s=a.substr(7).split(",")[0],r=a.substr(7).split(",")[2],l=Math.sqrt(s*s+r*r);l>1e-4&&(i*=l)}if((n=n.parentNode).id&&"game_play_area"==n.id)break}this.zoomFactorOriginalElement=i;this.draggedThisTime=!1;this.onStartDragging(this.item_id,this.element_x_origin,this.element_y_origin)}},onMouseUp:function(t){if(!this.is_disabled&&!0===this.is_dragging){var i={x:t.pageX-this.mouse_x_origin,y:t.pageY-this.mouse_y_origin},n=this.page.vector_rotate(i,this.parentRotation);if(void 0!==this.page.gameinterface_zoomFactor){n.x=n.x/this.page.gameinterface_zoomFactor;n.y=n.y/this.page.gameinterface_zoomFactor}if(1!=this.zoomFactorOriginalElement){n.x=n.x/this.zoomFactorOriginalElement;n.y=n.y/this.zoomFactorOriginalElement}var o=n.x+this.element_x_origin,a=n.y+this.element_y_origin;this.bGrid&&(o=Math.round(o/this.gridSize)*this.gridSize);this.bGrid&&(a=Math.round(a/this.gridSize)*this.gridSize);this.is_dragging=!1;e.disconnect(this.dragging_handler);e.disconnect(this.dragging_handler_touch);e.removeClass(this.item_div,"dragging_in_progress");this.onEndDragging(this.item_id,o,a,this.draggedThisTime);this.dragging_handler=null;this.dragging_handler_touch=null;if(this.automatic_z_index){e.style(this.item_id,"zIndex","auto");this.automatic_z_index=!1}var s=Math.abs(o-this.element_x_origin)<10&&Math.abs(a-this.element_y_origin)<10;s&&"touchend"==t.type&&this.item_div.click()}},onMouseMove:function(t){if(!this.is_disabled&&!0===this.is_dragging){var i={x:t.pageX-this.mouse_x_origin,y:t.pageY-this.mouse_y_origin},n=this.page.vector_rotate(i,this.parentRotation);if(void 0!==this.page.gameinterface_zoomFactor){n.x=n.x/this.page.gameinterface_zoomFactor;n.y=n.y/this.page.gameinterface_zoomFactor}if(1!=this.zoomFactorOriginalElement){n.x=n.x/this.zoomFactorOriginalElement;n.y=n.y/this.zoomFactorOriginalElement}var o=n.x+this.element_x_origin,a=n.y+this.element_y_origin;if(this.bSnap&&0==this.parentRotation){var s=this.snapCallback(o,a);o=s.x;a=s.y}else if(this.bGrid){a=Math.round(a/this.gridSize)*this.gridSize;o=Math.round(o/this.gridSize)*this.gridSize}e.style(this.item_div,"left",o+"px");e.style(this.item_div,"top",a+"px");if(0==this.draggedThisTime){e.addClass(this.item_div,"dragging_in_progress");this.draggedThisTime=!0;if(this.bUseAutomaticZIndex&&"auto"==e.style(this.item_id,"zIndex")){this.automatic_z_index=!0;e.style(this.item_id,"zIndex",1e3)}}this.onDragging(this.item_id,o,a,o-this.element_x_origin,a-this.element_y_origin);e.stopEvent(t)}},disable:function(t){this.is_disabled=!0;this.item_div&&(t?e.style(this.item_div,"cursor",t):e.style(this.item_div,"cursor","default"))},enable:function(){this.is_disabled=!1;this.item_div&&e.style(this.item_div,"cursor","move")},onStartDragging:function(e,t,i){},onEndDragging:function(e,t,i,n){},onDragging:function(e,t,i,n,o){}})}))},"ebg/resizable":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.resizable",null,{constructor:function(){this.page=null;this.item_id=null;this.item_div=null;this.mouse_x_origin=null;this.mouse_y_origin=null;this.element_x_origin=null;this.element_y_origin=null;this.is_dragging=!1;this.is_disabled=!1;this.element_w_origin=null;this.element_h_origin=null;this.dragging_handler=null;this.width_resize=!0;this.height_resize=!0;this.resize_parent=!1;this.automatic_z_index=!0},create:function(t,i,n,o,a,s){this.page=t;this.item_id=i;this.item_div=$(i);!1===o&&(this.width_resize=!1);!1===a&&(this.height_resize=!1);!0===s&&(this.resize_parent=!0);n?e.connect($(n),"onmousedown",this,"onMouseDown"):e.connect(this.item_div,"onmousedown",this,"onMouseDown");e.connect($("ebd-body"),"onmouseup",this,"onMouseUp")},onMouseDown:function(t){e.stopEvent(t);if(!this.is_disabled){var i=e.marginBox(this.item_div);this.element_w_origin=i.w;this.element_h_origin=i.h;this.mouse_x_origin=t.pageX;this.mouse_y_origin=t.pageY;var n=e.marginBox(this.item_div);this.element_x_origin=n.l;this.element_y_origin=n.t;this.is_dragging=!0;this.dragging_handler&&e.disconnect(this.dragging_handler);this.dragging_handler=e.connect($("ebd-body"),"onmousemove",this,"onMouseMove");this.onStartDragging(this.item_id,this.element_x_origin,this.element_y_origin);if("auto"==e.style(this.item_id,"zIndex")){this.automatic_z_index=!0;e.style(this.item_id,"zIndex",1e3)}}},onMouseUp:function(t){if(!this.is_disabled&&!0===this.is_dragging){var i=t.pageX-this.mouse_x_origin+this.element_x_origin,n=t.pageY-this.mouse_y_origin+this.element_y_origin;this.is_dragging=!1;e.disconnect(this.dragging_handler);this.onEndDragging(this.item_id,i,n);this.automatic_z_index&&e.style(this.item_id,"zIndex","auto")}},onMouseMove:function(t){t.preventDefault();if(!this.is_disabled&&!0===this.is_dragging){if(this.width_resize){var i=t.pageX-this.mouse_x_origin;e.style(this.item_div,"width",this.element_w_origin+i+"px")}if(this.height_resize){var n=t.pageY-this.mouse_y_origin;e.style(this.item_div,"height",this.element_h_origin+n+"px")}if(this.resize_parent&&this.item_div.parentNode){var o=e.marginBox(this.item_div);e.style(this.item_div.parentNode,"width",o.w+"px");e.style(this.item_div.parentNode,"height",o.h+"px")}this.onDragging(this.item_id,i,n)}},disable:function(t){this.is_disabled=!0;this.item_div&&(t?e.style(this.item_div,"cursor",t):e.style(this.item_div,"cursor","default"))},enable:function(){this.is_disabled=!1;this.item_div&&e.style(this.item_div,"cursor","move")},onStartDragging:function(e,t,i){},onEndDragging:function(e,t,i){},onDragging:function(e,t,i){}})}))},"ebg/popindialog":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.popindialog",null,{constructor:function(){this.id=null;this.target_id=null;this.container_id="ebd-body";this.resizeHandle=null;this.closeHandle=null;this.bCloseIsHiding=!1;this.onShow=null;this.onHide=null;this.jstpl_standard_popin='<div id="popin_${id}" class="standard_popin"><h2 id="popin_${id}_title" class="standard_popin_title"></h2><a href="#" target="_blank" id="popin_${id}_help" class="standard_popin_helpicon"><i class="fa fa-question-circle-o fa-2x" aria-hidden="true"></i></a><a href="#" id="popin_${id}_close" class="standard_popin_closeicon"><i class="fa fa-times-circle fa-2x" aria-hidden="true"></i></a><div id="popin_${id}_contents" class="clear"></div></div>'},create:function(t,i){this.id=t;this.target_id=i;void 0===this.target_id&&(this.target_id=null!==$("main-content")?"main-content":"left-side");e.destroy("popin_"+this.id+"_underlay");e.place('<div id="popin_'+this.id+'_underlay" class="standard_popin_underlay"></div>',this.container_id);e.destroy("popin_"+this.id);e.place(e.string.substitute(this.jstpl_standard_popin,{id:this.id}),this.container_id);e.style("popin_"+this.id+"_help","display","none");this.closeHandle=e.connect($("popin_"+this.id+"_close"),"onclick",this,(function(t){e.stopEvent(t);this.bCloseIsHiding?this.hide():this.destroy()}));this.resizeHandle=e.connect(window,"onresize",this,"adjustSizeAndPosition")},destroy:function(t){if(null!=this.id){void 0===t&&(t=!0);e.disconnect(this.resizeHandle);if(t){if($("popin_"+this.id)){var i=e.fadeOut({node:"popin_"+this.id});e.connect(i,"onEnd",this,(function(t){$("popin_"+this.id)&&e.destroy("popin_"+this.id)}));i.play()}if($("popin_"+this.id+"_underlay")){var n=e.fadeOut({node:"popin_"+this.id+"_underlay"});e.connect(n,"onEnd",this,(function(t){$("popin_"+this.id+"_underlay")&&e.destroy("popin_"+this.id+"_underlay");this.id=null}));n.play()}}else{$("popin_"+this.id)&&e.destroy("popin_"+this.id);$("popin_"+this.id+"_underlay")&&e.destroy("popin_"+this.id+"_underlay")}}},replaceCloseCallback:function(t){e.disconnect(this.closeHandle);this.closeHandle=e.connect($("popin_"+this.id+"_close"),"onclick",this,t)},hideCloseIcon:function(){e.style("popin_"+this.id+"_close","display","none")},setTitle:function(e){if(null===this.id)throw"You should CREATE this popindialog first";$("popin_"+this.id+"_title").innerHTML=e},setMaxWidth:function(t){if(null===this.id)throw"You should CREATE this popindialog first";e.style("popin_"+this.id,"maxWidth",t+"px")},setHelpLink:function(t){$("popin_"+this.id+"_help").href=t;e.style("popin_"+this.id+"_help","display","block")},setContent:function(e){if(null===this.id)throw"You should CREATE this popindialog first";$("popin_"+this.id+"_contents").innerHTML=e},adjustSizeAndPosition:function(){$("popin_"+this.id)&&"none"!=e.style("popin_"+this.id,"display")&&this.show(!1)},show:function(t){if(null===this.id)throw"You should CREATE this popindialog first";void 0===t&&(t=!0);e.style("popin_"+this.id+"_underlay","opacity","0");e.style("popin_"+this.id+"_underlay","display","block");e.style("popin_"+this.id,"opacity","0");e.style("popin_"+this.id,"display","inline-block");e.style("popin_"+this.id,"transform","");var i=e.position(this.container_id),n=e.position(this.target_id),o=e.position("popin_"+this.id),a=(e.style("popin_"+this.id,"top"),e.window.getBox()),s=43;"undefined"!=typeof gameui&&(s=65);var r=Math.max(a.t+s,(a.h-o.h)/2+a.t);e.style("popin_"+this.id,"top",r+"px");var l=n.x+n.w/2-o.w/2;l<0&&(l=Math.max(0,a.w/2-o.w/2));e.style("popin_"+this.id,"left",l+"px");if(e.hasClass("ebd-body","mobile_version")&&l+o.w>i.w){e.style("popin_"+this.id,"left","5px");var d=i.w/(o.w+10);e.style("popin_"+this.id,"transform","scale("+d+")");e.style("popin_"+this.id,"transform-origin","left center")}e.style("popin_"+this.id+"_underlay","width",i.w+"px");e.style("popin_"+this.id+"_underlay","height",i.h-s+"px");if(t){e.fadeIn({node:"popin_"+this.id+"_underlay"}).play();var c=e.animateProperty({node:"popin_"+this.id+"_underlay",properties:{opacity:.7}});e.connect(c,"onEnd",this,(function(t){var i=e.position(this.container_id);e.style("popin_"+this.id+"_underlay","width",i.w+"px");e.style("popin_"+this.id+"_underlay","height",i.h-s+"px")}));c.play();e.fadeIn({node:"popin_"+this.id}).play()}else{e.style("popin_"+this.id+"_underlay","opacity",.7);e.style("popin_"+this.id,"opacity",1)}null!==this.onShow&&this.onShow()},hide:function(t){if(null===this.id)throw"You should CREATE this popindialog first";void 0===t&&(t=!0);if(t){if($("popin_"+this.id+"_underlay")){e.fadeOut({node:"popin_"+this.id+"_underlay"}).play();var i=e.animateProperty({node:"popin_"+this.id+"_underlay",properties:{opacity:0}});e.connect(i,"onEnd",this,(function(t){e.style("popin_"+this.id+"_underlay","display","none");e.style("popin_"+this.id,"display","none")}));i.play()}$("popin_"+this.id)&&e.fadeOut({node:"popin_"+this.id}).play()}else{if($("popin_"+this.id+"_underlay")){e.style("popin_"+this.id+"_underlay","opacity",0);e.style("popin_"+this.id+"_underlay","display","none")}if($("popin_"+this.id)){e.style("popin_"+this.id,"opacity",0);e.style("popin_"+this.id,"display","none")}}null!==this.onHide&&this.onHide()}})}))},"ebg/gamenotif":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.gamenotif",null,{constructor:function(){this.queue=[];this.next_log_id=0;this.game=null;this.checkSequence=!1;this.last_packet_id=0;this.notificationResendInProgress=!1;this.synchronous_notifs={};this.waiting_from_notifend=null;this.ignoreNotificationChecks={};this.playerBufferQueue={};this.debugnotif_i=1;this.currentNotifCallback=null;this.onPlaceLogOnChannel=null;this.lastMsgTime=0;e.subscribe("notifEnd",this,"onSynchronousNotificationEnd")},onNotification:function(t){"string"==typeof t&&(t=e.fromJson(t));try{var i=!1;"/table"==t.channel.substr(0,6)&&(i=!0);if("/player"==t.channel.substr(0,7)&&void 0!==t.table_id&&null!==t.table_id&&(null===this.game||this.game.table_id!=t.table_id))return;if("single"==t.packet_type);else if("sequence"==t.packet_type&&this.checkSequence){var n=null;t.prevpacket&&i&&(t.prevpacket[0]?n=toint(t.prevpacket[0]):t.prevpacket[this.game.player_id]&&(n=toint(t.prevpacket[this.game.player_id])));if(null!==n)if(toint(this.last_packet_id)==toint(n))this.last_packet_id=toint(t.packet_id);else{if(toint(n)>toint(this.last_packet_id)){this.resynchronizeNotifications(!1);return}toint(this.last_packet_id)>toint(n)&&(this.last_packet_id=toint(t.packet_id))}}else if("resend"==t.packet_type)toint(t.packet_id)>toint(this.last_packet_id)&&(this.last_packet_id=t.packet_id);else if("history"==t.packet_type)for(var o in t.data){var a=t.data[o].type;if("chatmessage"==a||"wouldlikethink"==a);else{t.data[o].args.originalType=t.data[o].type;t.data[o].type="history_history";null!==this.game&&(t.data[o].gamenameorig=this.game.game_name)}}else t.packet_type;var s=t.data.length;for(o=0;o<s;o++){t.data[o].channelorig=t.channel;void 0!==t.gamename&&(t.data[o].gamenameorig=t.gamename);void 0!==t.time&&(t.data[o].time=t.time);void 0!==t.move_id&&i&&(t.data[o].move_id=t.move_id)}if(t.chatmessage||"history"==t.packet_type||"single"==t.packet_type)for(o=0;o<s;o++)this.dispatchNotification(t.data[o]);else if(!i&&t.move_id)this.playerBufferQueue[t.move_id]={notifs:t,counter:0};else{for(o=0;o<=s;o++){if(t.move_id)if(o<s&&("replaywaitingdelay"==t.data[o].type||"end_replaywaitingdelay"==t.data[o].type||"replayinitialwaitingdelay"==t.data[o].type||"end_replayinitialwaitingdelay"==t.data[o].type));else if(this.playerBufferQueue[t.move_id]){for(var r=this.playerBufferQueue[t.move_id].counter,l=this.playerBufferQueue[t.move_id].notifs,d=0;d<l.data.length;d++)if(toint(l.data[d].synchro)==toint(r)){l.data[d].bIsTableMsg=!1;this.queue.push(l.data[d]);l.data[d].lock_uuid&&e.publish("lockInterface",[{status:"queued",bIsTableMsg:!1,uuid:l.data[d].lock_uuid}])}this.playerBufferQueue[t.move_id].counter++}if(o<s){t.data[o].bIsTableMsg=i;i&&t.move_id&&(t.data[o].move_id=t.move_id);i&&t.table_id&&(t.data[o].table_id=t.table_id);this.queue.push(t.data[o]);t.data[o].lock_uuid&&e.publish("lockInterface",[{status:"queued",bIsTableMsg:i,uuid:t.data[o].lock_uuid}])}}t.move_id&&this.playerBufferQueue[t.move_id]&&delete this.playerBufferQueue[t.move_id];this.dispatchNotifications()}}catch(h){var c="";$("logs")&&e.style("logs","display","block");this.currentNotifCallback&&(c+="During notification "+this.currentNotifCallback+"\n");c+=h.message+"\n";c+=h.stack||h.stacktrace||"no_stack_avail";this.game?this.game.onScriptError(c,"",""):mainsite.onScriptError(c,"","")}},resynchronizeNotifications:function(e){if(!this.notificationResendInProgress){this.notificationResendInProgress=!0;var t=this.game.game_name,i=e?1:0;"undefined"!=typeof g_replayFrom&&(i=0);this.game.ajaxcall("/"+t+"/"+t+"/notificationHistory.html",{table:this.game.table_id,from:toint(this.last_packet_id)+1,privateinc:1,history:i},this,(function(e){0==e.data.length&&"undefined"!=typeof g_replayFrom&&this.game.onEndOfReplay();var t=[];for(var n in e.data)t.push(n);t.sort((function(t,i){return e.data[i]-e.data[t]}));if("undefined"!=typeof gameui&&0==gameui.log_history_loading_status.downloaded){gameui.log_history_loading_status.downloaded=1;gameui.log_history_loading_status.total=t.length;gameui.updateLoaderPercentage()}this.logs_to_load=e.data;this.logs_to_load_sortedNotifsKeys=t;this.logs_to_load_loadhistory=i;this.logs_to_load_bMaskStillActive=!0;this.logs_to_load_bFirst=!0;this.pullResynchronizeLogsToDisplay()}),(function(e){this.notificationResendInProgress=!1}))}},pullResynchronizeLogsToDisplay:function(){for(var t,i=0;i<10;i++){if(void 0===(t=this.logs_to_load_sortedNotifsKeys.shift())){if(this.logs_to_load_loadhistory&&this.game&&$("move_nbr")&&toint($("move_nbr").innerHTML)>1){var n="/"+this.game.gameserver+"/"+this.game.game_name+"?table="+this.game.table_id+"&replayLastTurn=1&replayLastTurnPlayer="+this.game.player_id;this.addToLog('<p style="text-align:center;"><a href="'+n+'" class="bgabutton bgabutton_gray replay_last_move_button"><span class="textalign"><span class="icon32 icon32_replaylastmoves textalign_inner"></span></span> '+__("lang_mainsite","Replay last moves")+"</a></p>",!1,!1,"replay_last_moves")}gameui.log_history_loading_status.loaded=gameui.log_history_loading_status.total;gameui.updateLoaderPercentage();return}if(this.game&&"undefined"!=typeof g_replayFrom){bLast=t==this.logs_to_load.length-1;if(this.logs_to_load_bFirst)this.logs_to_load_bFirst=!1;else if(null!==this.logs_to_load[t].move_id){this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"end_replaywaitingdelay",uid:this.archive_uuid+10});this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"replaywaitingdelay",uid:this.archive_uuid+11})}if(this.logs_to_load_bMaskStillActive&&toint(this.logs_to_load[t].move_id)>=toint(g_replayFrom)){this.logs_to_load_bMaskStillActive=!1;this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"end_replayinitialwaitingdelay",uid:this.archive_uuid+20});this.logs_to_load[t].data.unshift({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"replayinitialwaitingdelay",uid:this.archive_uuid+21})}bLast&&this.game&&"undefined"!=typeof g_replayFrom&&this.logs_to_load[t].data.push({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"replay_has_ended",uid:this.archive_uuid+30})}this.onNotification(this.logs_to_load[t])}if("undefined"!=typeof gameui){gameui.log_history_loading_status.loaded=parseInt(t)+1;gameui.updateLoaderPercentage()}setTimeout(e.hitch(this,"pullResynchronizeLogsToDisplay"),0)},dispatchNotifications:function(){$("logs")&&e.style("logs","display","none");for(var t=!1,i=!1;this.queue.length>0;){if(null!==this.waiting_from_notifend){e.style("logs","display","block");return i}var n=this.queue.shift();if(n.uid&&n.uid==g_last_msg_dispatched_uid);else{t=this.dispatchNotification(n,t);i=!0;if(void 0!==this.synchronous_notifs[n.type]){$("synchronous_notif_icon")&&e.style("synchronous_notif_icon","display","inline");e.style("logs","display","block");return i}"undefined"!=typeof gameui&&gameui&&gameui.onEndOfNotificationDispatch&&gameui.onEndOfNotificationDispatch();if(void 0!==this.bStopAfterOneNotif&&this.bStopAfterOneNotif)break}}i&&this.game&&this.game.onNotificationPacketDispatched();$("logs")&&e.style("logs","display","block");return i},formatLog:function(e,t){var i="";if(""!=e)if(this.game){if(void 0!==t){t=this.playerNameFilterGame(t);i=this.game.format_string_recursive(e,t)}}else{t=this.playerNameFilter(t);i=mainsite.format_string_recursive(e,t)}return i},dispatchNotification:function(t,i){this.currentNotifCallback=t.type;if("undefined"!=typeof mainsite&&mainsite.filterNotification(t))return!1;if(t.uid&&t.uid==g_last_msg_dispatched_uid)return!1;if($("debug_output")){var n='<div>< <i><a href="#" id="replay_notif_'+this.debugnotif_i+'">'+t.type+'</a></i><br/><div class="notifparams" id="debugnotif_'+this.debugnotif_i+'">'+e.toJson(t.args)+"</div></div>";e.place(n,"debug_output","first");e.connect($("replay_notif_"+this.debugnotif_i),"onclick",this,"debugReplayNotif");this.debugnotif_i++}if(this.game&&void 0!==this.game.players_metadata[this.game.player_id]&&void 0!==this.game.players_metadata[this.game.player_id].bl&&this.game.players_metadata[this.game.player_id].bl&&Math.random()<.1)return!1;t.bIsTableMsg&&!this.game&&"tablechat"!=t.type&&"tableInfosChanged"!=t.type&&"refuseGameStart"!=t.type&&"newRTCMode"!=t.type&&(t.log="");"undefined"!=typeof mainsite&&"privatechat"==t.type&&"player"==mainsite.chatDetached.type&&toint(t.args.player_id)!=toint(mainsite.chatDetached.id)&&toint(t.args.target_id)!=toint(mainsite.chatDetached.id)&&(t.log="");if("undefined"!=typeof mainsite&&mainsite.bUnderage&&"chat"==t.type&&"/chat/general"==t.channelorig)return!1;var o=!!this.ignoreNotificationChecks[t.type]&&this.ignoreNotificationChecks[t.type](t);"history_history"==t.type&&(o=!!this.ignoreNotificationChecks[t.args.originalType]&&this.ignoreNotificationChecks[t.args.originalType](t));if(void 0!==t.log&&void 0!==t.args&&!o)if(""!=t.log||"startWriting"==t.type||"stopWriting"==t.type){var a=!1;null!==this.onPlaceLogOnChannel&&void 0!==t.channelorig&&(a=this.onPlaceLogOnChannel(e.clone(t)));if(!a){var s=t.args.logaction;n=this.formatLog(t.log,t.args);"undefined"!=typeof mainsite&&(n=mainsite.makeClickableLinks(n,!0));if("chatmessage"!=t.type&&"wouldlikethink"!=t.type||null===this.game){var r=this.addToLog(n,t.args.seemore,s,null!==this.game,"chat"==t.type||"groupchat"==t.type||"chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"startWriting"==t.type||"stopWriting"==t.type,"history_history"==t.type||void 0!==t.loadprevious,t.time);void 0!==t.move_id&&e.publish("addMoveToLog",[r,t.move_id])}else this.addToLog(n,t.args.seemore)}}else(this.log_notification_name,1)&&this.log_notification_name&&this.addToLog("<i>("+t.type+")</i>","");if(void 0!==t.move_id&&$("move_nbr")){if($("move_nbr").innerHTML!=t.move_id){$("move_nbr").innerHTML=t.move_id;$("images_status_text")&&null!==t.move_id&&($("images_status_text").innerHTML=_("Move")+" "+t.move_id);this.game&&this.game.onNextMove(t.move_id)}this.game&&this.game.onMove();if(this.game&&1==this.game.instantaneousMode&&"undefined"!=typeof g_replayFrom)if(toint(t.move_id)>=toint(g_replayFrom)){this.game.instantaneousMode=!1;e.query(".dijitDialog").forEach(e.destroy);e.query(".dijitDialogUnderlayWrapper").forEach(e.destroy);setTimeout(e.hitch(this,(function(){this.game.setLoader(100)})),1500);this.game.setLoader(100)}else{var l=Math.floor(100*toint(t.move_id)/toint(g_replayFrom));this.game.setLoader(l)}}t.lock_uuid&&e.publish("lockInterface",[{status:"dispatched",uuid:t.lock_uuid,bIsTableMsg:t.bIsTableMsg}]);if(void 0!==this.synchronous_notifs[t.type]){this.waiting_from_notifend;this.waiting_from_notifend=t;var d=this.synchronous_notifs[t.type];if(d>0){(this.game&&1==this.game.instantaneousMode||o)&&(d=1);setTimeout("endnotif()",d)}}"string"==typeof t.uid&&t.uid&&"archivewaitingdelay"!=t.uid.substr(0,19)&&(g_last_msg_dispatched_uid=t.uid);!o&&e.publish(t.type,[t]);void 0===this.synchronous_notifs[t.type]&&t.lock_uuid&&e.publish("lockInterface",[{status:"updated",uuid:t.lock_uuid,bIsTableMsg:t.bIsTableMsg}]);if(o);else if(this.game&&1==this.game.instantaneousMode);else if(this.game&&void 0!==this.game.bDisableSoundOnMove&&this.game.bDisableSoundOnMove);else if("chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"groupchat"==t.type){var c=0;"undefined"!=typeof current_player_id&&(c=current_player_id);"undefined"!=typeof gameui&&void 0!==gameui.player_id&&(c=gameui.player_id);void 0!==t.args.text&&null===t.args.text||void 0!==t.args.player_id&&t.args.player_id==c||playSound("chatmessage")}else if(!i&&null!==this.game&&"playerstatus"!=t.type&&t.log){i=!0;"undefined"!=typeof gameui&&gameui.bDisableNextMoveOnNextSound?gameui.bDisableNextMoveOnNextSound=!1:playSound("move")}if(this.game){this.game.adaptPlayersPanels();this.game.adaptStatusBar()}this.currentNotifCallback=null;return i},addChatToLog:function(t,i,n,o){void 0===n&&(n=!0);void 0===o&&(o="");if($("chatlogs")){var a=this.next_log_id;this.next_log_id++;var s="chatlogs",r=15e3;if(this.game&&this.game.instantaneousMode){r=0;s="logs"}var l='<div class="roundedbox roundedboxenlighted log logchat '+o+'" id="log_'+a+'"><div class="roundedbox_top"><div class="roundedbox_topleft"></div><div class="roundedbox_topmain"></div><div class="roundedbox_topright"></div></div><div class="roundedbox_main"></div><div class="roundedbox_bottom"><div class="roundedbox_bottomleft"></div><div class="roundedbox_bottommain"></div><div class="roundedbox_bottomright"></div></div><div class="roundedboxinner">';i&&(this.game?l+='<a href="'+this.game.metasiteurl+"/"+i+'" target="_blank" class="seemore"><div class="icon16 icon16_seemore"></div></a>':l+='<a href="'+i+'" class="seemore"><div class="icon16 icon16_seemore"></div></a>');this.game?l+=this.game.addSmileyToText(t):l+=mainsite.addSmileyToText(t);n&&(l+='<div class="translate_icon" id="logtr_'+a+'" title="'+_("Translate with Google")+'"></div>');l+="</div></div>";e.place(l,s,"first");n&&$("logtr_"+a)&&e.connect($("logtr_"+a),"onclick",this,"onTranslateLog");var d="log_"+a;e.style(d,"display","none");e.fx.chain([e.fx.wipeIn({node:d}),e.animateProperty({node:$(d),delay:5e3,properties:{color:{end:"#000000"},onEnd:function(t){e.style(t,"display","block")}}})]).play();r>0&&setTimeout(e.hitch(this,(function(){var t=e.clone($(d));e.destroy(d);e.place(t,"logs","first");e.style(t,"position","relative");e.style(t,"top","-10px");e.animateProperty({node:t,delay:200,properties:{top:{end:0,unit:"px"}}}).play();$("logtr_"+a)&&e.connect($("logtr_"+a),"onclick",this,"onTranslateLog")})),r)}},onTranslateLog:function(e){e.preventDefault();e.stopPropagation();var t=e.currentTarget.parentElement,i=t.innerHTML;i=(i=(i=(i=(i=(i=i.replace(/<!--PNS.*--PNE-->/gi,"")).replace(/<b><a.*a><\/b> /gi,"")).replace(/<a href.*<br>/gi,"")).replace(/<span.*span> /gi,"")).replace(/<div.*div>/gi,"")).replace(/&nbsp;/gi," ");var n=encodeURIComponent(i),o=dojoConfig.locale;switch(o){case"zh":o="zh-TW";break;case"zh-cn":o="zh-CN";break;case"he":o="iw"}var a="translateChat",s=n;s+=" "+n.length;s+=" "+o;if(this.game){s="[P"+this.game.player_id+"@T"+this.game.table_id+"] "+s;this.game.ajaxcall("/web/scriptlogger/"+a+".html",{log:s,lock:!1},this,(function(e){}),(function(e){}),"post")}else{var r=t.parentElement.parentElement.id,l=r.split("_")[2],d=r.split("_")[3];"privatechat"!=l&&"table"!=l&&(l="generalchat");s="[P"+current_player_id+"@"+("table"==l?"T"+d:l)+"] "+s;mainsite.ajaxcall("/web/scriptlogger/"+a+".html",{log:s,lock:!1},this,(function(e){}),(function(e){}),"post")}window.open("http://translate.google.com/#auto/"+o+"/"+n)},addToLog:function(t,i,n,o,a,s,r){void 0===a&&(a=!1);void 0===s&&(s=!1);var l="";a&&(l="spectator_chat");if($("logs")){var d=this.next_log_id;this.next_log_id++;var c='<div class="log '+l+'" id="log_'+d+'"><div class="roundedbox">';i&&(this.game?c+='<a href="'+this.game.metasiteurl+"/"+i+'" target="_blank" class="seemore"><div class="icon16 icon16_seemore"></div></a>':c+='<a href="'+i+'" class="seemore"><div class="icon16 icon16_seemore"></div></a>');a&&"undefined"!=typeof mainsite?c+=mainsite.addSmileyToText(t):a&&this.game?c+=this.game.addSmileyToText(t):c+=t;a&&(o||(c+='<div class="translate_icon '+(i?"translate_icon_seemore":"")+'" id="logtr_'+d+'" title="'+_("Translate with Google")+'"></div>'));if(null==this.game&&n){c+='<div class="logaction"><a href="#" id="logaction_'+d+'">['+(t=this.formatLog(n.log,n.args))+"]</a></div>"}c+="</div>";if(void 0!==r){var h=this.lastMsgTime,u=r;if(Math.floor(h/60)!=Math.floor(u/60)){var p=new Date(1e3*h),m=new Date(1e3*u);if(p.toLocaleDateString()!=m.toLocaleDateString())var g=m.toLocaleDateString()+" "+m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});else g=m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});c+='<div class="timestamp">'+g+"</div>";this.lastMsgTime=u}}c+="</div>";e.place(c,"logs","first");o||$("logtr_"+d)&&e.connect($("logtr_"+d),"onclick",this,"onTranslateLog");null==this.game&&n&&$("logaction_"+d)&&e.connect($("logaction_"+d),"onclick",this,(function(t){e.stopEvent(t);mainsite.ajaxcall(n.action,n.action_arg,this,(function(){}))}));var f="log_"+d;e.style(f,"display","none");if(s){e.style(f,"color","black");e.style(f,"display","block")}else e.fx.chain([e.fx.wipeIn({node:f}),e.animateProperty({node:$(f),delay:5e3,properties:{color:{end:"#000000"},onEnd:function(t){e.style(t,"display","block")}}})]).play()}else if(null!==this.onPlaceLogOnChannel){var v={channelorig:"/chat/general",args:{},log:t,type:"service",time:Math.min((new Date).getTime()/1e3)};bNotifSend=this.onPlaceLogOnChannel(v)}return d},playerNameFilter:function(e){e.player_name&&e.player_id&&(e.player_name='<b><a href="/player?id='+e.player_id+'" class="playername">'+e.player_name+"</a></b>");return e},playerNameFilterGame:function(e){if(void 0!==e){if(this.game)for(argname in e)if("i18n"!=argname&&"object"==typeof e[argname])null!==e[argname]&&void 0!==e[argname].log&&void 0!==e[argname].args&&(e[argname].args=this.playerNameFilterGame(e[argname].args));else if(argname.match(/^player_name(\d+)?$/)){var t="",i="";for(var n in this.game.gamedatas.players)if(this.game.gamedatas.players[n].name==e[argname]){t=this.game.gamedatas.players[n].color;i="";this.game.gamedatas.players[n].color_back&&(i="background-color:#"+this.game.gamedatas.players[n].color_back+";");break}e[argname]=""!=t?'\x3c!--PNS--\x3e<span class="playername" style="color:#'+t+";"+i+'">'+e[argname]+"</span>\x3c!--PNE--\x3e":'\x3c!--PNS--\x3e<span class="playername">'+e[argname]+"</span>\x3c!--PNE--\x3e"}return e}},setSynchronous:function(e,t){this.synchronous_notifs[e]=void 0===t?-1:t},setSynchronousDuration:function(e){this.game&&this.game.instantaneousMode&&(e=1);setTimeout("endnotif()",e)},isSynchronousNotifProcessed:function(){return null!==this.waiting_from_notifend},setIgnoreNotificationCheck:function(e,t){this.ignoreNotificationChecks[e]=t},onSynchronousNotificationEnd:function(){if(null!==this.waiting_from_notifend){this.waiting_from_notifend.lock_uuid&&e.publish("lockInterface",[{status:"updated",uuid:this.waiting_from_notifend.lock_uuid,bIsTableMsg:this.waiting_from_notifend.bIsTableMsg}]);$("synchronous_notif_icon")&&e.style("synchronous_notif_icon","display","none");this.waiting_from_notifend=null;"undefined"!=typeof gameui&&gameui&&gameui.onEndOfNotificationDispatch&&gameui.onEndOfNotificationDispatch();void 0!==this.bStopAfterOneNotif&&this.bStopAfterOneNotif||this.dispatchNotifications()}},debugReplayNotif:function(t){t.preventDefault();var i=t.currentTarget.id.substr(13),n={};n.type=$("replay_notif_"+i).innerHTML;var o=$("debugnotif_"+i).innerHTML;n.args=e.fromJson(o);this.dispatchNotification(n,!1)}})}))},"ebg/core/gamegui":function(){define(["dojo","dojo/_base/declare","dojo/query","dijit/DialogUnderlay","dijit/TooltipDialog","ebg/core/sitecore","ebg/gamenotif","ebg/chatinput","dijit/Dialog","ebg/playerlocation","ebg/pageheader","ebg/draggable","ebg/tableresults","ebg/paymentbuttons"],(function(e,t,i){e.extend(dijit.DialogUnderlay,{layout:function(){var t=this.node.style,i=this.domNode.style;i.display="none";var n=e.position("left-side",!0),o=e.position("overall-header",!0);i.top=n.y+o.h+"px";i.left=n.x+"px";t.width=n.w+"px";t.height=n.h-o.h+"px";i.display="block"}});e.extend(dijit.Dialog,{_position:function(){this.autofocus=!1;if(!e.hasClass(e.body(),"dojoMove")){var t=this.domNode,i=e.window.getBox(),n=e.position("left-side",!0),o=e.position("topbar",!0),a=this._relativePosition,s=a?null:e.position(t),r=Math.floor(n.x+(a?a.x:(n.w-s.w)/2)),l=Math.floor(i.t+(a?a.y:(i.h-s.h)/2));i.t<=o.h&&!a&&(l=Math.floor(o.h+(i.h-(o.h-i.t)-s.h)/2));e.style(t,{left:r+"px",top:l+"px"})}}});return t("ebg.core.gamegui",ebg.core.sitecore,{constructor:function(){this.game_name="";this.game_name_displayed="";this.gamedatas=null;this.channel=null;this.privatechannel=null;this.player_id=null;this.table_id=null;this.scoreCtrl=[];this.currentPlayerReflexionTime={positive:!0,mn:0,s:0};this.activePlayerReflexionTime={positive:!0,mn:0,s:0};this.clock_timeout=null;this.clock_opponent_timeout=null;this.wakeup_timeout=null;this.wakupchek_timeout=null;this.forceTestUser=null;this.next_private_args=null;this.next_archive_index=0;this.archive_playmode="stop";this.archive_gotomove=null;this.archive_previous_player=null;this.archive_uuid=999999;this.archiveCommentNew=null;this.archiveCommentNewAnchor="";this.archiveCommentNo=0;this.archiveCommentNbrFromStart=0;this.archiveCommentLastDisplayedNo=0;this.archiveCommentLastDisplayedId=0;this.archiveCommentMobile={id:0,anchor:"",bCenter:!1,lastX:0,lastY:0};this.archiveCommentPosition=["below","above","after","before"];this.bJumpToNextArchiveOnUnlock=!1;this.archiveCommentAlreadyDisplayed={};this.tuto_pointers_types_nbr=20;this.tuto_textarea_maxlength=400;this.last_server_state=null;this.on_client_state=!1;this.tablechat=null;this.mediaRatingParams="";this.quitDlg=null;this.isSpectator=!0;this.log_mode="normal";this.nextPubbanner=null;this.interface_locked_by_id=null;this.interface_status="updated";this.interface_locking_type=null;this.isNotifWindow=!1;this.lastWouldLikeThinkBlinking=null;this.gamepreferences_control={};this.blinkid=null;this.developermode=!1;this.last_visitorlist={};this.jstpl_player_tooltip='<div class="active_player_iconinfos"><div class="emblemwrap_xxl"><img class="emblem" src="${avatarurl}"></img></div><div class="active_player_small_infos_block"><p><div class="flag" id="flag_${player_id}" style="background-position: -${flagx}px -${flagy}px"></div> ${country} ${city}</p><p><div class="fa fa-comment-o languages_spoken" id="ttspeak_${player_id}"></div> <span id="speak_${player_id}">${languages}</span></p><p><div class="fa ${genderclass}" id="gender_${player_id}"></div></p> </div><div id="reputationbar_${player_id}" class="progressbar progressbar_reputation reputation_${karma_class}" style="display:${progressbardisplay}"><div class="progressbar_label"><span class="symbol">☯</span><span class="value">${karma}%</span></div><div class="progressbar_bar"><span class="progressbar_valuename">${karma_label}</span><div class="progressbar_content" style="width:${karma}%"><span class="progressbar_valuename">${karma_label}</span></div></div></div></div>';this.playerlocation=null;this.log_to_move_id={};this.tutorialItem={};this.current_player_was_active=!1;this.current_player_is_active=!1;this.showOpponentCursorMouveOver=null;this.showOpponentCursorClickHook=null;this.showOpponentCursorClickCounter=0;this.showOpponentCursorClickCooldown=null;this.showOpponentCursorClickNumberSinceCooldown=0;this.ebgControls=[];this.bThisGameSupportFastReplay=!1;this.images_loading_status={};this.log_history_loading_status={downloaded:0,total:0,loaded:0};this.is_sandbox=!1;this.jstpl_player_ranking='<div class="player_in_list player_in_list_withbaseline player_in_list_fullwidth player_in_list_rank ${add_class}">                    <div class="rank">${rank}</div>                    <div class="emblemwrap ${premium}">                        <img class="pl_avatar emblem" src="${avatar}"/>                        <div class="emblempremium"></div>                        <i class="fa fa-${device} playerstatus status_${status}"></i>                    </div>                    <a href="/player?id=${id}" class="playername">${name}</a>                    <div class="player_baseline"><div class="flag" id="flag_${id}" style="display:${flagdisplay};background-position: -${flagx}px -${flagy}px"></div></div>                    <div class="ranking ${additional_ranking}">${ranking}</div>                </div>';this.jstpl_hotseat_interface='<iframe src="${url}" frameborder="0"  class="hotseat_iframe" id="hotseat_iframe_${player_id}"></iframe>';this.gameinterface_zoomFactor=1;this.control3dxaxis=40;this.control3dzaxis=10;this.control3dxpos=-25;this.control3dypos=0;this.control3dscale=1.4;this.control3dmode3d=!1;this.GAMEPREFERENCE_DISPLAYTOOLTIPS=200},completesetup:function(t,i,n,o,a,s,r,l,d,c,h){var u="keep_existing_gamedatas_limited"==r;this.gamedatas=l;if(e.hasClass("ebd-body","new_gameux")){e.place($("upperrightmenu"),"page-title");e.place($("reflexiontime_value"),"page-title");e.place($("ingame_menu_content"),"page-title")}var p=[this.gamedatas.gamestate];this.gamedatas.gamestate.private_state&&p.push(this.gamedatas.gamestate.private_state);p.forEach(function(e){if(void 0!==e.id){this.gamedatas.gamestates[e.id];void 0!==this.gamedatas.gamestates[e.id].args&&delete this.gamedatas.gamestates[e.id].args;void 0!==this.gamedatas.gamestates[e.id].updateGameProgression&&delete this.gamedatas.gamestates[e.id].updateGameProgression;for(var t in this.gamedatas.gamestates[e.id])e[t]=this.gamedatas.gamestates[e.id][t]}}.bind(this));if(u)this.applyTranslationsOnLoad();else{this.game_name=t;this.game_name_displayed=i;this.player_id=o;this.table_id=n;this.original_game_area_html=$("game_play_area").innerHTML;this.setLoader(10,10);for(var m in l.players)this.player_id==m&&(this.isSpectator=!1);$("debug_output")&&(this.developermode=!0);$("notifwindow_beacon")&&(this.isNotifWindow=!0);e.query(".expressswitch").length>0&&(g_archive_mode||(this.forceTestUser=o));if(this.discussblock&&this.isSpectator){this.showMessage(__("lang_mainsite","A player at thie table blocked you."),"error");setTimeout(e.hitch(this,(function(){window.location.href=this.metasiteurl+"/table?table="+this.table_id})),2e3);return}g_i18n.jsbundlesversion=this.jsbundlesversion;g_i18n.loadBundle("lang_mainsite");g_i18n.loadBundle("lang_"+t);g_i18n.setActiveBundle("lang_"+t);this.translate_client_targets({you:__("lang_mainsite","You")},"lang_"+t);this.init_core();this.setupCoreNotifications();this.applyTranslationsOnLoad();if("undefined"!=typeof g_replayFrom){this.lockInterface("replayFrom");this.instantaneousMode=!0;if($("current_header_infos_wrap")){e.style("current_header_infos_wrap","display","none");e.style("previously_on","display","block")}if(this.gameUpgraded){e.addClass("loader_skip","loader_skip_warning");$("loader_skip").innerHTML='<div class="icon20 icon20_warning"></div> '+__("lang_mainsite","This game has been updated since game start: thus the replay is EXPERIMENTAL.")+"<br/>"+$("loader_skip").innerHTML;e.style("gameUpdated","display","block")}}this.onGameUiWidthChange()}this.gamedatas.game_result_neutralized>0&&this.showNeutralizedGamePanel(this.gamedatas.game_result_neutralized,this.gamedatas.neutralized_player_id);this.isNotifWindow||this.setup(l,u);for(m in l.players){var g=l.players[m];if(void 0===this.scoreCtrl[m]){$("player_score_"+m).innerHTML=g.score;this.scoreCtrl[m]=new ebg.counter;this.scoreCtrl[m].create($("player_score_"+m))}if(void 0!==g.score){if(!this.is_sandbox){this.scoreCtrl[m].setValue(g.score);null===g.score&&this.scoreCtrl[m].disable()}}else this.scoreCtrl[m].disable();u||(this.gamedatas.players[m].ack="ack")}if(!u){this.players_metadata=d;for(m in d){g=d[m];var _=this.getPlayerTooltip(g);this.addTooltipHtml("player_name_"+m,_);this.addTooltipHtml("avatar_"+m,_);1==d[m].is_premium&&e.addClass("avatarwrap_"+m,"is_premium");null!==g.gender&&0==g.gender&&void 0!==l.players[m]?this.gameFemininePlayers.push(l.players[m].name):null!==g.gender&&1==g.gender&&void 0!==l.players[m]?this.gameMasculinePlayers.push(l.players[m].name):this.gameNeutralPlayers.push(l.players[m].name)}if(void 0!==this.gamedatas.players[o]&&1!=this.gamedatas.players[o].zombie&&this.rtc_mode>0&&null!==this.rtc_room)if(this.rtc_room.indexOf("T")>=0)this.setNewRTCMode(this.table_id,null,this.rtc_mode);else if(this.rtc_room.indexOf("P")>=0){var f=this.rtc_room.substr(1).split("_"),v=f[0]==o?f[1]:f[0];this.createChatBarWindow({type:"privatechat",id:v,label:"",game_name:"",url:"",channel:"/player/p"+v,window_id:"privatechat_"+v,subscribe:!1,start:"expanded"},!1);this.expandChatWindow("privatechat_"+v);this.setNewRTCMode(null,v,this.rtc_mode)}this.notifqueue.game=this}this.last_server_state=e.clone(this.gamedatas.gamestate);this.updateActivePlayerAnimation()&&this.sendWakeUpSignal();this.updatePageTitle();this.gamedatas.decision=this.decision;this.updateDecisionPanel(this.gamedatas.decision);"gameEnd"==l.gamestate.name?this.onGameEnd():"tutorialStart"==l.gamestate.name&&this.isCurrentPlayerActive()&&this.showTutorialActivationDlg();e.addClass("overall-content","gamestate_"+l.gamestate.name);this.onEnteringState(l.gamestate.name,l.gamestate);if(null!=l.gamestate.private_state){this.updatePageTitle(l.gamestate.private_state);this.onEnteringState(l.gamestate.private_state.name,l.gamestate.private_state)}if("gameSetup"==l.gamestate.name&&!g_archive_mode){this.paymentbuttons=new ebg.paymentbuttons;this.paymentbuttons.create(this);this.lockScreenCounter()}$("pr_gameprogression").innerHTML=l.gamestate.updateGameProgression;if(!u){this.addTooltip("game_progression_bar",__("lang_mainsite","Current game progression"),"");this.addTooltip("toggleSound","",__("lang_mainsite","Switch the sound on/off"));this.addTooltip("globalaction_pause","",__("lang_mainsite","Signals you want to pause the game"));this.addTooltip("globalaction_fullscreen","",__("lang_mainsite","Fullscreen mode"));this.addTooltip("globalaction_help","",__("lang_mainsite","Help about this game"));this.addTooltip("globalaction_preferences","",__("lang_mainsite","Change your preferences for this game"));this.addTooltip("globalaction_quit","",__("lang_mainsite","Quit current game"));e.connect($("globalaction_fullscreen"),"onclick",this,"onGlobalActionFullscreen");e.connect($("globalaction_zoom_wrap"),"onclick",this,"onZoomToggle");e.connect($("ingame_menu_quit"),"onclick",this,"onGlobalActionQuit");e.connect($("ingame_menu_back"),"onclick",this,"onGlobalActionBack");e.connect($("skip_player_turn"),"onclick",this,"onWouldFirePlayer");if(g_archive_mode){this.setLoader(100,100);e.style("connect_status","display","none");e.style("connect_gs_status","display","none");e.style("chatbar","display","none");$("gotonexttable_wrap")&&e.destroy("gotonexttable_wrap");if(e.hasClass("archivecontrol","demomode")){e.style("archivecontrol","display","none");if($("demomode_registration_ok")){e.connect($("demomode_registration_email"),"onfocus",this,(function(){$("demomode_registration_email").value=""}));e.connect($("demomode_registration_ok"),"onclick",this,(function(t){e.stopEvent(t);this.ajaxcall("/archive/archive/fastRegistration.html",{email:$("demomode_registration_email").value},this,(function(e){}))}))}}if("edit"==g_tutorialwritten.mode){var b=__("lang_mainsite","Publish as tutorial");g_tutorialwritten.top_game&&e.place('<div class="whiteblock"><p><i class="fa fa-warning"></i> '+__("lang_mainsite","This game is one of the most played: admins may be particularly demanding and picky about tutorials written for this game.")+"</div>","logs_wrap","before");g_tutorialwritten.old_game&&e.place('<div class="whiteblock"><p><i class="fa fa-warning"></i> '+__("lang_mainsite","This replay is quite old and you may not benefit from the most recent tutorial creation tool features: we suggest you to choose a more recent one.")+"</div>","logs_wrap","before");if("private"==this.game_status)e.place('<div class="whiteblock"><p><i class="fa fa-info-circle"></i> '+__("lang_mainsite","You cannot publish a tutorial for a game in Alpha")+"<p>","logs_wrap","before");else if("terramystica"==this.game_name)e.place('<div class="whiteblock"><p><i class="fa fa-info-circle"></i> '+__("lang_mainsite","Sorry, but for legal reasons we cannot propose tutorial for this game on BGA.")+"<p>","logs_wrap","before");else if(null!==g_tutorialwritten.status){b=__("lang_mainsite","Update tutorial");var y=window.location.href+"&tutorial";y=y.replace("#&tutorial","&tutorial");if("public"==g_tutorialwritten.status){e.place('<div class="whiteblock"><p>'+__("lang_mainsite","Your tutorial is now available to everyone on BGA.")+'<p><a href="'+y+'" target="_blank">'+__("lang_mainsite","Preview tutorial")+"</a></p></div>","logs_wrap","before");e.place('<div class="whiteblock"><p><i class="fa fa-warning"></i> '+__("lang_mainsite","Any update you make is immediately applied to the published tutorial.")+"</div>","logs_wrap","before")}else if("rejected"==g_tutorialwritten.status)e.place('<div class="whiteblock"><p>'+__("lang_mainsite","Your tutorial has unfortunately be rejected :(")+'<p><a href="'+y+'" target="_blank">'+__("lang_mainsite","Preview tutorial")+"</a></p></div>","logs_wrap","before");else if("beta"==g_tutorialwritten.status){e.place('<div class="whiteblock"><p>'+__("lang_mainsite","BETA: Your tutorial is now being tested with some random players on BGA.")+'<p><a href="'+y+'" target="_blank">'+__("lang_mainsite","Preview tutorial")+"</a></p></div>","logs_wrap","before");e.place('<div class="whiteblock"><p><i class="fa fa-warning"></i> '+__("lang_mainsite","Any update you make is immediately applied to the published tutorial.")+"</div>","logs_wrap","before")}else if("alpha"==g_tutorialwritten.status){e.place('<div class="whiteblock"><p>'+__("lang_mainsite","ALPHA: Your tutorial is being reviewed by some expert players.")+'<p><p style="word-wrap: break-word;"><a href="'+y+'" target="_blank">'+y+"</a></p></div>","logs_wrap","before");e.place('<div class="whiteblock"><p><i class="fa fa-warning"></i> '+__("lang_mainsite","Any update you make is immediately applied to the published tutorial.")+"</div>","logs_wrap","before")}}else e.place('<p style="text-align:center;display:none;" id="publishtutorial_block" style="display:none;"><a id="publishtutorial" class="bgabutton bgabutton_blue">'+b+"</a><p>","logs_wrap","before");e.place('<p style="text-align:center;display:block;"><a id="howto_tutorial" class="bgabutton bgabutton_gray"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> '+__("lang_mainsite","How to build a tutorial?")+"</a><p>","logs_wrap","before");for(var w='<div id="tuto_pointers_choice">',C=1;C<=this.tuto_pointers_types_nbr;C++){w+='<div id="tuto_pointer_'+C+'" class="tuto_pointer tuto_pointer_'+C+'" style="background-position: -'+(C-1)%10*42+"px -"+42*Math.floor((C-1)/10)+'px"></div>'}w+="</div>";e.place(w,"logs_wrap","before");e.query(".tuto_pointer").connect("onclick",this,"onTutoPointerClick");e.addClass("tuto_pointer_1","selected");e.connect($("howto_tutorial"),"onclick",this,"onHowToTutorial");$("publishtutorial")&&e.connect($("publishtutorial"),"onclick",this,"onPublishTutorial");$("publishtutorial_block")&&e.style("publishtutorial_block","display",e.query(".archiveComment").length>0?"block":"none");e.style("archivecontrol_editmode","display","block");e.style("archivecontrol_viewmode","display","none")}else{if(g_tutorialwritten.author==g_tutorialwritten.viewer_id){if($("bga_release_id"))var k=$("bga_release_id").innerHTML;else{var x=g_themeurl.split("/");x.pop();k=x.pop()}var T="/archive/replay/"+k+"/?table="+this.table_id+"&player="+this.player_id+"&comments="+g_tutorialwritten.author+";";e.place('<p style="text-align:center;display:block;"><a href="'+T+'" class="bgabutton bgabutton_gray"><i class="fa fa-pencil" aria-hidden="true"></i> '+__("lang_mainsite","Edit tutorial")+"</a><p>","logs_wrap","before")}e.addClass("ebd-body","game_tutorial_mode");e.style("archivecontrol_editmode","display","none");e.style("archivecontrol_viewmode","display","block");e.style("ingame_menu","display","none");e.style("maingameview_menufooter","display","none");e.style("overall-footer","display","none");e.style("tableinfos","display","none");e.query(".player_board_inner .emblempremium").style("display","none");e.query(".player_board_inner .timeToThink").style("display","none");e.query(".player_board_inner .player_status").style("display","none");e.query(".player_board_inner .flag").style("display","none");e.query(".player_board_inner .player_elo_wrap").style("display","none");e.query(".player_board_inner .doubletime_infos").style("display","none");if($("quitTutorialTop")){e.connect($("quitTutorialTop"),"onclick",this,"onQuitTutorial");e.connect($("logoicon"),"onclick",this,"onQuitTutorial")}this.notifqueue.setSynchronous("archivewaitingdelay",1e3);e.place('<p style="text-align:center;display:block;"><a id="restart_tutorial" class="bgabutton bgabutton_gray" href="javascript:window.location.href=window.location.href"><i class="fa fa-undo" aria-hidden="true"></i> '+__("lang_mainsite","Restart tutorial?")+"</a><p>","logs_wrap","before");e.connect($("ebd-body"),"onkeyup",this,"onKeyUpTutorial");e.connect($("ebd-body"),"onkeypress",this,"onKeyPressTutorial")}e.connect($("archive_next"),"onclick",this,"onArchiveNext");e.connect($("archive_next_turn"),"onclick",this,"onArchiveNextTurn");e.connect($("archive_end_game"),"onclick",this,"onArchiveGoTo");e.connect($("archive_go_to_nextComment"),"onclick",this,"onNewArchiveCommentNext");e.connect($("archive_history"),"onclick",this,"onArchiveHistory");e.connect($("archive_nextlog"),"onclick",this,"onArchiveNextLog");e.connect($("archive_addcomment"),"onclick",this,"onArchiveAddComment");this.addTooltip("archive_addcomment","",__("lang_mainsite","Add some public comment"));this.addTooltip("archive_history","",__("lang_mainsite","Show game history"));this.addTooltip("archive_nextlog","",__("lang_mainsite","Next visible change"));this.addTooltip("archive_restart","",__("lang_mainsite","Go back to first move"));this.addTooltip("archive_next","",__("lang_mainsite","Next move"));this.addTooltip("archive_next_turn","",__("lang_mainsite","Next turn"));this.addTooltip("archive_end_game","",__("lang_mainsite","Go to game end"));e.place('<div id="archiveCommentMinimized"><div id="archiveCommentMinimizedIcon"><i class="fa fa-graduation-cap fa-2x"></i></div></div>',"maintitlebar_content");e.connect($("archiveCommentMinimizedIcon"),"onclick",this,"onArchiveCommentMaximize");e.style("archive_history","display","none");e.style("archive_next_turn","display","none");e.style("archive_nextlog","display","none");e.style("archive_go_to_move_wrap","display","none");e.style("archive_go_to_move","display","none");e.connect($("advanced_replay_features"),"onclick",this,(function(t){e.stopEvent(t);e.style("archive_history","display","inline");e.style("archive_nextlog","display","inline");e.style("advanced_replay_features","display","none");e.style("archive_go_to_move_wrap","display","block");this.bEnabledArchiveAdvancedFeatures=!0;if(void 0!==this.archiveGotoMenu){dijit.popup.close(this.archiveGotoMenu);this.archiveGotoMenu.destroy();delete this.archiveGotoMenu}}))}e.connect($("not_playing_help"),"onclick",this,"onNotPlayingHelp");e.connect($("ai_not_playing"),"onclick",this,"onAiNotPlaying");e.connect($("wouldlikethink_button"),"onclick",this,"onWouldLikeToThink");e.connect($("decision_yes"),"onclick",this,"onPlayerDecide");e.connect($("decision_no"),"onclick",this,"onPlayerDecide");e.connect($("zombieBack_button"),"onclick",this,"onZombieBack")}this.isSpectator||g_archive_mode||1!=l.players[this.player_id].zombie||this.displayZombieBack();if(!u){e.subscribe("lockInterface",this,"onLockInterface");this.channel="/table/t"+this.table_id;this.tablechannelSpectators="/table/ts"+this.table_id;this.privatechannel="/player/p"+s;this.notifqueue.checkSequence=!0;l.notifications.table_next_notification_no?this.notifqueue.last_packet_id=l.notifications.table_next_notification_no:this.notifqueue.last_packet_id=l.notifications.last_packet_id;e.connect(this.notifqueue,"addToLog",this,"onNewLog");e.subscribe("addMoveToLog",this,"addMoveToLog")}$("move_nbr")&&($("move_nbr").innerHTML=l.notifications.move_nbr);if($("menu_option_value_206")){$("menu_option_value_206").innerHTML=this.playingHoursToLocal($("menu_option_value_206").innerHTML);var A=$("menu_option_value_206").innerHTML;if(-1==A.indexOf(":"))this.playingHours={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0,14:!0,15:!0,16:!0,17:!0,18:!0,19:!0,20:!0,21:!0,22:!0,23:!0};else{var j=toint(A.substr(0,A.indexOf(":")));this.playingHours={0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,10:!1,11:!1,12:!1,13:!1,14:!1,15:!1,16:!1,17:!1,18:!1,19:!1,20:!1,21:!1,22:!1,23:!1};for(var S=0;S<12;S++)this.playingHours[(j+S)%24]=!0}}$("footer_option_value_206")&&($("footer_option_value_206").innerHTML=this.playingHoursToLocal($("footer_option_value_206").innerHTML));if(!u)if(g_archive_mode){this.initArchiveIndex();this.notifqueue.checkSequence=!1;this.initCommentsForMove($("move_nbr").innerHTML);this.checkIfArchiveCommentMustBeDisplayed()}else{this.cometd_service=r;var M={user:this.player_id,name:this.current_player_name,credentials:a};this.socket=io(c,{query:e.objectToQuery(M),path:"/"+h});this.socket.on("bgamsg",e.hitch(this.notifqueue,"onNotification"));this.socket.on("connect",e.hitch(this,(function(e){this.onSocketIoConnectionStatusChanged("connect")})));this.socket.on("connect_error",e.hitch(this,(function(e){this.onSocketIoConnectionStatusChanged("connect_error",e)})));this.socket.on("connect_timeout",e.hitch(this,(function(e){this.onSocketIoConnectionStatusChanged("connect_timeout")})));this.socket.io.on("reconnect",e.hitch(this,(function(e){this.onSocketIoConnectionStatusChanged("reconnect",e)})));this.socket.io.on("reconnect_attempt",e.hitch(this,(function(e){this.onSocketIoConnectionStatusChanged("reconnect_attempt")})));this.socket.io.on("reconnect_error",e.hitch(this,(function(e){this.onSocketIoConnectionStatusChanged("reconnect_error",e)})));this.socket.io.on("reconnect_failed",e.hitch(this,(function(e){this.onSocketIoConnectionStatusChanged("reconnect_failed")})));this.subscribeCometdChannel("/general/emergency",this.notifqueue,"onNotification");this.subscribeCometdChannel(this.channel,this.notifqueue,"onNotification");this.subscribeCometdChannel(this.tablechannelSpectators,this.notifqueue,"onNotification");this.subscribeCometdChannel("/player/p"+this.player_id,this.notifqueue,"onNotification");this.notifqueue.cometd_service=this.cometd_service;if(""!=this.gs_socketio_url){M={user:this.player_id,name:this.current_player_name,credentials:a};this.gs_socket=io(this.gs_socketio_url,{query:e.objectToQuery(M),path:"/"+this.gs_socketio_path});this.gs_socket.on("bgamsg",e.hitch(this.notifqueue,"onNotification"));this.gs_socket.on("connect",e.hitch(this,(function(e){this.onGsSocketIoConnectionStatusChanged("connect")})));this.gs_socket.on("connect_error",e.hitch(this,(function(e){this.onGsSocketIoConnectionStatusChanged("connect_error",e)})));this.gs_socket.on("connect_timeout",e.hitch(this,(function(e){this.onGsSocketIoConnectionStatusChanged("connect_timeout")})));this.gs_socket.io.on("reconnect",e.hitch(this,(function(e){this.onGsSocketIoConnectionStatusChanged("reconnect",e)})));this.gs_socket.io.on("reconnect_attempt",e.hitch(this,(function(e){this.onGsSocketIoConnectionStatusChanged("reconnect_attempt")})));this.gs_socket.io.on("reconnect_error",e.hitch(this,(function(e){this.onGsSocketIoConnectionStatusChanged("reconnect_error",e)})));this.gs_socket.io.on("reconnect_failed",e.hitch(this,(function(e){this.onGsSocketIoConnectionStatusChanged("reconnect_failed")})));this.gs_socket.emit("join",this.channel);this.gs_socket.emit("join",this.tablechannelSpectators);this.gs_socket.emit("join","/player/p"+this.player_id)}else{e.style("connect_gs_status","display","none");this.gs_socket=this.socket}}if(!u){if(this.dockedChat){var E={type:"table",game_name:this.game_name,id:this.table_id,label:__("lang_mainsite","Discuss at this table"),url:null,channel:"/table/t"+this.table_id,window_id:"table_"+this.table_id,start:"collapsed",notifymethod:"title",autoShowOnKeyPress:!0};this.createChatBarWindow(E,!1);e.connect(this.chatbarWindows["table_"+this.table_id].input,"callbackBeforeChat",this,"onBeforeChatInput");e.connect($("chatbarinput_table_"+this.table_id+"_input"),"onblur",this,"onChatInputBlur");e.connect(document,"onkeydown",this,"onChatKeyDown");e.connect($("chatbarinput_table_"+this.table_id+"_input"),"onkeydown",this,"onChatKeyDown");this.loadPreviousMessage("table",this.table_id)}else{this.tablechat=new ebg.chatinput;this.tablechat.detachType="playtable";this.tablechat.detachTypeGame=this.game_name;this.tablechat.detachId=this.table_id;this.tablechat.create(this,"chatinput","/table/table/say.html",__("lang_mainsite","Discuss at this table"));this.tablechat.baseparams={table:this.table_id};this.tablechat.callbackBeforeChat=e.hitch(this,"onBeforeChatInput")}this.updatePlayerOrdering();var N=[__("lang_mainsite","If the game seems blocked or buggy, please <b>refresh</b> the webpage or <b>press F5</b>."),__("lang_mainsite","Insults and aggressive behaviours are stricly forbidden in this chatroom. Please report us any incident: we take an immediate action againt all problematic players."),__("lang_mainsite","You can mute sound by clicking on:")+' <div class="icon20 icon20_mute"></div>',__("lang_mainsite","To play in fullscreen, click on:")+' <div class="icon20 icon20_fullscreen"></div>',__("lang_mainsite","You have a wide screen ? You can choose in preferences to display players information and game logs in 2 columns:")+' <div class="icon20 icon20_config"></div>',__("lang_mainsite","You find a bug ? Please report it in BGA bug reporting system, a description and if possible a screenshot. Thank you."),__("lang_mainsite","If some player is not playing, just wait until he run out reflexion time, then kick him out the game.")],D=N.length,I=Math.floor(Math.random()*D)%D;g_archive_mode||this.notifqueue.addToLog("<b>"+__("lang_mainsite","Did you know ?")+"</b><br/>"+N[I]);for(var L in{logsSecondColumn:{}}){e.connect($("preference_global_control_"+L),"onchange",this,"onChangePreference");e.connect($("preference_global_fontrol_"+L),"onchange",this,"onChangePreference")}g_archive_mode||"1"!=$("preference_global_control_logsSecondColumn").value||this.switchLogModeTo(1);e.query(".reftime_format").forEach(e.hitch(this,(function(e){e.innerHTML=this.formatReflexionTime(e.innerHTML).string})));for(var L in this.prefs){var P=this.prefs[L];P.values[P.value].cssPref&&e.addClass(e.doc.documentElement,P.values[P.value].cssPref)}e.query(".game_preference_control").connect("onchange",this,(function(e){var t=e.currentTarget.id.substr(19),i=e.currentTarget.value;this.ajaxcall("/table/table/changePreference.html",{id:t,value:i,game:this.game_name},this,(function(e){if("reload"==e.status){this.showMessage("Done, reload in progress...","info");location.hash="";window.location.reload()}else e.pref_id==this.GAMEPREFERENCE_DISPLAYTOOLTIPS&&this.switchDisplayTooltips(e.value)}))}));"1"==$("preference_control_"+this.GAMEPREFERENCE_DISPLAYTOOLTIPS).value&&this.switchDisplayTooltips(1);e.query(".preference_control").style("display","block");e.connect($("ingame_menu_concede"),"onclick",e.hitch(this,(function(t){t.preventDefault();this.confirmationDialog(__("lang_mainsite","You are about to concede this game. Are you sure?"),e.hitch(this,(function(){this.ajaxcall("/table/table/concede.html?src=menu",{table:this.table_id},this,(function(e,t){}))})))})));e.connect($("ingame_menu_abandon"),"onclick",e.hitch(this,(function(e){e.preventDefault();this.ajaxcall("/table/table/decide.html?src=menu",{type:"abandon",decision:1,table:this.table_id},this,(function(e,t){}))})));this.bRealtime?e.connect($("ingame_menu_switch_tb"),"onclick",e.hitch(this,(function(e){e.preventDefault();this.ajaxcall("/table/table/decide.html?src=menu",{type:"switch_tb",decision:1,table:this.table_id},this,(function(e,t){}))}))):e.style("ingame_menu_switch_tb","display","none");if(e.query(".expressswitch").length>0){e.style("ingame_menu_expresstop","display","block");e.connect($("ingame_menu_expresstop"),"onclick",e.hitch(this,(function(t){t.preventDefault();this.ajaxcall("/table/table/expressGameStopTable.html",{table:this.table_id},this,e.hitch(this,(function(t,i){if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom(e.hitch(this,(function(){this.redirectToTablePage()})))}else this.redirectToTablePage()})))})))}if(!this.bRealtime&&!this.isSpectator){e.style("ingame_menu_notes_wrap","display","block");e.connect($("ingame_menu_notes"),"onclick",this,"toggleTurnBasedNotes")}e.connect($("ingame_menu"),"onclick",this,"toggleIngameMenu");e.connect($("ingame_menu_content"),"onclick",this,"hideIngameMenu");e.connect(document,"onclick",this,"hideIngameMenu");e.query(".preference_control").connect("onclick",this,(function(t){e.stopEvent(t)}));this.updatePubBanner();this.isSpectator&&e.addClass("overall-content","spectatorMode");e.query(".chatbarbelowinput_item_showcursor").connect("onclick",this,"onShowMyCursor");e.query(".player_hidecursor").connect("onclick",this,"onHideCursor");this.addTooltipToClass("chatbarbelowinput_item_showcursor","",__("lang_mainsite","Show your mouse cursor to opponents"));e.query(".debug_save").connect("onclick",this,"onSaveState");e.query(".debug_load").connect("onclick",this,"onLoadState");if(!g_archive_mode){this.notifqueue.resynchronizeNotifications(!0);e.connect(this,"reconnectAllSubscriptions",this,"onReconnect")}this.ensureImageLoading();e.connect($("overall_footer_topbutton"),"onclick",(function(){window.scroll(0,0)}));""!=this.turnBasedNotes&&this.openTurnBasedNotes(this.turnBasedNotes);g_archive_mode||this.socket.emit("requestSpectators",this.table_id);this.updatePremiumEmblemLinks();e.connect($("abandon_alternate_button"),"onclick",e.hitch(this,(function(e){e.preventDefault();this.ajaxcall("/table/table/decide.html",{type:"abandon",decision:1,table:this.table_id},this,(function(e,t){}))})));e.connect($("concede_alternate_button"),"onclick",e.hitch(this,(function(t){t.preventDefault();this.confirmationDialog(__("lang_mainsite","Are you sure?"),e.hitch(this,(function(){this.ajaxcall("/table/table/concede.html?src=alt",{table:this.table_id},this,(function(e){}))})))})));if(g_archive_mode){e.hasClass("archivecontrol","demomode");if(e.hasClass("archivecontrol","autoplay")){this.archive_playmode="play";this.bDisableSoundOnMove=!0;this.sendNextArchive();this.instantaneousMode||this.notifqueue.setSynchronous("archivewaitingdelay",1e3)}}this.is_solo&&e.addClass("ebd-body","solo_game");g_archive_mode||this.bTutorial&&this.showTutorial();if("cantstop"==this.game_name&&this.is_solo){e.style("its_your_turn","display","none");e.place('<a href="#" id="quitFirstTutorialTop" class="bgabutton bgabutton_gray bgabutton_always_big" style="text-decoration:none;top:-9px;position:relative;">'+__("lang_mainsite","Quit tutorial")+"</a> ","reflexiontimevalues");e.connect($("quitFirstTutorialTop"),"onclick",this,e.hitch(this,(function(t){e.stopEvent(t);e.style("quitFirstTutorialTop","display","none");this.ajaxcall("/table/table/concede.html?src=top",{table:this.table_id},this,(function(t){window.location.href=this.metasiteurl+"/"+this.mslobby;e.style("quitFirstTutorialTop","display","block")}))})))}e.query(".judgegivevictory").connect("onclick",this,"onJudgeDecision");var R=1;for(var C in this.emergencymsg){var O=this.emergencymsg[C];if("emergency"==O.type){var B={channel:"/general/emergency",packet_type:"single",data:[]};B.data.push({args:O,bIsTableMsg:!1,lock_uuid:"dummy",log:"${player_name} ${text}",type:"chat",time:O.time,loadprevious:!0,uid:R++});this.notifqueue.onNotification(B)}}this.onGameUiWidthChange();e.connect(window,"scroll",this,e.hitch(this,"adaptStatusBar"));e.connect(window,"orientationchange",this,e.hitch(this,"onGameUiWidthChange"));e.connect(window,"onresize",this,e.hitch(this,"onGameUiWidthChange"));if($("go_to_next_table_active_player")){e.connect($("go_to_next_table_active_player"),"onclick",e.hitch(this,(function(t){e.stopEvent(t);this.confirmationDialog(__("lang_mainsite","This is your turn. Do you really want to go to your next table?"),(function(){document.location.href=$("go_to_next_table_active_player").href}))})));this.addTooltip("go_to_next_table_active_player","",__("lang_mainsite","Go to next table (play later on this one)"))}var H=[{btn:"pageheader_gameresult",section:"pagesection_gameresult",onShow:e.hitch(this,"onShowGameResults")},{btn:"pageheader_gameview",section:"pagesection_gameview",defaults:!0}];this.pageheader=new ebg.pageheader;this.pageheader.create(this,"maingameview_menuheader",H,!1);H=[{btn:"pageheader_howtoplay",section:"pagesection_howtoplay",onShow:e.hitch(this,"onShowGameHelp")},{btn:"pageheader_competition",section:"pagesection_competition",defaults:!0},{btn:"pageheader_tournament",section:"pagesection_tournament"},{btn:"pageheader_strategytips",section:"pagesection_strategytips",onShow:e.hitch(this,"onShowStrategyHelp")},{btn:"pageheader_options",section:"pagesection_options"},{btn:"pageheader_credits",section:"pagesection_credits"},{btn:"pageheader_music",section:"pagesection_music",onShow:e.hitch(this,"playMusic")}];this.pageheaderfooter=new ebg.pageheader;this.pageheaderfooter.create(this,"maingameview_menufooter",H,!1);e.query(".seemore").connect("onclick",this,"onSeeMoreLink");this.addTooltipToClass("thumbuplink","",__("lang_mainsite","Thumb up this item"));e.query(".thumbuplink").connect("onclick",this,"onThumbUpLink");this.getRanking();e.connect($("seemore_rankings"),"onclick",this,"onSeeMoreRanking");e.query(".sectiontitle_dropdown_command").connect("onclick",this,(function(t){e.stopEvent(t);var i=t.currentTarget.parentNode.id;e.query("#"+i+" .sectiontitle_dropdown_menu").toggleClass("sectiontitle_dropdown_menu_visible")}));this.closeRankMenu=e.connect($("overall-content"),"onclick",this,(function(t){e.query(".sectiontitle_dropdown_menu_visible").removeClass("sectiontitle_dropdown_menu_visible")}));e.query(".rank_season").connect("onclick",this,"onChangeRankMode");e.query(".trophytooltip").forEach(e.hitch(this,(function(e){var t=e.id.substr(14),i=$("trophytooltip_"+t).innerHTML;this.addTooltipHtml("awardimg_"+t,'<div class="trophytooltip_displayed">'+i+"</div>")})));this.playerawardsCollapsedAlignement();this.isSpectator||this.gamedatas.players[this.player_id].beginner&&this.pageheaderfooter.showSectionFromButton("pageheader_howtoplay");e.hasClass("ebd-body","training_mode")&&this.pageheaderfooter.showSectionFromButton("pageheader_howtoplay");if(void 0!==this.tournament_id&&null!=this.tournament_id){$("tournament_frame").src=this.metasiteurl+"/tournament/tournament/results.html?id="+this.tournament_id;this.pageheaderfooter.showSectionFromButton("pageheader_tournament")}if(g_archive_mode&&"view"!=g_tutorialwritten.mode){var F=this.getReplayLogNode();if($("pageheader_strategytips")&&null!==F){$("pageheader_strategytips").innerHTML=__("lang_mainsite","Replay log")+'<div class="pageheader_menuitembar">';this.pageheaderfooter.showSectionFromButton("pageheader_strategytips");this.loadReplayLogs()}}e.hasClass("ebd-body","new_gameux")&&this.pageheaderfooter.hideAllSections()}"gameSetup"==this.gamedatas.gamestate.name&&g_archive_mode&&this.sendNextArchive();if(g_archive_mode&&""!=$("archive_go_to_move_nbr").value){this.archive_gotomove=toint($("archive_go_to_move_nbr").value);this.archive_playmode="goto";this.setModeInstataneous();this.sendNextArchive()}if(g_archive_mode&&"view"==g_tutorialwritten.mode){this.pageheaderfooter.hideAllSections();$("table_ref_item_table_id")&&($("table_ref_item_table_id").innerHTML=e.string.substitute(__("lang_mainsite","Tutorial #${id}"),{id:g_tutorialwritten.id}));if($("newArchiveComment"));else{this.archive_playmode="nextcomment";this.sendNextArchive()}}u||this.init3d();"gameEnd"==l.gamestate.name&&this.updateResultPage();u||this.initHotseat();this.sendResizeEvent()},disableNextMoveSound:function(){this.bDisableNextMoveOnNextSound=!0},sendResizeEvent:function(){if(document.createEventObject)window.fireEvent("resize");else{var e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!0);window.dispatchEvent(e)}},onReconnect:function(){this.notifqueue.resynchronizeNotifications(!1)},onGsSocketIoConnectionStatusChanged:function(t,i){if(this.page_is_unloading)e.style("connect_gs_status","display","none");else if("connect"==t)e.style("connect_gs_status","display","none");else if("connect_error"==t){e.style("connect_gs_status","display","block");$("connect_gs_status_text").innerHTML=__("lang_mainsite","Disconnected from your game!");g_sitecore.notifqueue.addToLog($("connect_gs_status_text").innerHTML)}else if("connect_timeout"==t){e.style("connect_gs_status","display","block");$("connect_gs_status_text").innerHTML=__("lang_mainsite","Disconnected from your game!");$("connect_gs_status_text").innerHTML+=" (timeout)";g_sitecore.notifqueue.addToLog($("connect_gs_status_text").innerHTML)}else if("reconnect"==t){e.style("connect_gs_status","display","none");g_sitecore.notifqueue.addToLog(__("lang_mainsite","You are connected again."));this.gs_socket.emit("join",this.channel);this.gs_socket.emit("join",this.tablechannelSpectators);this.gs_socket.emit("join","/player/p"+this.player_id)}else if("reconnect_error"==t){e.style("connect_gs_status","display","block");$("connect_gs_status_text").innerHTML=__("lang_mainsite","Disconnected from your game!");g_sitecore.notifqueue.addToLog($("connect_gs_status_text").innerHTML)}else if("reconnect_failed"==t){e.style("connect_gs_status","display","block");$("connect_gs_status_text").innerHTML=__("lang_mainsite","Disconnected from your game!");$("connect_gs_status_text").innerHTML+=" (reconnect failed)";g_sitecore.notifqueue.addToLog($("connect_gs_status_text").innerHTML)}},getReplayLogNode:function(){if($("strategytips_content"))return $("strategytips_content");var t=e.query("#pagesection_strategytips .pagesection");return t.length>0?t[0]:void 0},updatePremiumEmblemLinks:function(){this.addTooltipToClass("emblempremium",__("lang_mainsite","Premium member: this player helps us to develop this service :)"),__("lang_mainsite","Support Board Game Arena: go Premium!"));e.query(".emblempremium").connect("onclick",this,(function(){window.open(this.metasiteurl+"/premium","_blank")}));e.query(".masqued_rank").connect("onclick",this,(function(){window.open(this.metasiteurl+"/premium","_blank")}))},onGameUiWidthChange:function(){if(!this.chatDetached){if(void 0===this.default_viewport){void 0!==(i=e.query('meta[name="viewport"]'))[0]&&(this.default_viewport=i[0].content)}var t=!1;if(void 0!==window.orientation){var i;if(void 0!==(i=e.query('meta[name="viewport"]'))[0])if(0!==window.orientation)i[0].content="width=980";else{this.isTouchDevice&&(t=!0);null!==this.default_viewport&&(i[0].content=this.default_viewport)}}var n=e.position("ebd-body"),o=240;"2cols"==this.log_mode&&(o=490);var a=this.interface_min_width+o;if("2cols"==this.log_mode&&(n.w<a||this.currentZoom<1))this.switchLogModeTo(0);else{if(e.hasClass("ebd-body","mobile_version")){if(n.w>=a&&1==this.currentZoom&&!t){e.removeClass("ebd-body","mobile_version");e.addClass("ebd-body","desktop_version");this.adaptChatbarDock()}}else if(n.w<a||this.currentZoom<1||t){e.removeClass("ebd-body","desktop_version");e.addClass("ebd-body","mobile_version");this.adaptChatbarDock()}var s=1,r=1;n.w<this.interface_min_width&&(r=s=n.w/this.interface_min_width);if(s<.9&&e.hasClass("globalaction_zoom_icon","fa-search-minus")){s=1;e.style("pagesection_gameview","overflow","auto");e.style("game_play_area","minWidth",this.interface_min_width+"px")}else{void 0!==this.bForceMobileHorizontalScroll&&e.hasClass("ebd-body","mobile_version")&&this.bForceMobileHorizontalScroll?e.style("pagesection_gameview","overflow","auto"):e.style("pagesection_gameview","overflow","visible");e.style("game_play_area","minWidth",0)}if(s!=this.gameinterface_zoomFactor){this.gameinterface_zoomFactor=s;e.style("page-content","zoom",s);e.style("right-side-first-part","zoom",s);e.style("page-title","zoom",s)}if(r<.9){e.style("globalaction_zoom_wrap","display","inline-block");e.style("toggleSound","display","none")}else{e.style("globalaction_zoom_wrap","display","none");e.style("toggleSound","display","inline-block")}this.adaptPlayersPanels();this.adaptStatusBar();this.onScreenWidthChange()}}},onZoomToggle:function(t){e.stopEvent(t);var i=this.gameinterface_zoomFactor,n=e.style("left-side","marginTop");if(e.hasClass("globalaction_zoom_icon","fa-search-plus")){e.removeClass("globalaction_zoom_icon","fa-search-plus");e.addClass("globalaction_zoom_icon","fa-search-minus")}else{e.removeClass("globalaction_zoom_icon","fa-search-minus");e.addClass("globalaction_zoom_icon","fa-search-plus");this.savePlayAreaXScroll=$("pagesection_gameview").scrollLeft}this.onGameUiWidthChange();var o=this.gameinterface_zoomFactor,a=e.style("left-side","marginTop"),s=e.window.getBox().h,r=window.scrollY||window.pageYOffset||document.documentElement.scrollTop;if(o<i){var l=r+(a-n);l*=o/i;l-=s*(1-o)/2}else{l=r*(o/i)+(a-n);l+=s*(1-i)/2;$("pagesection_gameview").scrollLeft=this.savePlayAreaXScroll}window.scroll(0,l)},onScreenWidthChange:function(){},adaptStatusBar:function(){var t=e.position("after-page-title"),i=e.position("page-title"),n=e.style("page-title","zoom");void 0===n&&(n=1);var o=i.h*n,a=e.window.getBox().h/10;if(!e.hasClass("page-title","fixed-page-title")&&t.y<0&&o<a)e.addClass("page-title","fixed-page-title");else if(e.hasClass("page-title","fixed-page-title")&&(t.y>=0||o>=a)){e.removeClass("page-title","fixed-page-title");e.style("page-title","width","auto");e.style("after-page-title","height","0px")}if(e.hasClass("page-title","fixed-page-title")){e.style("page-title","width",(t.w-10)/n+"px");e.style("after-page-title","height",i.h+"px")}if($("archive_history_backtotop")){var s=e.position("maingameview_menufooter");0!=s.y&&(s.y<200?e.style("archive_history_backtotop","display","block"):e.style("archive_history_backtotop","display","none"))}},adaptPlayersPanels:function(){if(e.hasClass("ebd-body","mobile_version")){var t=e.position("right-side-first-part").w,n=Math.floor(t/243),o=e.query("#player_boards .player-board"),a=o.length,s=Math.ceil(a/n),r=Math.ceil(a/s),l=Math.floor(t/r)-3-6,d=0,c=0,h=i.NodeList();o.style("height","auto");for(var u in o)if(void 0!==o[u].id){c=Math.max(e.style(o[u],"height"),c);h.push(o[u]);if(++d%r==0||d>=a){h.style("height",c+"px");c=0,h=i.NodeList()}}o.style("width",l+"px");var p=e.position("right-side").h;e.style("left-side","marginTop",p+"px")}else{e.query("#player_boards .player-board").style("width","234px");e.query("#player_boards .player-board").style("height","auto");e.style("left-side","marginTop","0px")}},activeShowOpponentCursor:function(){if(null==this.showOpponentCursorMouveOver){this.showOpponentCursorLastEvent=null;this.showOpponentCursorLastInfosSendMark=null;this.showOpponentCursorMouveOver=e.connect($("ebd-body"),"onmousemove",this,"onShowOpponentCursorMouseOver");this.showOpponentCursorSendInfos();e.query(".chatbarbelowinput_item_showcursor").addClass("audiovideo_active");this.showMessage(__("lang_mainsite","Your mouse cursor is now visible by other players."),"info");this.showOpponentCursorClickHook=e.connect(document,"onmousedown",this,"showOpponentCursorClick")}},showOpponentCursorClick:function(t){if("mousedown"==t.type){null===this.showOpponentCursorClickCooldown&&(this.showOpponentCursorClickCooldown=Date.now());this.showOpponentCursorClickNumberSinceCooldown++;if(Math.round((Date.now()-this.showOpponentCursorClickCooldown)/1e3)<5&&this.showOpponentCursorClickNumberSinceCooldown>=10){this.showMessage(__("lang_mainsite","We know this feature is fun, but please slow down! Don't bomb the screen with your clicks please ;)"),"info");return}this.showOpponentCursorClickCounter++;if(this.showOpponentCursorClickCounter%10==1){this.showOpponentCursorClickCooldown=Date.now();this.showOpponentCursorClickNumberSinceCooldown=0}this.onShowOpponentCursorMouseOver(t);var i=this.getCursorInfos(!0);this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/showCursorClick.html",{path:e.toJson(i)},this,(function(e){}))}},unactiveShowOpponentCursor:function(){if(null!==this.showOpponentCursorMouveOver){e.disconnect(this.showOpponentCursorMouveOver);e.disconnect(this.showOpponentCursorClickHook);clearTimeout(this.showOpponentCursorTimeout);this.showOpponentCursorMouveOver=null;this.showOpponentCursorClickHook=null;this.showOpponentCursorTimeout=null;e.query(".chatbarbelowinput_item_showcursor").removeClass("audiovideo_active");this.gs_socket.emit("oppCursor",{table_id:this.table_id,path:null})}},onShowMyCursor:function(t){e.stopEvent(t);this.isSpectator?this.showMessage(__("lang_mainsite","You cannot do this as a spectator."),"error"):null==this.showOpponentCursorMouveOver?this.activeShowOpponentCursor():this.unactiveShowOpponentCursor()},onHideCursor:function(t){var i=t.currentTarget.id.substr(18);e.style("player_showcursor_"+i,"display","none");$("opponent_cursor_"+i)&&e.destroy("opponent_cursor_"+i)},getCursorInfos:function(e){for(var t=this.showOpponentCursorLastEvent,i=t.target;!i.id;)i=i.parentNode;var n=[],o=t.offsetX||t.layerX,a=t.offsetY||t.layerY,s=!1;if(null===this.showOpponentCursorLastInfosSendMark)this.showOpponentCursorLastInfosSendMark=i.id+" "+o+","+a;else if(this.showOpponentCursorLastInfosSendMark==i.id+" "+o+","+a)s=!0;else this.showOpponentCursorLastInfosSendMark=i.id+" "+o+","+a;if(!s||e){if(void 0===t.path){for(var r=[],l=i;l;){r.push(l);l=l.parentElement}-1===r.indexOf(window)&&-1===r.indexOf(document)&&r.push(document);-1===r.indexOf(window)&&r.push(window);t.path=r}for(var d in t.path){"<br/>";var c=t.path[d];c.id+" : "+o+","+a;c.id&&n.push({id:c.id,x:o,y:a});var h=c.getBoundingClientRect(),u=c.parentNode.getBoundingClientRect(),p={top:h.top-u.top,left:h.left-u.left};o+=p.left;a+=p.top;if("game_play_area"==c.id)break;if("ebd-body"==c.id)break}return n}return null},showOpponentCursorSendInfos:function(){if(null!==this.showOpponentCursorLastEvent){var t=this.getCursorInfos(!1);null===t||this.gs_socket.emit("oppCursor",{table_id:this.table_id,path:t})}this.showOpponentCursorTimeout=setTimeout(e.hitch(this,"showOpponentCursorSendInfos"),500)},onShowOpponentCursorMouseOver:function(e){this.showOpponentCursorLastEvent=e},setup:function(e){},onEnteringState:function(e,t){},onLeavingState:function(e){},getGameStandardUrl:function(){return"/"+this.gameserver+"/"+this.game_name+"?table="+this.table_id},showIngameMenu:function(){e.style("ingame_menu_content","display","block");e.addClass("ingame_menu","menu_open")},hideIngameMenu:function(){e.style("ingame_menu_content","display","none");e.removeClass("ingame_menu","menu_open")},toggleIngameMenu:function(t){e.stopEvent(t);"none"==e.style("ingame_menu_content","display")?this.showIngameMenu():this.hideIngameMenu()},getPlayerTooltip:function(e){for(var t="",i=1;i>=0;i--)for(var n in e.languages)if(e.languages[n].level==i){var o=n;1===toint(e.languages[n].level)&&(o="<b>"+n+"</b>");t+='<span id="lang_'+e.user_id+"_"+n+'">'+o+"</span> "}var a="free";1==e.is_beginner?a="beginner":1==e.is_premium&&(a="premium");var s=$("avatar_"+e.user_id).src;s=s.match(/\/default-\d+_32.jpg$/)?s.replace("_32.jpg",".jpg"):s.replace("_32.jpg","_184.jpg");void 0===e.karma&&(e.karma=100);var r=this.getKarmaLabel(e.karma),l={player_id:e.user_id,genderclass:null===e.gender?"gender_not_specified":1==e.gender?"fa-mars male":"fa-venus female",flagx:e.country_infos.flag_x,flagy:e.country_infos.flag_y,country:e.country_infos.name,city:null===e.city||""==e.city?"":"("+e.city+")",languages:t,accounttype:a,avatarurl:s,karma:e.karma,karma_label:r.label,karma_class:r.css,progressbardisplay:"block"};return this.format_string(this.jstpl_player_tooltip,l)},setClientState:function(t,i){"gameSetup"==t&&void 0!==this.lockScreenTimeout&&clearTimeout(this.lockScreenTimeout);e.removeClass("overall-content","gamestate_"+this.gamedatas.gamestate.name);this.onLeavingState(this.gamedatas.gamestate.name);this.on_client_state=!0;this.gamedatas.gamestate.name=t;for(var n in i)this.gamedatas.gamestate[n]=i[n];this.updatePageTitle();e.addClass("overall-content","gamestate_"+t);this.onEnteringState(t,this.gamedatas.gamestate)},restoreServerGameState:function(){e.removeClass("overall-content","gamestate_"+this.gamedatas.gamestate.name);this.onLeavingState(this.gamedatas.gamestate.name);var t=e.clone(this.gamedatas.gamestate.reflexion);this.gamedatas.gamestate=e.clone(this.last_server_state);this.on_client_state=!1;this.gamedatas.gamestate.reflexion=t;this.updatePageTitle();e.addClass("overall-content","gamestate_"+this.gamedatas.gamestate.name);this.onEnteringState(this.gamedatas.gamestate.name,this.gamedatas.gamestate)},onStartGame:function(){this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/startgame.html",{},this,(function(e){}))},onNotificationPacketDispatched:function(){if(!this.current_player_was_active&&this.current_player_is_active)if(this.instantaneousMode||"undefined"!=typeof g_replayFrom);else{stopSound("move");playSound("yourturn")}this.current_player_was_active=this.current_player_is_active},updateActivePlayerAnimation:function(){var t,i={},n=!1,o=!1;for(var a in this.gamedatas.players){if("none"==e.style("avatarwrap_"+a,"display")){e.style("avatarwrap_"+a,"display","block");e.style("avatar_active_wrap_"+a,"display","none");i[a]=1;a==this.player_id&&(n=!0)}if($("player_table_status_"+a)){var s="";if(this.gamedatas.players[a].beginner&&this.player_id!=a)if(e.hasClass("ebd-body","no_time_limit")){s+='<p class="boardblock doubletime_infos">';s+=__("lang_mainsite","This is my first game.")+"<br/>";s+=__("lang_mainsite","Thanks for helping me!");s+="</p>"}else{s+='<p class="boardblock doubletime_infos">';s+=__("lang_mainsite","This is my first game : my time is doubled")+"<br/>";s+=__("lang_mainsite","Thanks for helping me!");s+="</p>"}if(1==this.gamedatas.players[a].is_ai){s+='<p class="boardblock">';s+=__("lang_mainsite","This player is an artificial intelligence");s+="</p>"}if(1==this.gamedatas.players[a].zombie){s+='<p class="boardblock">';s+=__("lang_mainsite","The turns of this player are skipped (this player left the game or was out of time)");s+="</p>"}if(1==this.gamedatas.players[a].eliminated){s+='<p class="boardblock">';s+=__("lang_mainsite","This player has been eliminated from the game");s+="</p>"}if(void 0!==this.hotseatplayers[a]&&this.player_id!=a){s+='<p class="boardblock">';s+=__("lang_mainsite","This player is playing from the same seat than another (`hotseat`)");s+="</p>"}if(""!=s){$("player_table_status_"+a).innerHTML=s;e.style("player_table_status_"+a,"display","block")}else e.style("player_table_status_"+a,"display","none")}}if(!g_archive_mode){e.query(".rtc_video_pulsating").removeClass("rtc_video_pulsating");if("activeplayer"==this.gamedatas.gamestate.type){t=this.gamedatas.gamestate.active_player;if(this.gamedatas.players[t]){if("unavail"!=this.gamedatas.players[t].ack){this.shouldDisplayClockAlert(t)?$("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player_clockalert.gif"):$("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player.gif");$("videofeed_"+t+"_pulse")&&e.addClass("videofeed_"+t+"_pulse","rtc_video_pulsating")}else $("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player_nonack.gif");e.style("avatarwrap_"+t,"display","none");e.style("avatar_active_wrap_"+t,"display","block");t==this.player_id&&(o=!0)}else this.showMessage("Error: there is no more active player!","error")}else if("multipleactiveplayer"==this.gamedatas.gamestate.type)for(var r in this.gamedatas.gamestate.multiactive){t=this.gamedatas.gamestate.multiactive[r];if("unavail"!=this.gamedatas.players[t].ack){this.shouldDisplayClockAlert(t)?$("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player_clockalert.gif"):$("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player.gif");$("videofeed_"+t+"_pulse")&&e.addClass("videofeed_"+t+"_pulse","rtc_video_pulsating")}else $("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player_nonack.gif");e.style("avatarwrap_"+t,"display","none");e.style("avatar_active_wrap_"+t,"display","block");t==this.player_id&&(o=!0)}n&&!o&&this.updatePubBanner()}if(o){this.shouldDisplayClockAlert(this.player_id)?$("active_player_statusbar_icon").src=getStaticAssetUrl("img/layout/active_player_clockalert.gif"):$("active_player_statusbar_icon").src=getStaticAssetUrl("img/layout/active_player.gif");e.style("active_player_statusbar","display","inline-block");e.addClass("ebd-body","current_player_is_active")}else{e.style("active_player_statusbar","display","none");e.removeClass("ebd-body","current_player_is_active")}this.fireDlg&&this.fireDlg.destroy();if("cantstop"==this.game_name&&this.is_solo);else if(o)if(n);else if(this.bRealtime){e.addClass("reflexiontimevalues","yourturn_animation");setTimeout(e.hitch(this,(function(){e.removeClass("reflexiontimevalues","yourturn_animation")})),800)}this.addTooltipToClass("tt_timemove_time_bar",__("lang_mainsite","Remaining time to think for this move. When the bar is all red, you can expel inactive active players."),"");this.addTooltip("reflexiontime_value",__("lang_mainsite","Remaining time to think for this game"),"");this.addTooltip("current_player_reflexion_time",__("lang_mainsite","Remaining time to think for this game"),"");this.addTooltipToClass("timeToThink",__("lang_mainsite","Remaining time to think for this game"),"");this.updateReflexionTimeDisplay();this.updateFirePlayerLink();this.current_player_is_active=o;this.checkHotseatFocus();return o},isCurrentPlayerActive:function(){return this.isPlayerActive(this.player_id)},isPlayerActive:function(e){if("activeplayer"==this.gamedatas.gamestate.type){if(this.gamedatas.gamestate.active_player==e)return!0}else if("multipleactiveplayer"==this.gamedatas.gamestate.type)for(var t in this.gamedatas.gamestate.multiactive)if(this.gamedatas.gamestate.multiactive[t]==e)return!0;return!1},getActivePlayers:function(){if("activeplayer"==this.gamedatas.gamestate.type)return[this.gamedatas.gamestate.active_player];if("multipleactiveplayer"==this.gamedatas.gamestate.type){var e=[];for(var t in this.gamedatas.gamestate.multiactive)e.push(this.gamedatas.gamestate.multiactive[t]);return e}return[]},getActivePlayerId:function(){return"activeplayer"==this.gamedatas.gamestate.type?this.gamedatas.gamestate.active_player:null},updatePageTitle:function(t=null){null===t&&(t=this.gamedatas.gamestate);var i=e.clone(t.args);null==i&&(i={});var n=this.getActivePlayers();if(1==n.length)var o=n.pop();else o=null;var a,s=t.description;void 0===s&&(s="");"gameSetup"==t.name&&(s=this.lockts<=0?e.string.substitute(__("lang_mainsite","Your ${game_name} game is about to start ..."),{game_name:this.game_name_displayed}):e.string.substitute(__("lang_mainsite","Your ${game_name} game will start in ${s} seconds"),{game_name:this.game_name_displayed,s:'<span class="locking_time">'+this.lockts+"</span>"}));var r="";if(void 0!==o&&0!==o&&null!==o){a=this.gamedatas.players[o].color;this.gamedatas.players[o].color_back&&(r="background-color:#"+this.gamedatas.players[o].color_back+";");this.gamedatas.players[o].name;i.actplayer='<span style="font-weight:bold;color:#'+a+";"+r+'">'+this.gamedatas.players[o].name+"</span>"}else i.actplayer="";if(this.isCurrentPlayerActive()&&null!==t.descriptionmyturn){a=this.gamedatas.players[this.player_id].color;r="";this.gamedatas.players[this.player_id].color_back&&(r="background-color:#"+this.gamedatas.players[this.player_id].color_back+";");i.you='<span style="font-weight:bold;color:#'+a+";"+r+'">'+__("lang_mainsite","You")+"</span>";s=t.descriptionmyturn}if(i.otherplayer){a=this.gamedatas.players[i.otherplayer_id].color;r="";this.gamedatas.players[i.otherplayer_id].color_back&&(r="background-color:#"+this.gamedatas.players[i.otherplayer_id].color_back+";");i.otherplayer='<span style="font-weight:bold;color:#'+a+";"+r+'">'+i.otherplayer+"</span>"}s=_(s);for(var l=1;l<=5;l++)i["titlearg"+l]="<span id='titlearg"+l+"'>N</span>";s=this.format_string_recursive(s,i);$("pagemaintitletext").innerHTML=""==s?"&nbsp;":s;e.empty("generalactions");this.instantaneousMode||(document.title=this.strip_tags(s)+" • "+this.game_name_displayed+" • "+$("websitename").innerHTML);this.onUpdateActionButtons(t.name,t.args);if($("gotonexttable_wrap"))if(this.isCurrentPlayerActive()||this.bRealtime||this.isSpectator){if(!this.bRealtime&&!this.isSpectator){e.style("gotonexttable_wrap","display","inline");e.style("go_to_next_table_inactive_player","display","none");e.style("go_to_next_table_active_player","display","inline")}}else{e.style("gotonexttable_wrap","display","inline");e.style("go_to_next_table_inactive_player","display","inline");e.style("go_to_next_table_active_player","display","none");void 0!==this.number_of_tb_table_its_your_turn&&"-"!=this.number_of_tb_table_its_your_turn?1==this.number_of_tb_table_its_your_turn?$("go_to_next_player_label").innerHTML=e.string.substitute(__("lang_mainsite","1 table is waiting for you"),{nbr:this.number_of_tb_table_its_your_turn}):this.number_of_tb_table_its_your_turn>0?$("go_to_next_player_label").innerHTML=e.string.substitute(__("lang_mainsite","${nbr} tables are waiting for you"),{nbr:this.number_of_tb_table_its_your_turn}):$("go_to_next_player_label").innerHTML=__("lang_mainsite","Get back to tables list"):$("go_to_next_player_label").innerHTML=__("lang_mainsite","Go to next table");if(e.hasClass("ingame_menu_notes","icon32_notes")&&void 0===this.turnBasedNotesPopupIncent&&!e.hasClass("ebd-body","mobile_version")){var d='<div id="turnBasedNotesPopupIncentContent">'+__("lang_mainsite","You may note something for the next time...")+"</div>";e.style("ingame_menu_notes_wrap","display","block");this.turnBasedNotesPopupIncent=new dijit.TooltipDialog({id:"turnBasedNotesIncent",content:d,closable:!0});dijit.popup.open({popup:this.turnBasedNotesPopupIncent,around:"ingame_menu_notes_wrap",orient:["below","below-alt","above","above-alt"]});e.connect($("turnBasedNotesPopupIncentContent"),"onclick",(function(){dijit.popup.close(this.turnBasedNotesPopupIncent)}));setTimeout(e.hitch(this,(function(){this.turnBasedNotesPopupIncent&&dijit.popup.close(this.turnBasedNotesPopupIncent)})),2500)}}},onUpdateActionButtons:function(){},addActionButton:function(t,i,n,o,a,s){void 0===a&&(a=!1);void 0===s&&(s="blue");tpl={};tpl.id=t;tpl.label=i;tpl.addclass="bgabutton ";"gray"==s?tpl.addclass+="bgabutton_gray":"red"==s?tpl.addclass+="bgabutton_red":"none"==s?tpl.addclass="":tpl.addclass+="bgabutton_blue";a&&(tpl.addclass+=" blinking");o||(o="generalactions");e.place(this.format_block("jstpl_action_button",tpl),o);e.connect($(t),"onclick",this,n)},removeActionButtons:function(){e.empty("generalactions")},updateVisitors:function(t){var i="",n=!0;this.last_visitorlist=t;for(var o in t){var a=t[o];if(this.gamedatas.players[o]&&"gameEnd"!=this.gamedatas.gamestate.name);else{n?n=!1:i+=" ";if(this.gamedatas.players[o])var s='<span style="white-space: nowrap"><span id="visitor_player_'+o+'" class="visitor_player">'+a+"</span></span>";else s='<span style="white-space: nowrap"><span id="visitor_player_'+o+'" class="visitor_player">'+a+'</span> <a href="#" style="display:none" id="ban_spectator_'+o+'" class="ban_spectator"><i class="fa fa-times" aria-hidden="true"></i></a></span>';i+=s}}if(n)e.style($("spectatorbox"),"display","none");else{e.place("<span>"+__("lang_mainsite","Spectators:")+" "+i+"</span>","spectatorlist","only");e.style($("spectatorbox"),"display","block");e.query(".ban_spectator").connect("onclick",this,"onBanSpectator")}},onBanSpectator:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(14);if(i!=this.player_id){this.showMessage(__("lang_mainsite","You can give this player a red thumb, so he won't be able to chat again at your table."),"info");var n=new ebg.thumb;n.create(this,"ban_spectator_"+i,i,0);e.style("ban_spectator_"+i,"display","none");n.bForceThumbDown=!0;n.onGiveThumbDown(t)}},switchToGameResults:function(){countVisibleDialog=0;e.query(".dijitDialog").forEach((function(t){"none"!=e.style(t,"display")&&countVisibleDialog++}));e.query(".standard_popin").forEach((function(t){"none"!=e.style(t,"display")&&countVisibleDialog++}));var t=Math.floor(Date.now()/1e3),i=t-1e3,n=!1;if(void 0!==this.end_of_game_timestamp){n=!0;i=this.end_of_game_timestamp+3}if(0==countVisibleDialog&&n&&t>=i){this.pageheader.showSectionFromButton("pageheader_gameresult");e.hasClass("ebd-body","arena_mode")||this.eloEndOfGameAnimation();var o=this.tableresults_datas,a=!1,s={};(e.hasClass("ebd-body","arena_mode")||void 0!==o.result.trophies&&void 0!==o.result.trophies[this.player_id]&&void 0!==o.result.trophies[this.player_id])&&(a=!0);if(a){void 0!==o.result.trophies&&void 0!==o.result.trophies[this.player_id]&&void 0!==o.result.trophies[this.player_id]&&(s=o.result.trophies[this.player_id]);setTimeout(e.hitch(this,(function(){this.loadTrophyToSplash(s)})),2e3)}this.gameeval&&this.showGameRatingDialog()}else setTimeout(e.hitch(this,(function(){this.switchToGameResults()})),1e3)},eloEndOfGameAnimation:function(){this.eloEndOfGameAnimationDatas={};var t=!1;e.query("#pagesection_gameresult .newrank .gamerank_value").forEach(e.hitch(this,(function(e){var i=e.innerHTML;if(""!=i){var n=e.parentNode.parentNode.id.substr(8);if($("player_elo_"+n)){var o=$("player_elo_"+n).innerHTML;this.eloEndOfGameAnimationDatas[n]={player_id:n,from:toint(o),to:toint(i),current:toint(o)};t=!0}}})));if(t){this.eloEndOfGameAnimationFrameCurrentDuration=0;this.eloEndOfGameAnimationWorker();playSound("elochange")}},eloEndOfGameAnimationWorker:function(){for(var t in this.eloEndOfGameAnimationDatas){var i=this.eloEndOfGameAnimationDatas[t],n=Math.round(i.from+this.eloEndOfGameAnimationFrameCurrentDuration/1e3*(i.to-i.from));if(n!=i.current){if(n>i.current&&t==this.player_id){var o='<div style="z-index:10000" class="icon20 icon20_rankwb"></div>',a=this.slideTemporaryObject(o,"page-content","winpoints_value_"+t,"player_elo_"+t,1e3),s=n;e.connect(a,"onEnd",e.hitch(this,(function(){$("player_elo_"+this.player_id).innerHTML=s;var t=this.getColorFromElo(s+1300);e.style($("player_elo_"+this.player_id).parentNode,"backgroundColor",t);var i=e.query("#player_board_"+this.player_id+" .gamerank");e.removeClass(i[0],"rankbounce");i[0].offsetWidth;e.addClass(i[0],"rankbounce")})))}else if(n<i.current&&t==this.player_id){o='<div style="z-index:10000" class="icon20 icon20_rankwb"></div>',a=this.slideTemporaryObject(o,"page-content","player_elo_"+t,"winpoints_value_"+t,1e3),s=n;$("player_elo_"+this.player_id).innerHTML=s;var r=this.getColorFromElo(s+1300);e.style($("player_elo_"+this.player_id).parentNode,"backgroundColor",r);var l=e.query("#player_board_"+this.player_id+" .gamerank");e.removeClass(l[0],"rankbounce");l[0].offsetWidth;e.addClass(l[0],"rankbounce")}else{$("player_elo_"+t).innerHTML=n;r=this.getColorFromElo(n+1300);e.style($("player_elo_"+t).parentNode,"backgroundColor",r)}this.eloEndOfGameAnimationDatas[t].current=n}}if(this.eloEndOfGameAnimationFrameCurrentDuration>=1e3);else{this.eloEndOfGameAnimationFrameCurrentDuration+=50;setTimeout(e.hitch(this,"eloEndOfGameAnimationWorker"),50)}},updateResultPage:function(){this.ajaxcall("/table/table/tableinfos.html",{id:this.table_id,nosuggest:!0},this,(function(t){if("finished"!=t.status&&"archive"!=t.status);else{this.tableresults=new ebg.tableresults;this.tableresults.create(this,"game_result_panel","statistics_content",t,this.pma);this.tableresults_datas=t;e.style("statistics","display","none");"normal_end"!==t.result.endgame_reason&&"normal_concede_end"!==t.result.endgame_reason&&"neutralized_after_skipturn"!==t.result.endgame_reason&&"neutralized_after_skipturn_error"!==t.result.endgame_reason||e.style("statistics","display","block");"undefined"!=typeof FB&&void 0!==FB.XFBML?this.onFBReady():e.subscribe("FBReady",this,"onFBReady")}}));this.switchToGameResults()},loadTrophyToSplash:function(e){var t={};for(var i in e)t[e[i].id]=!0;this.ajaxcall("/playernotif/playernotif/getNotificationsToBeSplashDisplayed.html",{},this,(function(e){var i=[];for(var n in e)28==e[n].news_type&&i.push(e[n]);for(var n in e)void 0!==t[e[n].jargs.award_id_id]&&i.push(e[n]);this.showSplashedPlayerNotifications(i)}))},displayScores:function(){e.style("maingameview_menuheader","display","block");var t=this.gamedatas.gamestate.args.result,i=this.buildScoreDlgHtmlContent(t);if(null!==i.title){$("pagemaintitletext").innerHTML+=" : "+i.title;$("game_result_label").innerHTML=" : "+i.title}else{$("pagemaintitletext").innerHTML+=" : "+e.string.substitute(__("lang_mainsite","${winner} wins"),{winner:t[0].name});$("game_result_label").innerHTML=" : "+e.string.substitute(__("lang_mainsite","${winner} wins"),{winner:t[0].name})}void 0!==this.bGameEndJustHappened&&this.bGameEndJustHappened&&(g_archive_mode||("victory"==i.result_for_current_player?playSound("victory"):"lose"==i.result_for_current_player?playSound("lose"):playSound("tie")));var n=this.metasiteurl+"/gamereview?table="+this.table_id;this.notifqueue.addToLog('<p style="text-align:center;"><a href="'+n+'" class="bgabutton bgabutton_gray replay_last_move_button"><span class="textalign"><span class="icon32 icon32_replaylastmoves textalign_inner"></span></span> '+__("lang_mainsite","Replay game")+"</a></p>",!1,!1)},buildScoreDlgHtmlContent:function(t){var i="",n=null,o=[],a=0,s=!1,r=!1,l=null,d=!0,c=!0,h=!0,u=!0;for(var p in t){var m=t[p];0==toint(m.score)&&-4242==toint(m.score_aux)||(d=!1);-4243!=toint(m.score_aux)&&(c=!1);-4244!=toint(m.score_aux)&&(h=!1);-4245!=toint(m.score_aux)&&(u=!1)}var g=null,f=null;for(var p in t){m=t[p];rank=toint(m.rank);var v=this.getRankString(rank),b="jstpl_score_entry";"undefined"!=typeof jstpl_score_entry_specific&&(b="jstpl_score_entry_specific");var y="";m.color_back&&(y="background-color: #"+m.color_back+";");if(null!==n&&n==m.score&&null!==m.score_aux){o.push(m.score);1==rank&&(s=!0)}n=m.score;m.player==this.player_id&&(g=rank);f=rank;if(!d){void 0===m.player&&(m.player=0);i+=this.format_block(b,{rank:v,name:m.name,color:m.color,color_back:y,score:m.score,score_aux:m.score_aux,index:a,id:m.player})}toint(m.score)>0&&(r=!0);a++}i+="<br class='clear' /><br/>";i+="<div style='text-align: center'>";var w="neutral";null!==g&&1==g&&f>1&&(w="victory");null!==g&&g==f&&f>1&&(w="lose");s&&(l=__("lang_mainsite","End of game (tie)"));this.losers_not_ranked&&(l=this.isSpectator?__("lang_mainsite","End of game"):"victory"==w?__("lang_mainsite","End of game (victory)"):"neutral"==w&&s?__("lang_mainsite","End of game (tie)"):__("lang_mainsite","End of game (defeat)"));d&&(l=__("lang_mainsite","End of game (abandon)"));c&&(l=__("lang_mainsite","End of game (tournament maximum time reached)"));h&&(l=__("lang_mainsite","End of game (players disagree on the game results)"));u&&(l=__("lang_mainsite","End of game (Arena season has ended)"));if(this.is_coop||this.is_solo)if(this.isSpectator)l=__("lang_mainsite","End of game");else if(r){l=__("lang_mainsite","End of game (victory)");w="victory"}else{l=__("lang_mainsite","End of game (defeat)");w="lose"}if("block"==e.style("neutralized_game_panel","display")||this.gamedatas.game_result_neutralized>0){i+=$("neutralized_explanation").innerHTML;l=__("lang_mainsite","End of game (game results neutralized)");this.tiebreaker=""}o.length>0&&""!=this.tiebreaker&&!d&&(i+="<div class='smalltext'>(<i class='fa fa-star tiebreaker'></i>: "+__("lang_mainsite","Tie breaker")+": "+_(this.tiebreaker)+")</div><br/>");c&&(i+="<div>("+__("lang_mainsite","Game has been abandonned automatically because players did not managed to finish it before the next round of the tournament. The player with the most remaining reflexion time wins the game.")+")</div><br/>");h&&(i+="<div>("+__("lang_mainsite","Game has been abandonned automatically because players did not managed to agree on a game result.")+")</div><br/>");d||(i+='<div class="fb-share-button" data-href="https://boardgamearena.com/table?table='+this.table_id+"table?table="+this.table_id+'" data-layout="button" data-size="large"></div>');return{html:i,title:l,result_for_current_player:w,tied_scores:o}},onFBReady:function(){e.query(".publishresult").style("display","inline-block");e.forEach(e.query(".fb_button_text"),(function(e){e.innerHTML=__("lang_mainsite","Publish on my Facebook profile")}))},onShowGameResults:function(){},onGameEnd:function(){this.displayScores();$("pagemaintitletext").innerHTML+="<br/>";this.addActionButton("backMetasite_btn",__("lang_mainsite","Return to main site"),"onBackToMetasite");this.addActionButton("createNew_btn",__("lang_mainsite","Play again"),"onCreateNewTable");this.isSpectator||this.addActionButton("revenge_btn",__("lang_mainsite","Propose a rematch"),"onProposeRematch");this.blinkid;e.hasClass("archivecontrol","demomode")?setTimeout(e.hitch(this,(function(){parent.location.reload()})),1e3):e.hasClass("archivecontrol","loop")&&setTimeout(e.hitch(this,(function(){window.location.reload()})),1e3);""!=this.quickGameEndUrl&&setTimeout(e.hitch(this,(function(){document.location.href=this.quickGameEndUrl+"?table="+this.table_id})),1e3);this.updateVisitors(this.last_visitorlist)},prepareMediaRatingParams:function(){this.mediaRatingParams="";"undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&this.mediaChatRating&&0!=this.rtc_mode&&null!==this.room&&(this.mediaRatingParams="media_rating="+(2==this.rtc_mode?"video":"audio")+"&room="+this.room)},getMediaRatingParams:function(e){void 0===e&&(e=!1);return"undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&this.mediaChatRating&&""!=this.mediaRatingParams?e?"?"+this.mediaRatingParams:"&"+this.mediaRatingParams:""},redirectToTablePage:function(){document.location.href=this.metasiteurl+"/table?table="+this.table_id+this.getMediaRatingParams(!1)},redirectToTournamentPage:function(){document.location.href=this.metasiteurl+"/tournament?id="+this.tournament_id+this.getMediaRatingParams(!1)},redirectToLobby:function(){document.location.href=this.metasiteurl+"/"+this.mslobby+this.getMediaRatingParams(!0)},redirectToMainsite:function(){document.location.href=this.metasiteurl+"/"+this.getMediaRatingParams(!0)},redirectToGamePage:function(){document.location.href=this.metasiteurl+"/gamepanel?game="+this.game_name+this.getMediaRatingParams(!1)},doRedirectToMetasite:function(){"new"===localStorage.getItem("bga-lobby-type")?this.redirectToGamePage():this.quickGameEnd?""!=this.quickGameEndUrl?this.redirectToTablePage():this.redirectToMainsite():null!=this.tournament_id?this.redirectToTournamentPage():this.redirectToLobby()},onBackToMetasite:function(){if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom(e.hitch(this,this.doRedirectToMetasite))}else this.doRedirectToMetasite()},onCreateNewTable:function(){if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom()}this.ajaxcall("/table/table/createnew.html",{game:this.game_id,src:"g",redirect_manual:!0},this,(function(e){(e.manual_lobby||e.mmstarted)&&(document.location.href=this.metasiteurl+"/lobby?game="+this.game_id+this.getMediaRatingParams(!1))}))},onProposeRematch:function(){if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom()}this.ajaxcall("/table/table/createnew.html",{game:this.game_id,rematch:this.table_id,src:"R"},this,(function(e){var t=e.table;document.location.href=this.metasiteurl+"/table?table="+t+"&acceptinvit"+this.getMediaRatingParams(!1)}))},onBuyThisGame:function(){document.location.href=this.blinkid},ajaxcall:function(){var t=arguments[0],i="/"+this.game_name+"/"+this.game_name+"/";if(g_archive_mode){var n=arguments[1],o=arguments[2],a=arguments[4];if(0==t.indexOf(i)){var s=t.substr(i.length);s=s.replace(".html","");delete n.lock;n.__action__=s;n.__move_id__=toint($("move_nbr").innerHTML)+1;n.__player_id__=this.player_id;n.table=this.table_id;n.h=g_gamelogs[this.next_archive_index].data[0].h;if(this.notifqueue.queue.length>0)for(var r in this.notifqueue.queue)if(void 0!==this.notifqueue.queue[r].h){n.h=this.notifqueue.queue[r].h;break}if("view"==g_tutorialwritten.mode&&!$("do_action_to_continue")){this.showMessage(__("lang_mainsite","You must use Continue button to continue the tutorial"),"error");return}var l=null;this.notifqueue.queue.length>0&&void 0!==this.notifqueue.queue[0].move_id&&(l=toint(this.notifqueue.queue[0].move_id));if(n.__move_id__===l){this.showMessage(__("lang_mainsite",'You are in the middle of reviewing a move, so you cannot play: use the "Next move" button to go to the end of this move'),"error");return}return ebg.core.sitecore.prototype.ajaxcall.call(this,"/table/table/checkNextMove.html",n,this,(function(t){if("ok"==t){this.archive_playmode="nextcomment";e.style("archiveCommentMinimizedIcon","display","none");this.doNewArchiveCommentNext()}}),(function(t){void 0!==a&&e.hitch(o,a)(!0,t,0)}))}}else if("/"==t.charAt(0)){var d="/"+this.game_name+"/"+this.game_name;t.substr(0,d.length)==d&&(arguments[0]=t.substr(1))}arguments[1].table=this.table_id;null!==this.forceTestUser&&(arguments[1].testuser=this.forceTestUser);if(e.hasClass("ebd-body","arena_cannot_play")&&0==t.indexOf(i)){if((n=arguments[1]).lock){this.showMessage(_("You must play first on another table"),"error");return}}return this.inherited(arguments)},onGlobalActionPause:function(e){e.preventDefault()},onGlobalActionFullscreen:function(t){e.stopEvent(t);var i=document.documentElement;i.requestFullScreen?i.requestFullScreen():i.webkitRequestFullScreen?i.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):i.mozRequestFullScreen?i.mozRequestFullScreen():window.open("/"+this.gameserver+"/"+this.game_name+"?table="+this.table_id,"","fullscreen=yes,scrollbars=yes");return!1},switchLogModeTo:function(t){if(0!=t&&"2cols"!=this.log_mode){this.log_mode="2cols";e.addClass("ebd-body","logs_on_additional_column");this.onGameUiWidthChange()}else if(0==t&&"normal"!=this.log_mode){this.log_mode="normal";e.removeClass("ebd-body","logs_on_additional_column");this.onGameUiWidthChange()}},onGlobalActionPreferences:function(){},onGlobalActionHelp:function(){},onGlobalActionBack:function(t){t.preventDefault();if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom(e.hitch(this,(function(){this.redirectToTablePage()})))}else this.redirectToTablePage()},onGlobalActionQuit:function(t){t.preventDefault();if("gameEnd"==this.gamedatas.gamestate.name||g_archive_mode||this.isSpectator)if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom(e.hitch(this,(function(){this.redirectToTablePage()})))}else this.redirectToTablePage();else this.leaveTable(this.table_id,e.hitch(this,(function(){if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom(e.hitch(this,(function(){this.redirectToTablePage()})))}else this.redirectToTablePage()})))},onNewLog:function(e,t){},addMoveToLog:function(t,i){this.addTooltip("log_"+t,"",__("lang_mainsite","Replay game from this point"));e.addClass("log_"+t,"log_replayable");this.log_to_move_id[t]=i;e.connect($("log_"+t),"onclick",this,"onReplayFromPoint")},onChangeContentHeight:function(){},onReplayFromPoint:function(t){var i=t.target||t.srcElement;if("A"!=i.tagName&&"a"!=i.tagName){var n=t.currentTarget.id.substr(4);if(!e.hasClass("log_"+n,"replay_move_added")){var o=this.log_to_move_id[n];o=Math.max(0,toint(o));var a="/"+this.gameserver+"/"+this.game_name+"?table="+this.table_id+"&replayFrom="+o+(e.query(".expressswitch").length>0?"&testuser="+this.forceTestUser:"");e.place('<p style="text-align:center;"><a href="'+a+'" class="bgabutton bgabutton_gray replay_last_move_button"><span class="textalign"><span class="icon32 icon32_replaylastmoves textalign_inner"></span></span> '+__("lang_mainsite","Replay from this move")+"</a></p>","log_"+n);e.addClass("log_"+n,"replay_move_added")}}},updateDecisionPanel:function(t){if("none"==t.decision_type)e.style("table-decision","display","none");else if(!0===t.decision_taken||"true"==t.decision_taken){e.style("table-decision","display","none");if("abandon"==t.decision_type){this.showMessage(__("lang_mainsite","The decision to ABANDON this game has been taken by all players."),"info");this.isSpectator||this.gamedatas.gamestate.reflexion.total[this.player_id]<0&&this.showMessage(__("lang_mainsite","You are OUT OF TIME, then you automatically accepted to abandon this game."),"info")}}else if(!0===t.decision_refused||"true"==t.decision_refused){e.style("table-decision","display","none");this.notifqueue.addToLog(__("lang_mainsite","Decision on table has been refused"))}else{e.style($("table-decision"),"display","block");var i,n="";"abandon"==t.decision_type?n=__("lang_mainsite","Would you like to abandon this game (no points loss) ?"):"switch_tb"==t.decision_type&&(n=__("lang_mainsite","Would you like to transform this table in a Turn-based table ?"));$("decision-title").innerHTML=n;$("decision-players-0").innerHTML="-";$("decision-players-1").innerHTML="-";$("decision-players-undecided").innerHTML="-";for(i in t.players){var o=t.players[i],a=this.gamedatas.players[i].name,s=$("decision-players-"+o);"-"==s.innerHTML?s.innerHTML="<b>"+a+"</b>":s.innerHTML+=", <b>"+a+"</b>"}this.bRealtime||(s.innerHTML+="<br/><br/><b>"+__("lang_mainsite","Important")+":</b> "+__("lang_mainsite","Until all players agree you must continue to PLAY or you may get some penalties."))}},onPlayerDecide:function(e){e.preventDefault();var t=0;"decision_yes"==e.currentTarget.id&&(t=1);this.ajaxcall("/table/table/decide.html",{type:null,decision:t,table:this.table_id},this,(function(e,t){}))},updateReflexionTimeDisplay:function(){if(g_archive_mode){e.style($("archivecontrol"),"display","block");e.hasClass("archivecontrol","demomode")&&e.style("archivecontrol","display","none")}else{if("undefined"==typeof g_replayFrom)for(var t in this.gamedatas.gamestate.reflexion.total){var i=this.formatReflexionTime(this.gamedatas.gamestate.reflexion.total[t]);$("timeToThink_"+t).innerHTML=i.string}else if(void 0!==this.updatedReflexionTime){this.gamedatas.gamestate.reflexion=this.updatedReflexionTime;for(var t in this.gamedatas.gamestate.reflexion.total){i=this.formatReflexionTime(this.gamedatas.gamestate.reflexion.total[t]);$("timeToThink_"+t).innerHTML=i.string}}if(this.isCurrentPlayerActive()||this.bTimerCommon){if(this.gamedatas.gamestate.reflexion.total[this.player_id]){e.style($("inactiveplayerpanel"),"display","none");e.style($("wouldlikethink_button"),"display","inline");e.style($("not_playing_help"),"display","none");e.style($("ai_not_playing"),"display","none");e.style($("reflexiontime"),"display","block");e.style($("its_your_turn"),"visibility","visible");i=this.formatReflexionTime(this.gamedatas.gamestate.reflexion.total[this.player_id]);$("reflexiontime_value").innerHTML=i.string;this.currentPlayerReflexionStartAt=this.gamedatas.gamestate.reflexion.total[this.player_id]}if(this.bTimerCommon&&!this.isCurrentPlayerActive()){e.style($("wouldlikethink_button"),"display","none");e.style($("its_your_turn"),"visibility","hidden")}}else{e.style($("inactiveplayerpanel"),"display","block");e.style($("wouldlikethink_button"),"display","none");e.style($("ai_not_playing"),"display","none");e.style($("not_playing_help"),"display","none");e.style($("reflexiontime"),"display","none")}if(this.clock_timeout){clearTimeout(this.clock_timeout);this.clock_timeout=null}this.updateReflexionTime(!0)}},updateReflexionTime:function(t){this.clock_timeout=setTimeout(e.hitch(this,"updateReflexionTime"),1e3);var i=this.getActivePlayers();if(this.bTimerCommon){i=[];for(var n in this.gamedatas.players)i.push(n)}var o=!1,a=!1;for(var n in i){var s=i[n];this.gamedatas.gamestate.reflexion.total[s];if(void 0!==t&&t){if(void 0===this.gamedatas.gamestate.reflexion.initial){this.gamedatas.gamestate.reflexion.initial={};this.gamedatas.gamestate.reflexion.initial_ts={}}this.gamedatas.gamestate.reflexion.initial[s]=this.gamedatas.gamestate.reflexion.total[s];this.gamedatas.gamestate.reflexion.initial_ts[s]=(new Date).getTime()}else{var r=!0,l=new Date;void 0!==this.playingHours&&(r=this.playingHours[l.getHours()]);if(r){var d=Math.floor((l.getTime()-this.gamedatas.gamestate.reflexion.initial_ts[s])/1e3);this.gamedatas.gamestate.reflexion.total[s]=this.gamedatas.gamestate.reflexion.initial[s]-d}else a=!0}var c=this.formatReflexionTime(this.gamedatas.gamestate.reflexion.total[s]);void 0!==this.gamedatas.players[s].is_ai&&0!=this.gamedatas.players[s].is_ai&&(o=!0);if($("timeToThink_"+s)){$("timeToThink_"+s).innerHTML=a?'<i class="fa fa-moon-o" aria-hidden="true"></i> '+c.string:c.string;if(c.positive)e.style($("timeToThink_"+s),"color","inherit");else{e.style($("timeToThink_"+s),"color","red");this.bTimerCommon&&($("timeToThink_"+s).innerHTML=this.formatReflexionTime(0).string)}}else this.showMessage("Unknow active player: "+s,"error")}if(this.isCurrentPlayerActive()||this.bTimerCommon){if(void 0!==this.gamedatas.gamestate.reflexion.total[this.player_id]){c=this.formatReflexionTime(this.gamedatas.gamestate.reflexion.total[this.player_id]);$("reflexiontime_value").innerHTML=a?'<div class="icon20 icon20_night this_is_night" style="top:1px"></div> '+c.string:c.string;if(this.gamedatas.gamestate.reflexion.total[this.player_id]<0){e.fx.chain([e.fadeOut({node:"reflexiontime_value",duration:200}),e.fadeIn({node:"reflexiontime_value",duration:200})]).play();this.bTimerCommon&&($("reflexiontime_value").innerHTML=this.formatReflexionTime(0).string)}if(this.bRealtime){if(10==this.gamedatas.gamestate.reflexion.total[this.player_id]){playSound("time_alarm");this.notifqueue.addToLog(__("lang_mainsite","Warning: Your clock has only 10 seconds remaining!"))}if(0==this.gamedatas.gamestate.reflexion.total[this.player_id]){playSound("time_alarm");this.notifqueue.addToLog(__("lang_mainsite","Warning: Your clock is negative: you should play now!"))}if(void 0!==this.currentPlayerReflexionStartAt&&this.currentPlayerReflexionStartAt<0&&this.gamedatas.gamestate.reflexion.total[this.player_id]==this.currentPlayerReflexionStartAt-10){playSound("time_alarm");this.notifqueue.addToLog(__("lang_mainsite","Warning: Your clock is negative: you should play now!"))}}}var h=document.title.substr(0,2),u={"◢ ":"◣ ","◣ ":"◤ ","◤ ":"◥ ","◥ ":"◢ "},p="new";u[h]&&(p=u[h]);document.title="new"==p?"◢ "+document.title:p+document.title.substr(2)}if(a){e.addClass("ebd-body","night_mode");this.addTooltipToClass("this_is_night",e.string.substitute(__("lang_mainsite","Playing hours for this game are ${hours}: consequently, the timer is not decreasing at now."),{hours:$("menu_option_value_206").innerHTML}),"")}else e.removeClass("ebd-body","night_mode");this.updateFirePlayerLink();this.lastWouldLikeThinkBlinking++;if(this.lastWouldLikeThinkBlinking>30&&i.length>0){e.fx.chain([e.fadeOut({node:"wouldlikethink_button",duration:200}),e.fadeIn({node:"wouldlikethink_button",duration:200})]).play();this.isCurrentPlayerActive()||(o?e.style($("ai_not_playing"),"display","inline"):e.style($("not_playing_help"),"display","inline"))}e.query(".blinking").forEach((function(t){e.fx.chain([e.fadeOut({node:t,duration:200}),e.fadeIn({node:t,duration:200})]).play()}))},shouldDisplayClockAlert:function(e){return this.gamedatas.gamestate.reflexion.total[e]<=0},updateFirePlayerLink:function(){e.style("skip_player_turn","display","none");var t=this.getActivePlayers();for(var i in t){var n=t[i];toint(n)!=toint(this.player_id)&&this.gamedatas.gamestate.reflexion.total[n]<0&&(this.isSpectator||e.style("skip_player_turn","display","inline"))}},onWouldLikeToThink:function(e){e.preventDefault();this.ajaxcall("/table/table/wouldlikethink.html",{},this,(function(e,t){}))},sendWakeupInTenSeconds:function(){this.cancelPlannedWakeUp();this.wakeup_timeout=setTimeout(e.hitch(this,"sendWakeUpSignal"),1e4)},sendWakeUpSignal:function(){this.cancelPlannedWakeUp();this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/wakeup.html",{myturnack:!0,table:this.table_id},this,(function(e,t){}))},cancelPlannedWakeUp:function(){if(this.wakeup_timeout){clearTimeout(this.wakeup_timeout);this.wakeup_timeout=null}},checkWakupUpInFourteenSeconds:function(){this.cancelPlannedWakeUpCheck();var t=14e3+6e3*Math.random();this.wakeupcheck_timeout=setTimeout(e.hitch(this,"checkWakups"),t)},checkWakups:function(){this.cancelPlannedWakeUpCheck();var e=!1,t=this.getActivePlayers();for(var i in t){var n=t[i];if("wait"==this.gamedatas.players[n].ack){this.gamedatas.players[n].ack="unavail";$("avatar_active_"+n).src=getStaticAssetUrl("img/layout/active_player_nonack.gif");e=!0}}e&&(this.isSpectator||this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/wakeupPlayers.html",{},this,(function(e,t){})))},cancelPlannedWakeUpCheck:function(){if(this.wakeupcheck_timeout){clearTimeout(this.wakeupcheck_timeout);this.wakeupcheck_timeout=null}},isInterfaceLocked:function(){return null!==this.interface_locked_by_id},isInterfaceUnlocked:function(){return null===this.interface_locked_by_id},lockInterface:function(t){this.isInterfaceLocked();e.addClass("ebd-body","lockedInterface");this.interface_locked_by_id=t},unlockInterface:function(t){if(this.isInterfaceLocked()&&this.interface_locked_by_id==t){this.interface_locked_by_id=null;e.removeClass("ebd-body","lockedInterface")}},onLockInterface:function(t){if("outgoing"==t.status){this.lockInterface(t.uuid);this.interface_locking_type=null;t.type&&(this.interface_locking_type=t.type);e.style("pagemaintitle_wrap","display","none");e.style("gameaction_status_wrap","display","block");$("gameaction_status").innerHTML=__("lang_mainsite","Sending move to server ...");this.interface_status="outgoing"}else if(t.uuid==this.interface_locked_by_id){if("recorded"==t.status&&"outgoing"==this.interface_status){$("gameaction_status").innerHTML=__("lang_mainsite","Move recorded, waiting for update ...");this.interface_status="recorded"}if(null===this.interface_locking_type||"table"==this.interface_locking_type&&t.bIsTableMsg||"player"==this.interface_locking_type&&!t.bIsTableMsg)if("queued"==t.status){if("outgoing"==this.interface_status||"recorded"==this.interface_status){$("gameaction_status").innerHTML=__("lang_mainsite","Updating game situation ...");this.interface_status="queued"}}else if("dispatched"==t.status)"queued"==this.interface_status&&(this.interface_status="dispatched");else if("updated"==t.status){this.unlockInterface(t.uuid);this.interface_status="updated";e.style("pagemaintitle_wrap","display","block");e.style("gameaction_status_wrap","display","none");e.style("synchronous_notif_icon","display","none")}}else if("queued"==t.status&&this.isInterfaceUnlocked()){this.lockInterface(t.uuid);this.interface_locking_type=null;t.type&&(this.interface_locking_type=t.type);$("gameaction_status").innerHTML=__("lang_mainsite","Updating game situation ...");this.interface_status="queued";e.style("pagemaintitle_wrap","display","none");e.style("gameaction_status_wrap","display","block")}},checkLock:function(e){if(this.isInterfaceLocked()){void 0===e&&this.showMessage(__("lang_mainsite","Please wait, an action is already in progress"),"error");return!1}return!0},checkAction:function(e,t){if(!this.checkLock(t)){void 0===t&&this.developermode&&this.showMessage("(Generated by: checkAction/"+e+")","error");return!1}if(!this.isCurrentPlayerActive()){void 0===t&&this.showMessage(__("lang_mainsite","This is not your turn"),"error");return!1}if(this.checkPossibleActions(e))return!0;void 0===t&&this.showMoveUnauthorized();return!1},checkPossibleActions:function(e){var t=this.gamedatas.gamestate.possibleactions;this.gamedatas.gamestate.private_state&&this.isCurrentPlayerActive()&&(t=this.gamedatas.gamestate.private_state.possibleactions);for(var i in t)if(t[i]==e)return!0;return!1},showMoveUnauthorized:function(){this.showMessage(__("lang_mainsite","This move is not authorized now"),"error")},disablePlayerPanel:function(t){e.addClass("overall_player_board_"+t,"roundedboxdisabled")},enablePlayerPanel:function(t){e.removeClass("overall_player_board_"+t,"roundedboxdisabled")},enableAllPlayerPanels:function(){e.query(".roundedboxdisabled").removeClass("roundedboxdisabled")},updatePlayerOrdering:function(){var t=0;for(var i in this.gamedatas.playerorder){var n=this.gamedatas.playerorder[i];e.place("overall_player_board_"+n,"player_boards",t);t++}},onAiNotPlaying:function(t){e.stopEvent(t);this.lastWouldLikeThinkBlinking=0;e.style($("ai_not_playing"),"display","none");this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/aiNotPlaying.html",{table:this.table_id},this,(function(e){}))},onNotPlayingHelp:function(e){e.preventDefault();var t=new ebg.popindialog;t.create("fireHelpContent");t.setTitle(__("lang_mainsite","Some player is not playing ?"));var i="<div id='fireHelpContent'>";i+=__("lang_mainsite","Some player is not playing ? Here is what you can do:");i+="<ul>";i+="<li>"+__("lang_mainsite","At first, remember that each player has the absolute right to think as long as he has some time left.")+"</li>";i+="<li>"+__("lang_mainsite","Try to contact him with the chatroom.")+"</li>";i+="<li>"+__("lang_mainsite","Maybe you are disconnected from the server and the other player is waiting for you: try to refresh the page (hit F5) to check.")+"</li>";i+="<li>"+__("lang_mainsite","If the other player is definitely not there, you just have to wait until his time to think is over:")+"</li>";i+="<li>"+__("lang_mainsite","As soon as your opponent is out of time, you can make him skip his turn.")+"</li>";i+="<li>"+__("lang_mainsite","DO NOT quit the game by yourself: you will get a leave penalty and not him.")+"</li>";i+="</ul></div>";t.setContent(i);t.show()},onSkipPlayersOutOfTime:function(e){e.preventDefault();this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/skipPlayersOutOfTime.html",{},this,(function(e){}))},onWouldFirePlayer:function(t){t.preventDefault();this.fireDlg=new ebg.popindialog;this.fireDlg.create("fireDlgContent");this.fireDlg.setTitle(__("lang_mainsite","Skip turn of players out of time"));this.fireDlg.telParentPage=this;var i='<div id="fireDlgContent">';i+="<p>"+__("lang_mainsite","Skipping a player`s turn is an important decision. This player will get a `leave` penalty and will lose ELO if he/she doesn't comme back.")+"</p>";i+="<p>"+e.string.substitute(__("lang_mainsite","You (and eventually all other opponents) will be considered as winner(s) of this game, and you'll get ${percent}% of ELO points you would have get for a normal victory."),{percent:$("pr_gameprogression").innerHTML})+" </p>";this.bRealtime&&(i+="<p>"+e.string.substitute(__("lang_mainsite","A good option is to ${transform_to_tb}, so everyone can finish this game."),{transform_to_tb:'<a href="#" id="transform_to_tb_from_dialog">'+__("lang_mainsite","switch this game to Turn-based mode")+"</a>"})+" </p>");i+="<p>"+e.string.substitute(__("lang_mainsite","Note that you may alternatively propose to ${abandon_this_game} (no penalty and no points for anyone)."),{abandon_this_game:'<a href="#" id="abandon_from_dialog">'+__("lang_mainsite","abandon this game")+"</a>"})+" </p>";i+="<p>"+__("lang_mainsite","Note that the best option for everyone is to finish the game normally. Are you really sure you want to neutralize this game and skip this player's turn?")+" </p>";i+="<br/>";i+="<p><a class='bgabutton bgabutton_gray bgabutton_big' id='fireplayer_cancel'>"+__("lang_mainsite","Continue waiting")+"</a> &nbsp; ";i+="<a class='bgabutton bgabutton_blue bgabutton_big' id='fireplayer_confirm'>"+__("lang_mainsite","Confirm")+"</a></p>";i+="</div>";this.fireDlg.setContent(i);this.fireDlg.show();this.fireDlgStatus="confirm";e.connect($("fireplayer_cancel"),"onclick",e.hitch(this.fireDlg,(function(){this.destroy()})));e.connect($("abandon_from_dialog"),"onclick",e.hitch(this,(function(){this.fireDlg.destroy();this.ajaxcall("/table/table/decide.html",{type:"abandon",decision:1,table:this.table_id},this,(function(e,t){}))})));$("transform_to_tb_from_dialog")&&e.connect($("transform_to_tb_from_dialog"),"onclick",e.hitch(this,(function(){this.fireDlg.destroy();this.ajaxcall("/table/table/decide.html",{type:"switch_tb",decision:1,table:this.table_id},this,(function(e,t){}))})));$("fireplayer_confirm")&&e.connect($("fireplayer_confirm"),"onclick",e.hitch(this.fireDlg,(function(){var t=!1;if(this.telParentPage.bRealtime)if("confirm"==this.telParentPage.fireDlgStatus)t=!0;else{if("expel"!=this.telParentPage.fireDlgStatus)return;t=!1}this.telParentPage.ajaxcall("/"+this.telParentPage.game_name+"/"+this.telParentPage.game_name+"/skipPlayersOutOfTime.html",{warn:t},this,e.hitch(this,(function(e,i){if(t){this.telParentPage.list_of_players_to_expel=e.data.names;this.telParentPage.onDecreaseExpelTime(20)}else this.destroy()})))})))},onDecreaseExpelTime:function(t){var i="Players";void 0!==this.list_of_players_to_expel&&(i=this.list_of_players_to_expel.join(", "));if($("fireplayer_confirm")){$("fireplayer_confirm").innerHTML=e.string.substitute(__("lang_mainsite","${players} will be expelled in ${delay} seconds"),{players:i,delay:t});this.fireDlgStatus="timer";if(0==t){$("fireplayer_confirm").innerHTML=e.string.substitute(__("lang_mainsite","Expel ${players} now"),{players:i});this.fireDlgStatus="expel"}else setTimeout(e.hitch(this,(function(){this.onDecreaseExpelTime(t-1)})),1e3)}},onMove:function(){},onNextMove:function(e){g_archive_mode&&this.initCommentsForMove(e)},initArchiveIndex:function(){"object"==typeof g_gamelogs&&g_gamelogs.data&&(g_gamelogs=g_gamelogs.data.data);for(var e=!0;e;)if(g_gamelogs[this.next_archive_index])toint(g_gamelogs[this.next_archive_index].packet_id)>toint(this.notifqueue.last_packet_id)?e=!1:this.next_archive_index++;else{this.showMessage("Error during game archive initialization","error");e=!1}},sendNextArchive:function(){if(-1==this.next_archive_index){this.showMessage(__("lang_mainsite","End of game"),"info");this.archive_playmode="stop";this.onLastArchivePlayed();return!1}if(this.notifqueue.queue.length>0){this.notifqueue.dispatchNotifications();return!0}var t=g_gamelogs[this.next_archive_index];if(t){e.query(".dijitDialog").forEach(e.destroy);e.query(".dijitDialogUnderlayWrapper").forEach(e.destroy);e.query(".standard_popin").forEach(e.destroy);e.query(".standard_popin_underlay").forEach(e.destroy);var i=!1;if("/table"!=t.channel.substr(0,6)){if(t.channel!=this.private_channel&&t.channel!="/player/p"+this.player_id){this.next_archive_index++;this.sendNextArchive();return!0}t.move_id&&(i=!0)}if(!i&&"nextlog"!=this.archive_playmode){t.data.push({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"archivewaitingdelay",uid:"archivewaitingdelay"+this.archive_uuid});t.data.push({args:{},bIsTableMsg:!0,lock_uuid:"dummy",log:"",type:"end_archivewaitingdelay",uid:"archivewaitingdelay"+(this.archive_uuid+1)})}$("move_nbr").innerHTML;this.notifqueue.onNotification(t);this.next_archive_index++;this.archive_uuid+=2;if(t.move_id){$("replaylogs_progression_"+t.move_id)&&this.slideToObjectPos("archivecursor","replaylogs_progression_"+t.move_id,-30,-23).play();$("replaylogs_move_"+t.move_id)&&e.addClass("replaylogs_move_"+t.move_id,"viewed")}i&&this.sendNextArchive();return!0}this.next_archive_index=-1;this.showMessage(__("lang_mainsite","End of game"),"info");this.archive_playmode="stop";this.onLastArchivePlayed();return!1},onArchiveNext:function(e){e.preventDefault();this.notifqueue.bStopAfterOneNotif=!1;this.clearArchiveCommentTooltip();if($("move_nbr")&&toint($("move_nbr").innerHTML)>0){this.archive_gotomove=toint($("move_nbr").innerHTML)+1;this.archive_playmode="goto";this.sendNextArchive()}else{this.archive_playmode="stop";this.sendNextArchive()}},onArchiveNextLog:function(e){e.preventDefault();this.doArchiveNextLog()},doArchiveNextLog:function(){if(null===this.notifqueue.waiting_from_notifend){this.archive_playmode="nextlog";this.notifqueue.bStopAfterOneNotif=!0;this.notifqueue.log_notification_name=!0;this.clearArchiveCommentTooltip();this.notifqueue.dispatchNotifications()||this.sendNextArchive();delete this.notifqueue.log_notification_name}else this.showMessage(_("A notification is still in progress"),"error")},onArchiveNextTurn:function(e){e.preventDefault();this.notifqueue.bStopAfterOneNotif=!1;this.clearArchiveCommentTooltip();this.archive_playmode="nextturn";this.archive_previous_player=this.gamedatas.gamestate.active_player;this.sendNextArchive()},onArchiveHistory:function(t){e.stopEvent(t);var i=e.position("archivecursor");window.scrollBy({top:i.y-200})},setModeInstataneous:function(){if(0==this.instantaneousMode){this.instantaneousMode=!0;this.savedSynchronousNotif=e.clone(this.notifqueue.synchronous_notifs);e.style("leftright_page_wrapper","visibility","hidden");e.style("loader_mask","display","block");e.style("loader_mask","opacity",1);for(var t in this.notifqueue.synchronous_notifs)-1!=this.notifqueue.synchronous_notifs[t]&&(this.notifqueue.synchronous_notifs[t]=1)}},unsetModeInstantaneous:function(){if(this.instantaneousMode){this.instantaneousMode=!1;e.style("leftright_page_wrapper","visibility","visible");e.style("loader_mask","display","none");for(var t in this.notifqueue.synchronous_notifs)-1!=this.notifqueue.synchronous_notifs[t]&&(this.notifqueue.synchronous_notifs[t]=this.savedSynchronousNotif[t])}},onLastArchivePlayed:function(){this.unsetModeInstantaneous()},onArchiveToEnd:function(e){e.preventDefault();this.notifqueue.bStopAfterOneNotif=!1;this.setModeInstataneous();this.archive_playmode="play";this.sendNextArchive()},onArchiveToEndSlow:function(e){e.preventDefault();this.notifqueue.bStopAfterOneNotif=!1;this.archive_playmode="play";this.sendNextArchive()},onArchiveGoTo:function(t){t.preventDefault();var i='<div id="archive_goto_menu">';void 0!==this.bEnabledArchiveAdvancedFeatures&&(i+="<p><a href='#' id='go_to_game_end'>"+_("Go to end of game (fast)")+"</a></p><hr/>");i+="<p><a href='#' id='go_to_game_end_slow'>"+_("Go to end of game")+"</a></p><hr/>";i+="<p><a href='#' id='go_to_new_turn'>"+_("Go to next player's turn")+"</a></p><hr/>";void 0!==this.bEnabledArchiveAdvancedFeatures&&(i+="<p><a href='#' id='go_to_specific_move'>"+_("Go to specific move (fast)")+"</a></p><hr/>");i+="<p><a href='#' id='go_to_specific_move_slow'>"+_("Go to specific move")+"</a></p>";i+="</div>";if(void 0===this.archiveGotoMenu){this.archiveGotoMenu=new dijit.TooltipDialog({id:"goto_menu",content:i,closable:!0});dijit.popup.open({popup:this.archiveGotoMenu,around:$("archive_end_game"),orient:["below","below-alt","above","above-alt"]});e.query(".dijitTooltipDialogPopup").style("zIndex",1055);e.query("#archive_goto_menu a").connect("onclick",this,(function(e){dijit.popup.close(this.archiveGotoMenu);this.archiveGotoMenu.destroy();delete this.archiveGotoMenu}));$("go_to_game_end")&&e.connect($("go_to_game_end"),"onclick",this,"onArchiveToEnd");e.connect($("go_to_game_end_slow"),"onclick",this,"onArchiveToEndSlow");e.connect($("go_to_new_turn"),"onclick",this,"onArchiveNextTurn");$("go_to_specific_move")&&e.connect($("go_to_specific_move"),"onclick",this,e.hitch(this,(function(t){this.askForValueDialog(_("Enter the move you want to go to"),e.hitch(this,(function(e){""!=e&&this.archiveGoToMove(toint(e),!0)})))})));e.connect($("go_to_specific_move_slow"),"onclick",this,e.hitch(this,(function(t){this.askForValueDialog(_("Enter the move you want to go to"),e.hitch(this,(function(e){""!=e&&this.archiveGoToMove(e,!1)})))})))}else{dijit.popup.close(this.archiveGotoMenu);this.archiveGotoMenu.destroy();delete this.archiveGotoMenu}},onEndDisplayLastArchive:function(){switch(this.archive_playmode){case"stop":return;case"nextturn":this.gamedatas.gamestate.active_player!=this.archive_previous_player&&"activeplayer"==this.gamedatas.gamestate.type?this.archive_playmode="stop":this.sendNextArchive();break;case"play":this.sendNextArchive();break;case"goto":if(-1!=this.next_archive_index){var t=g_gamelogs[this.next_archive_index];if(void 0!==t)if(t.move_id){toint(t.move_id)<=this.archive_gotomove&&this.sendNextArchive();toint(t.move_id)>=this.archive_gotomove&&this.unsetModeInstantaneous()}else this.sendNextArchive()}break;case"nextcomment":if($("newArchiveComment"));else{var i=e.query(".archiveComment").length;this.getCommentsViewedFromStart()>=i?this.showMessage(__("lang_mainsite","No more comments"),"info"):this.sendNextArchive()}}},onArchiveGoToMoveDisplay:function(){e.style("archive_go_to_move_control","display","inline-block");e.style("archive_go_to_move","display","none")},archiveGoToMove:function(e,t){if(toint(e)<=toint($("move_nbr").innerHTML))this.insertParamIntoCurrentURL("goto",toint(e));else{this.notifqueue.bStopAfterOneNotif=!1;this.archive_gotomove=toint(e);this.archive_playmode="goto";t&&this.setModeInstataneous();this.sendNextArchive()}},showArchiveComment:function(t,i){null!==this.archiveCommentNew&&"do_not_show_only_infos"!=t&&this.clearArchiveCommentTooltip();"saved"==t&&(i=0);"edit"==t?e.addClass("ebd-body","archivecommentmode_edit"):e.removeClass("ebd-body","archivecommentmode_edit");var n=!1;if(void 0!==i){var o=$("move_nbr").innerHTML,a=e.query(".archiveComment_move"+o);if("saved"==t)a=e.query(".archiveComment");else if("edit"==t||"displayid"==t){a=e.query("#archiveComment_"+i);i=0}if(!a[i])return!1;var s=a[i].id,r=e.query("#"+s+" .archiveComment_author");if(!r[0])return!1;var l=e.query("#"+s+" .archiveComment_anchor");if(!l[0])return!1;var d=e.query("#"+s+" .archiveComment_text");if(d[0]){var c=e.query("#"+s+" .archiveComment_uid");if(!c[0])return!1;var h=e.query("#"+s+" .archiveComment_no");if(h[0]){if("do_not_show_only_infos"==t)return{notif_uid:c[0].innerHTML};n=!0;this.archiveCommentLastDisplayedNo=h[0].innerHTML;this.archiveCommentLastDisplayedId=s.substr(15)}}var u=0,p=e.query("#"+s+" .archiveComment_continuemode");p[0]&&(u=p[0].innerHTML);var m=0,g=e.query("#"+s+" .archiveComment_displaymode");g[0]&&(m=g[0].innerHTML);var f="",v=e.query("#"+s+" .archiveComment_pointers");v[0]&&(f=v[0].innerHTML);f=f.split(" ");var b=null;for(var y in f)if(null===b)b=f[y];else{var w=f[y];if($(b))if(isNaN(w)){var C=w.split("/");if(3==C.length){var k=atob(C[0]),x=C[1],T=C[2];$(b).setAttribute("datasrc",k);this.archiveCommentAttachImageToElement($(b),x,T)}}else{var A='<div id="tuto_pointer_'+b+'" class="archiveCommentPointed archiveCommentPointed'+w+'"><div class="archiveCommentPointed_inner"></div></div>';e.place(A,$(b));"static"==e.style(b,"position")&&e.style(b,"position","relative");"visible"!=e.style(b,"overflow")&&e.style(b,"overflow","visible")}b=null}e.addClass(s,"commentviewed")}var j=n?d[0].innerHTML:"";j=j.replace(new RegExp("ARCHIVECOMMENT_","g"),"");var S=n?r[0].innerHTML:$("archiveViewerName").innerHTML,M=!1;n&&(M=$("archiveViewerName").innerHTML==r[0].innerHTML);var E=e.query(".archiveComment").length,N=this.getCommentsViewedFromStart(),D=n?this.archiveCommentLastDisplayedId:0,I=__("lang_mainsite","Next comment");if("view"==g_tutorialwritten.mode){I=__("lang_mainsite","Continue");"archiveComment_intro"==s&&(I=__("lang_mainsite","Start"))}A="<div id='newArchiveComment' class='newArchiveComment'>                            <div class='archiveAuthor' style='display:none'>"+S+":</div>                            <div class='archiveComment_before'><p class='archiveComment_before_inner'><i class='fa fa-graduation-cap'></i></p></div>                            <div id='newArchiveCommentMove' class='icon20 icon20_move'></div>                            <textarea id='newArchiveCommentText' maxlength='"+this.tuto_textarea_maxlength+"'>"+j+"</textarea>                            <div id='newArchiveCommentOptions'>                                <select id='newArchiveCommentContinueMode'>                                    <option value='0'>"+__("lang_mainsite","Player must click on Continue button to continue.")+"</option>                                    <option value='1'>"+__("lang_mainsite","Player must DO the next game action with the game interface to continue.")+"</option>                                </select><br/>                                <select id='newArchiveCommentDisplayMode'>                                    <option value='0'>"+__("lang_mainsite","Display this comment with an arrow to the linked item.")+"</option>                                    <option value='1'>"+__("lang_mainsite","Display this comment centered over the linked item.")+"</option>                                </select><br/>                                <a id='newArchiveCommentAdditionalImage' href='#'><i class='fa fa-picture-o fa-2x'></i></a>                                 <a id='newArchiveCommentShowHelp' href='#'><i class='fa fa-info-circle fa-2x' ></i></a>                            </div>                            <div id='newArchiveCommentContinueModeWarning'><i class='fa fa-warning'></i> "+e.string.substitute(__("lang_mainsite","Do not forget to explain to the player which action to do in the text above. Note that the very next action in the replay MUST have been played by ${player}."),{player:"<b>"+$("archiveViewerName").innerHTML+"</b>"})+"</div>                            <div id='newArchiveCommentHelp'><p>"+__("lang_mainsite","Note : you can click on any game element to highlight it when this step is displayed.")+"</p><p>"+__("lang_mainsite","Available markup")+" :<br/>&nbsp;*text in bold*<br/>&nbsp;[red]text in red[/red]<br/>&nbsp;[green]text in green[/green]<br/>&nbsp;[blue]text in blue[/blue]<br/>&nbsp;!!! => <i class='fa fa-exclamation-triangle'></i><br/>&nbsp;[tip] => <i class='fa fa-lightbulb-o'></i><br/>&nbsp;[img]URL[/img] => Display an image. Tip: you may use <a href='https://snipboard.io/'>Snipboard.io</a> to upload an image, and then copy/paste the URL.<br/></p></div>                            <div id='newArchiveCommentTextDisplay'>"+this.applyArchiveCommentMarkup(j)+"</div>                            <div id='newArchiveCommentMoveHelp'>"+__("lang_mainsite","Place your mouse cursor on a game element to attach this comment")+":</div>                            <div id='newArchiveCommentControls' class='newArchiveCommentControls'>                                <a class='bgabutton bgabutton_gray' href='#' id='newArchiveCommentCancel'><span>"+__("lang_mainsite","Cancel")+"</span></a>                                <a class='bgabutton bgabutton_blue' href='#' id='newArchiveCommentSave'><span>"+__("lang_mainsite","Save")+"</span></a>                                <a class='bgabutton bgabutton_blue' href='#' id='newArchiveCommentSaveModify_"+D+"'><span>"+__("lang_mainsite","Save")+"</span></a>                            </div>                            <div id='newArchiveCommentDisplayControls'><a href='#' id='newArchiveCommentDelete' class='bgabutton bgabutton_gray'>"+__("lang_mainsite","Delete")+"</a> <a href='#' id='newArchiveCommentModify' class='bgabutton bgabutton_gray'>"+__("lang_mainsite","Modify")+"</a>&nbsp;&nbsp;<span class='newArchiveCommentNo'>"+N+"/"+E+"&nbsp;&nbsp; </span><a href='#' id='newArchiveCommentNext' class='bgabutton bgabutton_blue'>"+I+"</a></div><a href='#' id='newArchiveCommentMinimize' class='standard_popin_closeicon'><i class='fa fa-minus-square-o fa-lg'></i></a>                        </div>";this.archiveCommentNew=new dijit.TooltipDialog({id:"newArchiveComment",content:A,closable:!0});var L=n?l[0].innerHTML:"page-title",P=!1,R=null;if(!$(L)||"page-title"==L||"archivecontrol_editmode_centercomment"==L){L="archivecontrol_editmode_centercomment";R="game_play_area";P=!0}if(1==m){P=!0;R=L}if(P){var O=e.position(R);if("game_play_area"==R){var B=O.w/2-215;dijit.popup.open({popup:this.archiveCommentNew,x:50,y:180,orient:this.archiveCommentPosition})}else{B=O.x+O.w/2-215;var H=O.y-O.h/2;dijit.popup.open({popup:this.archiveCommentNew,x:B,y:H,orient:"above-centered"})}this.archiveCommentNewAnchor="archivecontrol_editmode_centercomment";this.archiveCommentMobile={id:D,anchor:R,bCenter:P,lastX:B,lastY:200};e.query(".dijitTooltipConnector").style("display","none")}else{dijit.popup.open({popup:this.archiveCommentNew,around:$(L),orient:this.archiveCommentPosition});this.archiveCommentNewAnchor="page-title";var F=e.position(L);this.archiveCommentMobile={id:D,anchor:L,bCenter:P,lastX:F.x,lastY:F.y};e.query(".dijitTooltipConnector").style("display","block")}e.query(".dijitTooltipDialogPopup").addClass("scale-in-center");e.connect($("newArchiveCommentContinueMode"),"onchange",this,"onArchiveCommentContinueModeChange");e.connect($("newArchiveCommentDisplayMode"),"onchange",this,"onArchiveCommentDisplayModeChange");e.connect($("newArchiveCommentMinimize"),"onclick",this,"onArchiveCommentMinimize");if(1==u){$("newArchiveCommentContinueMode").value=1;e.place('<span class="smalltext" id="do_action_to_continue">'+__("lang_mainsite","Do the action to continue")+"</span>","newArchiveCommentNext","after");e.destroy("newArchiveCommentNext")}1==m&&($("newArchiveCommentDisplayMode").value=1);this.archiveCommentMobile.timeout=setTimeout(e.hitch(this,"onRepositionPopop"),10);if("edit"==t){this.addTooltip("newArchiveCommentMove","",__("lang_mainsite","Attach this comment somewhere else"));this.addTooltip("newArchiveCommentAdditionalImage","",__("lang_mainsite","Add image on interface"));this.addTooltip("newArchiveCommentShowHelp","",__("lang_mainsite","Show tips"));e.style("newArchiveCommentMinimize","display","none");e.style("newArchiveCommentDisplayControls","display","none");e.style("newArchiveCommentTextDisplay","display","none");e.style("newArchiveCommentShowHelp","display","inline");e.style("newArchiveCommentAdditionalImage","display","inline");e.style("newArchiveCommentHelp","display","none");e.addClass("newArchiveComment","newArchiveCommentEdit");e.connect($("newArchiveCommentCancel"),"onclick",this,"onNewArchiveCommentCancel");e.connect($("newArchiveCommentMove"),"onmousedown",this,"onNewArchiveCommentStartDrag");e.connect($("newArchiveCommentShowHelp"),"onclick",this,e.hitch(this,(function(t){e.stopEvent(t);e.style("newArchiveCommentShowHelp","display","none");e.style("newArchiveCommentHelp","display","block")})));e.connect($("newArchiveCommentAdditionalImage"),"onclick",this,e.hitch(this,(function(t){e.stopEvent(t);this.askForValueDialog(_("Please enter the URL of the image you want to add"),e.hitch(this,(function(e){if(this.validURL(e)){this.archiveCommentImageToAnchor=e;this.showMessage(_("Please click now on the game interface element where you want to anchor this image."),"info")}else this.showMessage(_("Sorry this is not a valid image URL."),"error")})),e.string.substitute(_("Tips: you may use ${url} to upload an image, and then copy/paste the URL."),{url:'<a href="https://snipboard.io/">Snipboard.io</a>'}));e.style("popin_askforvalue_dialog","zIndex",1001)})));$("newArchiveCommentText").focus();if(""!=$("newArchiveCommentText").value){var z=$("newArchiveCommentText").value,q=new RegExp("\\[img\\](http:|https:)\\/\\/.*?\\/data\\/tutorials\\/(.*?)\\[\\/img\\]","g");z=z.replace(q,"[img]$2[/img]");var W=$("newArchiveCommentText").value.length-z.length;W>0&&($("newArchiveCommentText").maxLength=this.tuto_textarea_maxlength+W)}if(n){e.style("newArchiveCommentSave","display","none");this.archiveCommentNewAnchor=l[0].innerHTML;e.connect($("newArchiveCommentSaveModify_"+D),"onclick",this,"onNewArchiveCommentSaveModify")}else{e.style("newArchiveCommentSaveModify_"+D,"display","none");e.connect($("newArchiveCommentSave"),"onclick",this,"onNewArchiveCommentSave")}this.onArchiveCommentContinueModeChange();this.archiveCommentPointElementMouseEnterEvt=e.connect(window,"mouseover",this,"onArchiveCommentPointElementOnMouseEnter")}else if("display"==t||"saved"==t||"displayid"==t){e.addClass("newArchiveComment","newArchiveCommentDisplay");e.style("newArchiveCommentControls","display","none");e.style("newArchiveCommentMove","display","none");e.style("newArchiveCommentMinimize","display","block");e.style("newArchiveCommentText","display","none");e.style("newArchiveCommentContinueMode","display","none");e.style("newArchiveCommentDisplayMode","display","none");e.style("newArchiveCommentOptions","display","none");e.style("newArchiveCommentHelp","display","none");e.style("newArchiveCommentShowHelp","display","none");e.style("newArchiveCommentAdditionalImage","display","none");if(M&&"view"!=g_tutorialwritten.mode){e.connect($("newArchiveCommentDelete"),"onclick",this,"onNewArchiveCommentDelete");e.connect($("newArchiveCommentModify"),"onclick",this,"onNewArchiveCommentModify")}else{e.style("newArchiveCommentDelete","display","none");e.style("newArchiveCommentModify","display","none")}$("newArchiveCommentNext")&&e.connect($("newArchiveCommentNext"),"onclick",this,"onNewArchiveCommentNext")}if("conclusion"==D){this.tutoratingDone=!1;e.query(".tuto_rating").style("cursor","pointer");e.query(".tuto_rating").connect("onmouseenter",this,"onTutoRatingEnter");e.query(".tuto_rating").connect("onmouseleave",this,"onTutoRatingLeave");e.query(".tuto_rating").connect("onclick",this,"onTutoRatingClick");e.style("newArchiveCommentMinimize","display","none");e.style("newArchiveComment","textAlign","center");e.destroy("newArchiveCommentNext");e.style("newArchiveCommentDisplayControls","display","none");$("end_tutorial_play_now")&&e.connect($("newArchiveCommentTextDisplay"),"onclick",this,(function(){window.location.href=$("end_tutorial_play_now").href}));e.query(".tuto_rating").length>0&&(this.bTutorialRatingStep=!0)}if("view"==g_tutorialwritten.mode&&$("newArchiveCommentNext")){e.connect($("newArchiveComment"),"onclick",this,"onNewArchiveCommentNext");e.addClass("newArchiveComment","archiveCommentClickable")}return!0},getCommentsViewedFromStart:function(){return e.query(".archiveComment.commentviewed").length},onArchiveCommentMinimize:function(t){e.stopEvent(t);clearTimeout(this.archiveCommentMobile.timeout);e.style("archiveCommentMinimizedIcon","display","block");this.placeOnObject("archiveCommentMinimizedIcon","newArchiveComment");this.slideToObjectPos("archiveCommentMinimizedIcon","archiveCommentMinimized",10,0).play();dijit.popup.close(this.archiveCommentNew)},onArchiveCommentMaximize:function(t){e.stopEvent(t);this.showArchiveComment("display",this.archiveCommentNo);e.style("archiveCommentMinimizedIcon","display","none")},applyArchiveCommentMarkup:function(e){e=this.addSmileyToText(e);e=this.applyCommentMarkup(e);e=this.nl2br(e,!1);var t=new RegExp("\\[img\\]((http:|https:)\\/\\/.*?\\.jpg)\\[\\/img\\]","g");e=e.replace(t,'<img src="$1" style="max-width:100%;margin-top:10px;margin-bottom:10px;">');t=new RegExp("\\[img\\]((http:|https:)\\/\\/.*?\\.jpeg)\\[\\/img\\]","g");e=e.replace(t,'<img src="$1" style="max-width:100%;margin-top:10px;margin-bottom:10px;">');t=new RegExp("\\[img\\]((http:|https:)\\/\\/.*?\\.png)\\[\\/img\\]","g");e=e.replace(t,'<img src="$1" style="max-width:100%;margin-top:10px;margin-bottom:10px;">');t=new RegExp("\\[img\\]((http:|https:)\\/\\/.*?)\\[\\/img\\]","g");return e=e.replace(t,"[img]Sorry we support only .jpg and .png images[/img]")},onArchiveCommentPointElementOnMouseEnter:function(t){if(t.target&&t.target.id&&"archiveCommentElementPointerTarget"!=t.target.id&&"archiveCommentElementPointerTargetInner"!=t.target.id&&(void 0===this.archiveCommentDraggingInProgress||!this.archiveCommentDraggingInProgress)){for(var i=!1,n=t.target;null!=n;){n.id&&"game_play_area"==n.id&&(i=!0);n.id&&"page-title"==n.id&&(i=!0);n.id&&"player_boards"==n.id&&(i=!0);n=n.parentNode}if(i){var o=e.position(t.target);if(!(o.w>300&&o.h>300)){$("archiveCommentElementPointerTarget")||e.place('<div id="archiveCommentElementPointerTarget"><div id="archiveCommentElementPointerTargetInner"></div></div>',"page-content");e.style("archiveCommentElementPointerTargetInner","width",o.w+"px");e.style("archiveCommentElementPointerTargetInner","height",o.h+"px");"static"==e.style(t.target,"position")&&e.style(t.target,"position","relative");"visible"!=e.style(t.target,"overflow")&&e.style(t.target,"overflow","visible");this.attachToNewParentNoReplace("archiveCommentElementPointerTarget",t.target,"first");e.connect($("archiveCommentElementPointerTargetInner"),"onclick",this,"onArchiveCommentPointElementClick");this.addTooltip("archiveCommentElementPointerTargetInner","",__("lang_mainsite","Click to highlight / unhighlight this element"));this.archiveCommentPointElementMouseEnterItem=t.target.id}}}},removeArchiveCommentPointElement:function(){e.disconnect(this.archiveCommentPointElementMouseEnterEvt);this.archiveCommentPointElementMouseEnterEvt=null;e.destroy("archiveCommentElementPointerTarget")},archiveCommentAttachImageToElement:function(t,i,n){var o=t.getAttribute("datasrc"),a=t.id+"_attached_webcommentimage";if(o.match(/.(jpg|jpeg|png)$/i))s='<img id="'+a+'" src="'+o+'" class="archiveCommentAttachedImage"></img>';else var s='<img id="'+a+'" src="'+getStaticAssetUrl("img/mainsite/unsupported_types.jpg")+'"  class="archiveCommentAttachedImage"></img>';e.place(s,t);e.connect($(a),"onload",e.hitch(this,(function(){if(void 0!==i&&void 0!==n){e.style(a,"left",i+"px");e.style(a,"top",n+"px")}else this.placeOnObject(a,t);var o=new ebg.draggable;o.create(this,a,a);this.bMustRemoveArchiveCommentImage=!1;o.onStartDragging=e.hitch(this,(function(){e.style("archivecontrol_editmode","display","none");e.style("archivecontrol_editmode_dropcommentimage","display","block");e.connect($("archivecontrol_editmode_dropcommentimage"),"mouseenter",e.hitch(this,(function(){this.bMustRemoveArchiveCommentImage=!0})));e.connect($("archivecontrol_editmode_dropcommentimage"),"mouseleave",e.hitch(this,(function(){this.bMustRemoveArchiveCommentImage=!1})))}));o.onEndDragging=e.hitch(this,(function(t){e.style("archivecontrol_editmode","display","block");e.style("archivecontrol_editmode_dropcommentimage","display","none");this.bMustRemoveArchiveCommentImage&&e.destroy(t)}))})))},onArchiveCommentPointElementClick:function(t){e.stopEvent(t);if(void 0!==this.archiveCommentImageToAnchor&&this.validURL(this.archiveCommentImageToAnchor)){e.addClass(this.archiveCommentPointElementMouseEnterItem,"archiveCommentPointedImage");$(this.archiveCommentPointElementMouseEnterItem).setAttribute("datasrc",this.archiveCommentImageToAnchor);this.archiveCommentAttachImageToElement($(this.archiveCommentPointElementMouseEnterItem))}else{var i=e.query(".tuto_pointer.selected")[0].id.split("_")[2],n=this.archiveCommentPointElementMouseEnterItem;if(e.query("#"+n+" .archiveCommentPointed"+i).length>0)e.query("#"+n+" .archiveCommentPointed").forEach(e.destroy);else{e.query("#"+n+" .archiveCommentPointed").forEach(e.destroy);var o='<div id="tuto_pointer_'+n+'" class="archiveCommentPointed archiveCommentPointed'+i+'"><div class="archiveCommentPointed_inner"></div></div>';e.place(o,this.archiveCommentPointElementMouseEnterItem)}}},onArchiveCommentContinueModeChange:function(t){if(0==$("newArchiveCommentContinueMode").value)e.style("newArchiveCommentContinueModeWarning","display","none");else{e.style("newArchiveCommentContinueModeWarning","display","block");if(!this.isCurrentPlayerActive()){alert(e.string.substitute(__("lang_mainsite","You can choose this option only if this is the turn of ${player}."),{player:$("archiveViewerName").innerHTML}));$("newArchiveCommentContinueMode").value=0;this.onArchiveCommentContinueModeChange()}}},onArchiveCommentDisplayModeChange:function(e){$("newArchiveCommentDisplayMode").value},onTutoRatingEnter:function(t){if(!this.tutoratingDone){for(var i=t.currentTarget.id.substr(11),n=1;n<=i;n++){e.removeClass("tutorating_"+n,"fa-star-o");e.addClass("tutorating_"+n,"fa-star")}for(;n<=5;n++){e.removeClass("tutorating_"+n,"fa-star");e.addClass("tutorating_"+n,"fa-star-o")}1==toint(i)?$("rating_explanation").innerHTML=__("lang_mainsite","I still don't know how to play this game ..."):2==toint(i)?$("rating_explanation").innerHTML=__("lang_mainsite","I'm not really sure I can play this game."):3==toint(i)?$("rating_explanation").innerHTML=__("lang_mainsite","Imperfect, but at least I know how to play."):4==toint(i)?$("rating_explanation").innerHTML=__("lang_mainsite","Good tutorial."):5==toint(i)&&($("rating_explanation").innerHTML=__("lang_mainsite","Perfect tutorial!"))}},onTutoRatingLeave:function(t){if(!this.tutoratingDone){for(var i=1;i<=5;i++){e.removeClass("tutorating_"+i,"fa-star");e.addClass("tutorating_"+i,"fa-star-o")}$("rating_explanation").innerHTML="&nbsp;"}},onTutoRatingClick:function(t){e.stopEvent(t);this.tutoratingDone=!0;var i=t.currentTarget.id.substr(11);this.ajaxcall("/archive/archive/rateTutorial.html",{id:g_tutorialwritten.id,rating:i,move:toint($("move_nbr").innerHTML)},this,(function(e){this.showMessage(__("lang_mainsite","Thanks for your feedback"),"info");window.location.href=i>=3?"/"+this.mslobby+"?game="+this.game_id:"/gamepanel?id="+this.game_id}),(function(e){e&&(this.tutoratingDone=!1)}))},onRepositionPopop:function(){if($(this.archiveCommentMobile.anchor))if(this.archiveCommentMobile.bCenter){e.query(".dijitTooltipConnector").style("display","none");if("game_play_area"==this.archiveCommentMobile.anchor);else{var t=e.position(this.archiveCommentMobile.anchor),i=(e.query(".dijitTooltipDialogPopup").style("height"),t.x+t.w/2-215),n=t.y-t.h/2;dijit.popup.close(this.archiveCommentNew);dijit.popup.open({popup:this.archiveCommentNew,x:i,y:n,orient:"above-centered"});(o=e.position(this.archiveCommentMobile.anchor)).x!=this.archiveCommentMobile.lastX||o.y!=this.archiveCommentMobile.lastY?this.archiveCommentMobile.timeout=setTimeout(e.hitch(this,"onRepositionPopop"),200):this.archiveCommentMobile.timeout=setTimeout(e.hitch(this,"onRepositionPopop"),1e3)}}else{e.query(".dijitTooltipConnector").style("display","block");dijit.popup.close(this.archiveCommentNew);dijit.popup.open({popup:this.archiveCommentNew,around:$(this.archiveCommentMobile.anchor),orient:this.archiveCommentPosition});var o;(o=e.position(this.archiveCommentMobile.anchor)).x!=this.archiveCommentMobile.lastX||o.y!=this.archiveCommentMobile.lastY?this.archiveCommentMobile.timeout=setTimeout(e.hitch(this,"onRepositionPopop"),200):this.archiveCommentMobile.timeout=setTimeout(e.hitch(this,"onRepositionPopop"),1e3)}},clearArchiveCommentTooltip:function(){clearTimeout(this.archiveCommentMobile.timeout);if(null!==this.archiveCommentNew){this.archiveCommentNew.destroy();dijit.popup.close(this.archiveCommentNew);this.archiveCommentNew=null}this.removeArchiveCommentAssociatedElements()},removeArchiveCommentAssociatedElements:function(){e.query(".archiveCommentPointed").forEach(e.destroy);e.query(".archiveCommentAttachedImage").forEach(e.destroy);e.query(".archiveCommentPointedImage").removeClass("archiveCommentPointedImage");e.style("archiveCommentMinimizedIcon","display","none")},onArchiveAddComment:function(e){e.preventDefault();this.showArchiveComment("edit")},onNewArchiveCommentCancel:function(t){e.stopEvent(t);this.removeArchiveCommentPointElement();this.removeArchiveCommentAssociatedElements();this.archiveCommentNew.destroy();this.archiveCommentNew=null;this.showArchiveComment("display",this.archiveCommentNo)},onNewArchiveCommentSave:function(t){e.stopEvent(t);this.removeArchiveCommentPointElement();this.newArchiveCommentSave()},newArchiveCommentSave:function(){var t=$("newArchiveCommentText").value;""!=t&&this.ajaxcall("/archive/archive/addArchiveComment.html",{table:this.table_id,viewpoint:this.player_id,move:toint($("move_nbr").innerHTML),text:t,anchor:this.archiveCommentNewAnchor,aftercomment:this.archiveCommentLastDisplayedNo,afteruid:g_last_msg_dispatched_uid,continuemode:$("newArchiveCommentContinueMode").value,displaymode:$("newArchiveCommentDisplayMode").value,pointers:this.getArchiveCommentsPointers()},this,(function(t){$("newArchiveCommentText").value="";e.place(t,"archiveComments","first");this.archiveCommentNo++;this.showArchiveComment("saved");e.style("publishtutorial_block","display",e.query(".archiveComment").length>0?"block":"none");if(this.tutorialShowOnce(23)){var i=_("About making tutorials"),n=_("Using game replays and comments, you can build tutorials for games on Board Game Arena!");n+="<br/><br/>";n+=e.string.substitute(_("Before you start, please read carefully ${our_guidelines} to make sure your tutorial has a chance to be selected."),{our_guidelines:'<a href="/tutorialfaq" target="_blank">'+_("our guidelines")+"</a>"});this.infoDialog(n,i)}}))},onNewArchiveCommentSaveModify:function(t){e.stopEvent(t);this.removeArchiveCommentPointElement();var i=t.currentTarget.id.substr(28);this.newArchiveCommentSaveModify(i)},newArchiveCommentSaveModify:function(t){var i=$("newArchiveCommentText").value;""!=i&&this.ajaxcall("/archive/archive/updateArchiveComment.html",{comment_id:t,text:i,anchor:this.archiveCommentNewAnchor,continuemode:$("newArchiveCommentContinueMode").value,displaymode:$("newArchiveCommentDisplayMode").value,pointers:this.getArchiveCommentsPointers()},this,(function(i){$("newArchiveCommentText").value="";e.place(i,"archiveComment_"+this.archiveCommentLastDisplayedId,"replace");this.showArchiveComment("displayid",t)}))},getArchiveCommentsPointers:function(){var t="";e.query(".archiveCommentPointed").forEach((function(e){var i=e.className.split(" ");for(var n in i){var o=i[n];if("archiveCommentPointed"==o.substr(0,21)){var a=o.substr(21);""==a||isNaN(a)||(t+=e.parentNode.id+" "+a+" ")}}}));e.query(".archiveCommentAttachedImage").forEach((function(i){var n=btoa(i.getAttribute("src")),o=Math.round(e.style(i,"left")),a=Math.round(e.style(i,"top"));t+=i.parentNode.id+" "+n+"/"+o+"/"+a+" "}));return t},onKeyPressTutorial:function(t){if(t.keyCode==e.keys.SPACE){e.stopEvent(t);return!1}},onKeyUpTutorial:function(t){if(t.keyCode==e.keys.SPACE){if(null!==$("newArchiveCommentNext")){e.stopEvent(t);this.doNewArchiveCommentNext();return!1}if($("do_action_to_continue")){this.showMessage(__("lang_mainsite","You must do the action to continue the tutorial"),"error");return}}},onNewArchiveCommentNext:function(t){e.stopEvent(t);this.doNewArchiveCommentNext()},doNewArchiveCommentNext:function(){if(this.checkLock(!0)){this.notifqueue.bStopAfterOneNotif=!1;if(this.notifqueue.queue.length>0&&"archivewaitingdelay"==this.notifqueue.queue[0].type){this.notifqueue.queue.shift();this.notifqueue.queue.shift()}this.archiveCommentNo++;this.clearArchiveCommentTooltip();if(this.checkIfArchiveCommentMustBeDisplayed());else{var t=e.query(".archiveComment").length;if(this.getCommentsViewedFromStart()>=t){this.showMessage(__("lang_mainsite","No more comments"),"info");this.doArchiveNextLog()}else{this.archive_playmode="nextcomment";this.sendNextArchive()}}}else this.bJumpToNextArchiveOnUnlock=!0},onNewArchiveCommentDelete:function(t){e.stopEvent(t);this.confirmationDialog(__("lang_mainsite","Are you sure?"),e.hitch(this,(function(){this.ajaxcall("/archive/archive/deleteArchiveComment.html",{id:this.archiveCommentLastDisplayedId},this,(function(i){this.showMessage(__("lang_mainsite","Done"),"info");this.removeArchiveCommentPointElement();$("gamelog_archiveComment_"+this.archiveCommentLastDisplayedId)?e.destroy("gamelog_archiveComment_"+this.archiveCommentLastDisplayedId):e.destroy("archiveComment_"+this.archiveCommentLastDisplayedId);this.archiveCommentNo--;this.onNewArchiveCommentNext(t)}))})));e.query(".dijitDialog").style("zIndex",1010)},onNewArchiveCommentModify:function(t){e.stopEvent(t);this.showArchiveComment("edit",this.archiveCommentLastDisplayedId)},onNewArchiveCommentStartDrag:function(t){e.addClass("overall-content","disable_selection");e.style("newArchiveCommentControls","display","none");e.style("newArchiveCommentMove","display","none");e.style("newArchiveCommentMoveHelp","display","block");e.style("archivecontrol_editmode","display","none");e.style("archivecontrol_editmode_centercomment","display","block");e.query(".dijitTooltipConnector").style("display","block");this.addCommentDragMouseUpLink=e.connect($("ebd-body"),"onmouseup",this,"onNewArchiveCommentEndDrag");this.addCommentDragMouseOverLink=e.connect($("ebd-body"),"onmousemove",this,"onNewArchiveCommentDrag");this.archiveCommentDraggingInProgress=!0},onNewArchiveCommentEndDrag:function(t){this.archiveCommentDraggingInProgress=!1;e.removeClass("overall-content","disable_selection");e.disconnect(this.addCommentDragMouseUpLink);e.disconnect(this.addCommentDragMouseOverLink);e.query(".newArchiveCommentMouseOver").removeClass("newArchiveCommentMouseOver");e.style("newArchiveCommentControls","display","block");e.style("newArchiveCommentMove","display","block");e.style("newArchiveCommentMoveHelp","display","none");e.style("archivecontrol_editmode","display","block");e.style("archivecontrol_editmode_centercomment","display","none");if("archivecontrol_editmode_centercomment"==this.archiveCommentMobile.anchor){dijit.popup.close(this.archiveCommentNew);dijit.popup.open({popup:this.archiveCommentNew,x:50,y:180,orient:this.archiveCommentPosition})}else this.onArchiveCommentPointElementOnMouseEnter(t);this.archiveCommentMobile.id},onNewArchiveCommentDrag:function(t){for(var i=t.target;!i.id;)i=i.parentNode;if(i.id&&!e.hasClass(i,"newArchiveCommentMouseOver")){dijit.popup.close(this.archiveCommentNew);e.query(".newArchiveCommentMouseOver").removeClass("newArchiveCommentMouseOver");e.addClass(i,"newArchiveCommentMouseOver");dijit.popup.open({popup:this.archiveCommentNew,around:i,orient:this.archiveCommentPosition});this.archiveCommentMobile.anchor=i.id;this.archiveCommentNewAnchor=i.id;this.archiveCommentMobile.bCenter="archivecontrol_editmode_centercomment"==i.id}},initCommentsForMove:function(e){this.archiveCommentNo=0;this.archiveCommentLastDisplayedNo=0;this.clearArchiveCommentTooltip()},onEndOfNotificationDispatch:function(){if(g_archive_mode&&this.checkIfArchiveCommentMustBeDisplayed()&&"nextcomment"==this.archive_playmode){this.notifqueue.bStopAfterOneNotif=!0;this.unlockInterface(this.interface_locked_by_id)}},checkIfArchiveCommentMustBeDisplayed:function(){var e=this.showArchiveComment("do_not_show_only_infos",this.archiveCommentNo),t=$("move_nbr").innerHTML;if(e&&void 0!==e.notif_uid){if(0==e.notif_uid){this.showArchiveComment("display",this.archiveCommentNo);return!0}if(g_last_msg_dispatched_uid==e.notif_uid){var i=t+"_"+this.archiveCommentNo+"_"+e.notif_uid;if(void 0!==this.archiveCommentAlreadyDisplayed[i])return!1;this.archiveCommentAlreadyDisplayed[i]=!0;this.showArchiveComment("display",this.archiveCommentNo);return!0}}return!1},onHowToTutorial:function(t){e.stopEvent(t);this.clearArchiveCommentTooltip();window.open("/tutorialfaq","_blank")},onTutoPointerClick:function(t){e.stopEvent(t);e.query(".tuto_pointer.selected").removeClass("selected");e.addClass(t.currentTarget.id,"selected")},onPublishTutorial:function(t){e.stopEvent(t);this.clearArchiveCommentTooltip();$("publishTuto")&&e.destroy("publishTuto");if("private"!=this.game_status)if("terramystica"!=this.game_name){this.publishTuto=new ebg.popindialog;this.publishTuto.create("publishTuto");this.publishTuto.setTitle(__("lang_mainsite","Publish as tutorial"));this.publishTuto.setMaxWidth(600);var i='<div id="publishTuto">';i+="<p>"+__("lang_mainsite","This game and your comments will be proposed to beginners as a tutorial to learn this game.")+"</p>";i+="<br/>";i+="<p>"+e.string.substitute(__("lang_mainsite","Before this, expert players (Gurus) will review your tutorial, evaluate it, and check that it respects <a href='${guidelines}' target='_blank'>BGA tutorial guidelines</a>.")+"</p>",{guidelines:"/tutorialfaq"});i+="<br/>";i+='<input id="tuto_lang" type="checkbox"></input> '+e.string.substitute(__("lang_mainsite","My tutorial is written in English."),{guidelines:"/tutorialfaq"});i+="<br/>";i+='<input id="tuto_guidelines" type="checkbox"></input> '+e.string.substitute(__("lang_mainsite","My tutorial respects <a href='${guidelines}' target='_blank'>BGA tutorial guidelines</a>."),{guidelines:"/tutorialfaq"});i+="<br/>";i+="<br/>";i+='<p id="publish_conclusion"></p>';i+='<a id="closepublish_btn" class="bgabutton bgabutton_gray">'+__("lang_mainsite","Close")+"</a> ";i+='<a id="publishTuto_btn" class="bgabutton bgabutton_blue">'+__("lang_mainsite","Publish as tutorial")+"</a>";i+="</div>";this.publishTuto.setContent(i);this.publishTuto.show();e.connect($("closepublish_btn"),"onclick",e.hitch(this,(function(){""!==$("publish_conclusion").innerHTML&&window.location.reload(!1);this.publishTuto.destroy()})));e.connect($("publishTuto_btn"),"onclick",e.hitch(this,(function(){$("tuto_lang").checked&&$("tuto_guidelines").checked?this.ajaxcall("/archive/archive/publishTutorial.html",{id:this.table_id,intro:"",lang:"en",viewpoint:this.player_id},this,(function(t){this.showMessage(__("lang_mainsite","Done"),"info");var i=window.location.href+"&tutorial";i=i.replace("#&tutorial","&tutorial");$("publish_conclusion").innerHTML=__("lang_mainsite","You can test the tutorial from the following URL (or send it to friends for review) :")+'<br/><a target="_blank" href="'+i+'">'+i+"</a>";e.destroy("publishTuto_btn")}),(function(){}),"post"):this.showMessage(_("You must check all the checkboxes"),"error")})))}else this.showMessage(__("lang_mainsite","Sorry, but for legal reasons we cannot propose tutorial for this game on BGA."),"error");else this.showMessage(__("lang_mainsite","You cannot publish a tutorial for a game in Alpha"),"error")},onQuitTutorial:function(t){e.stopEvent(t);void 0!==this.bTutorialRatingStep&&this.bTutorialRatingStep?this.showMessage(__("lang_mainsite","Please rate this tutorial to quit and return to BGA."),"error"):window.location.href="/"+this.mslobby+"?game="+this.game_id},loadReplayLogs:function(){var t=this.getReplayLogNode();e.empty(t);if("public"==g_tutorialwritten.status){e.place('<div class="row"><div id="replaylogs" class="col-md-8"></div><div id="tutorial_stats" class="col-md-4"><h4>'+__("lang_mainsite","Tutorial statistics")+"</h4></div></div>",t);var i="";i+='<div class="row-data"><div class="row-label">Unique view</div><div class="row-value">'+g_tutorialwritten.stats.viewed+"</div></div>";i+='<div class="row-data"><div class="row-label">Recent (<2 months)</div><div class="row-value">'+g_tutorialwritten.stats.recentviewed+"</div></div>";i+='<div class="row-data"><div class="row-label">Average rating</div><div class="row-value">'+Math.round(10*g_tutorialwritten.stats.rating)/10+" / 5</div></div>";i+='<div class="row-data"><div class="row-label">Viewed duration</div><div class="row-value">'+(null===g_tutorialwritten.stats.duration?"-":g_tutorialwritten.stats.duration)+" mn</div></div>";i+='<div class="row-data"><div class="row-label">&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i></div><div class="row-value">'+g_tutorialwritten.stats.rating5+"</div></div>";i+='<div class="row-data"><div class="row-label">&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i></div><div class="row-value">'+g_tutorialwritten.stats.rating4+"</div></div>";i+='<div class="row-data"><div class="row-label">&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i></div><div class="row-value">'+g_tutorialwritten.stats.rating3+"</div></div>";i+='<div class="row-data"><div class="row-label">&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-star"></i><i class="fa fa-star"></i></div><div class="row-value">'+g_tutorialwritten.stats.rating2+"</div></div>";i+='<div class="row-data"><div class="row-label">&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-star"></i></div><div class="row-value">'+g_tutorialwritten.stats.rating1+"</div></div>";for(var n in g_tutorialwritten.stats.steps){var o=g_tutorialwritten.stats.steps[n],a=Math.round(100*o/g_tutorialwritten.stats.recentviewed);i+='<div class="row-data"><div class="row-label">Abandon on move '+n+'</div><div class="row-value">'+o+" ("+a+"%)</div></div>"}e.place(i,"tutorial_stats")}else e.place('<div class="row"><div class="col-md-1"></div><div id="replaylogs" class="col-md-10"></div></div>',t);var s="",r="",l=null,d=(i="",null),c=!1,h="";i+='<div id="archivecursor"><i class="fa fa-caret-right fa-3x" aria-hidden="true"></i></div>';for(var u in g_gamelogs){var p=g_gamelogs[u],m=!0;"/table"!=p.channel.substr(0,6)&&(p.channel==this.private_channel||p.channel=="/player/p"+this.player_id||(m=!1));if(m){null!==p.move_id&&null!==l&&l!=p.move_id&&(i+="</div>");var g=!1;if(null!==p.move_id&&l!=p.move_id){g=!0;l=p.move_id;h="";p.move_id<=toint($("move_nbr").innerHTML)&&(h=" viewed ");var _='<div id="replaylogs_move_'+p.move_id+'" class="replaylogs_move '+h+'"><div class="replaylogs_progression"><div id="replaylogs_progression_'+p.move_id+'" class="replaylogs_progression_bottom"></div></div><div class="smalltext">'+__("lang_mainsite","Move")+" "+p.move_id+" :";if(void 0!==p.time){var f=new Date(1e3*p.time);r=f.toLocaleDateString();_+=r!=s?'<span style="float: right">'+r+" "+f.toLocaleTimeString()+"</span></div>":'<span style="float: right">'+f.toLocaleTimeString()+"</span></div>"}else _+='<span style="float: right">'+p.data[0].time+" GMT+1</span></div>";c=!1}for(var v in p.data){var b=p.data[v];if(""!=b.log){if(!c){c=!0;i+=_}i+='<div class="gamelogreview whiteblock">'+this.format_string_recursive(b.log,b.args)+"</div>"}}if(c){s=r;""!=h&&(d=p.move_id)}g&&e.query(".archiveComment_move"+p.move_id).forEach(e.hitch(this,(function(t){if(!c){c=!0;i+=_}i+='<div class="gamelogreview gamelog_archivecomment whiteblock"><i class="fa fa-graduation-cap" style="float:left;margin-right:8px;"></i>'+t.outerHTML+'<i class="fa fa-trash"></i></div>';e.destroy(t)})))}}null!==l&&(i+="</div>");e.place(i,"replaylogs");e.query(".replaylogs_move").connect("onclick",this,"onReplayLogClick");if(null!==d){this.archiveCursorPos=d;this.replaceArchiveCursor()}e.query(".own_comment").forEach((function(t){e.addClass(t.parentNode,"own_comment");t.parentNode.id="gamelog_"+t.id}));e.query(".own_comment .archiveComment_text").connect("onclick",this,"onEditReplayLogsComment");e.query(".archiveComment").connect("onclick",this,(function(t){e.stopEvent(t)}));e.query(".gamelog_archivecomment .fa-trash").connect("onclick",this,"onRemoveReplayLogsComment")},replaceArchiveCursor:function(){this.slideToObjectPos("archivecursor","replaylogs_progression_"+this.archiveCursorPos,-30,-23).play()},onEditReplayLogsComment:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(20);e.place('<div id="replaylogs_edit_inplace_'+i+'" class="replaylogs_edit_inplace"><textarea  id="replaylogs_edit_text_'+i+'">'+t.currentTarget.innerHTML+'</textarea><br/><div id="replaylogs_edit_save_'+i+'" class="bgabutton bgabutton_blue">'+__("lang_mainsite","Save")+"</div></div>",t.currentTarget.id,"after");e.style(t.currentTarget.id,"display","none");e.connect($("replaylogs_edit_save_"+i),"onclick",this,"onEditReplayLogsCommentSave")},onRemoveReplayLogsComment:function(t){e.stopEvent(t);var i=t.currentTarget.parentNode.id.substr(23);this.confirmationDialog(__("lang_mainsite","Are you sure?"),e.hitch(this,(function(){this.ajaxcall("/archive/archive/deleteArchiveComment.html",{id:i},this,(function(t){this.showMessage(__("lang_mainsite","Done"),"info");e.destroy("gamelog_archiveComment_"+i)}))})))},onEditReplayLogsCommentSave:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(21),n=$("replaylogs_edit_text_"+i).value;""==n||this.ajaxcall("/archive/archive/updateArchiveComment.html",{comment_id:i,text:n,anchor:""},this,(function(t){e.style("archiveComment_text_"+i,"display","block");$("archiveComment_text_"+i).innerHTML=n;e.destroy("replaylogs_edit_inplace_"+i)}))},onReplayLogClick:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(16);if(toint(i)-1<toint($("move_nbr").innerHTML))this.insertParamIntoCurrentURL("goto",i-1);else if(toint(i)-1==toint($("move_nbr").innerHTML));else{$("archive_go_to_move_nbr").value=i-1;this.archive_gotomove=toint(i-1);this.archive_playmode="goto";this.sendNextArchive()}},ensureImageLoading:function(){for(var t in g_img_preload){var i=g_img_preload[t];if(""!=i){var n=new Image;e.connect(n,"onload",this,"onLoadImageOk");e.connect(n,"onerror",this,"onLoadImageNok");var o=g_gamethemeurl+"img/"+i;this.images_loading_status[o]=!1;n.src=g_gamethemeurl+"img/"+i}}},ensureSpecificImageLoading:function(t){for(var i in t){var n=t[i];if(""!=n){var o=new Image;e.connect(o,"onerror",this,"onLoadImageNok");o.src=getStaticAssetUrl("img/"+this.game_name+"/"+n)}}},ensureSpecificGameImageLoading:function(t){for(var i in t){var n=t[i];if(""!=n){var o=new Image;e.connect(o,"onload",this,"onLoadImageOk");e.connect(o,"onerror",this,"onLoadImageNok");o.src=g_gamethemeurl+"img/"+n}}},dontPreloadImage:function(e){for(var t in g_img_preload){g_img_preload[t]==e&&g_img_preload.splice(t,1)}},onLoadImageOk:function(e){var t=decodeURIComponent(e.target.src);if(void 0!==this.images_loading_status[t]){this.images_loading_status[t]=!0;this.updateLoaderPercentage()}},onLoadImageNok:function(e){this.showMessage(__("lang_mainsite","Can't load image:")+' <a href="'+e.currentTarget.src+'" target="_blank">'+e.currentTarget.src+"</a><br/>"+__("lang_mainsite","Please check your connexion or hard-refresh this web page (Ctrl+F5)"),"error")},updateLoaderPercentage:function(){if("undefined"==typeof g_replayFrom){var e=0,t=0;for(var i in this.images_loading_status){e++;this.images_loading_status[i]&&t++}if(0==e)var n=90;else n=90*t/e;var o=0;1==this.log_history_loading_status.downloaded&&(o=0==this.log_history_loading_status.total?100:this.log_history_loading_status.loaded/this.log_history_loading_status.total*100);this.setLoader(10+n,o)}},displayTableWindow:function(t,i,n,o,a,s){void 0===o&&(o="");void 0===a&&(a="");if(void 0!==s){a+="<br/><br/><div style='text-align: center'>";a+="<a class='bgabutton bgabutton_blue' id='close_btn' href='#'><span>"+_(s)+"</span></a>";a+="</div>"}var r=new ebg.popindialog;r.create("tableWindow");r.setTitle(i);var l="<div class='tableWindow'>";if("object"==typeof o){o.args=this.notifqueue.playerNameFilterGame(o.args);l+=this.format_string_recursive(o.str,o.args)}else l+=o;l+="<table>";for(var d in n){var c=n[d];l+="<tr>";for(col_id in c){var h=c[col_id];if("object"==typeof h)if(h.str&&h.args){h.type&&"header"==h.type?l+="<th>":l+="<td>";h.args=this.notifqueue.playerNameFilterGame(h.args);l+=this.format_string_recursive(h.str,h.args);h.type&&"header"==h.type?l+="</th>":l+="</td>"}else l+="<td>invalid displayTable obj</td>";else l+="<td>"+h+"</td>"}l+="</tr>"}l+="</table>";l+=a;l+="</div>";r.setContent(l);$("close_btn")&&e.connect($("close_btn"),"onclick",this,(function(e){e.preventDefault();r.destroy()}));r.show();return r},updatePubBanner:function(){if(!g_archive_mode){if(!this.isCurrentPlayerActive()&&!this.gameisalpha){var t=e.query(".publisherannounce");if(0==t.length)return;if(null===this.nextPubbanner)var i=Math.floor(Math.random()*t.length);else i=this.nextPubbanner%t.length;e.place($("announce_"+i).innerHTML,"inactiveplayermessage","only");this.nextPubbanner++}if(!this.isCurrentPlayerActive()&&this.gameisalpha){var n='<div class="alphabanner">';n+='  <div style="display:inline-block; vertical-align: middle;">';n+='    <a href="#" class="emblemalpha emblemstatus emblemstatus_nofold" style="margin: 6px 8px 6px 8px;"></a>';n+='  </div><div style="display:inline-block; vertical-align: middle;">';n+='    <a target="_blank" href="'+this.metasiteurl+"/bug?id=0&table="+this.table_id+'" class="bgabutton bgabutton_small bgabutton_small_margin bgabutton_blue">'+_("Report a bug")+"</a>";n+='    <a target="_blank" href="'+this.metasiteurl+"/bug?id=0&table="+this.table_id+'&suggest" class="bgabutton bgabutton_small bgabutton_small_margin bgabutton_blue">'+_("Make a suggestion")+"</a>";n+="    <br />";n+='    <a target="_blank" href="'+this.metasiteurl+'/forum/viewtopic.php?f=240&t=17325" class="bgabutton bgabutton_small bgabutton_small_margin bgabutton_gray" style="margin-top: 0px;"> <i class="fa fa-info-circle"></i> '+_("Guidelines")+"</a>";""!=this.game_group&&(n+='    <a target="_blank" href="'+this.metasiteurl+"/group?id="+this.game_group+'" class="bgabutton bgabutton_small bgabutton_small_margin bgabutton_gray" style="margin-top: 0px;"> <i class="fa fa-comment"></i> '+_("Discuss")+"</a>");n+="  </div>";n+="</div>";e.place(n,"inactiveplayermessage","only")}}},onSaveState:function(e){e.preventDefault();var t=e.currentTarget.id.substr(10);this.ajaxcall("/table/table/debugSaveState.html",{table:this.table_id,state:t},this,(function(e){this.showMessage("Done","info")}))},onLoadState:function(e){e.preventDefault();var t=e.currentTarget.id.substr(10);this.ajaxcall("/table/table/loadSaveState.html",{table:this.table_id,state:t},this,(function(e){this.showMessage("Done, reload in progress...","info");window.location.reload()}))},getScriptErrorModuleInfos:function(){return"U="+this.player_id},showTutorial:function(){},onCloseTutorial:function(t){e.stopEvent(t);e.destroy("tutorial_support")},onBeforeChatInput:function(t){if(-1!=(" "+t.msg.toLowerCase()+" ").indexOf(" bug ")){var i=this.metasiteurl+"/bug?id=0&table="+this.table_id;this.notifqueue.addChatToLog("<b>"+e.string.substitute(__("lang_mainsite",'Found a bug? Please report it using <a href="${url}">BGA bug reporting system</a>.'),{url:i+'" target="_blank'})+"</b>")}return!0},showEliminated:function(){var t=new ebg.popindialog;t.create("eliminateDlg");t.setTitle(__("lang_mainsite","You have been eliminated"));var i='<div id="eliminateDlgContent">';i+="<div style='text-align: center'>";i+="<p>"+__("lang_mainsite","You have been eliminated from this game.")+"</p><br/>";this.quickGameEnd?i+="<a href='"+this.metasiteurl+"/' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Return to main site")+"</a><br/>"+__("lang_mainsite","or")+"<br/>":i+="<a href='"+this.metasiteurl+"/table?table="+this.table_id+"' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Return to main site")+"</a><br/>"+__("lang_mainsite","or")+"<br/>";i+="<a href='#' id='closeScoreDlg_btn_elim' onclick='return false;' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Continue to watch the game")+"</a><br/>";this.blinkid&&""!=this.blinkid&&(i+=__("lang_mainsite","or")+"<br/><a href='"+this.blinkid+"' target='_new' class='bgabutton bgabutton_blue'>"+this.blinkdomain+"</a>");i+="</div>";i+="</div>";t.setContent(i);t.show();e.connect($("closeScoreDlg_btn_elim"),"onclick",e.hitch(t,(function(){e.destroy("eliminateDlgContent");this.destroy()})))},setLoader:function(t,i){t=Math.round(t);i=Math.round(i);t<8&&(t=8);e.style("progress_bar_progress","width",t+"%");e.style("game_box_loader_front_wrap","width",t+"%");$("images_status_text").innerHTML=(null!=$("loader_loading_art_text")?$("loader_loading_art_text").textContent:"Loading game art")+" ("+t+"%)";if(toint(t)>=100){var n=e.fadeOut({node:"loader_mask"});e.connect(n,"onEnd",(function(){e.style("loader_mask","display","none")}));n.play()}$("log_history_status_text").innerHTML=(null!=$("loader_loading_logs_text")?$("loader_loading_logs_text").textContent:"Loading game log history")+" ("+i+"%)";e.style("log_history_progress_bar_progress","width",i+"%");toint(i)>=100&&e.style("log_history_status","display","none")},displayZombieBack:function(){e.style("zombieBack","display","block")},onZombieBack:function(t){e.stopEvent(t);this.confirmationDialog(__("lang_mainsite","You will get back into the game, but you will keep the penalty you received for quitting this game. Continue?"),e.hitch(this,(function(){this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/zombieBack.html",{},this,(function(e){}))})))},showNeutralizedGamePanel:function(t,i){if("block"!=e.style("neutralized_game_panel","display")){e.style("neutralized_game_panel","display","block");var n="";n+="<div id='neutralized_explanation'>";n+="<p>"+e.string.substitute(__("lang_mainsite","Player ${name} was out of time (or quit this game) and lost this game (at ${progression}% of the game progression)."),{name:"<b>"+(void 0===this.gamedatas.players[i]?"-inexistent player: "+i+"-":this.gamedatas.players[i].name)+"</b>",progression:Math.round(t)});n+="</p>";if(e.hasClass("ebd-body","training_mode"))n+="<p>"+__("lang_mainsite","Training mode has been enabled for this table: no penalty will be applied.")+"</p>";else{n+="<p>"+__("lang_mainsite","All other players will be considered winners.")+"</p>";n+="<p>"+__("lang_mainsite","This may be frustrating, so quitting players gets a penalty on their Karma (☯). If you want to avoid this situation in the future, play with opponents with a good Karma.")+"</p>"}n+="</div>";this.player_id==i||this.isSpectator||(n+=e.string.substitute(__("lang_mainsite","You may continue to play if you like, or ${quit} this game without any penalty."),{quit:'<div class="bgabutton bgabutton_blue" id="neutralized_quit">'+__("lang_mainsite","quit")+"</div>"}));$("neutralized_game_panel").innerHTML=n;$("neutralized_quit")&&e.connect($("neutralized_quit"),"onclick",this,(function(){this.ajaxcall("/table/table/quitgame.html?src=panel",{table:this.table_id,neutralized:!0,s:"gameui_neutralized"},this,(function(t){if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom(e.hitch(this,(function(){this.redirectToTablePage()})))}else this.redirectToTablePage()}))}));if(this.player_id==i&&1==this.gamedatas.players[i].zombie){this.expelledDlg=new ebg.popindialog;this.expelledDlg.create("expelledDlg");this.expelledDlg.setTitle(__("lang_mainsite","You've been expelled"));n="<div>";n+="<p>"+_("You had no more time and an opponent expelled you from the game :(")+"</p><br/>";n+="<p>"+_("Some tips to avoid this in the future (and avoid a bad reputation):")+"</p>";n+="<p>_ "+_("Choose a slower game speed (ex: `Slow`) or play turn-based.")+"</p>";n+="<p>_ "+_("Make sure you are playing from a stable Internet and reliable device.")+"</p>";n+="<p>_ "+_("Discuss with your opponents and explain your difficulties.")+"</p>";n+="</div>";this.expelledDlg.setContent(n);this.expelledDlg.show()}}},setupCoreNotifications:function(){e.subscribe("gameStateChange",this,"ntf_gameStateChange");e.subscribe("gameStateChangePrivateArg",this,"ntf_gameStateChangePrivateArgs");e.subscribe("gameStateMultipleActiveUpdate",this,"ntf_gameStateMultipleActiveUpdate");e.subscribe("newActivePlayer",this,"ntf_newActivePlayer");e.subscribe("playerstatus",this,"ntf_playerStatusChanged");e.subscribe("yourturnack",this,"ntf_yourTurnAck");e.subscribe("clockalert",this,"ntf_clockalert");e.subscribe("tableInfosChanged",this,"ntf_tableInfosChanged");e.subscribe("playerEliminated",this,"ntf_playerEliminated");e.subscribe("tableDecision",this,"ntf_tableDecision");e.subscribe("infomsg",this,"ntf_infomsg");e.subscribe("archivewaitingdelay",this,"ntf_archivewaitingdelay");e.subscribe("end_archivewaitingdelay",this,"ntf_end_archivewaitingdelay");this.notifqueue.setSynchronous("archivewaitingdelay",500);e.subscribe("replaywaitingdelay",this,"ntf_replaywaitingdelay");e.subscribe("end_replaywaitingdelay",this,"ntf_end_replaywaitingdelay");this.notifqueue.setSynchronous("replaywaitingdelay",1500);e.subscribe("replayinitialwaitingdelay",this,"ntf_replayinitialwaitingdelay");e.subscribe("end_replayinitialwaitingdelay",this,"ntf_end_replayinitialwaitingdelay");this.notifqueue.setSynchronous("replayinitialwaitingdelay",1500);e.subscribe("aiPlayerWaitingDelay",this,"ntf_aiPlayerWaitingDelay");this.notifqueue.setSynchronous("aiPlayerWaitingDelay",2e3);e.subscribe("replay_has_ended",this,"ntf_replay_has_ended");e.subscribe("updateSpectatorList",this,"ntf_updateSpectatorList");e.subscribe("tableWindow",this,"ntf_tableWindow");e.subscribe("wouldlikethink",this,"ntf_wouldlikethink");e.subscribe("updateReflexionTime",this,"ntf_updateReflexionTime");e.subscribe("undoRestorePoint",this,"ntf_undoRestorePoint");e.subscribe("resetInterfaceWithAllDatas",this,"ntf_resetInterfaceWithAllDatas");e.subscribe("zombieModeFail",this,"ntf_zombieModeFail");e.subscribe("zombieModeFailWarning",this,"ntf_zombieModeFailWarning");e.subscribe("aiError",this,"ntf_aiError");e.subscribe("skipTurnOfPlayer",this,"ntf_skipTurnOfPlayer");e.subscribe("zombieBack",this,"ntf_zombieBack");e.subscribe("allPlayersAreZombie",this,"ntf_allPlayersAreZombie");e.subscribe("gameResultNeutralized",this,"ntf_gameResultNeutralized");e.subscribe("playerConcedeGame",this,"ntf_playerConcedeGame");e.subscribe("showTutorial",this,"ntf_showTutorial");this.notifqueue.setSynchronous("showTutorial");e.subscribe("showCursor",this,"ntf_showCursor");e.subscribe("showCursorClick",this,"ntf_showCursorClick");e.subscribe("skipTurnOfPlayerWarning",this,"ntf_skipTurnOfPlayerWarning");e.subscribe("simplePause",this,"ntf_simplePause");this.notifqueue.setSynchronous("simplePause");e.subscribe("banFromTable",this,"ntf_banFromTable");e.subscribe("resultsAvailable",this,"ntf_resultsAvailable");e.subscribe("switchToTurnbased",this,"ntf_switchToTurnbased");e.subscribe("newPrivateState",this,"ntf_newPrivateState")},ntf_gameStateChange:function(t){if(void 0!==t.args.id){this.gamedatas.gamestates[t.args.id];void 0!==this.gamedatas.gamestates[t.args.id].args&&delete this.gamedatas.gamestates[t.args.id].args;void 0!==this.gamedatas.gamestates[t.args.id].updateGameProgression&&delete this.gamedatas.gamestates[t.args.id].updateGameProgression;for(var i in this.gamedatas.gamestates[t.args.id])t.args[i]=this.gamedatas.gamestates[t.args.id][i]}if(this.gamedatas.gamestate.private_state){e.removeClass("overall-content","gamestate_"+this.gamedatas.gamestate.private_state.name);this.onLeavingState(this.gamedatas.gamestate.private_state.name)}e.removeClass("overall-content","gamestate_"+this.gamedatas.gamestate.name);this.onLeavingState(this.gamedatas.gamestate.name);if(null!=this.next_private_args){t.args.args._private=this.next_private_args;this.next_private_args=null}"gameSetup"==this.gamedatas.gamestate.name&&this.sendResizeEvent();this.gamedatas.gamestate=e.clone(t.args);this.last_server_state=e.clone(this.gamedatas.gamestate);this.on_client_state=!1;for(var n in this.gamedatas.players)this.gamedatas.players[n].ack="wait";this.cancelPlannedWakeUp();this.cancelPlannedWakeUpCheck();this.updateActivePlayerAnimation()&&!g_archive_mode&&this.bRealtime&&this.sendWakeupInTenSeconds();this.bRealtime&&!g_archive_mode&&this.checkWakupUpInFourteenSeconds();this.updatePageTitle();e.style("pagemaintitle_wrap","display","block");e.style("gameaction_status_wrap","display","none");void 0!==t.args.updateGameProgression&&($("pr_gameprogression").innerHTML=t.args.updateGameProgression);if("gameSetup"==t.args.name){if(!g_archive_mode){this.showMessage("Game will start in few seconds ...","error");setTimeout("window.location.reload();",3e3)}}else{this.lastWouldLikeThinkBlinking=0;e.addClass("overall-content","gamestate_"+t.args.name);this.onEnteringState(t.args.name,t.args);if("gameEnd"==t.args.name){this.bGameEndJustHappened=!0;this.onGameEnd();void 0===this.end_of_game_timestamp&&(this.end_of_game_timestamp=Math.floor(Date.now()/1e3))}}},ntf_gameStateChangePrivateArgs:function(e){this.next_private_args=e.args},ntf_gameStateMultipleActiveUpdate:function(e){this.gamedatas.gamestate.multiactive=e.args;this.last_server_state.multiactive=e.args;this.updateActivePlayerAnimation()&&this.sendWakeupInTenSeconds();var t=null;null!=this.gamedatas.gamestate.private_state&&this.isCurrentPlayerActive()&&(t=this.gamedatas.gamestate.private_state);this.updatePageTitle(t)},ntf_newActivePlayer:function(e){this.gamedatas.gamestate.active_player=e.args;this.updatePageTitle();this.updateActivePlayerAnimation()},ntf_playerStatusChanged:function(t){var i="player_"+t.args.player_id+"_status";if($(i)){e.removeClass(i,"status_online");e.removeClass(i,"status_offline");e.removeClass(i,"status_inactive");e.addClass(i,"status_"+t.args.player_status)}this.updateFirePlayerLink()},ntf_yourTurnAck:function(e){var t=e.args.player;if(this.gamedatas.players[t]){this.gamedatas.players[t].ack="ack";-1!=$("avatar_active_"+t).src.indexOf("active_player")&&(this.shouldDisplayClockAlert(t)?$("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player_clockalert.gif"):$("avatar_active_"+t).src=getStaticAssetUrl("img/layout/active_player.gif"))}},ntf_clockalert:function(e){},ntf_tableInfosChanged:function(e){if("playerQuitGame"==e.args.reload_reason){this.gamedatas.players[e.args.who_quits].zombie=1;this.updateActivePlayerAnimation()}else if("playerElimination"==e.args.reload_reason){this.gamedatas.players[e.args.who_quits].eliminated=1;this.updateActivePlayerAnimation()}},ntf_playerEliminated:function(e){e.args.who_quits==this.player_id&&this.showEliminated()},ntf_tableDecision:function(e){this.updateDecisionPanel(e.args)},ntf_infomsg:function(t){if(t.args.player==this.player_id){var i=e.string.substitute(t.log,t.args);this.showMessage(i,"info")}},ntf_archivewaitingdelay:function(e){this.lockInterface()},ntf_end_archivewaitingdelay:function(e){this.unlockInterface();if(this.bJumpToNextArchiveOnUnlock){this.bJumpToNextArchiveOnUnlock=!1;this.doNewArchiveCommentNext()}this.onEndDisplayLastArchive()},ntf_replaywaitingdelay:function(e){},ntf_end_replaywaitingdelay:function(e){},ntf_replayinitialwaitingdelay:function(e){},ntf_end_replayinitialwaitingdelay:function(e){},ntf_replay_has_ended:function(e){this.onEndOfReplay()},onEndOfReplay:function(){this.unlockInterface("replayFrom");this.setLoader(100,100);g_replayFrom=void 0;if($("current_header_infos_wrap")){e.style("current_header_infos_wrap","display","block");e.style("previously_on","display","none")}this.gameUpgraded&&(window.location.href=this.getGameStandardUrl())},ntf_updateSpectatorList:function(e){e.channelorig=="/table/ts"+this.table_id&&this.updateVisitors(e.args)},ntf_tableWindow:function(e){var t="";void 0!==e.args.header&&(t=e.args.header);var i="";void 0!==e.args.footer&&(i=e.args.footer);var n="";void 0!==e.args.closing&&(n=e.args.closing);this.displayTableWindow(e.args.id,_(e.args.title),e.args.table,_(t),_(i),_(n))},ntf_wouldlikethink:function(e){this.lastWouldLikeThinkBlinking=0},ntf_updateReflexionTime:function(e){if("undefined"==typeof g_replayFrom){var t=toint(this.gamedatas.gamestate.reflexion.total[e.args.player_id]);this.gamedatas.gamestate.reflexion.total[e.args.player_id]=t+toint(e.args.delta);null!==e.args.max&&(this.gamedatas.gamestate.reflexion.total[e.args.player_id]=Math.min(toint(this.gamedatas.gamestate.reflexion.total[e.args.player_id]),toint(e.args.max)));var i=toint(this.gamedatas.gamestate.reflexion.total[e.args.player_id]);void 0!==this.gamedatas.gamestate.reflexion.initial&&(this.gamedatas.gamestate.reflexion.initial[e.args.player_id]=toint(this.gamedatas.gamestate.reflexion.initial[e.args.player_id])+toint(toint(i)-toint(t)))}},ntf_undoRestorePoint:function(t){g_archive_mode||this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/gamedatas.html",{},this,(function(t){e.query(".player_board_content > *").forEach((function(t){e.hasClass(t,"player_score")||e.hasClass(t,"player_table_status")||e.destroy(t)}));e.empty("game_play_area");e.place(this.original_game_area_html,"game_play_area");e.removeClass("overall-content","gamestate_"+this.gamedatas.gamestate.name);this.destroyAllEbgControls();this.setupNotifications=function(){};this.completesetup(this.game_name,this.game_name_displayed,this.table_id,this.player_id,null,null,"keep_existing_gamedatas_limited",t.data,null,null)}))},ntf_resetInterfaceWithAllDatas:function(t){e.query(".player_board_content > *").forEach((function(t){e.hasClass(t,"player_score")||e.hasClass(t,"player_table_status")||e.destroy(t)}));e.empty("game_play_area");e.place(this.original_game_area_html,"game_play_area");e.removeClass("overall-content","gamestate_"+this.gamedatas.gamestate.name);this.destroyAllEbgControls();this.setupNotifications=function(){};this.completesetup(this.game_name,this.game_name_displayed,this.table_id,this.player_id,null,null,"keep_existing_gamedatas_limited",t.args,null,null)},ntf_zombieModeFailWarning:function(e){this.showMessage(__("lang_mainsite","Error during Skip turn execution : if you are blocked please retry the same action and the game will be abandonned."),"info")},ntf_zombieModeFail:function(e){this.showMessage(__("lang_mainsite","Error during Skip turn execution : this game has been cancelled. Please leave the game."),"info")},ntf_aiError:function(t){this.showMessage(__("lang_mainsite","Artificial intelligence error:")+" "+t.args.error,"error");e.style("ai_not_playing","display","inline")},ntf_skipTurnOfPlayer:function(e){e.args.player_id==this.player_id&&e.args.zombie&&this.displayZombieBack();e.args.zombie&&(this.gamedatas.players[e.args.player_id].zombie=1);this.updateActivePlayerAnimation()},ntf_zombieBack:function(t){if(t.args.player_id==this.player_id){e.style("zombieBack","display","none");this.setNewRTCMode(this.table_id,null,this.rtc_mode)}this.gamedatas.players[t.args.player_id].zombie=0;this.updateActivePlayerAnimation()},ntf_gameResultNeutralized:function(e){this.showNeutralizedGamePanel(e.args.progression,e.args.player_id)},ntf_allPlayersAreZombie:function(t){this.showMessage(__("lang_mainsite","All players are over time limit and all turns are skipped: game is abandonned."),"info");if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room){this.prepareMediaRatingParams();this.doLeaveRoom(e.hitch(this,(function(){this.quickGameEnd?this.redirectToMainsite():this.redirectToTablePage()})))}else this.quickGameEnd?this.redirectToMainsite():this.redirectToTablePage()},ntf_simplePause:function(e){var t=e.args.time;t=Math.min(t,1e4);this.notifqueue.setSynchronousDuration(t)},ntf_showTutorial:function(t){this.lockInterface();t.args.delay&&t.args.delay>0?setTimeout(e.hitch(this,(function(){this.showTutorialItem(t)})),toint(t.args.delay)):this.showTutorialItem(t)},showTutorialActivationDlg:function(){if(this.is_solo)this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/activeTutorial.html",{active:1},this,(function(e){}));else{var t="<div class='tutorial_ingame'>";t+=e.string.substitute(__("lang_mainsite","Welcome on ${game}. Do you want to learn how to play?"),{game:this.game_name_displayed});t+="<div class='tutorial_footer'>";t+="<a id='disable_tutorial' class='bgabutton bgabutton_gray' href='#'>";t+="<span>"+__("lang_mainsite","No, thanks")+"</span></a>&nbsp;&nbsp;";t+="<a id='enable_tutorial' class='bgabutton bgabutton_blue' href='#'>";t+="<span>"+__("lang_mainsite","Yes")+"</span></a></div>";t+="</div>";t+="</div>";this.tutorialActiveDlg=new ebg.popindialog;this.tutorialActiveDlg.create("tutorialActiveDlg");this.tutorialActiveDlg.setTitle(__("lang_mainsite","Tutorial"));this.tutorialActiveDlg.setContent(t);this.tutorialActiveDlg.show();e.connect($("disable_tutorial"),"onclick",this,(function(){this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/activeTutorial.html",{active:0},this,(function(e){}));this.tutorialActiveDlg.destroy()}));e.connect($("enable_tutorial"),"onclick",this,(function(){this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/activeTutorial.html",{active:1},this,(function(e){}));this.tutorialActiveDlg.destroy()}))}},showTutorialItem:function(t){if(void 0===this.tutorialItem[t.args.id]){var i="<div class='tutorial_ingame'>";i+=_(t.args.text);i+="<div class='tutorial_footer'><a id='close_tutorial_"+t.args.id+"' class='bgabutton bgabutton_blue' href='#'>";t.args.calltoaction?i+="<span>"+_(t.args.calltoaction)+"</span></a></div>":i+="<span>"+__("lang_mainsite","Ok")+"</span></a></div>";i+="</div>";var n=null;if(t.args.attachement)n=t.args.attachement;$(n)||(n=null);if(null===n){$("tutorialDialogContent")&&e.destroy("tutorialDialogContent");this.tutorialItem[t.args.id]=new dijit.Dialog({title:__("lang_mainsite","Tutorial")});this.tutorialItem[t.args.id].set("content",i);this.tutorialItem[t.args.id].show();e.connect($("close_tutorial_"+t.args.id),"onclick",this,"onTutorialDlgClose")}else{this.tutorialItem[t.args.id]=new dijit.TooltipDialog({id:"tutorial_item_"+t.args.id,content:i,closable:!0});dijit.popup.open({popup:this.tutorialItem[t.args.id],around:null!==n?$(n):null});e.connect($("close_tutorial_"+t.args.id),"onclick",this,"onTutorialClose")}}else endnotif()},onTutorialClose:function(e){var t=e.currentTarget.id.substr(15);dijit.popup.close(this.tutorialItem[t]);this.tutorialItem[t].destroy();this.markTutorialAsSeen(t)},onTutorialDlgClose:function(e){var t=e.currentTarget.id.substr(15);this.tutorialItem[t].hide();this.tutorialItem[t].destroy();this.markTutorialAsSeen(t)},markTutorialAsSeen:function(t){this.unlockInterface();this.interface_status="updated";e.style("pagemaintitle_wrap","display","block");e.style("gameaction_status_wrap","display","none");e.style("synchronous_notif_icon","display","none");endnotif();this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/seenTutorial.html",{id:t},this,(function(e){}))},toggleTurnBasedNotes:function(){$("ingame_menu_notes");void 0===this.turnBasedNotes?this.openTurnBasedNotes():this.turnBasedNotesIsOpen?this.closeTurnBasedNotes():this.openTurnBasedNotes()},closeTurnBasedNotes:function(){if(void 0!==this.turnBasedNotes&&this.turnBasedNotesIsOpen){dijit.popup.close(this.turnBasedNotesPopup);this.turnBasedNotesIsOpen=!1;window.focus();document.activeElement&&document.activeElement.blur()}},openTurnBasedNotes:function(t){if(void 0===t)t="";else{e.removeClass("ingame_menu_notes","icon32_notes");e.addClass("ingame_menu_notes","icon32_notes_active")}var i=$("ingame_menu_notes");if(void 0===this.turnBasedNotesPopup){var n='<div id="turnbased_notes">';n+="<h3>"+__("lang_mainsite","My personal notes on this game")+":</h3>";n+=__("lang_mainsite","Note: your opponents CANNOT see your notes.");n+="<br/>";n+="<br/>";n+="<textarea id='turnbased_notes_content'>"+t+"</textarea>";n+="<br/>";n+="<div id='turnbased_notes_commands'>";n+="<a href='#' id='btn_clearmynotes' class='bgabutton bgabutton_gray' style='float:left'>"+__("lang_mainsite","Clear my notes")+"</a> &nbsp;";n+="<a href='#' id='btn_savemynotes' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","OK")+"</a> &nbsp;";n+="</div>";n+="<div class='clear'></div>";n+="</div>";this.turnBasedNotesPopup=new dijit.TooltipDialog({id:"turnBasedNotes",content:n,closable:!0});dijit.popup.open({popup:this.turnBasedNotesPopup,around:$(i),orient:["below","below-alt","above","above-alt"]});$("turnbased_notes_content").focus();setCaretPosition($("turnbased_notes_content"),9999);e.query(".dijitPopup").style("zIndex",1054);e.connect($("btn_savemynotes"),"onclick",this,"onSaveNotes");e.connect($("btn_clearmynotes"),"onclick",this,"onClearNotes");this.turnBasedNotesIsOpen=!0}else{dijit.popup.open({popup:this.turnBasedNotesPopup,around:$(i),orient:["below","below-alt","above","above-alt"]});this.turnBasedNotesIsOpen=!0;$("turnbased_notes_content").focus();setCaretPosition($("turnbased_notes_content"),9999);e.query(".dijitPopup").style("zIndex",1054)}},onSaveNotes:function(t){e.stopEvent(t);var i=$("turnbased_notes_content").value;this.ajaxcall("/table/table/updateTurnBasedNotes.html",{value:i,table:this.table_id},this,(function(e){}));if(""!=i){e.removeClass("ingame_menu_notes","icon32_notes");e.addClass("ingame_menu_notes","icon32_notes_active")}else{e.removeClass("ingame_menu_notes","icon32_notes_active");e.addClass("ingame_menu_notes","icon32_notes")}this.closeTurnBasedNotes()},onClearNotes:function(t){e.stopEvent(t);this.ajaxcall("/table/table/updateTurnBasedNotes.html",{value:"",table:this.table_id},this,(function(e){}));e.removeClass("ingame_menu_notes","icon32_notes_active");e.addClass("ingame_menu_notes","icon32_notes");this.closeTurnBasedNotes()},onSeeMoreLink:function(t){e.stopEvent(t);t.currentTarget.id.substr(7);e.query(".link_see_more").style("display","block");e.style(t.currentTarget.id,"display","none")},onThumbUpLink:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(13);this.ajaxcall("/table/table/thumbUpLink.html",{id:i},this,(function(e){$("thumbup_current_"+i).innerHTML=toint($("thumbup_current_"+i).innerHTML)+1}))},onChangePreference:function(e){var t=e.currentTarget.id.substr(26),i=e.currentTarget.value;$("preference_global_control_"+t).value=i;$("preference_global_fontrol_"+t).value=i;"logsSecondColumn"==t?this.switchLogModeTo(i):"showOpponentCursor"==t?this.showMessage(__("lang_mainsite","Your preference will be applied starting next move"),"info"):"displayTooltips"==t&&this.switchDisplayTooltips(i);this.hideIngameMenu();this.ajaxcall("/table/table/changeGlobalPreference.html",{id:t,value:i},this,(function(e){}))},getRanking:function(){if(void 0===this.last_rank_displayed){this.last_rank_displayed=0;this.ranking_mode_displayed="arena"}this.ajaxcall("/gamepanel/gamepanel/getRanking.html",{game:this.game_id,start:this.last_rank_displayed,mode:this.ranking_mode_displayed},this,(function(t){this.insert_rankings(t.ranks);if(0==e.query(".champion").length&&t.champion){t.champion.rank=_("Reigning Champion");t.champion.premium="emblemwrap_l player_in_list_l";t.champion.flagx=t.champion.country.flag_x;t.champion.flagy=t.champion.country.flag_y;t.champion.flagdisplay="inline-block";t.champion.additional_ranking="";t.champion.ranking="";t.champion.add_class="champion";t.champion.avatar=getPlayerAvatar(t.champion.id,t.champion.avatar,32);t.champion.device=playerDeviceToIcon(t.champion.device);e.place(this.format_string(this.jstpl_player_ranking,t.champion),"players","first")}}))},insert_rankings:function(t){var i=this.last_rank_displayed+1;for(var n in t){var o=!1,a=t[n];a.rank=this.getRankString(a.rank_no);a.additional_ranking="";a.premium="";a.add_class="";a.avatar=getPlayerAvatar(a.id,a.avatar,32);a.device=playerDeviceToIcon(a.device);if(a.ranking){a.ranking=this.getEloLabel(a.ranking);a.link=this.metasiteurl+"/player?id="+a.id;a.flagx=a.country.flag_x;a.flagy=a.country.flag_y;a.flagdisplay="inline-block"}else if(a.arena){a.ranking=this.getArenaLabel(a.arena);a.arena>=500&&(a.ranking=this.getArenaLabel(a.arena,a.rank_no));a.link="player?id="+a.id;a.flagx=a.country.flag_x;a.flagy=a.country.flag_y;a.flagdisplay="inline-block";a.additional_ranking="ranking_arena"}else{o=!0;a.name='<img class="masqued_rank" id="maskn_'+a.rank_no+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'"/>';a.ranking='<a href="premium"><img class="masqued_rank" id="maskr_'+a.rank_no+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'"/></a>';a.link="premium";a.flagx=0;a.flagy=0;a.flagdisplay="none";a.id=""}e.place(this.format_string(this.jstpl_player_ranking,a),"players");o||this.addTooltip("flag_"+a.id,a.country.name,"");this.last_rank_displayed=i;i++}},onSeeMoreRanking:function(t){e.stopEvent(t);this.getRanking()},onChangeRankMode:function(t){e.stopEvent(t);e.query(".sectiontitle_dropdown_menu_visible").removeClass("sectiontitle_dropdown_menu_visible");var i=t.currentTarget.id.split("_")[1];this.ranking_mode_displayed="current"==i?"arena":"elo";e.query("#ranking_menu .display_section .fa-check").forEach(e.destroy);e.query("#ranking_menu .display_section .rank_season").removeClass("selected_");e.query("#ranking_menu .display_section .rank_season").addClass("notselected");$("ranking_menu_menu_title").innerHTML=t.currentTarget.innerHTML+' <i class="fa fa-caret-down" aria-hidden="true"></i>';e.place(' <i class="fa fa-check" aria-hidden="true"></i>',t.currentTarget);this.last_rank_displayed=0;e.empty("players");this.getRanking()},ntf_aiPlayerWaitingDelay:function(e){},ntf_playerConcedeGame:function(t){this.showMessage(e.string.substitute(__("lang_mainsite","${player_name} concedes this game."),t.args),"info")},ntf_skipTurnOfPlayerWarning:function(e){e.args.player_id==this.player_id&&this.showMessage(__("lang_mainsite","You are out of time and an opponent is ready to EXPEL you from the game. You have 20 SECONDS to finish your turn or you'll lose this game."),"error");this.notifqueue.resynchronizeNotifications(!1)},ntf_showCursorClick:function(e){if(!$("player_hidecursor_"+e.args.player_id)||$("player_hidecursor_"+e.args.player_id).checked){var t=null,i=null,n=null;for(var o in e.args.path){var a=e.args.path[o];if($(a.id)&&null!==$(a.id).offsetParent){t=a.id;i=a.x;n=a.y;break}}if(null!==t){var s=e.args.player_id;this.showClick(t,i,n,"#"+this.gamedatas.players[s].color)}}},ntf_showCursor:function(t){if(!$("player_hidecursor_"+t.args.player_id)||$("player_hidecursor_"+t.args.player_id).checked){var i=null,n=null,o=null;if(null!=t.args.path){e.style("player_showcursor_"+t.args.player_id,"display","block");for(var a in t.args.path){var s=t.args.path[a];if($(s.id)&&null!==$(s.id).offsetParent){i=s.id;n=s.x;o=s.y;break}}var r=t.args.player_id;if(!$("opponent_cursor_"+r)){var l="";this.gamedatas.players[r]&&(l=this.gamedatas.players[r].name);e.place('<i id="opponent_cursor_'+r+'" class="opponent_cursor fa fa-hand-pointer-o"> '+l+"</i>","ebd-body");null!==i&&this.placeOnObjectPos($("opponent_cursor_"+r),i,n+-10,o)}e.style("opponent_cursor_"+r,"display","block");e.style("opponent_cursor_"+r,"color","#"+this.gamedatas.players[r].color);null!==i&&this.slideToObjectPos($("opponent_cursor_"+r),i,n+-10,o,500).play()}else{$("opponent_cursor_"+t.args.player_id)&&e.destroy("opponent_cursor_"+t.args.player_id);e.style("player_showcursor_"+t.args.player_id,"display","none")}}},onChatKeyDown:function(t){if(this.control3dmode3d&&"ebd-body"==t.target.id&&(37==t.keyCode||38==t.keyCode||39==t.keyCode||40==t.keyCode||107==t.keyCode||109==t.keyCode)){if(0==t.ctrlKey)if(37==t.keyCode)this.change3d(0,0,100,0,0,!0,!1);else if(38==t.keyCode)this.change3d(0,100,0,0,0,!0,!1);else if(39==t.keyCode)this.change3d(0,0,-100,0,0,!0,!1);else if(40==t.keyCode)this.change3d(0,-100,0,0,0,!0,!1);else{if(107==t.keyCode){this.change3d(0,0,0,0,.1,!0,!1);return}if(109==t.keyCode){this.change3d(0,0,0,0,-.1,!0,!1);return}}else 37==t.keyCode?this.change3d(0,0,0,-10,0,!0,!1):38==t.keyCode?this.change3d(-10,0,0,0,0,!0,!1):39==t.keyCode?this.change3d(0,0,0,10,0,!0,!1):40==t.keyCode&&this.change3d(10,0,0,0,0,!0,!1);107==t.keyCode||109==t.keyCode||e.stopEvent(t)}"ebd-body"==t.target.id&&0==t.ctrlKey&&0==t.metaKey&&(t.keyCode>=48&&t.keyCode<=57||t.keyCode>=65&&t.keyCode<=90||t.keyCode>=96&&t.keyCode<=111||32==t.keyCode||59==t.keyCode||61==t.keyCode||173==t.keyCode||186==t.keyCode||187==t.keyCode||188==t.keyCode||189==t.keyCode||190==t.keyCode||191==t.keyCode||192==t.keyCode||219==t.keyCode||220==t.keyCode||221==t.keyCode||222==t.keyCode)&&this.expandChatWindow("table_"+this.table_id,!0);27==t.keyCode&&0==t.ctrlKey&&this.collapseChatWindow("table_"+this.table_id)},onChatInputBlur:function(e){},onJudgeDecision:function(e){var t=e.currentTarget.id.substr(17);this.ajaxcall("/table/table/judgegivevictory.html",{id:this.table_id,winner:t},this,(function(e){}))},registerEbgControl:function(e){this.ebgControls.push(e)},destroyAllEbgControls:function(){for(var e in this.ebgControls)this.ensureEbgObjectReinit(this.ebgControls[e]);this.ebgControls=[]},playMusic:function(e){if(void 0!==$("melodice_frame").getAttribute("to_be_loaded_src")&&null!==$("melodice_frame").getAttribute("to_be_loaded_src")){$("melodice_frame").src=$("melodice_frame").getAttribute("to_be_loaded_src");$("melodice_frame").removeAttribute("to_be_loaded_src")}},onShowGameHelp:function(){if(null!=$("mediawiki_gamehelp_content")){e.place('<div class="loading_icon"></div>',"mediawiki_gamehelp_content");this.ajaxcall("/gamepanel/gamepanel/getWikiHelp.html",{gamename:this.game_name,section:"help"},this,(function(t){e.place(t.content,"mediawiki_gamehelp_content","only")}))}},onShowStrategyHelp:function(){if(null!=$("mediawiki_strategy_content")){e.place('<div class="loading_icon"></div>',"mediawiki_strategy_content");this.ajaxcall("/gamepanel/gamepanel/getWikiHelp.html",{gamename:this.game_name,section:"tips"},this,(function(t){e.place(t.content,"mediawiki_strategy_content","only")}))}},lockScreenCounter:function(){if("gameSetup"==this.gamedatas.gamestate.name&&!g_archive_mode){this.updatePageTitle();this.lockts--;this.lockts<=0&&this.ajaxcall("/"+this.game_name+"/"+this.game_name+"/endLockScreen.html",{},this,(function(e){if(1==e.data.c);else if(void 0!==this.lockScreenTimeout){clearTimeout(this.lockScreenTimeout);return}}));this.lockScreenTimeout=setTimeout(e.hitch(this,"lockScreenCounter"),1e3)}},initHotseat:function(){this.hotseat_focus=null;for(var t in this.hotseat){var i="/"+this.gameserver+"/"+this.game_name+"?table="+this.table_id+"&lang="+dojoConfig.locale+"&testuser="+t;if("normal"==this.hotseat_interface){e.place(e.string.substitute(this.jstpl_hotseat_interface,{url:i,player_id:t}),"overall-footer","before");e.style("hotseat_mask","display","block")}this.hotseat_focus=this.player_id}null!==this.hotseat_focus&&(this.hotseat[this.player_id]=1);"hotseataccount"==this.hotseat_interface&&(this.forceTestUser=this.player_id);e.connect($("hotseat_mask"),"onclick",this,"onHotseatPlayButton")},onHotseatPlayButton:function(t){e.stopEvent(t);e.style("hotseat_mask","display","none")},checkHotseatFocus:function(){if(null!==this.hotseat_focus&&!this.isPlayerActive(this.hotseat_focus))for(var t in this.hotseat)if(this.isPlayerActive(t)){setTimeout(e.hitch(this,(function(){this.giveHotseatFocusTo(t)})),1e3);return}},giveHotseatFocusTo:function(t){if("single_screen"==this.hotseat_interface){this.hotseat_focus=t;this.player_id=t;this.forceTestUser=t;this.showMessage(e.string.substitute("This is ${player} turn!",{player:this.gamedatas.players[t].player_name}),"info")}else{e.query(".hotseat_iframe").style("left","200%");if(t!=this.player_id){e.style("hotseat_iframe_"+t,"left","0px");e.addClass("ebd-body","fullscreen_iframe")}this.hotseat_focus=t;if(this.hotseat_focus==this.player_id){e.style("hotseat_mask","display","block");e.removeClass("ebd-body","fullscreen_iframe")}else{var i=window.frames["hotseat_iframe_"+this.hotseat_focus].contentDocument.getElementById("hotseat_mask");e.style(i,"display","block")}}},init3d:function(){e.connect($("c3dAngleUp"),"onclick",e.hitch(this,this.change3d,-10,0,0,0,0,!0,!1));e.connect($("c3dAngleDown"),"onclick",e.hitch(this,this.change3d,10,0,0,0,0,!0,!1));e.connect($("c3dUp"),"onclick",e.hitch(this,this.change3d,0,100,0,0,0,!0,!1));e.connect($("c3dDown"),"onclick",e.hitch(this,this.change3d,0,-100,0,0,0,!0,!1));e.connect($("c3dLeft"),"onclick",e.hitch(this,this.change3d,0,0,100,0,0,!0,!1));e.connect($("c3dRight"),"onclick",e.hitch(this,this.change3d,0,0,-100,0,0,!0,!1));e.connect($("c3dRotateL"),"onclick",e.hitch(this,this.change3d,0,0,0,-10,0,!0,!1));e.connect($("c3dRotateR"),"onclick",e.hitch(this,this.change3d,0,0,0,10,0,!0,!1));e.connect($("ingame_menu_3d"),"onclick",e.hitch(this,this.change3d,0,0,0,0,0,!1,!1));e.connect($("c3dZoomIn"),"onclick",e.hitch(this,this.change3d,0,0,0,0,.1,!0,!1));e.connect($("c3dZoomOut"),"onclick",e.hitch(this,this.change3d,0,0,0,0,-.1,!0,!1));e.query(".control3d_command").connect("onmouseenter",this,"enter3dButton");e.query(".control3d_command").connect("onmouseleave",this,"leave3dButton");if(e.hasClass("ebd-body","mobile_version")){this.control3ddraggable=new ebg.draggable;this.control3ddraggable.create(this,"controls3d_wrap","controls3d_img")}},change3d:function(t,i,n,o,a,s,r){0==s&&(this.control3dmode3d=!this.control3dmode3d);if(0==this.control3dmode3d){e.hasClass("ebd-body","mode_3d")&&e.removeClass("ebd-body","mode_3d");$("ingame_menu_3d_label").innerHTML=__("lang_mainsite","3D mode");$("game_play_area").style.transform="rotatex(0deg) translate(0px,0px) rotateZ(0deg)"}else{e.hasClass("ebd-body","mode_3d")||e.addClass("ebd-body","mode_3d");e.addClass("ebd-body","enableTransitions");$("ingame_menu_3d_label").innerHTML=__("lang_mainsite","2D mode");this.control3dxaxis+=t;this.control3dxaxis>=80&&(this.control3dxaxis=80);this.control3dxaxis<=0&&(this.control3dxaxis=0);this.control3dscale<.5&&(this.control3dscale=.5);this.control3dzaxis+=o;this.control3dxpos+=i;this.control3dypos+=n;this.control3dscale+=a;if(1==r){this.control3dxaxis=0;this.control3dzaxis=0;this.control3dxpos=0;this.control3dypos=0;this.control3dscale=1}$("game_play_area").style.transform="rotatex("+this.control3dxaxis+"deg) translate("+this.control3dypos+"px,"+this.control3dxpos+"px) rotateZ("+this.control3dzaxis+"deg) scale3d("+this.control3dscale+","+this.control3dscale+","+this.control3dscale+")"}},enter3dButton:function(e){"c3dLeft"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Left arrow"));"c3dRight"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Right arrow"));"c3dUp"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Up arrow"));"c3dDown"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Down arrow"));"c3dRotateL"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Ctrl+Left arrow"));"c3dRotateR"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Ctrl+Right arrow"));"c3dAngleDown"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Ctrl+Down arrow"));"c3dAngleUp"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : Ctrl+Up arrow"));"c3dZoomIn"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : +"));"c3dZoomOut"==e.currentTarget.id&&($("tooltip3d").innerHTML=__("lang_mainsite","Shortcut : -"))},leave3dButton:function(e){$("tooltip3d").innerHTML=__("lang_mainsite","Note: 3D is experimental")},ntf_banFromTable:function(e){if(this.isSpectator&&void 0!==this.gamedatas.players[e.args.from]){location.hash="";window.location.reload()}},ntf_resultsAvailable:function(e){this.updateResultPage()},ntf_switchToTurnbased:function(t){this.showMessage(__("lang_mainsite","This Realtime table has been switched to Turnbased table."),"info");setTimeout(e.hitch(this,(function(){window.location.href=this.getGameStandardUrl()})),1e3)},ntf_newPrivateState:function(t){if(void 0!==t.args.id){this.gamedatas.gamestates[t.args.id];void 0!==this.gamedatas.gamestates[t.args.id].args&&delete this.gamedatas.gamestates[t.args.id].args;void 0!==this.gamedatas.gamestates[t.args.id].updateGameProgression&&delete this.gamedatas.gamestates[t.args.id].updateGameProgression;for(var i in this.gamedatas.gamestates[t.args.id])t.args[i]=this.gamedatas.gamestates[t.args.id][i]}if(this.gamedatas.gamestate.private_state){e.removeClass("overall-content","gamestate_"+this.gamedatas.gamestate.private_state.name);this.onLeavingState(this.gamedatas.gamestate.private_state.name)}this.gamedatas.gamestate.private_state=e.clone(t.args);this.updatePageTitle(this.gamedatas.gamestate.private_state);e.style("pagemaintitle_wrap","display","block");e.style("gameaction_status_wrap","display","none");e.addClass("overall-content","gamestate_"+t.args.name);this.onEnteringState(t.args.name,t.args)},saveclient:function(){this.save=e.clone($("game_play_area"))},restoreClient:function(){e.destroy("game_play_area");e.place(this.save,"game_play_area_wrap")},decodeHtmlEntities:function(e){var t=document.createElement("textarea");t.innerHTML=e;return t.value},applyTranslationsOnLoad:function(){e.query(".to_translate").forEach(e.hitch(this,(function(e){var t=this.decodeHtmlEntities(e.innerHTML),i=t.split("£µ;");if(i.length>1){var n=_(i.shift());for(var o in i){var a=i[o].split("µù;");2==a.length&&(n=n.replace(a[0],a[1]))}e.innerHTML=n}else e.innerHTML=_(t)})))},showGameRatingDialog:function(){g_sitecore.displayRatingContent("game",{table:this.table_id,rating:null,issue:null,text:null})}})}))},"dijit/TooltipDialog":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","./focus","./layout/ContentPane","./_DialogMixin","./form/_FormMixin","./_TemplatedMixin","dojo/text!./templates/TooltipDialog.html","./main"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u){var p=e("dijit.TooltipDialog",[r,c,d,l],{title:"",doLayout:!1,autofocus:!0,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,templateString:h,_setTitleAttr:"containerNode",postCreate:function(){this.inherited(arguments);this.own(a(this.domNode,"keydown",o.hitch(this,"_onKey")))},orient:function(e,i,n){var o={"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft","BR-TL":"dijitTooltipBelow dijitTooltipABLeft","BL-TR":"dijitTooltipBelow dijitTooltipABRight","TL-BR":"dijitTooltipAbove dijitTooltipABRight","TR-BL":"dijitTooltipAbove dijitTooltipABLeft"}[i+"-"+n];t.replace(this.domNode,o,this._currentOrientClass||"");this._currentOrientClass=o},focus:function(){this._getFocusItems();s.focus(this._firstFocusItem)},onOpen:function(e){this.orient(this.domNode,e.aroundCorner,e.corner);var t=e.aroundNodePos;if("M"==e.corner.charAt(0)&&"M"==e.aroundCorner.charAt(0)){this.connectorNode.style.top=t.y+(t.h-this.connectorNode.offsetHeight>>1)-e.y+"px";this.connectorNode.style.left=""}else"M"==e.corner.charAt(1)&&"M"==e.aroundCorner.charAt(1)&&(this.connectorNode.style.left=t.x+(t.w-this.connectorNode.offsetWidth>>1)-e.x+"px");this._onShow()},onClose:function(){this.onHide()},_onKey:function(e){if(e.keyCode==n.ESCAPE){this.defer("onCancel");e.stopPropagation();e.preventDefault()}else if(e.keyCode==n.TAB){var t=e.target;this._getFocusItems();if(this._firstFocusItem==this._lastFocusItem){e.stopPropagation();e.preventDefault()}else if(t==this._firstFocusItem&&e.shiftKey){s.focus(this._lastFocusItem);e.stopPropagation();e.preventDefault()}else if(t!=this._lastFocusItem||e.shiftKey)e.stopPropagation();else{s.focus(this._firstFocusItem);e.stopPropagation();e.preventDefault()}}}});i("dojo-bidi")&&p.extend({_setTitleAttr:function(e){this.containerNode.title=this.textDir&&this.enforceTextDirWithUcc?this.enforceTextDirWithUcc(null,e):e;this._set("title",e)},_setTextDirAttr:function(e){if(!this._created||this.textDir!=e){this._set("textDir",e);this.textDir&&this.title&&(this.containerNode.title=this.enforceTextDirWithUcc(null,this.title))}}});return p}))},"ebg/core/sitecore":function(){define(["dojo","dojo/_base/declare","svelte/index","dojo/has","ebg/core/core","ebg/core/soundManager","dijit/form/Select","dijit/TooltipDialog","dojox/dtl/filter/htmlstrings","ebg/gamenotif","ebg/chatinput","ebg/thumb"],(function(e,t,i){return t("ebg.core.sitecore",ebg.core.core,{constructor:function(){this.ajaxcall_running=0;g_sitecore=this;this.notifqueue=new ebg.gamenotif;this.active_menu_label="";this.next_headmsg_id=1;this.cometd_is_connected=!1;this.page_is_unloading=!1;this.cometd_first_connect=!0;this.cometd_subscriptions={};this.reportErrorTimeout=!1;this.next_log_id=0;this.chatbarWindows={};this.jstpl_chatwindow=['<div id="chatwindow_${id}" class="chatwindow chatwindowtype_${type}">','<div id="chatwindowexpanded_${id}" class="chatwindowexpanded">','<div class="dropshadow"></div>','<div id="chatbarinput_${id}" class="chatbarinput"></div>','<div id="chatbarbelowinput_${id}" class="chatbarbelowinput">','<div id="chatbarinput_stopnotif_${id}" class="chatbarinput_stopnotif">','<input type="checkbox" checked="checked" id="chatbarinput_stopnotif_box_${id}" />','<span id="chatbarinput_stopnotif_label_${id}">${stop_notif_label}</span>',"</div>","<div",' id="chatbarinput_startaudiochat_${id}"',' class="chatwindow_startaudiochat chatbarbelowinput_item audiovideo_inactive">','<i class="fa fa-microphone"></i>',"</div>","<div",' id="chatbarinput_startvideochat_${id}"',' class="chatwindow_startvideochat chatbarbelowinput_item audiovideo_inactive">','<i class="fa fa-video-camera"></i>',"</div>",'<div id="chatbarinput_predefined_${id}" class="chatbarbelowinput_item">','<div class="chatbarinput_predefined icon20 icon20_meeple_wb"></div>',"</div>",'<div id="chatbarinput_showcursor_${id}" class="chatbarbelowinput_item chatbarbelowinput_item_showcursor">','<i class="fa fa-hand-pointer-o"></i>',"</div>",'<div id="chatbar_startchat_${id}" class="chatbar_startchat">','<a class="bgabutton bgabutton_blue" id="startchat_accept_${id}">${start_chat}</a><br />','<a class="bgabutton bgabutton_red" id="startchat_block_${id}">${block_chat}</a>',"</div>","</div>",'<div id="chatwindowlogs_${id}" class="chatwindowlogs">','<div id="chatwindowlogstitlebar_${id}" class="chatwindowlogstitlebar">','<div class="chatwindowlogstitle" id="chatwindowlogstitle_${id}">','<span id="is_writing_now_title_${id}" class="is_writing_now">','<i class="fa fa-pencil fa-blink"></i>&nbsp;<span',' id="is_writing_now_expl_title_${id}"',' class="is_writing_now_expl"></span>',"</span>",'<span id="chatwindowlogstitle_content_${id}">${title}</span>',"</div>",'<div id="chatwindowicon_${id}" class="chatwindowicon">','<div class="avatarwrap emblemwrap">${avatar}</div>',"</div>",'<div id="chatwindowcollapse_${id}" class="chatwindowcollapse icon20 icon20_collapse_white"></div>','<div id="chatwindowremove_${id}" class="chatwindowremove icon20 icon20_remove_white"></div>',"</div>",'<div id="chatwindowlogs_zone_${id}" class="chatwindowlogs_zone">','<div id="chatwindowlogs_endzone_${id}" class="chatwindowlogs_endzone"></div>',"</div>",'<div id="chatwindowmorelogs_${id}" class="chatwindowmorelogs roundedbox">','<a class="bga-link" id="chatwindowmorelogslink_${id}" href="#">${more_logs_label}</a>',"</div>","</div>","</div>",'<div id="chatwindowpreview_${id}" class="chatwindowpreview"></div>','<div id="chatwindowcollapsed_${id}" class="chatwindowcollapsed">','<div class="chatwindowcollapsedtitle">','<span id="chatwindownewmsgcount_${id}" class="chatwindownewmsgcount"></span>','<span id="is_writing_now_${id}" class="is_writing_now">','<i class="fa fa-pencil fa-blink"></i>&nbsp;<span',' id="is_writing_now_expl_${id}"',' class="is_writing_now_expl"></span>',"</span>",'<span id="chatwindowtitlenolink_${id}">${titlenolink}</span>',"</div>",'<div id="chatwindowremovc_${id}" class="chatwindowremovec icon20 icon20_remove"></div>','<div class="chatwindowavatar">','<div class="avatarwrap emblemwrap emblemwrap_l">${avatar}</div>','<div id="chatMindownewmsgcount_${id}" class="chatwindownewmsgcount chatMindownewmsgcount"></div>','<i class="bubblecaret fa fa-caret-up"></i>',"</div>","</div>","</div>"].join("");this.dockedChatInitialized=!1;this.groupToCometdSubs={};this.window_visibility="visible";this.premiumMsgAudioVideo=null;var e=new URLSearchParams(window.location.search);if(e.has("media_rating")&&e.has("room")){var t=e.get("media_rating"),i=e.get("room");"video"!=t&&"audio"!=t||g_sitecore.displayRatingContent(t,{room_id:i,media:t,rating:null,issue:null,text:null})}this.badWordList=["youporn","redtube","pornotube","pornhub","xtube","a-hole","dumb","fool","imbecile","nutcase","dipstick","lunatic","weirdo","dork","dope","dimwit","half-wit","oaf","bimbo","jerk","numskull","numbskull","goof","suck","moron","morons","idiot","idi0t","rape","rapist","hitler","4r5e","5h1t","5hit","a55","anal","anus","ar5e","arrse","arse","ass","ass-fucker","asses","assfucker","assfukka","asshole","assholes","asswhole","a_s_s","b!tch","b00bs","b17ch","b1tch","ballbag","ballsack","bastard","beastial","beastiality","bellend","bestial","bestiality","bi+ch","biatch","bitch","bitcher","bitchers","bitches","bitchin","bitching","blow job","blowjob","blowjobs","boiolas","bollock","bollok","boner","boob","boobs","booobs","boooobs","booooobs","booooooobs","breasts","buceta","bugger","bum","bunny fucker","butt","butthole","buttmuch","buttplug","c0ck","c0cksucker","carpet muncher","cawk","chink","cipa","cl1t","clit","clitoris","clits","cnut","cock","cock-sucker","cockface","cockhead","cockmunch","cockmuncher","cocks","cocksuck ","cocksucked ","cocksucker","cocksucking","cocksucks ","cocksuka","cocksukka","cokmuncher","coksucka","coon","cox","crap","cum","cummer","cumming","cums","cumshot","cunilingus","cunillingus","cunnilingus","cunt","cuntlick ","cuntlicker ","cuntlicking ","cunts","cyalis","cyberfuc","cyberfuck ","cyberfucked ","cyberfucker","cyberfuckers","cyberfucking ","d1ck","damn","dick","dickhead","dildo","dildos","dink","dinks","dirsa","dlck","dog-fucker","doggin","dogging","donkeyribber","doosh","duche","dyke","ejaculate","ejaculated","ejaculates ","ejaculating ","ejaculatings","ejaculation","ejakulate","f u c k","f u c k e r","f4nny","fag","fagging","faggitt","faggot","faggs","fagot","fagots","fags","fanny","fannyflaps","fannyfucker","fanyy","fatass","fcuk","fcuker","fcuking","feck","fecker","felching","fellate","fellatio","fingerfuck ","fingerfucked ","fingerfucker ","fingerfuckers","fingerfucking ","fingerfucks ","fistfuck","fistfucked ","fistfucker ","fistfuckers ","fistfucking ","fistfuckings ","fistfucks ","flange","fook","fooker","fucka","fucked","fucker","fuckers","fuckhead","fuckheads","fuckings","fuckingshitmotherfucker","fuckme ","fucks","fuckwhit","fuckwit","fudge packer","fudgepacker","fuk","fuker","fukker","fukkin","fuks","fukwhit","fukwit","fux","fux0r","f_u_c_k","gangbang","gangbanged ","gangbangs ","gaylord","gaysex","goatse","God","god-dam","god-damned","goddamn","goddamned","hardcoresex ","heshe","hoar","hoare","hoer","homo","hore","horniest","horny","hotsex","jack-off ","jackoff","jap","jerk-off ","jism","jiz ","jizm ","jizz","kawk","knob","knobead","knobed","knobend","knobhead","knobjocky","knobjokey","kock","kondum","kondums","kum","kummer","kumming","kums","kunilingus","l3i+ch","l3itch","labia","lmfao","lust","lusting","m0f0","m0fo","m45terbate","ma5terb8","ma5terbate","masochist","master-bate","masterb8","masterbat*","masterbat3","masterbate","masterbation","masterbations","masturbate","mo-fo","mof0","mofo","mothafuck","mothafucka","mothafuckas","mothafuckaz","mothafucked ","mothafucker","mothafuckers","mothafuckin","mothafucking ","mothafuckings","mothafucks","mother fucker","motherfuck","motherfucked","motherfucker","motherfuckers","motherfuckin","motherfucking","motherfuckings","motherfuckka","motherfucks","muff","mutha","muthafecker","muthafuckker","muther","mutherfucker","n1gga","n1gger","nazi","nigg3r","nigg4h","nigga","niggah","niggas","niggaz","nigger","niggers ","nob","nob jokey","nobhead","nobjocky","nobjokey","numbnuts","nutsack","orgasim ","orgasims ","orgasm","orgasms ","p0rn","pecker","penis","penisfucker","phonesex","phuck","phuk","phuked","phuking","phukked","phukking","phuks","phuq","pigfucker","pimpis","piss","pissed","pisser","pissers","pisses ","pissflaps","pissin ","pissing","pissoff ","poop","porn","porno","pornography","pornos","prick","pricks ","pron","pube","pusse","pussi","pussies","pussy","pussys ","rectum","retards","rimjaw","rimming","s hit","s.o.b.","sadist","schlong","screwing","scroat","scrote","scrotum","semen","sex","sh!+","sh!t","sh1t","shag","shagger","shaggin","shagging","shemale","shi+","shit","shitdick","shite","shited","shitey","shitfuck","shitfull","shithead","shiting","shitings","shits","shitted","shitter","shitters ","shitting","shittings","shitty ","skank","slut","sluts","smegma","smut","snatch","son-of-a-bitch","spac","spunk","s_h_i_t","t1tt1e5","t1tties","teets","teez","testical","testicle","tit","titfuck","tits","titt","tittie5","tittiefucker","titties","tittyfuck","tittywank","titwank","tosser","turd","tw4t","twat","twathead","twatty","twunt","twunter","v14gra","v1gra","vulva","w00se","wang","wank","wanker","wanky","whoar","whore","willies","willy","xrated","xxx","enculé","baiser","nique","niquer","salope","pute","fuck","f*ck","f**k","noob"];this.tutorialHighlightedQueue=[];this.browser_inactivity_time=0;this.bInactiveBrowser=!1;this.red_thumbs_given={};this.red_thumbs_taken={}},init_core:function(){this.premiumMsgAudioVideo=__("lang_mainsite","Premium feature: audio or video calls can be started by Premium players.")+'<br /><a href="/premium">'+__("lang_mainsite","To be able to start a live chat with fellow players, go Premium!")+"</a><br />"+__("lang_mainsite","(browser compatibility: %s)").replace("%s","Chrome, Firefox, Opera");e.removeClass("ebd-body","page_is_loading");$("head_infomsg")&&e.empty("head_infomsg");this.takeIntoAccountAndroidIosRequestDesktopWebsite(document);if("undefined"!=typeof mainsite&&mainsite.dockedChat&&(void 0===this.chatDetached||null===this.chatDetached.type)){this.notifqueue.onPlaceLogOnChannel=e.hitch(this,"onPlaceLogOnChannel");this.initChatDockedSystem()}if("undefined"!=typeof gameui&&gameui.dockedChat){this.notifqueue.onPlaceLogOnChannel=e.hitch(this,"onPlaceLogOnChannel");this.initChatDockedSystem()}this.isTouchDevice="ontouchstart"in window||navigator.msMaxTouchPoints>0;this.isTouchDevice?e.addClass("ebd-body","touch-device"):e.addClass("ebd-body","notouch-device");this.predefinedTextMessages={tbleave:"Sorry I will continue to play later.",goodmove:"Sorry I have an emergency: I'm back in few seconds...",gm:"Good move!",think:"I would like to think a little, thank you",stillthinkin:"Yeah, still there, just thinking.",stillthere:"Hey, are you still there?",gg:"Good Game!",glhf:"Good luck, have fun!",hf:"Have fun!",tftg:"Thanks for the game!"};this.predefinedTextMessages_untranslated={"Sorry I will continue to play later.":"tbleave","Sorry I have an emergency: I'm back in few seconds...":"goodmove","Good move!":"gm","Yeah, still there, just thinking.":"stillthinkin","Hey, are you still there?":"stillthere","I would like to think a little, thank you":"think","Good Game!":"gg","Good luck, have fun!":"glhf","Have fun!":"hf","Thanks for the game!":"tftg"};this.predefinedTextMessages_target_translation={tbleave:__("lang_mainsite","Sorry I will continue to play later."),goodmove:__("lang_mainsite","Sorry I have an emergency: I'm back in few seconds..."),gm:__("lang_mainsite","Good move!"),think:__("lang_mainsite","I would like to think a little, thank you"),stillthinkin:__("lang_mainsite","Yeah, still there, just thinking."),stillthere:__("lang_mainsite","Hey, are you still there?"),gg:__("lang_mainsite","Good Game!"),glhf:__("lang_mainsite","Good luck, have fun!"),test:__("lang_mainsite","We detect an insult in your chat input."),hf:__("lang_mainsite","Have fun!"),tftg:__("lang_mainsite","Thanks for the game!")};$("seemorelogs_btn")&&e.connect($("seemorelogs_btn"),"onclick",this,"onSeeMoreLogs");this.initMonitoringWindowVisibilityChange();var t=$("servicetime").innerHTML,n=new Date,o=60*n.getHours()+n.getMinutes();this.timezoneDelta=Math.round((o-t)/60);this.timezoneDelta<0&&(this.timezoneDelta+=24);this.register_subs(e.subscribe("ackmsg",this,"onAckMsg"));this.register_subs(e.subscribe("force_browser_reload",this,"onForceBrowserReload"));this.register_subs(e.subscribe("debugPing",this,"onDebugPing"));this.register_subs(e.subscribe("newRequestToken",this,"onNewRequestToken"));if(1==soundManager.bMuteSound&&null!==$("toggleSound_icon")){e.removeClass("toggleSound_icon","fa-volume-up");e.addClass("toggleSound_icon","fa-volume-off")}if($("toggleSound")){e.connect($("toggleSound"),"onclick",this,"onToggleSound");e.connect($("toggleSound"),"onmouseover",this,"onDisplaySoundControls");e.connect($("toggleSound"),"onmouseout",this,"onHideSoundControls")}if($("soundVolumeControl")){e.connect($("soundVolumeControl"),"onmouseup",this,"onSoundVolumeControl");e.connect($("soundVolumeControl"),"ontouchend",this,"onSoundVolumeControl")}if($("soundControls")){e.connect($("soundControls"),"onmouseover",this,"onStickSoundControls");e.connect($("soundControls"),"onmouseout",this,"onUnstickSoundControls")}{let e=!0;i.stores.userVolume.subscribe((t=>{localStorage.setItem("sound_muted",t.volumeMuted?"1":"0");localStorage.setItem("sound_volume",t.volume);this.onSetSoundVolume(!e);e=!1}))}setInterval(e.hitch(this,"inactivityTimerIncrement"),6e4);document.onmousemove=e.hitch(this,"resetInactivityTimer");document.onkeypress=e.hitch(this,"resetInactivityTimer");$("pilink")&&e.connect($("pilink"),"onclick",this,(function(t){e.stopEvent(t);this.ajaxcall("/player/player/pilink.html",{},this,(function(e){}))}))},unload:function(){var e=void 0!==this.current_player_id?this.current_player_id:this.player_id;this.recordMediaStats(e,"stop");this.page_is_unloading=!0},updateAjaxCallStatus:function(){i.stores.menuStates.setIsPageLoading(this.ajaxcall_running>0)},showMessage:function(t,i){if("only_to_log"!=i){var n="head_infomsg_"+this.next_headmsg_id,o="<div class='bga-link-inside head_"+i+"' id='"+n+"' style='display:none;'><div class='head_infomsg_close' id='close_"+n+"'><i class='fa fa-close' aria-hidden='true'></i></div><div class='head_infomsg_item'>"+t+"</div></div>";this.next_headmsg_id++;e.place(o,"head_infomsg");e.connect($("close_"+n),"onclick",this,(function(t){e.style(t.currentTarget.parentElement.id,"display","none")}));e.fx.chain([e.fx.wipeIn({node:n,duration:500}),e.fx.wipeOut({node:n,delay:5e3,duration:500})]).play()}"error"!=i&&"only_to_log"!=i||g_sitecore.notifqueue.addToLog(t)},changeActiveMenuItem:function(t){i.stores.menuStates.setActivePageName(t);menu_label_mappings={preferences:"welcome",playernotif:"welcome",welcomestudio:"welcome",start:"welcome",legal:"welcome",message:"welcome",gameinprogress:"welcome",table:"lobby",lobby:"gamelobby",meetinglobby:"gamelobby",availableplayers:"gamelobby",createtable:"gamelobby",newtable:"gamelobby",gamereview:"gamelobby",gamelobby:"gamelobby",gamelobbyauto:"gamelobby",tournament:"gamelobby",newtournament:"gamelobby",tournamentlist:"gamelobby",gamepanel:"gamelist",games:"gamelist",player:"community",playerstat:"community",group:"community",newgroup:"community",community:"community",report:"community",newreport:"community",moderated:"community",translation:"community",translationhq:"community",map:"community",grouplist:"community",contribute:"community",sponsorship:"community",moderator:"community",bug:"community",bugs:"community",faq:"community",gamepublishers:"community",team:"community",troubleshootmainsite:"community",sandbox:"community",penalty:"community",karmalimit:"community",club:"premium",premium:"premium",contact:"community",reviewer:"community",giftcodes:"premium",shop:"shop",shopsupport:"shopsupport",prestige:"competition",gameranking:"competition",award:"competition",gamestats:"competition",leaderboard:"competition",page:"doc",news:"headlines",event:"events",eventnew:"events",eventmodify:"events",controlpanel:"controlpanel",linkmoderation:"controlpanel",moderation:"controlpanel",studio:"controlpanel",studiogame:"controlpanel",administration:"controlpanel",banners:"controlpanel",projects:"projects",startwannaplay:"welcome",startsteps:"welcome",halloffame:"halloffame"};menu_label_mappings[t]&&(t=menu_label_mappings[t]);if(""!=this.active_menu_label){$("navbutton_"+this.active_menu_label)&&e.removeClass("navbutton_"+this.active_menu_label,"navigation-button-active");i.stores.menuStates.setActiveMenuItem(null)}this.active_menu_label=t;if(""!=t){$("navbutton_"+t)&&e.addClass("navbutton_"+t,"navigation-button-active");i.stores.menuStates.setActiveMenuItem(t)}},subscribeCometdChannel:function(e,t,i){if("socketio"==this.cometd_service){if(void 0===this.cometd_subscriptions[e]){this.socket.emit("join",e);this.cometd_subscriptions[e]=1}else this.cometd_subscriptions[e]++;return e}},subscribeCometdChannels:function(e,t,i){var n={};if("socketio"==this.cometd_service){var o=[];for(var a in e){var s=e[a];if(void 0===this.cometd_subscriptions[s]){o.push(s);this.cometd_subscriptions[s]=1}else this.cometd_subscriptions[s]++}o.length>0&&this.socket.emit("join",o);n=e}return n},unsubscribeCometdChannel:function(e){if(void 0!==this.cometd_subscriptions[e]){this.cometd_subscriptions[e]--;if(0==this.cometd_subscriptions[e]){this.socket.emit("leave",e);delete this.cometd_subscriptions[e]}}},reconnectAllSubscriptions:function(){var e=[];for(var t in this.cometd_subscriptions)e.push(t);e.length>0&&this.socket.emit("join",e)},onSocketIoConnectionStatusChanged:function(t,i){if(this.page_is_unloading)e.style("connect_status","display","none");else if("connect"==t){e.style("connect_status","display","none");this.cometd_is_connected=!0}else if("connect_error"==t){e.style("connect_status","display","block");this.cometd_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}else if("connect_timeout"==t){e.style("connect_status","display","block");this.cometd_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");$("connect_status_text").innerHTML+=" (timeout)";g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}else if("reconnect"==t){e.style("connect_status","display","none");this.cometd_is_connected=!0;g_sitecore.notifqueue.addToLog(__("lang_mainsite","You are connected again."));this.reconnectAllSubscriptions()}else if("reconnect_error"==t){e.style("connect_status","display","block");this.cometd_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}else if("reconnect_failed"==t){e.style("connect_status","display","block");this.cometd_is_connected=!1;$("connect_status_text").innerHTML=__("lang_mainsite","Disconnected from game server !");$("connect_status_text").innerHTML+=" (reconnect failed)";g_sitecore.notifqueue.addToLog($("connect_status_text").innerHTML)}},onFirstConnectedToComet:function(){},leaveTable:function(t,i){this.ajaxcall("/table/table/quitgame.html",{table:t,neutralized:!0,s:"table_quitgame"},this,(function(e){i()}),(function(n,o,a){if(n&&(803==a||804==a)){var s=new ebg.popindialog;s.create("quitConfirmContent");s.setTitle(__("lang_mainsite","Quit game in progress"));s.tableModule=this;var r='<div id="quitConfirmContent">';if(803==a){r+=__("lang_mainsite","You are about to quit a game in progress.")+"<br/>";r+=__("lang_mainsite","This will cost you some <img src='theme/img/common/rank.png' class='imgtext'/> for this game, and 1 <div class='icon20 icon20_penaltyleave'></div> for your reputation.<br/><br/>");r+='<b style="color:red">'+__("lang_mainsite","A bad reputation may prevent you to chat or to join some games!")+"</b><br/><br/>";r+=__("lang_mainsite","Note 1: If you are forced to quit the game because some opponent is not playing, you should fire him from the game instead of quit the game.")+"<br/>";r+=__("lang_mainsite","Note 2: You also have the possibility to quit the game collectively without loosing any rank point or reputation.")+" "+__("lang_mainsite","You can do it from the top-right menu on game screen.")+"<br/><br/>"}else{r+=__("lang_mainsite","You are about to quit a Training game in progress.")+"<br/>";r+=__("lang_mainsite","Because this is a Training game, this will have no consequence (no penalty whatsoever).")}r+="<p><a class='bgabutton bgabutton_blue' id='quitgame_cancel' href='#'>"+__("lang_mainsite","Cancel")+"</a>&nbsp;&nbsp;&nbsp;<a class='bgabutton bgabutton_gray' id='quitgame_confirm' href='#'>"+__("lang_mainsite","Leave game")+"</a></p>";r+="</div>";s.setContent(r);s.show();e.connect($("quitgame_cancel"),"onclick",e.hitch(s,(function(e){e.preventDefault();this.destroy()})));e.connect($("quitgame_confirm"),"onclick",e.hitch(s,(function(e){e.preventDefault();this.destroy();this.tableModule.ajaxcall("/table/table/quitgame.html",{table:t,s:"table_quitdlg"},this,(function(e){i()}))})))}}))},onSeeMoreLogs:function(t){t.preventDefault();var i=toint(e.style($("logs"),"maxHeight"))+600;e.style($("logs"),"maxHeight",i+"px");e.style($("seemorelogs"),"top",i-24+"px");this.onIncreaseContentHeight(600)},onIncreaseContentHeight:function(){},onScriptError:function(t,i,n){if(!this.page_is_unloading){"function"==typeof this.setLoader&&this.setLoader(100,100);if(!1!==this.reportJsError&&-1==i.search("telwa/cometd?")&&-1==i.search("cloudfront.net")){var o=t+"\nScript: "+i+"\nUrl: "+window.location+"\n";$("bga_release_id")&&(o+="BGA version "+$("bga_release_id").innerHTML+"\n");o+=this.getScriptErrorModuleInfos()+"\n";o+=navigator.userAgent+"\n";if("show"==this.reportJsError){var a=this.nl2br(o,!1);this.showMessage("Javascript error:<br/>"+a,"error")}if(!this.reportErrorTimeout){this.reportErrorTimeout=!0;setTimeout(e.hitch(this,(function(){this.reportErrorTimeout=!1})),6e4);this.ajaxcall("/web/scripterror",{log:o},this,(function(e){}))}}}},initChatDockedSystem:function(){var t={id:"stacked",type:"stacked",title:'<div class="icon20 icon20_speak"></div>',titlenolink:'<span style="font-size:120%">+</span>',avatar:'<i class="fa fa-ellipsis-h" aria-hidden="true"></i>',more_logs_label:__("lang_mainsite","Scroll down to see new messages"),stop_notif_label:__("lang_mainsite","Notify chat messages"),start_chat:__("lang_mainsite","Accept chat"),block_chat:__("lang_mainsite","Block player")};e.place(this.format_string(this.jstpl_chatwindow,t),"chatbarstackedmenu","first");e.place('<div id="stackedmenu"></div>',"chatwindowcollapsed_stacked");e.connect($("chatwindowcollapsed_stacked"),"onclick",this,"onToggleStackMenu");this.adaptChatbarDock();e.connect(window,"onresize",this,e.hitch(this,(function(e){this.stackOrUnstackIfNeeded()})));this.dockedChatInitialized=!0},extractChannelInfosFromNotif:function(t){var i=t.channelorig,n=e.hasClass("ebd-body","mobile_version");if("/table/t"==i.substr(0,8)){var o=i.substr(8),a="";if(void 0!==t.gamenameorig){var s=this.getGameNameDisplayed(t.gamenameorig)+" #"+o;a=t.gamenameorig}else if(void 0!==t.args.game_name_ori){s=this.getGameNameDisplayed(t.args.game_name_ori)+" #"+o;a=t.args.game_name_ori}else if(void 0!==t.args.game_name){s=this.getGameNameDisplayed(t.args.game_name)+" #"+o;a=t.args.game_name}else s="Table #"+o;return"chat"==t.type||"groupchat"==t.type||"chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"startWriting"==t.type||"stopWriting"==t.type||"newRTCMode"==t.type||"undefined"==typeof gameui?{type:"table",id:o,game_name:a,label:s,url:"/table?table="+o,channel:i,window_id:"table_"+o,subscription:!0,start:"collapsed"}:{type:"tablelog",id:o,game_name:a,label:__("lang_mainsite","Game log"),url:"#",channel:i,window_id:"tablelog_"+o,subscription:!0,notifymethod:"title",start:"collapsed"}}if("/group/g"==i.substr(0,8)){var r=i.substr(8);return{type:"group",id:r,group_avatar:t.args.group_avatar,group_type:t.args.group_type,label:void 0===t.args.group_name?"":t.args.group_name,url:void 0===t.args.seemore?"":"/"+t.args.seemore,channel:"/group/g"+r,window_id:"group_"+r,start:"collapsed"}}if("/chat/general"==i.substr(0,13))return{type:"general",id:0,label:__("lang_mainsite","General messages"),url:null,channel:"/chat/general",window_id:"general",start:"collapsed"};if("/player/p"==i.substr(0,9)){if("privatechat"==t.type||"startWriting"==t.type||"stopWriting"==t.type||"newRTCMode"==t.type){if("undefined"!=typeof current_player_id)if(current_player_id==t.args.player_id)var l=t.args.target_id,d=t.args.target_name,c=t.args.target_avatar;else l=t.args.player_id,d=t.args.player_name,c=t.args.avatar;else if(this.player_id)if(this.player_id==t.args.player_id)l=t.args.target_id,d=t.args.target_name,c=t.args.target_avatar;else l=t.args.player_id,d=t.args.player_name,c=t.args.avatar;else l=t.args.player_id,d=t.args.player_name,c=t.args.avatar;return{type:"privatechat",id:l,label:d,avatar:c,url:"/player?id="+l,channel:"/player/p"+l,window_id:"privatechat_"+l,subscription:!1,start:"collapsed"}}if(void 0!==t.gamenameorig&&"undefined"!=typeof gameui){return{type:"tablelog",id:o=gameui.table_id,label:__("lang_mainsite","Game log"),url:"#",channel:"/table/t"+o,window_id:"tablelog_"+o,subscription:!0,notifymethod:"title",start:"collapsed"}}}else if("/general/emergency"==i.substr(0,18))return{type:"emergency",id:0,label:__("lang_mainsite","Important notice"),url:null,channel:"/general/emergency",window_id:"emergency",start:n?"collapsed":"expanded"};return"startWriting"==t.type||"stopWriting"==t.type?null:{type:"general",id:0,label:__("lang_mainsite","General messages"),url:null,channel:"/chat/general",window_id:"general",start:"collapsed"}},getChatInputArgs:function(e){if("table"==e.type){var t="";void 0!==e.game_name&&(t='<img src="'+getMediaUrl(e.game_name,"icon")+'" alt="" class="game_icon emblem" />');var i="";"undefined"!=typeof gameui&&void 0!==gameui.debug_from_chat&&gameui.debug_from_chat&&void 0!==e.game_name&&(i="/"+e.game_name+"/"+e.game_name+"/say.html");"undefined"!=typeof gameui&&void 0!==gameui.chat_on_gs_side&&gameui.chat_on_gs_side&&void 0!==e.game_name&&(i="/"+e.game_name+"/"+e.game_name+"/say.html");return{type:"table",id:e.id,action:"/table/table/say.html",doubleaction:i,label:__("lang_mainsite","Discuss at this table"),param:{table:e.id},channel:"/table/t"+e.id,avatar:t}}if("tablelog"==e.type)return null;if("general"==e.type)return{type:"global",id:0,action:"/chat/chat/say.html",label:__("lang_mainsite","Discuss with everyone"),param:{},channel:null,avatar:'<i class="fa fa-comments" aria-hidden="true"></i>'};if("privatechat"==e.type)return{type:"player",id:e.id,action:"/table/table/say_private.html",label:__("lang_mainsite","Discuss with")+" "+e.label,param:{to:e.id},channel:"/player/p"+e.id,avatar:'<img src="'+getPlayerAvatar(e.id,e.avatar,50)+'" alt="" class="emblem" />'};if("emergency"==e.type)return null;if("group"==e.type){Math.floor(e.id/1e3);var n=e.avatar_src?e.avatar_src:getGroupAvatar(e.id,e.group_avatar,e.group_type,50);return{type:"group",id:e.id,action:"/group/group/say.html",label:__("lang_mainsite","Discuss with the group"),param:{to:e.id},channel:"/group/g"+e.id,avatar:'<img src="'+n+'" alt="" class="emblem" />'}}return null},onPlaceLogOnChannel:function(t){if(!this.dockedChatInitialized)return!1;var i=this.extractChannelInfosFromNotif(t);if(null===i)return!0;var n=i.window_id,o=e.hasClass("ebd-body","mobile_version"),a=!0;if(null!==this.notifqueue.game)if("playtable"==i.type||"table"==i.type||"tablelog"==i.type);else if("privatechat"!=t.type&&"newRTCMode"!=t.type&&"startWriting"!=t.type&&"emergency"!=i.type)return!1;var s=null!==this.notifqueue.game,r="chat"==t.type||"groupchat"==t.type||"chatmessage"==t.type||"tablechat"==t.type||"privatechat"==t.type||"stopWriting"==t.type||"startWriting"==t.type,l=!1,d=!1;if(r&&void 0!==t.args.text&&null===t.args.text){t.log="~ "+__("lang_mainsite","${player_name} left the chat")+" ~";l=!0;d=!0}var c=!0;if("history_history"==t.type||void 0!==t.loadprevious){c=!1;if(void 0!==t.loadprevious&&t.loadprevious&&r&&void 0!==t.args.is_new&&1==t.args.is_new){c=!0;t.args.mread=null}}void 0!==t.donotpreview&&(c=!1);"chat"==t.type&&"/chat/general"==t.channelorig&&"undefined"!=typeof mainsite&&0==mainsite.notifyOnGeneralChat&&(c=!1);s&&(r||(a=!1));if(r&&"chatmessage"==t.type&&void 0!==t.args.message&&void 0!==t.gamenameorig&&void 0===t.args.message.log&&"werewolves"==t.gamenameorig&&-1!=t.args.message.indexOf("$$$"))return!0;if(void 0!==this.chatbarWindows[n]){if("startWriting"==t.type){void 0!==this.chatbarWindows[n].is_writing_now[t.args.player_name]&&clearTimeout(this.chatbarWindows[n].is_writing_now[t.args.player_name]);this.chatbarWindows[n].is_writing_now[t.args.player_name]=setTimeout(e.hitch(this,(function(){if(void 0!==this.chatbarWindows[n]){delete this.chatbarWindows[n].is_writing_now[t.args.player_name];this.onUpdateIsWritingStatus(n)}})),8e3);this.onUpdateIsWritingStatus(n);return!0}if(r&&void 0!==t.args.player_id){this.chatbarWindows[n].is_writing_now[t.args.player_name];clearTimeout(this.chatbarWindows[n].is_writing_now[t.args.player_name]);delete this.chatbarWindows[n].is_writing_now[t.args.player_name];this.onUpdateIsWritingStatus(n)}}else if("startWriting"==t.type||"stopWriting"==t.type)return!0;var h=this.next_log_id;this.next_log_id++;var u=!1;void 0!==i.subscription&&i.subscription&&i.subscription&&(u=!0);if(void 0===this.chatbarWindows[i.window_id]&&l)return!0;var p=this.createChatBarWindow(i,u);if("newRTCMode"==t.type&&void 0!==t.args.table_id)if(t.args.rtc_mode>0&&null!==this.room&&this.room.indexOf("P")>=0){var m='<div  class="rtc_dialog"><br />';m+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?__("lang_mainsite","A Premium user has set up a video chat session for this table!"):__("lang_mainsite","A Premium user has set up an audio chat session for this table!"))+"</i></div><br /><br />";m+='<div style="text-align: center; font-weight: bold;">'+__("lang_mainsite","But you are already taking part in another live chat session!")+"<br /><br /> "+__("lang_mainsite","Do you want to join the call?")+" ("+__("lang_mainsite","you will be disconnected from your current live chat session to join the new one")+")</div><br /><br />";m+="</div>";this.confirmationDialog(m,e.hitch(this,(function(){var i=this.room.substr(1).split("_"),n=i[0]==N?i[1]:i[0];this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:n},this,e.hitch(this,(function(e){this.already_accepted_room="T"+t.args.table_id;this.setNewRTCMode(t.args.table_id,null,t.args.rtc_mode,t.args.room_creator)}))):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:n},this,e.hitch(this,(function(e){this.already_accepted_room="T"+t.args.table_id;this.setNewRTCMode(t.args.table_id,null,t.args.rtc_mode,t.args.room_creator)})))})),e.hitch(this,(function(){})))}else(null===this.room||this.room.indexOf("T")>=0)&&this.setNewRTCMode(t.args.table_id,null,t.args.rtc_mode,t.args.room_creator);if("newRTCMode"==t.type&&void 0!==t.args.player_id)if(t.args.rtc_mode>0&&null!==this.room&&this.room.indexOf("T")>=0){m='<div  class="rtc_dialog"><br />';m+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+(!1!==this.mediaConstraints.video?__("lang_mainsite","A Premium user has set up a video chat session with you!"):__("lang_mainsite","A Premium user has set up an audio chat session with you!"))+"</i></div><br /><br />";m+='<div style="text-align: center; font-weight: bold;">'+__("lang_mainsite","But you are already taking part in another live chat session!")+"<br /><br /> "+__("lang_mainsite","Do you want to join the call?")+" ("+__("lang_mainsite","you will be disconnected from your current live chat session to join the new one")+")</div><br /><br />";m+="</div>";this.confirmationDialog(m,e.hitch(this,(function(){this.room.substr(1);this.doLeaveRoom(e.hitch(this,(function(){this.already_accepted_room="P"+Math.min(t.args.player_id,t.args.target_id)+"_"+Math.max(t.args.player_id,t.args.target_id);this.expandChatWindow(i.window_id);this.setNewRTCMode(null,t.args.target_id,t.args.rtc_mode,t.args.room_creator)})))})),e.hitch(this,(function(){this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:t.args.target_id},this,(function(e){this.mediaChatRating=!1})):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:t.args.target_id},this,(function(e){this.mediaChatRating=!1}))})))}else if(null===this.room||this.room.indexOf("P")>=0){this.expandChatWindow(i.window_id);this.setNewRTCMode(null,t.args.target_id,t.args.rtc_mode,t.args.room_creator)}if(p&&"groupchat"==t.type&&void 0!==t.args.gamesession&&t.args.gamesessionadmin!=this.getCurrentPlayerId()){var g=e.clone(t);g.log='<p style="text-align:center"><a id="quit_playingsession_'+t.args.group_id+'" href="#" class="bgabutton bgabutton_gray">'+__("lang_mainsite","Quit this playing session")+"</a></p>";g.donotpreview=!0;this.onPlaceLogOnChannel(g);e.connect($("quit_playingsession_"+t.args.group_id),"onclick",this,e.hitch(this,(function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(20);this.ajaxcall("/community/community/quitGroup.html",{id:i},this,(function(){}),(function(e){}));this.closeChatWindow("group_"+i)})))}var _=t.args.logaction;if(r&&void 0!==t.args.text&&void 0!==this.predefinedTextMessages_untranslated[t.args.text]){t.args.text=__("lang_mainsite",t.args.text);d=!0}if(r){var f=!1;"/chat/general"==t.channelorig&&(f=!0);r&&void 0!==t.args.text&&null!=t.args.text?t.args.text=this.makeClickableLinks(t.args.text,f):r&&void 0!==t.args.message&&void 0===t.args.message.log&&(t.args.message=this.makeClickableLinks(t.args.message,f))}m=this.notifqueue.formatLog(t.log,t.args);var v="",b="";if(null==this.notifqueue.game){if(_){var y=this.notifqueue.formatLog(_.log,_.args);v='<div class="logaction"><a href="#" id="logaction_'+h+'">['+y+"]</a></div>";b='<div class="logaction"><a href="#" id="logactionp_'+h+'">['+y+"]</a></div>"}}else r||(m=this.notifqueue.game.applyGenderRegexps(m));r&&void 0!==t.args.text&&this.isBadWorkInChat(t.args.text)&&(v+='<div  class="logaction">'+__("lang_mainsite","Insult? Aggressive attitude? Please do not respond or you will be moderated too.")+" "+__("lang_mainsite","Block this player (thumb down) and report him/her to moderators.")+"</div>");var w,C="",k=this.chatbarWindows[n].lastMsgTime,x=t.time,T=new Date(1e3*x);w=T.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});var A=new Date(1e3*k),j=x-k;if(Math.floor(k/60)!=Math.floor(x/60)){if(A.toLocaleDateString()!=T.toLocaleDateString()){C+='<div class="timestamp">'+T.toLocaleDateString()+"</div>"}this.chatbarWindows[n].lastMsgTime=x}var S="",M=!1,E="";if(r){S+=" chatlog";var N=void 0!==this.current_player_id?this.current_player_id:this.player_id;if(void 0!==t.args.player_id&&t.args.player_id==N){S+=" ownchatlog";M=!0}if(void 0!==this.chatbarWindows[n].lastMsgAuthor&&this.chatbarWindows[n].lastMsgAuthor==t.args.player_id&&j<60){!0;S+=" sameauthor"}this.chatbarWindows[n].lastMsgAuthor=t.args.player_id;if(void 0!==t.args.mread&&!M)if(t.args.mread);else{S+=" newmessage";void 0!==t.args.id&&(E=' id="newmessage_'+n.substr(0,1)+"_"+t.args.id+'"')}l&&(S+=" leavechat")}C+='<div class="roundedbox log bga-link-inside'+S+'" id="dockedlog_'+h+'"><div class="roundedboxinner"'+E+">";r&&(m=this.addSmileyToText(m).replace(/(?:\r\n|\r|\n)/g,"<br>"));var D=m;if(""!=w){var I="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",L="";if("privatechat"==t.type&&void 0!==t.args.mread&&M)if(t.args.mread){L='<i class="fa fa-check message_read" aria-hidden="true"></i>';I+="&nbsp;&nbsp;"}else{L='<i class="fa fa-check message_unread" id="privmsg_read_'+t.args.id+'" aria-hidden="true"></i>';I+="&nbsp;&nbsp;"}r||(I+="&nbsp;&nbsp;");m+=I+'<div class="msgtime">'+w+" "+L+"</div>"}C+=m+v;!r||M||d||(C+='<div class="translate_icon " id="logtr_'+n+"_"+h+'" title="'+__("lang_mainsite","Translate with Google")+'"></div>');C+="</div></div>";var P=e.style("chatwindowlogs_zone_"+n,"height"),R=$("chatwindowlogs_zone_"+n).scrollTop+P>=$("chatwindowlogs_zone_"+n).scrollHeight-10;void 0!==t.loadprevious&&$("load_previous_message_wrap_"+n)?e.place(C,"load_previous_message_wrap_"+n,"before"):e.place(C,"chatwindowlogs_endzone_"+n,"before");this.addTooltipToClass("message_read",__("lang_mainsite","This message has been read"),"");this.addTooltipToClass("message_unread",__("lang_mainsite","This message has not been read yet"),"");null==this.notifqueue.game?_&&$("logaction_"+h)&&e.connect($("logaction_"+h),"onclick",this,(function(t){e.stopEvent(t);mainsite.ajaxcall(_.action,_.action_arg,this,(function(){}))})):r&&void 0!==t.args.player_id&&$("ban_spectator_"+t.args.player_id)&&e.style("ban_spectator_"+t.args.player_id,"display","inline");void 0===t.loadprevious&&(R?$("chatwindowlogs_zone_"+n).scrollTop=$("chatwindowlogs_zone_"+n).scrollHeight:e.style("chatwindowmorelogs_"+n,"display","block"));r&&$("logtr_"+n+"_"+h)&&e.connect($("logtr_"+n+"_"+h),"onclick",this.notifqueue,"onTranslateLog");var O="dockedlog_"+h;if(void 0===t.loadprevious){e.style(O,"display","none");e.fx.chain([e.fx.wipeIn({node:O,onAnimate:function(e){R&&($("chatwindowlogs_zone_"+n).scrollTop=$("chatwindowlogs_zone_"+n).scrollHeight)},onEnd:function(e){R&&($("chatwindowlogs_zone_"+n).scrollTop=$("chatwindowlogs_zone_"+n).scrollHeight)}}),e.animateProperty({node:O,delay:5e3,properties:{color:{end:"#000000"},onEnd:function(t){e.style(t,"display","block")}}})]).play()}else $(O)&&e.style(O,"color","#000000");if("title"==this.chatbarWindows[n].notifymethod){var B=D.split("\x3c!--"),H="",F=!0;for(var z in B){var q=B[z];if("PNS--\x3e"==q.substr(0,6))H+=F?q:"\x3c!--"+q;else{F||(q="\x3c!--"+q);H+=dojox.dtl.filter.htmlstrings.striptags(q)}F&&(F=!1)}$("chatwindowtitlenolink_"+n).innerHTML=H}var W=this.chatbarWindows[n].status;if(c&&("collapsed"==W||"stacked"==W)){if("collapsed"==W){if("general"==n);else if("normal"==this.chatbarWindows[n].notifymethod||o&&"tablechat"==t.type){e.addClass("chatwindow_"+n,"newmessage");var U=$("chatwindownewmsgcount_"+n).innerHTML;if(""==U){$("chatwindownewmsgcount_"+n).innerHTML=1;$("chatMindownewmsgcount_"+n).innerHTML=1}else if(toint(U)<=8){$("chatwindownewmsgcount_"+n).innerHTML=toint(U)+1;$("chatMindownewmsgcount_"+n).innerHTML=toint(U)+1}else{$("chatwindownewmsgcount_"+n).innerHTML="9+";$("chatMindownewmsgcount_"+n).innerHTML="9+"}}if(!o){e.place('<div><div id="logprev_'+h+'" class="chatwindowpreviewmsg bga-link-inside">'+D+b+"</div></div>","chatwindowpreview_"+n);var V=e.query("#chatwindowpreview_"+n+" .chatwindowpreviewmsg");if(V.length>5){var G=V.length;for(var z in V){if(G<=5)break;e.destroy(V[z]);G--}}}}else"stacked"==W&&(o||e.place('<div id="logprev_'+h+'" class="chatwindowpreviewmsg bga-link-inside">'+m+b+"</div>","chatwindowpreview_stacked"));if(!o){O="logprev_"+h;e.style(O,"display","none");e.fx.wipeIn({node:O}).play();this.fadeOutAndDestroy(O,500,5e3)}null==this.notifqueue.game&&_&&$("logactionp_"+h)&&e.connect($("logactionp_"+h),"onclick",this,(function(t){e.stopEvent(t);mainsite.ajaxcall(_.action,_.action_arg,this,(function(){}))}))}["privatechat","tablechat","groupchat"].includes(t.type)&&(void 0===this.chatbarWindows[n].first_msg_timestamp?this.chatbarWindows[n].first_msg_timestamp=toint(t.time):this.chatbarWindows[n].first_msg_timestamp=Math.min(t.time,this.chatbarWindows[n].first_msg_timestamp));if(l&&"leavelast"==t.args.type){$("chatbarinput_"+n+"_input").disabled=!0;$("chatbarinput_"+n+"_input").placeholder=__("lang_mainsite","There is no one left in this chat")}return a},onUpdateIsWritingStatus:function(t){var i=0,n="";for(var o in this.chatbarWindows[t].is_writing_now)if(o!=this.current_player_name){""==n?n=o:n+=", "+o;i++}if(0==i){e.style("chatwindowtitlenolink_"+t,"display","inline");e.style("is_writing_now_"+t,"display","none");e.style("chatwindowlogstitle_content_"+t,"display","inline");e.style("is_writing_now_title_"+t,"display","none")}else{$("is_writing_now_expl_"+t).innerHTML=e.string.substitute(__("lang_mainsite","${player} is writing something ..."),{player:n});$("is_writing_now_expl_title_"+t).innerHTML=e.string.substitute(__("lang_mainsite","${player} is writing something ..."),{player:n});e.style("chatwindowtitlenolink_"+t,"display","none");e.style("is_writing_now_"+t,"display","inline");e.style("chatwindowlogstitle_content_"+t,"display","none");e.style("is_writing_now_title_"+t,"display","inline")}},createChatBarWindow:function(t,i){if(!this.dockedChatInitialized)return!1;var n=e.hasClass("ebd-body","mobile_version"),o=t.window_id,a=t.label;if(void 0!==this.chatbarWindows[o]){if("collapsed"==this.chatbarWindows[o].status)return!1;if("expanded"==this.chatbarWindows[o].status)return!1;if("stacked"==this.chatbarWindows[o].status)return!1}this.stackChatWindowsIfNeeded(t.start);null!==t.url&&(a='<a href="'+t.url+'" class="chatwindowtitlelink no-underline" id="chatwindowtitlelink_'+o+'"">'+a+"</a>");var s="normal";void 0!==t.notifymethod&&(s=t.notifymethod);var r=!1;void 0!==t.autoShowOnKeyPress&&(r=t.autoShowOnKeyPress);this.chatbarWindows[o]={status:t.start,title:a,input:new ebg.chatinput,subscription:null,notifymethod:s,autoShowOnKeyPress:r,lastMsgTime:0,lastMsgAuthor:0,is_writing_now:{}};this.chatbarWindows[o].input.callbackBeforeChat=e.hitch(this,"onCallbackBeforeChat");this.chatbarWindows[o].input.callbackAfterChat=e.hitch(this,"onCallbackAfterChat");this.chatbarWindows[o].input.callbackAfterChatError=e.hitch(this,"callbackAfterChatError");this.adaptChatbarDock();var l=this.getChatInputArgs(t),d=o.split("_")[0];if(null==l||void 0===l.avatar||""==l.avatar){var c='<i class="fa fa-comment" aria-hidden="true"></i>';if(null===l&&"tablelog"==t.type)c='<i class="fa fa-history" aria-hidden="true"></i>'}else c=l.avatar;if("undefined"!=typeof gameui&&"table"==t.type&&t.id==gameui.table_id)c='<i class="fa fa-comment" aria-hidden="true"></i>';if("emergency"==t.type)c='<img src="'+getStaticAssetUrl("img/logo/logo.png")+'" alt="" class="bga_logo emblem" />';var h={id:o,title:a,type:d,titlenolink:t.label,more_logs_label:__("lang_mainsite","Scroll down to see new messages"),stop_notif_label:__("lang_mainsite","Notify chat messages"),avatar:c,start_chat:__("lang_mainsite","Accept chat"),block_chat:__("lang_mainsite","Block player")};e.place(this.format_string(this.jstpl_chatwindow,h),"chatbardock","first");e.addClass("chatwindow_"+o,t.start);if("expanded"==t.start){e.style("chatwindowexpanded_"+o,"display","block");n||e.style("chatwindowcollapsed_"+o,"display","none");e.style("chatwindowpreview_"+o,"display","none");n&&this.makeSureChatBarIsOnTop(o)}if($("chatbarinput_stopnotif_general")){this.addTooltip("chatbarinput_stopnotif_general","",__("lang_mainsite","Uncheck this box if you don't want to be notified when there is a new message in the global chat."));e.connect($("chatbarinput_stopnotif_box_general"),"onclick",this,"onChangeStopNotifGeneralBox");e.connect($("chatbarinput_stopnotif_label_general"),"onclick",this,"onChangeStopNotifGeneralLabel");if("undefined"!=typeof mainsite&&(0==mainsite.notifyOnGeneralChat||mainsite.bUnderage)){bDisplayPreview=!1;$("chatbarinput_stopnotif_box_general").checked=""}}e.connect($("startchat_accept_"+o),"onclick",this,"onStartChatAccept");e.connect($("startchat_block_"+o),"onclick",this,"onStartChatBlock");if(null!==l){this.chatbarWindows[o].input.create(this,"chatbarinput_"+o,l.action,l.label);this.chatbarWindows[o].input.writingNowChannel=l.channel;this.chatbarWindows[o].input.baseparams=l.param;void 0!==l.doubleaction&&""!=l.doubleaction&&(this.chatbarWindows[o].input.post_url_bis=l.doubleaction);e.connect($("chatbarinput_predefined_"+o),"onclick",this,"onShowPredefined")}else e.addClass("chatwindowlogs_zone_"+o,"chatwindowlogs_zone_big");if(["privatechat","table","group"].includes(d)){var u='<div id="load_previous_message_wrap_'+o+'" class="load_previous_message">                                <a class="bga-link" href="#" id="load_previous_message_'+o+'">'+__("lang_mainsite","Load previous messages")+"</a>                            </div>";e.place(u,"chatwindowlogs_endzone_"+o,"before");e.connect($("load_previous_message_"+o),"onclick",this,"onLoadPreviousMessages")}e.connect($("chatwindowremove_"+o),"onclick",this,"onCloseChatWindow");e.connect($("chatwindowcollapse_"+o),"onclick",this,"onCollapseChatWindow");e.connect($("chatwindowlogstitlebar_"+o),"onclick",this,"onCollapseChatWindow");e.connect($("chatwindowcollapsed_"+o),"onclick",this,"onExpandChatWindow");e.connect($("chatwindowremovc_"+o),"onclick",this,"onCloseChatWindow");e.connect($("chatwindowmorelogslink_"+o),"onclick",this,"onScrollDown");e.connect($("chatbar_inner"),"onclick",this,"onCollapseAllChatWindow");e.connect(this.chatbarWindows[o].input,"onChatInputKeyUp",this,"onDockedChatInputKey");e.connect($("chatbarinput_"+o+"_input"),"onclick",this,"onDockedChatFocus");i&&(this.chatbarWindows[o].subscription=this.subscribeCometdChannel(t.channel,this.notifqueue,"onNotification"));if("table"==d||"privatechat"==d){if("undefined"!=typeof mainsite&&mainsite.pma||"undefined"!=typeof gameui&&gameui.pma){e.query("#chatbarinput_startaudiochat_"+o).connect("onclick",this,"onStartStopAudioChat");this.addTooltip("chatbarinput_startaudiochat_"+o,"",__("lang_mainsite","Audio call"));e.query("#chatbarinput_startvideochat_"+o).connect("onclick",this,"onStartStopVideoChat");this.addTooltip("chatbarinput_startvideochat_"+o,"",__("lang_mainsite","Video call"))}else{this.addTooltip("chatbarinput_startaudiochat_"+o,this.premiumMsgAudioVideo,"");e.query("#chatbarinput_startaudiochat_"+o).connect("onclick",this,(function(t){e.stopEvent(t);this.showMessage(_(this.premiumMsgAudioVideo),"info")}));this.addTooltip("chatbarinput_startvideochat_"+o,this.premiumMsgAudioVideo,"");e.query("#chatbarinput_startvideochat_"+o).connect("onclick",this,(function(t){e.stopEvent(t);this.showMessage(_(this.premiumMsgAudioVideo),"info")}))}this.mediaConstraints.video?e.query("#chatbarinput_startvideochat_"+o).removeClass("audiovideo_inactive").addClass("audiovideo_active"):this.mediaConstraints.audio&&e.query("#chatbarinput_startaudiochat_"+o).removeClass("audiovideo_inactive").addClass("audiovideo_active")}return!0},onStartChatAccept:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(17);e.removeClass("chatwindow_"+i,"startchat_toconfirm")},onStartChatBlock:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(16),n=t.currentTarget.id.substr(28),o=new ebg.thumb;o.create(this,t.currentTarget.id,n,0);o.bForceThumbDown=!0;o.onGiveThumbDown(t);this.closeChatWindow(i)},onChangeStopNotifGeneralBox:function(e){var t=$("chatbarinput_stopnotif_box_general").checked?1:0;this.ajaxcall("/player/profile/setNotificationPreference.html",{type:"notifyGeneralChat",value:t},this,(function(){this.showMessage(__("lang_mainsite","Preference updated!"),"info")}));"undefined"!=typeof mainsite&&(mainsite.notifyOnGeneralChat=t)},onChangeStopNotifGeneralLabel:function(t){e.stopEvent(t);$("chatbarinput_stopnotif_box_general").checked?$("chatbarinput_stopnotif_box_general").checked="":$("chatbarinput_stopnotif_box_general").checked="checked";this.onChangeStopNotifGeneralBox(t)},checkAVFrequencyLimitation:function(){var e=sessionStorage.getItem("timeToWaitNextAV"),t=sessionStorage.getItem("lastAVAttemptTimestamp");if(!e||!t)return!1;var i=Date.now(),n=Math.round((i-t)/1e3);if(n>=120){sessionStorage.removeItem("timeToWaitNextAV");sessionStorage.removeItem("AVAttemptNumber");sessionStorage.removeItem("lastAVAttemptTimestamp");return!1}var o=e-n;if(o>0){this.showMessage(__("lang_mainsite","You need to wait %s seconds before launching an audio/video chat again.").replace("%s",o),"info");return!0}return!1},setAVFrequencyLimitation:function(){var e=sessionStorage.getItem("AVAttemptNumber")?sessionStorage.getItem("AVAttemptNumber"):0;e++;sessionStorage.setItem("AVAttemptNumber",e);var t=Date.now();sessionStorage.setItem("lastAVAttemptTimestamp",t);var i=Math.min(10*e,60);sessionStorage.setItem("timeToWaitNextAV",i)},onStartStopAudioChat:function(t){e.stopEvent(t);if(null!==this.room||!this.checkAVFrequencyLimitation()){var i=t.target.id.split("_")[2];void 0===i&&(i=t.target.parentNode.id.split("_")[2]);if("table"==i){if(null!==this.room&&this.room.indexOf("T")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}var n="undefined"!=typeof current_player_id?current_player_id:this.player_id;if("undefined"!=typeof mainsite&&null===$("active_player_"+n)){this.showMessage(__("lang_mainsite","You are not currently playing at this table (you haven't joined yet, you have quit or the game has ended)."),"error");return}var o=t.target.id.split("_")[3];void 0===o&&(o=t.target.parentNode.id.split("_")[3]);if(null===this.room){var a='<div  class="rtc_dialog"><br />';a+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching an audio chat session for this table!")+"</i></div>";a+="</div>";this.confirmationDialog(a,e.hitch(this,(function(){this.ajaxcall("/table/table/startStopAudio.html",{target_table:o,target_player:null},this,(function(e){}))})),e.hitch(this,(function(){})))}else{this.setAVFrequencyLimitation();this.ajaxcall("/table/table/startStopAudio.html",{target_table:o,target_player:null},this,(function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("audio",{room_id:e.room_id,media:"audio",rating:null,issue:null,text:null})}))}}if("privatechat"==i){if(null!==this.room&&this.room.indexOf("P")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}void 0===(n=t.target.id.split("_")[3])&&(n=t.target.parentNode.id.split("_")[3]);if(null===this.room){a='<div  class="rtc_dialog"><br />';a+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching an audio chat session with another player!")+"</i></div>";a+="</div>";this.confirmationDialog(a,e.hitch(this,(function(){this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:n},this,(function(e){}))})),e.hitch(this,(function(){})))}else{this.setAVFrequencyLimitation();this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:n},this,(function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("audio",{room_id:e.room_id,media:"audio",rating:null,issue:null,text:null})}))}}}},onStartStopVideoChat:function(t){e.stopEvent(t);var i=t.target.id.split("_")[2];void 0===i&&(i=t.target.parentNode.id.split("_")[2]);if("table"==i){if(null!==this.room&&this.room.indexOf("T")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}var n="undefined"!=typeof current_player_id?current_player_id:this.player_id;if("undefined"!=typeof mainsite&&null===$("active_player_"+n)){this.showMessage(__("lang_mainsite","You are not currently playing at this table (you haven't joined yet, you have quit or the game has ended)."),"error");return}var o=t.target.id.split("_")[3];void 0===o&&(o=t.target.parentNode.id.split("_")[3]);var a='<div  class="rtc_dialog"><br />';a+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching a video chat session for this table!")+"</i></div>";a+="</div>";null===this.room?this.confirmationDialog(a,e.hitch(this,(function(){this.ajaxcall("/table/table/startStopVideo.html",{target_table:o,target_player:null},this,(function(e){}))})),e.hitch(this,(function(){}))):this.ajaxcall("/table/table/startStopVideo.html",{target_table:o,target_player:null},this,(function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("video",{room_id:e.room_id,media:"video",rating:null,issue:null,text:null})}))}if("privatechat"==i){if(null!==this.room&&this.room.indexOf("P")<0){this.showMessage(__("lang_mainsite","You must end your other live chat sessions before starting a new one."),"error");return}void 0===(n=t.target.id.split("_")[3])&&(n=t.target.parentNode.id.split("_")[3]);a='<div  class="rtc_dialog"><br />';a+='<div style="text-align: center; border-bottom: 1px solid black; border-top: 1px solid black; padding: 5px 5px 5px 5px;"><i>'+__("lang_mainsite","You are launching a video chat session with another player!")+"</i></div>";a+="</div>";null===this.room?this.confirmationDialog(a,e.hitch(this,(function(){this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:n},this,(function(e){}))})),e.hitch(this,(function(){}))):this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:n},this,(function(e){this.mediaChatRating&&g_sitecore.displayRatingContent("video",{room_id:e.room_id,media:"video",rating:null,issue:null,text:null})}))}},setNewRTCMode:function(t,i,n,o){if(null!==n){this.rtc_mode=n;if("undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&!this.isSpectator){var a="undefined"!=typeof current_player_id?current_player_id:this.player_id,s=!1,r=0!=n;if(this.mediaConstraints.audio!=r){this.mediaConstraints.audio=r;s=!0}var l=this.getRtcVideoConstraints(n);if(JSON.stringify(this.mediaConstraints.video)!=JSON.stringify(l)){this.mediaConstraints.video=l;s=!0}if(s&&null!==this.webrtc){this.clearRTC();this.room=null}if(null===this.room&&(this.mediaConstraints.audio||this.mediaConstraints.video)){if(null!==t){this.room="T"+t;if("undefined"!=typeof gameui&&null==$("rtc_container_"+a)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!1),{player_id:a,muted:"muted"}),$("rtc_placeholder_"+a));this.setupRTCEvents(a)}if("undefined"!=typeof mainsite&&null!=$("active_player_"+a)&&null!=$("emblem_"+a)&&null==$("rtc_container_"+a)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!1),{player_id:a,muted:"muted"}),$("table_rtc_placeholder"));this.placeOnObject($("rtc_container_"+a),$("emblem_"+a));this.setupRTCEvents(a)}}else if(null!==i){this.room="P"+Math.min(a,i)+"_"+Math.max(a,i);if(null!==$("chatwindowlogs_privatechat_"+i)&&null==$("rtc_container_"+a)){e.place(this.format_string(this.getRTCTemplate(this.mediaConstraints.audio,this.mediaConstraints.video,!1),{player_id:a,muted:"muted"}),$("chatwindowlogs_privatechat_"+i));if(this.mediaConstraints.video){e.style($("rtc_container_"+a),"top","-6px");e.style($("rtc_container_"+a),"left","115px");e.style($("rtc_container_"+a),"zIndex","496")}else if(this.mediaConstraints.audio){e.style($("rtc_container_"+a),"top","-13px");e.style($("rtc_container_"+a),"left","135px")}this.setupRTCEvents(a)}}o==a&&(this.already_accepted_room=this.room);var d=null!==t?"table_"+t:"privatechat_"+i;if(this.mediaConstraints.video){e.query("#chatbarinput_startvideochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active");e.query("#playersaroundtable_startvideochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active")}else if(this.mediaConstraints.audio){e.query("#chatbarinput_startaudiochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active");e.query("#playersaroundtable_startaudiochat_"+d).removeClass("audiovideo_inactive").addClass("audiovideo_active")}this.startRTC()}}}},onLoadPreviousMessages:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(22),n=i.split("_")[0],o=i.split("_")[1];this.loadPreviousMessage(n,o)},loadPreviousMessage:function(e,t){var i=e+"_"+t,n=null;void 0!==this.chatbarWindows[i].first_msg_timestamp&&(n=this.chatbarWindows[i].first_msg_timestamp);this.ajaxcall("/table/table/chatHistory.html",{type:e,id:t,before:n},this,"loadPreviousMessageCallback",(function(e){}),"get")},loadPreviousMessageCallback:function(t){if(void 0===i)var i=this.player_id;var n=t.type,o=t.id;if(t.status){if("underage"==t.status){this.showMessage(_("Sorry, you are not authorized to discuss with this player"),"error");this.closeChatWindow(n+"_"+o);return}if("admin"==t.status){var a=__("lang_mainsite","Our ${contact_page} is the best way to get in touch with us :)");a=a.replace("${contact_page}",__("lang_mainsite","Contact page"));this.showMessage(a,"error");this.closeChatWindow(n+"_"+o);gotourl("support");return}t.status;"newchat"==t.status&&e.place('<div class="whiteblock"><i class="fa fa-exclamation-triangle"></i> '+_("Unsollicited messages may lead to be blocked and affect your reputation.")+"</div>","chatwindowlogs_endzone_"+n+"_"+o,"before");"newchattoconfirm"==t.status&&e.addClass("chatwindow_"+n+"_"+o,"startchat_toconfirm")}this.chatbarWindows[n+"_"+o].lastMsgAuthor=null;var s=$("chatwindowlogs_zone_"+n+"_"+o).scrollHeight,r=!1;for(var l in t.history){r=!0;if("privatechat"==n){var d={channel:"/player/p"+i,channelorig:"/player/p"+i,args:t.history[l],bIsTableMsg:!1,lock_uuid:"dummy",log:"${player_name} ${text}",type:"privatechat",time:t.history[l].time,mread:t.history[l].mread,loadprevious:!0,uid:0};this.onPlaceLogOnChannel(d)}else if("table"==n){d={channel:"/table/t"+o,channelorig:"/table/t"+o,args:t.history[l],bIsTableMsg:!0,lock_uuid:"dummy",log:"${player_name} ${text}",type:"tablechat",time:t.history[l].time,loadprevious:!0,uid:0};this.onPlaceLogOnChannel(d)}else if("group"==n){d={channel:"/group/g"+o,channelorig:"/group/g"+o,args:t.history[l],lock_uuid:"dummy",log:"${player_name} ${text}",type:"groupchat",time:t.history[l].time,loadprevious:!0,uid:0};this.onPlaceLogOnChannel(d)}}e.place("load_previous_message_wrap_"+n+"_"+o,"chatwindowlogs_zone_"+n+"_"+o,"first");r||e.destroy("load_previous_message_"+n+"_"+o);var c=$("chatwindowlogs_zone_"+n+"_"+o).scrollHeight;c>s&&($("chatwindowlogs_zone_"+n+"_"+o).scrollTop+=toint(c-s))},stackOrUnstackIfNeeded:function(){var t=this.countStackedWindows(),i=e.hasClass("ebd-body","mobile_version");if(t>0){if(this.getNeededChatbarWidth()+(i?80:300)<=e.position("chatbar").w-50)for(var n in this.chatbarWindows)if("stacked"==this.chatbarWindows[n].status){this.unstackChatWindow(n,"automatic");return}}this.stackChatWindowsIfNeeded();i&&e.query("#chatbar .expanded .chatwindowlogs_zone").forEach((function(e){setTimeout((function(){e.scrollTop=e.scrollHeight}),1)}))},onUnstackChatWindow:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(15);this.unstackChatWindow(i);e.style("stackedmenu","display","none")},unstackChatWindow:function(t,i){void 0===i&&(i="normal");this.stackChatWindowsIfNeeded("expanded");this.expandChatWindow(t);"automatic"==i&&this.collapseChatWindow(t);$("stackmenu_item_"+t)&&e.destroy("stackmenu_item_"+t)},stackChatWindowsIfNeeded:function(t){var i=e.hasClass("ebd-body","mobile_version");if("none"!=e.style("chatbar","display")){"undefined"==typeof save_spaces_nbr&&(save_spaces_nbr=null);var n=e.position("chatbar").w-50,o=this.getNeededChatbarWidth();"collapsed"==t&&(o+=i?64:176);"expanded"==t&&(o+=i?64:220);if(o>n){this.stackOneChatWindow();this.stackChatWindowsIfNeeded(t)}}},stackOneChatWindow:function(){var t=null;for(var i in this.chatbarWindows){"collapsed"==this.chatbarWindows[i].status&&(t=i)}if(null===t)for(var i in this.chatbarWindows){"expanded"==this.chatbarWindows[i].status&&(t=i)}this.chatbarWindows[t].status="stacked";e.removeClass("chatwindow_"+t,["collapsed","expanded","stacked"]);e.addClass("chatwindow_"+t,"stacked");this.updateChatBarStatus();e.style("chatwindowexpanded_"+t,"display","none");e.style("chatwindowcollapsed_"+t,"display","none");e.style("chatwindowpreview_"+t,"display","none");var n=$("chatwindowtitlenolink_"+t).innerHTML;e.place('<div class="stackmenu_item" id="stackmenu_item_'+t+'">'+n+"</div>","stackedmenu");e.connect($("stackmenu_item_"+t),"onclick",this,"onUnstackChatWindow");this.adaptChatbarDock()},getNeededChatbarWidth:function(){var t=e.hasClass("ebd-body","mobile_version"),i=0,n=0,o=t?64:280,a=t?64:176,s=0;for(var r in this.chatbarWindows){"tablelog"==r.substr(0,8)&&e.hasClass("ebd-body","desktop_version")&&!e.hasClass("ebd-body","new_gameux")||("expanded"==this.chatbarWindows[r].status?i++:"collapsed"==this.chatbarWindows[r].status&&n++);"table_"==r.substr(0,6)&&e.hasClass("ebd-body","desktop_version")&&"undefined"!=typeof gameui&&("expanded"==this.chatbarWindows[r].status?s+=412-o:"collapsed"==this.chatbarWindows[r].status&&(s+=312-a))}return 2+i*o+n*a+s},adaptChatbarDock:function(){if($("chatwindowcollapsed_stacked")){var t=this.getNeededChatbarWidth();if(t>0){e.addClass("chatbardock","chatbardock_visible");e.style("chatbardock","width",t+"px")}else e.removeClass("chatbardock","chatbardock_visible");this.countStackedWindows()>0?e.style("chatwindowcollapsed_stacked","display","block"):e.style("chatwindowcollapsed_stacked","display","none")}},countStackedWindows:function(){var e=0;for(var t in this.chatbarWindows)"stacked"==this.chatbarWindows[t].status&&e++;return e},closeChatWindow:function(t){if(this.chatbarWindows[t]){this.makeSureChatBarIsOnBottom(t);null!==this.chatbarWindows[t].subscription&&g_sitecore.unsubscribeCometdChannel(this.chatbarWindows[t].subscription);e.destroy("chatwindow_"+t);delete this.chatbarWindows[t];this.updateChatBarStatus();this.stackOrUnstackIfNeeded();this.adaptChatbarDock()}},onCloseChatWindow:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(17),n=i.split("_")[0],o=i.split("_")[1];this.ackUnreadMessage(i,"unsub");if(null!==this.room&&this.room.indexOf("P")>=0){var a="undefined"!=typeof current_player_id?current_player_id:this.player_id;if("table"==n&&this.room=="T"+o){this.doLeaveRoom();this.closeChatWindow(i)}else"privatechat"==n&&this.room=="P"+o+"_"+a||"privatechat"==n&&this.room=="P"+a+"_"+o?this.mediaConstraints.video?this.ajaxcall("/table/table/startStopVideo.html",{target_table:null,target_player:o},this,(function(e){this.closeChatWindow(i)})):this.mediaConstraints.audio&&this.ajaxcall("/table/table/startStopAudio.html",{target_table:null,target_player:o},this,(function(e){this.closeChatWindow(i)})):this.closeChatWindow(i)}else this.closeChatWindow(i)},onCollapseChatWindow:function(t){if("chatwindowtitlelink"==t.target.id.substr(0,19))return!0;e.stopEvent(t);if("chatwindowcollapse"==t.currentTarget.id.substr(0,18))var i=t.currentTarget.id.substr(19);else i=t.currentTarget.id.substr(23);this.collapseChatWindow(i)},collapseChatWindow:function(t,i){this.chatbarWindows[t].status="collapsed";e.removeClass("chatwindow_"+t,["collapsed","expanded","stacked"]);e.addClass("chatwindow_"+t,"collapsed");this.updateChatBarStatus();e.style("chatwindowexpanded_"+t,"display","none");e.style("chatwindowcollapsed_"+t,"display","block");e.style("chatwindowpreview_"+t,"display","block");this.stackOrUnstackIfNeeded();this.adaptChatbarDock();void 0!==this.autoChatWhilePressingKey&&dijit.popup.close(this.autoChatWhilePressingKey);void 0!==i&&i||this.makeSureChatBarIsOnBottom(t)},onExpandChatWindow:function(e){var t=e.currentTarget.id.substr(20);if("expanded"!=this.chatbarWindows[t].status){this.expandChatWindow(t);this.ackUnreadMessage(t)}else this.collapseChatWindow(t)},onCollapseAllChatWindow:function(t){if("chatbar_inner"==t.target.id){e.stopEvent(t);for(var i in this.chatbarWindows)"expanded"==this.chatbarWindows[i].status&&this.collapseChatWindow(i)}},updateChatBarStatus:function(){e.query(".chatwindow.expanded").length>0?e.addClass("chatbar","at_least_one_expanded"):e.removeClass("chatbar","at_least_one_expanded")},expandChatWindow:function(t,i){var n=e.hasClass("ebd-body","mobile_version");if("expanded"==this.chatbarWindows[t].status);else{if(n)for(var o in this.chatbarWindows)"expanded"==this.chatbarWindows[o].status&&this.collapseChatWindow(o,!0);this.chatbarWindows[t].autoCollapseAfterMessage=!(void 0===i||!i);this.chatbarWindows[t].status="expanded";e.removeClass("chatwindow_"+t,["collapsed","expanded","stacked"]);e.addClass("chatwindow_"+t,"expanded");this.updateChatBarStatus();e.style("chatwindowexpanded_"+t,"display","block");n?e.style("chatwindowcollapsed_"+t,"display","block"):e.style("chatwindowcollapsed_"+t,"display","none");e.style("chatwindowpreview_"+t,"display","none");e.removeClass("chatwindow_"+t,"newmessage");$("chatwindownewmsgcount_"+t).innerHTML="";$("chatwindowlogs_zone_"+t).scrollTop=$("chatwindowlogs_zone_"+t).scrollHeight;this.stackOrUnstackIfNeeded();this.adaptChatbarDock();n&&this.makeSureChatBarIsOnTop(t)}$("chatbarinput_"+t+"_input")&&$("chatbarinput_"+t+"_input").focus()},makeSureChatBarIsOnTop:function(t){if(!e.hasClass("ebd-body","chatbar_ontop")){var i=e.position("chatbar");e.addClass("ebd-body","chatbar_ontop");var n=e.position("chatbar");e.style("chatbar","top",i.y+"px");e.style("chatbar","bottom","auto");var o=e.fx.slideTo({node:"chatbar",top:n.y,left:0,delay:0,duration:200,unit:"px"});e.connect(o,"onEnd",(function(){e.style("chatbar","bottom","");e.style("chatbar","top","");e.style("chatbar","position","")}));o.play();if(i.y==n.y)e.style("chatwindowexpanded_"+t,"opacity",1);else{e.style("chatwindowexpanded_"+t,"opacity",0);e.fadeIn({node:"chatwindowexpanded_"+t,duration:200,delay:180,onEnd:function(t){e.style(t,"opacity","")}}).play()}}},makeSureChatBarIsOnBottom:function(t){if(e.hasClass("ebd-body","chatbar_ontop")){var i=e.position("chatbar");e.removeClass("ebd-body","chatbar_ontop");var n=e.position("chatbar");e.style("chatbar","top","auto");e.style("chatbar","bottom",n.y-i.y+"px");e.animateProperty({node:"chatbar",delay:0,properties:{bottom:{end:"0",unit:"px"}},onEnd:function(t){e.style("chatbar","top","");e.style("chatbar","bottom","");e.style("chatbar","position","")}}).play();e.style("chatwindowexpanded_"+t,"opacity",1)}},onScrollDown:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(23);e.style("chatwindowmorelogs_"+i,"display","none");$("chatwindowlogs_zone_"+i).scrollTop=$("chatwindowlogs_zone_"+i).scrollHeight},onToggleStackMenu:function(t){e.stopEvent(t);"block"==e.style("stackedmenu","display")?e.style("stackedmenu","display","none"):e.style("stackedmenu","display","block")},onCallbackBeforeChat:function(e,t){if(void 0!==e.table&&"undefined"!=this.chatbarWindows["table_"+e.table]){"undefined"!=this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.collapseChatWindow("table_"+e.table);if(void 0!==this.discussblock){this.showMessage(_("A player at thie table blocked you."),"error");return!1}}if(this.isBadWorkInChat(e.msg)){var i=__("lang_mainsite","We detect a word in your chat input that may be considered as an insult/profanity/aggressive attitude by others.")+"\n\n";i+=__("lang_mainsite","BGA has a zero-tolerance policy about insults and aggressive attitudes, whatever the reason.")+"\n\n";i+=__("lang_mainsite","If another player reports you, you will be ban from BGA.")+"\n\n";i+=__("lang_mainsite","If someone is provoking you, DO NOT RESPOND, block this player (thumb down on his/her profile) and report this players to moderators.")+"\n\n";i+=__("lang_mainsite","Insults on both side = Moderation of both side.")+"\n\n";i+=__("lang_mainsite","Do you really want to send your message and risk a moderation?");return confirm(i)}if("/chat/chat/say.html"==t&&"undefined"!=typeof mainsite&&mainsite.tutorialShowOnce(21)){i=__("lang_mainsite","You are using Board Game Arena global chat: your message will be visible by all players")+"\n\n";i+=__("lang_mainsite","There is a zero-tolerance policy on this chat for insults, advertising, or any content that may not be appropriate for all audience, or may be interpreted as an aggression.")+"\n\n";i+=__("lang_mainsite","Players who do not respect these rules will be banned immediately with no warning.")+"\n\n";i+=__("lang_mainsite","Do you confirm you want to send this message?");return confirm(i)}return!0},isBadWorkInChat:function(e){if(null===e)return!1;var t=" "+e.toLowerCase()+" ";for(var i in this.badWordList)if(-1!=t.indexOf(" "+this.badWordList[i].replace("-"," ")+" "))return!0;return!1},onCallbackAfterChat:function(e){void 0!==this.autoChatWhilePressingKey&&dijit.popup.close(this.autoChatWhilePressingKey)},callbackAfterChatError:function(e){void 0!==e.table&&"undefined"!=this.chatbarWindows["table_"+e.table]&&"undefined"!=this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.chatbarWindows["table_"+e.table].autoCollapseAfterMessage&&this.expandChatWindow("table_"+e.table,!0)},onDockedChatFocus:function(e){var t=e.target.id.substr(13).slice(0,-6);this.ackUnreadMessage(t)},onDockedChatInputKey:function(t){var i=t.target.id.substr(13).slice(0,-6);this.ackUnreadMessage(i);if(this.chatbarWindows[i].autoShowOnKeyPress&&!this.chatbarWindows[i].autoCollapseAfterMessage&&void 0===this.autoChatWhilePressingKey&&e.hasClass("ebd-body","desktop_version")){var n='<div class="icon20 icon20_suggestion"></div> ';n+="<b>"+__("lang_mainsite","Did you know?")+"</b>";n+="<hr/><div style='max-width:200px'>";n+=__("lang_mainsite","You can type messages anytime during a game to start chatting without opening this chat window manually.");n+="</div>";this.autoChatWhilePressingKey=new dijit.TooltipDialog({id:"autoChatWhilePressingKey",content:n,closable:!0});var o=t.target;dijit.popup.open({popup:this.autoChatWhilePressingKey,around:$(o),orient:["before-centered","before","below","below-alt","above","above-alt"]})}},onShowPredefined:function(t){var i=t.currentTarget.id.substr(24),n=t.currentTarget.id,o=!1;if(void 0===this.chatbarWindows[i].predefinedMessages){o=!0;var a=this.getSmileyClassToCodeTable(),s="";s+="<div style='width:300px'>";if(null!==this.notifqueue.game&&"table_"==i.substr(0,6)){for(var r in this.predefinedTextMessages)"tbleave"==r&&e.hasClass("ebd-body","playmode_realtime")||(s+="<p class='predefined_textmessage' id='predefined_textmessage_"+i+"-"+r+"'>"+__("lang_mainsite",this.predefinedTextMessages[r])+"</p>");s+="<hr/>"}for(var l in a){s+="<div class='predefined_message' id='predefined_message_"+i+"-"+l+"'>";s+=this.addSmileyToText(a[l]);s+="</div>"}s+="</div>";this.chatbarWindows[i].predefinedMessages=new dijit.TooltipDialog({id:"predefinedMessages_"+i,content:s,closable:!0});this.chatbarWindows[i].predefinedMessagesOpen=!1}if(0==this.chatbarWindows[i].predefinedMessagesOpen){this.chatbarWindows[i].predefinedMessagesOpen=!0;dijit.popup.open({popup:this.chatbarWindows[i].predefinedMessages,around:$(n),orient:["after-centered","after","below","below-alt","above","above-alt"]})}else{this.chatbarWindows[i].predefinedMessagesOpen=!1;dijit.popup.close(this.chatbarWindows[i].predefinedMessages)}var d=e.hasClass("ebd-body","mobile_version");e.style("chatbarinput_predefined_"+i+"_dropdown","zIndex",d?10510:1051);if(o){e.query("#chatbarinput_predefined_"+i+"_dropdown .predefined_message").connect("onclick",this,"onInsertPredefinedMessage");e.query("#chatbarinput_predefined_"+i+"_dropdown .predefined_textmessage").connect("onclick",this,"onInsertPredefinedTextMessage")}},onInsertPredefinedMessage:function(e){var t=e.currentTarget.id.substr(19).split("-"),i=t[0],n=t[1],o=this.getSmileyClassToCodeTable();this.chatbarWindows[i].input.addContentToInput(o[n]);$("chatbarinput_"+i+"_input").focus();this.chatbarWindows[i].predefinedMessagesOpen=!1;dijit.popup.close(this.chatbarWindows[i].predefinedMessages)},onInsertPredefinedTextMessage:function(e){var t=e.currentTarget.id.substr(23).split("-"),i=t[0],n=t[1],o=this.predefinedTextMessages[n];this.chatbarWindows[i].input.addContentToInput(o);$("chatbarinput_"+i+"_input").focus();this.chatbarWindows[i].input.input_div.value==o&&this.chatbarWindows[i].input.sendMessage();this.chatbarWindows[i].predefinedMessagesOpen=!1;dijit.popup.close(this.chatbarWindows[i].predefinedMessages)},setGroupList:function(e,t,i,n){this.groupList=e;this.red_thumbs_given={};this.red_thumbs_taken={};void 0!==t&&(this.allGroupList=t);this.red_thumbs_given=void 0!==i&&"object"==typeof i?i:{};this.red_thumbs_taken=void 0!==n&&"object"==typeof n?n:{};if(!this.bChatDetached){var o={};for(var a in e)o[a]="/group/g"+a;this.groupToCometdSubs=this.subscribeCometdChannels(o,this.notifqueue,"onNotification")}},setLanguagesList:function(e){this.allLanguagesList=e},setPma:function(e){this.pma=e},setRtcMode:function(e,t){this.rtc_mode=e;this.rtc_room=t},takeIntoAccountAndroidIosRequestDesktopWebsite:function(e){var t,i,n=navigator.userAgent,o=/ mobile/i.test(n),a=!(!/ gecko/i.test(n)||!/ firefox\//i.test(n)),s="was"===(i="wasmobile",(e.cookie.match("(^|; )"+i+"=([^;]*)")||0)[2]),r="user-scalable=yes, maximum-scale=2";if(o&&!s)e.cookie="wasmobile=was";else if(!o&&s)if(a){(t=e.createElement("meta")).setAttribute("content",r);t.setAttribute("name","viewport");e.getElementsByTagName("head")[0].appendChild(t)}else void 0===e.getElementsByName("viewport")[0]||e.getElementsByName("viewport")[0].setAttribute("content",r)},traceLoadingPerformances:function(){if(window.performance&&window.performance.getEntries){var t=window.performance.getEntries(),i={};for(var n in t){var o=t[n],a=extractDomain(o.name);if(void 0===i[a])i[a]={nb:1,max:o.duration,total:o.duration};else{i[a].nb++;i[a].max=Math.max(i[a].max,o.duration);i[a].total+=o.duration}}for(var n in i){i[n].avg=Math.round(i[n].total/i[n].nb);i[n].total=Math.round(i[n].total);i[n].max=Math.round(i[n].max)}this.ajaxcall("/table/table/perfs.html",{perfs:e.toJson(i)},this,(function(e){}),(function(e){}),"post")}},getCurrentPlayerId:function(){return"undefined"!=typeof current_player_id?current_player_id:this.player_id},tutorialShowOnce:function(e,t){void 0===t&&(t=!0);if("undefined"!=typeof current_player_id){if(toint(current_player_id)<0)return!1}else if(this.isSpectator)return!1;if(e<0||e>=256)return!1;var i=Math.floor(e/64),n=1<<e%64;if(void 0!==this.tutorial)var o=this.tutorial;else o=this.metasite_tutorial;if(o[i]&n){if(t){o[i]=o[i]&~n;this.ajaxcall("/table/table/markTutorialAsSeen.html",{id:e},this,(function(e){}))}return!0}return!1},highligthElementwaitForPopinToClose:function(){if(e.query(".standard_popin").length>0)setTimeout(e.hitch(this,"highligthElementwaitForPopinToClose"),1e3);else{this.bHighlightPopinTimeoutInProgress=!1;this.onElementTutorialNext()}},highlightElementTutorial:function(t,i,n){void 0===n&&(n="");if($("tutorial-overlay"))this.tutorialHighlightedQueue.push({id:t,text:i,optclass:n});else if(e.query(".standard_popin").length>0){this.tutorialHighlightedQueue.push({id:t,text:i,optclass:n});if(void 0===this.bHighlightPopinTimeoutInProgress||0==this.bHighlightPopinTimeoutInProgress){this.highligthElementwaitForPopinToClose();this.bHighlightPopinTimeoutInProgress=!0}}else{e.place('<div id="tutorial-overlay" class="tutorial-overlay"></div>',"ebd-body","first");e.connect($("tutorial-overlay"),"onclick",this,"onElementTutorialNext");var o={node:"tutorial-overlay",duration:1e3},a=this;this.highlightFadeInInProgress=!0;o.onEnd=e.hitch(this,(function(){this.highlightFadeInInProgress=!1;$("newArchiveComment")&&e.destroy("newArchiveComment");dijit.byId("currentTutorialDialog")&&dijit.byId("currentTutorialDialog").destroy();var n="<div id='newArchiveComment' class='newArchiveComment'>                                    <div class='archiveComment_before'><p class='archiveComment_before_inner'><i class='fa fa-graduation-cap'></i></p></div>                                    <div id='newArchiveCommentTextDisplay'>"+this.applyCommentMarkup(i)+"</div>                                    <div id='newArchiveCommentDisplayControls'><a href='#' id='newArchiveCommentNext' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Continue")+"</a>                                    </div>                                </div>";this.currentTutorialDialog=new dijit.TooltipDialog({id:"currentTutorialDialog",content:n,closable:!0});if(null!==t&&$(t))dijit.popup.open({popup:this.currentTutorialDialog,around:$(t),orient:["below","above","after","before"]});else{var o=e.position("ebd-body").w/2-215;dijit.popup.open({popup:this.currentTutorialDialog,x:o,y:180,orient:["below","above","after","before"]});e.query(".dijitTooltipConnector").style("display","none")}$("newArchiveCommentNext")&&e.connect($("newArchiveCommentNext"),"onclick",a,"onElementTutorialNext")}));if(null!=t){var s=e.window.getBox(),r=e.position(t),l=!1;(r.y<0||r.y+r.h>s.h)&&(l=!0);l&&window.scrollBy({top:r.y-200,behavior:"smooth"});e.addClass(t,"above-overlay");this.current_hightlighted_additional_class=n;""!=n&&e.addClass(t,n);"static"==e.style(t,"position")&&e.addClass(t,"above-overlay-relative")}e.fadeIn(o).play()}},onElementTutorialNext:function(t){void 0!==t&&e.stopEvent(t);if(void 0===this.highlightFadeInInProgress||!this.highlightFadeInInProgress){if(null!==this.currentTutorialDialog){dijit.popup.close(this.currentTutorialDialog);this.currentTutorialDialog=null}if($("tutorial-overlay")){var i={node:"tutorial-overlay",duration:500};this.highlightFadeInInProgress=!0;i.onEnd=e.hitch(this,(function(){this.highlightFadeInInProgress=!1;e.destroy("tutorial-overlay");""!=this.current_hightlighted_additional_class&&e.query(".above-overlay").removeClass(this.current_hightlighted_additional_class);e.query(".above-overlay").removeClass("above-overlay");e.query(".above-overlay-relative").removeClass("above-overlay-relative");if(this.tutorialHighlightedQueue.length>0){var t=this.tutorialHighlightedQueue.shift();this.highlightElementTutorial(t.id,t.text,t.optclass)}}));e.fadeOut(i).play()}else if(this.tutorialHighlightedQueue.length>0){var n=this.tutorialHighlightedQueue.shift();this.highlightElementTutorial(n.id,n.text,n.optclass)}}},websiteWindowVisibilityChange:function(e){var t="visible",i="hidden",n={focus:t,focusin:t,pageshow:t,blur:i,focusout:i,pagehide:i};(e=e||window.event).type in n?this.window_visibility=n[e.type]:this.window_visibility=document.hidden?"hidden":"visible"},ackUnreadMessage:function(t,i){var n=t.split("_")[0],o=t.split("_")[1],a=!1;void 0!==i&&"unsub"==i&&"table"==n&&(a=!0);if(("privatechat"==n||"table"==n)&&(e.query("#chatwindowlogs_zone_"+t+" .newmessage").length>0||a)){var s=[];e.query("#chatwindowlogs_zone_"+t+" .newmessage .roundedboxinner").forEach((function(e){s.push(e.id.substr(13))}));if("privatechat"==n){var r=o;this.ackMessagesWithPlayer(r,s)}else if("table"==n){var l=o;this.ackMessagesOnTable(l,s,a)}e.query("#chatwindowlogs_zone_"+t+" .newmessage").removeClass("newmessage")}},ackMessagesWithPlayer:function(e,t){this.ajaxcall("/table/table/chatack.html",{player:e,list:t.join(";")},this,(function(t){i.stores.discussions.ackMessagesWithPlayer(e)}),(function(e){}),"get")},ackMessagesOnTable:function(e,t,i){var n={table:e,list:t.join(";")};i&&(n.bUnsub=i);this.ajaxcall("/table/table/chatack.html",n,this,(function(e){}),(function(e){}),"get")},onAckMsg:function(t){for(var i in t.args.msgs){var n=t.args.msgs[i];if($("privmsg_read_"+n)){e.removeClass("privmsg_read_"+n,"message_unread");e.addClass("privmsg_read_"+n,"message_read")}}},initMonitoringWindowVisibilityChange:function(){var t="hidden";if(t in document)e.connect(document,"visibilitychange",this,"websiteWindowVisibilityChange");else if((t="mozHidden")in document)e.connect(document,"mozvisibilitychange",this,"websiteWindowVisibilityChange");else if((t="webkitHidden")in document)e.connect(document,"webkitvisibilitychange",this,"websiteWindowVisibilityChange");else if((t="msHidden")in document)e.connect(document,"msvisibilitychange",this,"websiteWindowVisibilityChange");else if("onfocusin"in document){e.connect(document,"onfocusin",this,"websiteWindowVisibilityChange");e.connect(document,"onfocusout",this,"websiteWindowVisibilityChange")}else{e.connect(window,"onpageshow",this,"websiteWindowVisibilityChange");e.connect(window,"onpagehide",this,"websiteWindowVisibilityChange");e.connect(window,"onfocus",this,"websiteWindowVisibilityChange");e.connect(window,"onblur",this,"websiteWindowVisibilityChange")}void 0!==document[t]&&this.websiteWindowVisibilityChange({type:document[t]?"blur":"focus"})},playingHoursToLocal:function(e,t){if(-1==e.indexOf(":00"))return e;var i=toint(e.substr(0,e.indexOf(":")))+this.timezoneDelta;return void 0!==t&&t?{start_hour:i%24+":00",end_hour:(i+12)%24+":00"}:i%24+":00 &rarr; "+(i+12)%24+":00"},showSplashedPlayerNotifications:function(t){void 0===this.splashNotifToDisplay&&(this.splashNotifToDisplay=[]);for(var i in t){var n=t[i];$("splash_trophy_"+n.id)||this.splashNotifToDisplay.push(n)}"none"==e.style("splashedNotifications_overlay","display")&&this.displayNextSplashNotif()},displayNextSplashNotif:function(){var t=this.splashNotifToDisplay.shift(),i=this.splashNotifToDisplay.length;if(void 0!==t)if(this.splashNotifRead&&this.splashNotifRead[t.id])this.displayNextSplashNotif();else{var n=500;if("none"==e.style("splashedNotifications_overlay","display")){e.style("splashedNotifications_overlay","display","block");e.fadeIn({node:"splashedNotifications_overlay",duration:1e3}).play();n=1e3}if(16==toint(t.news_type)||21==toint(t.news_type)||17==toint(t.news_type)||30==toint(t.news_type)){var o=t.args[3];if(toint(o)>1e3){var a=t.args[17],s=t.args[18];t.base_img=getStaticAssetUrl("img/awards/"+o+"_"+s+".png");var r=Math.floor(a/1e3);t.addimg='<img src="'+g_themeurl+"../../data/grouparms/"+r+"/group_"+a+'.png?h=t"/>';t.trophy_name=t.jargs.championship_name+" "+t.jargs.tournament_name+": "+__("lang_mainsite",t.trophy_name)}else{t.base_img=getStaticAssetUrl("img/awards/"+o+".png");t.addimg="";t.trophy_name=__("lang_mainsite",t.trophy_name);t.trophy_name=t.trophy_name.replace("%s",format_number(t.trophy_name_arg));t.trophy_descr=__("lang_mainsite",t.trophy_descr);t.trophy_descr=t.trophy_descr.replace("%s",format_number(t.trophy_name_arg))}t.shadow_img=getStaticAssetUrl("img/awards/award_shadow.png");t.game_name="";if(void 0!==t.jargs.game_name){t.game_name=__("lang_mainsite",t.jargs.game_name+"_displayed");t.trophy_descr=""}t.continuelbl=__("lang_mainsite","Continue");t.prestige=format_number(t.args[16]);t.skiplbl=i>0?e.string.substitute(_("Skip ${nbr} more"),{nbr:i}):"";var l='<div id="splash_trophy_${id}" class="splash_block">                        <div id="splash_background_${id}" class="splash_background"></div>                        <div id="splash_central_${id}" class="splash_central">                            <div class="trophyimg_wrap">                                <div id="splash_trophy_imgwrap_${id}" class="trophyimg_image">                                    <img class="trophyimg_shadow"  src=\'${shadow_img}\'"></img>                                    <div id="splash_trophyimg_${id}" class="trophyimg trophyimg_xlarge" style="background-image: url(\'${base_img}\')">${addimg}</div>                                </div>                                <div id="trophy_prestige_${id}" class="trophy_prestige"><div class="xp_container" style="font-size:14px;">+${prestige} XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div></div>                            </div>                            <div class="splash_intro">'+__("lang_mainsite","You get a new trophy")+'</div>                            <div class="splash_gamename gamename">${game_name}</div>                            <div class="splash_trophyname">${trophy_name}</div>                            <div class="splash_descr">${trophy_descr}</div>                        </div>                        <div id="continue_btn_${id}" class="bgabutton bgabutton_always_big bgabutton_blue">${continuelbl}</div>                        <a id="skip_wrap_${id}" class="skip_wrap no-underline" href="#">${skiplbl}</a>                    </div>';e.place(e.string.substitute(l,t),splashedNotifications_overlay);e.style("splash_central_"+t.id,"opacity",0);e.style("continue_btn_"+t.id,"opacity",0);e.style("skip_wrap_"+t.id,"opacity",0);e.style("splash_background_"+t.id,"left","100%");e.style("trophy_prestige_"+t.id,"opacity",0);e.fx.chain([e.animateProperty({delay:n,node:"splash_background_"+t.id,properties:{left:0,unit:"%"},onEnd:function(){playSound("new_trophy")}}),e.fadeIn({node:"splash_central_"+t.id,duration:700}),e.fadeIn({node:"trophy_prestige_"+t.id,duration:700}),e.fx.combine([e.fadeIn({node:"continue_btn_"+t.id,duration:700}),e.fadeIn({node:"skip_wrap_"+t.id,duration:700})])]).play();e.connect($("continue_btn_"+t.id),"onclick",this,"onDisplayNextSplashNotif");e.connect($("skip_wrap_"+t.id),"onclick",this,"onDisplayNextSplashNotif")}else if(28==toint(t.news_type)){var d=t.args[1];t.game_name=__("lang_mainsite",t.jargs.game_name+"_displayed");t.continuelbl=__("lang_mainsite","Continue");var c=t.args[10],h=t.args[11],u=this.arenaPointsDetails(c/1e4,t.jargs.league_nbr),p=this.arenaPointsDetails(h/1e4,t.jargs.league_nbr);l='<div id="splash_trophy_${id}" class="splash_block splash_arena_points"><div id="splash_background_arena" class="splash_background"></div><div id="splash_central_arena" class="splash_central"><div id="splash_trophy_imgwrap_arena" class="leagueimg_image"><img class="trophyimg_shadow"  src=\'${shadow_img}\'"></img><div id="splash_trophyimg_arena" class="trophyimg trophyimg_xlarge" style="background-image: url(\'${base_img}\')"></div></div><div id="splash_arena_bar"></div><div class="splash_intro">${game_name}  ${league_name}</div><div class="progressbar progressbar_arena arena_${league_id} progressbar_nolabel"><div id="arena_bar" class="progressbar_bar"><div id="progressbar_arena_width" class="progressbar_content"  style="${arenabarpcent}"><div id="arena_bar_container" class="arena_container">${arena_points_html}</div></div></div></div><div id="arena_bar_bottom_infos" class="progressbar_bottom_infos">${arena_bottom_infos}</div><div id="arena_world_rank_wrap" style="display:none;">'+__("lang_mainsite","World rank")+': <span id="arena_world_rank"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span></div></div><div id="continue_btn_${id}" class="bgabutton bgabutton_always_big bgabutton_blue">${continuelbl}</div></div>';t.shadow_img=getStaticAssetUrl("img/awards/award_shadow.png");t.base_img=getStaticAssetUrl("img/awards/"+(100+u.league)+".png");t.league_name=u.league_name;t.league_id=u.league;var m,g=this.arenaPointsHtml(u);t.arena_points_html=g.bar_content;t.arena_bottom_infos=g.bottom_infos;t.arenabarpcent=g.bar_pcent;if(toint(h)<=toint(c))var f=p.points,v=u.points;else{f=p.points,v=u.points;p.league>u.league&&(f=10)}e.place(e.string.substitute(l,t),splashedNotifications_overlay);e.style("splash_central_arena","opacity",0);e.style("continue_btn_"+t.id,"opacity",0);e.style("splash_background_arena","left","100%");e.forEach(["transform","WebkitTransform","msTransform","MozTransform","OTransform"],(function(t){void 0!==e.body().style[t]&&(m=t)}));this.transform=m;var b=[e.animateProperty({delay:n,node:"splash_background_arena",properties:{left:0,unit:"%"}}),e.fadeIn({node:"splash_central_arena",duration:700})];if(5==u.league){var y=this.arenaPointsHtml(p);if(p.arelo!=u.arelo){var w="";if(p.arelo>u.arelo){var C=p.arelo-u.arelo;w="+"+Math.round(C)+" "+__("lang_mainsite","points")}else{C=p.arelo-u.arelo;w=Math.round(C)+" "+__("lang_mainsite","points")}var k=new e.Animation({curve:[u.arelo,p.arelo],duration:1e3,onBegin:function(){playSound("elochange")},onAnimate:e.hitch(this,(function(e){$("arena_bar_container").innerHTML=Math.round(e)+" "+__("lang_mainsite","points");var t=g.bar_pcent_number+(y.bar_pcent_number-g.bar_pcent_number)*(e-u.arelo)/(p.arelo-u.arelo);$("progressbar_arena_width").style.width=t+"%"})),onEnd:function(){$("arena_bar").innerHTML+='<div class="arena_container_bar_details">'+w+"</div>"}});b.push(k)}var x={transform:m,node:$("arena_world_rank_wrap")};k=new e.Animation({curve:[20,1],delay:300,onBegin:e.hitch(x,(function(){e.style("arena_world_rank_wrap","display","block")})),onAnimate:e.hitch(x,(function(e){this.node.style[this.transform]="scale("+e+")"})),onEnd:function(){playSound("gain_arena")},duration:500});b.push(k);this.ajaxcall("/lobby/lobby/getArenaWorldRank.html",{game:d,arelo:p.arelo},this,e.hitch(this,(function(e){$("arena_world_rank").innerHTML=this.getRankString(e.rank)})))}if(f>v){soundManager.loadSound&&soundManager.loadSound("gain_arena");for(var T=v;T<f;T++){e.query(".arena_point_wrap_"+T+" .arena_shadow").style("opacity",1);var A=e.query(".arena_point_wrap_"+T+" .arena_colored")[0];x={transform:m,node:A},k=new e.Animation({curve:[20,1],onBegin:e.hitch(x,(function(){this.node.style.opacity=1})),onAnimate:e.hitch(x,(function(e){this.node.style[this.transform]="scale("+e+")"})),onEnd:function(){playSound("gain_arena");var t=e.query(".splash_block .remain_arena_points")[0];if(t){t.innerHTML=toint(t.innerHTML)-1;0==toint(t.innerHTML)&&(e.query(".progressbar_bottom_infos")[0].innerHTML='<i class="fa fa-check"></i> '+__("lang_mainsite","Completed!"))}},duration:500});b.push(k)}}else if(f<v){soundManager.loadSound&&soundManager.loadSound("lose_arena");for(T=v;T>f;T--){e.query(".arena_point_wrap_"+(T-1)+" .arena_white").style("opacity",1);e.query(".arena_point_wrap_"+(T-1)+" .arena_shadow").style("opacity",0);A=e.query(".arena_point_wrap_"+(T-1)+" .arena_colored")[0],k=this.slideToObjectPos(A,A.parentNode,0,500);e.connect(k,"onEnd",(function(t){e.destroy(t);playSound("lose_arena");var i=e.query(".splash_block .remain_arena_points")[0];i&&(i.innerHTML=toint(i.innerHTML)+1)}));b.push(k)}}b.push(e.fadeIn({node:"continue_btn_"+t.id,duration:700}));e.fx.chain(b).play();e.connect($("continue_btn_"+t.id),"onclick",this,"onDisplayNextSplashNotif")}else if(31==toint(t.news_type)){e.style("splashedNotifications_overlay","display","none");var j=t.args[20];setTimeout((function(){gotourl("penalty?id="+j+"&n="+t.id)}),500)}else if(32==toint(t.news_type)){e.style("splashedNotifications_overlay","display","none");var S=t.args[21];setTimeout((function(){gotourl("karmalimit?limit="+S+"&n="+t.id)}),500)}else this.displayNextSplashNotif()}else e.fadeOut({node:"splashedNotifications_overlay",duration:500,onEnd:function(){e.style("splashedNotifications_overlay","display","none")}}).play()},onNewsRead:function(t){if($("splash_trophy_"+t))if(e.hasClass("splash_trophy_"+t,"to_be_destroyed"));else{this.fadeOutAndDestroy("splash_trophy_"+t);this.displayNextSplashNotif()}else{this.splashNotifRead||(this.splashNotifRead={});this.splashNotifRead[t]=!0}},onDisplayNextSplashNotif:function(t){e.stopEvent(t);var i=t.currentTarget.id.split("_"),n=i[2];if("continue"==i[0]){var o={id:n};this.ajaxcall("/message/board/markread.html",o,this,(function(){}))}else if("skip"==i[0]){var a=n+";";for(var s in this.splashNotifToDisplay)a+=this.splashNotifToDisplay[s].id+";";this.ajaxcall("/message/board/markreads.html",{ids:a},this,(function(){}));this.splashNotifToDisplay=[]}e.addClass("splash_trophy_"+n,"to_be_destroyed");this.fadeOutAndDestroy("splash_trophy_"+n);this.displayNextSplashNotif()},inactivityTimerIncrement:function(){this.browser_inactivity_time+=1;if(this.browser_inactivity_time>120&&0==this.bInactiveBrowser){this.bInactiveBrowser=!0;"undefined"!=typeof bgaConfig&&bgaConfig.webrtcEnabled&&null!==this.room&&this.doLeaveRoom();if(this.socket){this.socket.close();this.infoDialog(__("lang_mainsite","Please click the button below to continue."),__("lang_mainsite","Are you still there?"),(function(){window.location.reload()}),!0)}}},resetInactivityTimer:function(){this.browser_inactivity_time=0},onForceBrowserReload:function(){if(this.socket){this.socket.close();this.warningDialog(__("lang_mainsite","Due to a BGA upgrade, we have to ask you to reload this page to continue."),(function(){window.location.reload()}))}},onDebugPing:function(){var e="_";$("bga_release_id")&&(e=$("bga_release_id").innerHTML);this.ajaxcall("/table/table/debugPing.html",{bgaversion:e},this,(function(e){}))},onNewRequestToken:function(e){void 0!==e.args.request_token&&void 0!==bgaConfig.requestToken&&(bgaConfig.requestToken=e.args.request_token)},onMuteSound:function(t=!0){if(1==localStorage.getItem("sound_muted")){soundManager.bMuteSound=!0;if(null!==$("toggleSound_icon")){e.removeClass("toggleSound_icon","fa-volume-up");e.addClass("toggleSound_icon","fa-volume-off")}null!==$("soundVolumeControl")&&($("soundVolumeControl").value=0)}else{soundManager.bMuteSound=!1;if(null!==$("toggleSound_icon")){e.addClass("toggleSound_icon","fa-volume-up");e.removeClass("toggleSound_icon","fa-volume-off")}null!==$("soundVolumeControl")&&($("soundVolumeControl").value=100*soundManager.volume);t&&playSound("tac")}},onSetSoundVolume:function(e=!0){var t=localStorage.getItem("sound_volume");soundManager.volume=t/100;this.onMuteSound(e)},onToggleSound:function(e){e.preventDefault();i.stores.userVolume.update((e=>{e.volumeMuted=!e.volumeMuted;return e}))},onDisplaySoundControls:function(t){clearTimeout(this.hideSoundControlsTimer);this.displaySoundControlsTimer=setTimeout(e.hitch(this,"displaySoundControls"),200)},displaySoundControls:function(t){e.hasClass("soundControls","soundControlsHidden")&&e.removeClass("soundControls","soundControlsHidden")},onHideSoundControls:function(t){clearTimeout(this.displaySoundControlsTimer);this.hideSoundControlsTimer=setTimeout(e.hitch(this,"hideSoundControls"),200)},hideSoundControls:function(){null===$("soundControls")||e.hasClass("soundControls","stickySoundControls")||e.hasClass("soundControls","soundControlsHidden")||e.addClass("soundControls","soundControlsHidden")},onStickSoundControls:function(e){clearTimeout(this.hideSoundControlsTimer)},onUnstickSoundControls:function(e){this.onHideSoundControls(e)},onSoundVolumeControl:function(e){if(null!==$("soundVolumeControl")){var t=$("soundVolumeControl").value;$("soundVolumeControl").blur();i.stores.userVolume.update((e=>{e.volume=+t;return e}))}},displayRatingContent:function(t,i){this.rating_step1=new ebg.popindialog;this.rating_step1.create("rating_step1");"video"==t?this.rating_step1.setTitle(__("lang_mainsite","Rate this BGA video chat")):"audio"==t?this.rating_step1.setTitle(__("lang_mainsite","Rate this BGA audio chat")):"support"==t?this.rating_step1.setTitle(__("lang_mainsite","Rate your conversation with BGA")):this.rating_step1.setTitle(__("lang_mainsite","Rate this BGA game adaptation"));this.playerRating=i;var n="<div id='rating_step1'>";n+='<div class="stars_list">';if("support"==t){n+='<a href="#" id="rating_1" class="fa fa-5x rating_star">&#128544;</a> ';n+='<a href="#" id="rating_2" class="fa fa-5x rating_star">&#128577;</a> ';n+='<a href="#" id="rating_3" class="fa fa-5x rating_star">&#128528;</a> ';n+='<a href="#" id="rating_4" class="fa fa-5x rating_star">&#128515;</a> ';n+='<a href="#" id="rating_5" class="fa fa-5x rating_star">&#129321;</a> '}else for(var o=1;o<=5;o++)n+='<i id="rating_'+o+'" class="fa fa-star-o fa-5x rating_star"></i>';n+="</div>";n+='<div id="rating_explanation">&nbsp;</div>';n+="<div id='rating_skip'>";n+="support"==t?"<a href='#' class='bgabutton bgabutton_blue' id='confirm_rating'>"+__("lang_mainsite","Confirm")+"</a>":"<a href='#' class='bgabutton bgabutton_gray' id='skip_rating'>"+__("lang_mainsite","Skip")+"</a>";n+="</div>";n+="</div>";this.rating_step1.setContent(n);this.rating_step1.show();var a="onGameRatingEnter";"video"===t?a="onVideoRatingEnter":"audio"===t?a="onAudioRatingEnter":"support"===t&&(a="onSupportRatingEnter");if("support"!==t){e.query(".rating_star").connect("onmouseenter",this,a);e.query(".rating_star").connect("onmouseleave",this,"onRatingLeave")}var s="onGameRatingClick";"audio"===t?s="onAudioRatingClick":"video"===t?s="onVideoRatingClick":"support"===t&&(s="onSupportRatingClick");e.query(".rating_star").connect("onclick",this,s);if("support"==t){this.processRatingEnter(this.playerRating.rating,"support");e.connect($("confirm_rating"),"onclick",this,(function(){this.rating_step1.hide();this.sendRating(t);this.showMessage(_("Thanks for your feeback! Let's go back to games!"),"info");gotourl("welcome")}))}else e.connect($("skip_rating"),"onclick",this,(function(){this.rating_step1.hide();this.sendRating(t)}))},sendRating:function(e){var t="/table/table/rateGame.html";if("audio"==e||"video"==e){this.mediaChatRating=!1;t="/videochat/videochat/rateChat.html"}"support"==e&&(t="/support/support/rateSupport.html");this.ajaxcall(t,this.playerRating,this,(function(e){}))},onGameRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"game")},onVideoRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"video")},onAudioRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"audio")},onSupportRatingEnter:function(e){var t=e.currentTarget.id.substr(7);this.processRatingEnter(t,"support")},processRatingEnter:function(t,i){if("support"==i){e.query(".rating_star").style("opacity","0.5");e.style("rating_"+t,"opacity","1")}else{for(var n=1;n<=t;n++){e.removeClass("rating_"+n,"fa-star-o");e.addClass("rating_"+n,"fa-star")}for(;n<=5;n++){e.removeClass("rating_"+n,"fa-star");e.addClass("rating_"+n,"fa-star-o")}}if(1==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The game adaptation is unplayable"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The video chat is unusable"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The audio chat is unusable"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","My experience has been bad. BGA should do better."))}else if(2==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I can play but there are some major problems"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I can use the video chat but there are some major problems"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I can use the audio chat but there are some major problems"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","I am disappointed, I expected a better support."))}else if(3==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Acceptable but could be way better"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Acceptable but could be way better"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Acceptable but could be way better"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","My experience has been standard. Nothing special."))}else if(4==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The game adaptation is good, but some details must be fixed"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The video chat is good, but some minor issues should be fixed"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The audio chat is good, but some minor issues should be fixed"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","Really good experience, thank you!"))}else if(5==toint(t)){"game"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The game adaptation is PERFECT"));"video"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The video chat is EXCELLENT"));"audio"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","The audio chat is EXCELLENT"));"support"==i&&($("rating_explanation").innerHTML=__("lang_mainsite","My experience has been stellar! A big hug to the team!"))}},onRatingLeave:function(t){t.currentTarget.id.substr(11);for(var i=1;i<=5;i++){e.removeClass("rating_"+i,"fa-star");e.addClass("rating_"+i,"fa-star-o")}$("rating_explanation").innerHTML="&nbsp;"},onVideoRatingClick:function(e){this.completeRatingClick(e,"video")},onAudioRatingClick:function(e){this.completeRatingClick(e,"audio")},onGameRatingClick:function(e){this.completeRatingClick(e,"game")},onSupportRatingClick:function(e){var t=e.currentTarget.id.substr(7);this.playerRating.rating=t;this.processRatingEnter(t,"support")},completeRatingClick:function(e,t){var i=e.currentTarget.id.substr(7);this.playerRating.rating=i;this.sendRating(t);this.rating_step1.hide();5==i?"game"===t?this.gamecanapprove?this.showGameRatingDialog_step4():this.gameisalpha?this.showMessage(_("Thanks for your feedback!"),"info"):this.showRatingDialog_step3(t):this.showMessage(_("Thanks for your feedback!"),"info"):this.showRatingDialog_step2(t)},showRatingDialog_step2:function(t){this.rating_step2=new ebg.popindialog;this.rating_step2.create("rating_step2");this.rating_step2.setTitle(__("lang_mainsite","What is the main thing we must improve?"));var i="<div id='rating_step2'>";if("game"==t){i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_bugs'><i class='fa fa-bug'></i> "+__("lang_mainsite","Fix the bugs!")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_ux'><i class='fa fa fa-hand-o-up'></i> "+__("lang_mainsite","Improve the interface")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_expansion'><i class='fa fa fa-puzzle-piece'></i> "+__("lang_mainsite","Add game expansions")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_dislike'><i class='fa fa fa-meh-o'></i> "+__("lang_mainsite","Nothing: I just dislike the game itself")+"</a></p>"}if("audio"==t||"video"==t){i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_quality'><i class='fa fa-bar-chart'></i> "+__("lang_mainsite","Audio or video quality could be better")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_ux'><i class='fa fa fa-hand-o-up'></i> "+__("lang_mainsite","Improve the interface")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_someonemissing'><i class='fa fa-user-times'></i> "+__("lang_mainsite","It worked but someone was missing")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_didntwork'><i class='fa fa fa-bug'></i> "+__("lang_mainsite","Sorry, it didn't work at all")+"</a></p>";i+="<p class='issue_wrap'><a href='#' class='rating_issue bgabutton bgabutton_gray' id='issue_dislike'><i class='fa fa fa-meh-o'></i> "+__("lang_mainsite","Nothing: I just disliked the experience")+"</a></p>"}i+="<div id='rating_skip'>";i+="<a href='#' class='bgabutton bgabutton_gray' id='skip_rating_2'>"+__("lang_mainsite","Skip")+"</a>";i+="</div>";i+="</div>";this.rating_step2.setContent(i);this.rating_step2.show();var n="onGameRatingClickIssue";"audio"===t?n="onAudioRatingClickIssue":"video"===t&&(n="onVideoRatingClickIssue");e.query(".rating_issue").connect("onclick",this,n);e.connect($("skip_rating_2"),"onclick",this,(function(){this.rating_step2.hide();this.sendRating(t);"game"===t?this.showMessage(_("Thanks for helping us to make this game adaptation better!"),"info"):this.showMessage(_("Thanks for helping us to make the audio/video chat better!"),"info")}))},onAudioRatingClickIssue:function(e){this.completeRatingClickIssue(e,"audio")},onVideoRatingClickIssue:function(e){this.completeRatingClickIssue(e,"video")},onGameRatingClickIssue:function(e){this.completeRatingClickIssue(e,"game")},completeRatingClickIssue:function(e,t){var i=e.currentTarget.id.substr(6);this.playerRating.issue=i;this.sendRating(t);this.rating_step2.hide();"game"==t?this.showRatingDialog_step3(t):this.showMessage(_("Thanks for your feedback!"),"info")},showRatingDialog_step3:function(t){this.rating_step3=new ebg.popindialog;this.rating_step3.create("rating_step3");"support"===t?this.rating_step3.setTitle(__("lang_mainsite","One last thing: any message for our team?")):"game"==t&&this.gameisalpha?this.rating_step3.setTitle(__("lang_mainsite","Do you have any other feedback to give?")):this.rating_step3.setTitle(__("lang_mainsite","One last thing: any message for the developer?"));var i="<div id='rating_step3'>";if("game"==t&&this.gameisalpha){i+="<div style='text-align:center'>";i+="<br />";i+=__("lang_mainsite","Did you run into an issue while playing?");i+="<br />";i+="<a href='/bug?id=0&table="+this.table_id+"' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Report a bug")+"</a>";i+="<br />";i+=__("lang_mainsite","Do you have an idea to improve the adaptation?");i+="<br />";i+="<a href='/bug?id=0&table="+this.table_id+"&suggest' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Make a suggestion")+"</a>";i+="<br />";if(""!=this.game_group){i+=__("lang_mainsite","Or you would like to discuss something with the community?");i+="<br />";i+="<a href='/group?id="+this.game_group+"' class='bgabutton bgabutton_blue'>"+__("lang_mainsite","Discuss with the group")+"</a>";i+="<br />"}i+="</div>"}else{i+="<p><textarea id='rating_comment'></textarea></p>";i+="<div style='text-align:center'>";i+="<a href='#' class='bgabutton bgabutton_blue' id='rating_post_comment'>"+__("lang_mainsite","Send message")+"</a>";i+="</div>"}i+="<div id='rating_skip'>";i+="<a href='#' class='bgabutton bgabutton_gray' id='skip_rating_3'>"+__("lang_mainsite","Skip")+"</a>";i+="</div>";if("game"==t&&!this.gameisalpha){i+="<div id='rating_alternative'>";i+=__("lang_mainsite","You may alternatively want to <a href='%s'>report a bug</a>").replace("%s","/bug?id=0&table="+this.table_id);i+="</div>"}i+="</div>";this.rating_step3.setContent(i);this.rating_step3.show();var n=__("lang_mainsite","Thanks for helping us to make this game adaptation better!");"audio"!=t&&"video"!=t||(n=__("lang_mainsite","Thanks for helping us to make the audio/video chat better!"));"support"==t&&(n=__("lang_mainsite","Thanks for helping us to improve our player support!"));null!==$("rating_post_comment")&&e.connect($("rating_post_comment"),"onclick",this,(function(){this.playerRating.text=$("rating_comment").value;this.rating_step3.hide();this.sendRating(t);this.showMessage(_(n),"info")}));null!==$("skip_rating_3")&&e.connect($("skip_rating_3"),"onclick",this,(function(){this.rating_step3.hide();this.sendRating(t);this.showMessage(_(n),"info")}))},showGameRatingDialog_step4:function(){this.rating_step4=new ebg.popindialog;this.rating_step4.create("rating_step4");this.rating_step4.setTitle(__("lang_mainsite","You are a reviewer!"));var t="<div id='rating_step4'>";t+="<p>"+__("lang_mainsite","You have given a 5 star rating. Do you want to approve this game for beta?")+"</p>";t+="<div style='text-align:center'>";t+="<a href='#' class='bgabutton bgabutton_blue' id='rating_go_approve'>"+__("lang_mainsite","Ok, let's go!")+"</a>";t+="</div>";t+="<div id='rating_skip'>";t+="<a href='#' class='bgabutton bgabutton_gray' id='skip_rating_4'>"+__("lang_mainsite","Skip")+"</a>";t+="</div>";t+="</div>";this.rating_step4.setContent(t);this.rating_step4.show();e.connect($("rating_go_approve"),"onclick",this,(function(){this.rating_step4.hide();window.location="/reviewer?game="+this.game_name+"&approve"}));e.connect($("skip_rating_4"),"onclick",this,(function(){this.rating_step4.hide();this.showRatingDialog_step3("game")}))},recordMediaStats:function(e,t){this.room&&this.ajaxcall("/videochat/videochat/recordStat.html",{player:e,room:this.room,startStop:t,media:this.mediaConstraints.video?"video":"audio"},this,(function(e){}),(function(e){}))}})}))},"ebg/core/soundManager":function(){define(["dojo","dojo/_base/declare","ebg/core/core"],(function(e,t){return t("ebg.core.soundManager",null,{constructor:function(){this.html5=!0;this.useOgg=!0;this.bMuteSound=!1;this.soundMode=0;this.initOk=!1;this.volume=.8},init:function(){if(!!document.createElement("audio").canPlayType){this.html5=!0;this.initHtml5Audio()}return this.html5},initHtml5Audio:function(){if(!!document.createElement("audio").canPlayType){var e=document.createElement("audio");if(e.canPlayType){if(!!e.canPlayType&&""!=e.canPlayType('audio/ogg; codecs="vorbis"')){this.html5=!0;this.useOgg=!0;this.initOk=!0}else{this.useOgg=!1;if(!!e.canPlayType&&""!=e.canPlayType("audio/mpeg")){this.html5=!0;this.initOk=!0}}}}},getSoundIdFromEvent:function(e){return soundManager.sounds[e]?soundManager.sounds[e]:e},getSoundTag:function(e){return this.useOgg?"audiosrc_o_"+e:"audiosrc_"+e},doPlay:function(e){if(!this.bMuteSound){var t=this.getSoundIdFromEvent(e.id);this.doPlayFile(t)}},loadSound:function(t){var i=this.getSoundTag(t);if(!$(i)){var n=t;this.useOgg?n+=".ogg":n+=".mp3";e.place(e.trim(e.string.substitute(jstpl_audiosrc,{id:i,file:n})),"audiosources")}},doPlayFile:function(e){var t=this.getSoundTag(e);this.loadSound(e);if($(t)){$(t).volume=this.volume;$(t).currentTime=0;$(t).play()}},stop:function(e){var t=this.getSoundIdFromEvent(e.id),i=this.getSoundTag(t);$(i)&&$(i).pause()},onChangeSound:function(e){this.sounds[e.args.event]=e.args.file}})}))},"dijit/form/Select":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../DropDownMenu","../MenuItem","../MenuSeparator","../Tooltip","../_KeyNavMixin","../registry","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m,g,_,f,v){var b=t("dijit.form._SelectMenu",u,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,"selectstart",(function(e){e.preventDefault();e.stopPropagation()})))},focus:function(){var t=!1,i=this.parentWidget.value;r.isArray(i)&&(i=i[i.length-1]);i&&e.forEach(this.parentWidget._getChildren(),(function(e){if(e.option&&i===e.option.value){t=!0;this.focusChild(e,!1)}}),this);t||this.inherited(arguments)}}),y=t("dijit.form.Select"+(d("dojo-bidi")?"_NoBidi":""),[c,h,_],{baseClass:"dijitSelect dijitValidationTextBox",templateString:v,_buttonInputDisabled:d("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var e=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[e>=0?e:0].value)}this.dropDown=new b({id:this.id+"_menu",parentWidget:this});n.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(e){if(e.value||e.label){var t=r.hitch(this,"_setValueAttr",e),i=new p({option:e,label:("text"===this.labelType?(e.label||"").toString().replace(/&/g,"&amp;").replace(/</g,"&lt;"):e.label)||this.emptyLabel,onClick:t,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:e.disabled||!1});i.focusNode.setAttribute("role","option");return i}return new m({ownerDocument:this.ownerDocument})},_addOptionItem:function(e){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(e))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(e){}},focusChild:function(e){e&&this.set("value",e.option)},_getFirst:function(){var e=this._getChildren();return e.length?e[0]:null},_getLast:function(){var e=this._getChildren();return e.length?e[e.length-1]:null},childSelector:function(e){return(e=f.byNode(e))&&e.getParent()==this.dropDown},onKeyboardSearch:function(e,t,i,n){e&&this.focusChild(e)},_loadChildren:function(t){if(!0===t){if(this.dropDown){delete this.dropDown.focusedChild;this.focusedChild=null}if(this.options.length)this.inherited(arguments);else{e.forEach(this._getChildren(),(function(e){e.destroyRecursive()}));var i=new p({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(i)}}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(e){this.inherited(arguments);i.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(e){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(e){this._set("required",e);this.focusNode.setAttribute("aria-required",e);this._refreshState()},_setOptionsAttr:function(e){this._isLoaded=!1;this._set("options",e)},_setDisplay:function(e){var t=("text"===this.labelType?(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;"):e)||this.emptyLabel;this.containerNode.innerHTML='<span role="option" aria-selected="true" class="dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'">'+t+"</span>"},validate:function(e){var t=this.disabled||this.isValid(e);this._set("state",t?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",t?"false":"true");var i=t?"":this._missingMsg;i&&this.focused&&this._hasBeenBlurred?g.show(i,this.domNode,this.tooltipPosition,!this.isLeftToRight()):g.hide(this.domNode);this._set("message",i);return t},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);g.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=a.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,"selectstart",(function(e){e.preventDefault();e.stopPropagation()})));this.domNode.setAttribute("aria-expanded","false");var e=this._keyNavCodes;delete e[s.LEFT_ARROW];delete e[s.RIGHT_ARROW]},_setStyleAttr:function(e){this.inherited(arguments);n.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(e){this._loadChildren(!0);this._isLoaded=!0;e()},destroy:function(e){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(e);delete this.dropDown}g.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){g.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});d("dojo-bidi")&&(y=t("dijit.form.Select",y,{_setDisplay:function(e){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));y._Menu=b;function w(e){return function(t){this._isLoaded?this.inherited(e,arguments):this.loadDropDown(r.hitch(this,e,t))}}y.prototype._onContainerKeydown=w("_onContainerKeydown");y.prototype._onContainerKeypress=w("_onContainerKeypress");return y}))},"dijit/form/_FormSelectWidget":function(){define(["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u){var p=o("dijit.form._FormSelectWidget",u,{multiple:!1,options:null,store:null,_setStoreAttr:function(e){this._created&&this._deprecatedSetStore(e)},query:null,_setQueryAttr:function(e){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:e})},queryOptions:null,_setQueryOptionsAttr:function(e){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:e})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,onLoadDeferred:null,getOptions:function(t){var i=this.options||[];if(null==t)return i;if(l.isArrayLike(t))return e.map(t,"return this.getOptions(item);",this);l.isString(t)&&(t={value:t});l.isObject(t)&&(e.some(i,(function(e,i){for(var n in t)if(!(n in e)||e[n]!=t[n])return!1;t=i;return!0}))||(t=-1));return t>=0&&t<i.length?i[t]:null},addOption:function(t){e.forEach(l.isArrayLike(t)?t:[t],(function(e){e&&l.isObject(e)&&this.options.push(e)}),this);this._loadChildren()},removeOption:function(t){var i=this.getOptions(l.isArrayLike(t)?t:[t]);e.forEach(i,(function(t){if(t){this.options=e.filter(this.options,(function(e){return e.value!==t.value||e.label!==t.label}));this._removeOptionItem(t)}}),this);this._loadChildren()},updateOption:function(t){e.forEach(l.isArrayLike(t)?t:[t],(function(e){var t,i=this.getOptions({value:e.value});if(i)for(t in e)i[t]=e[t]}),this);this._loadChildren()},setStore:function(e,t,i){r.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.","","2.0");this._deprecatedSetStore(e,t,i)},_deprecatedSetStore:function(o,a,s){var r=this.store;s=s||{};if(r!==o){for(var d;d=this._notifyConnections.pop();)d.remove();if(!o.get){l.mixin(o,{_oldAPI:!0,get:function(e){var i=new t;this.fetchItemByIdentity({identity:e,onItem:function(e){i.resolve(e)},onError:function(e){i.reject(e)}});return i.promise},query:function(e,i){var n=new t((function(){o.abort&&o.abort()}));n.total=new t;var o=this.fetch(l.mixin({query:e,onBegin:function(e){n.total.resolve(e)},onComplete:function(e){n.resolve(e)},onError:function(e){n.reject(e)}},i));return new h(n)}});o.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[i.after(o,"onNew",l.hitch(this,"_onNewItem"),!0),i.after(o,"onDelete",l.hitch(this,"_onDeleteItem"),!0),i.after(o,"onSet",l.hitch(this,"_onSetItem"),!0)])}this._set("store",o)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null}s.query&&this._set("query",s.query);s.queryOptions&&this._set("queryOptions",s.queryOptions);if(o&&o.query){this._loadingStore=!0;this.onLoadDeferred=new t;this._queryRes=o.query(this.query,this.queryOptions);c(this._queryRes,l.hitch(this,(function(t){if(this.sortByLabel&&!s.sort&&t.length)if(o.getValue)t.sort(n.createSortFunction([{attribute:o.getLabelAttributes(t[0])[0]}],o));else{var i=this.labelAttr;t.sort((function(e,t){return e[i]>t[i]?1:t[i]>e[i]?-1:0}))}s.onFetch&&(t=s.onFetch.call(this,t,s));e.forEach(t,(function(e){this._addOptionForItem(e)}),this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(l.hitch(this,(function(e,t,i){if(t==i)this._onSetItem(e);else{-1!=t&&this._onDeleteItem(e);-1!=i&&this._onNewItem(e)}})),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:a);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(t):this._loadChildren();this.onLoadDeferred.resolve(!0);this.onSetStore()})),l.hitch(this,(function(e){this.onLoadDeferred.reject(e)})))}return r},_setValueAttr:function(t,i){this._onChangeActive||(i=null);if(this._loadingStore)this._pendingValue=t;else if(null!=t){t=l.isArrayLike(t)?e.map(t,(function(e){return l.isObject(e)?e:{value:e}})):l.isObject(t)?[t]:[{value:t}];t=e.filter(this.getOptions(t),(function(e){return e&&e.value}));var n=this.getOptions()||[];this.multiple||t[0]&&t[0].value||!n.length||(t[0]=n[0]);e.forEach(n,(function(i){i.selected=e.some(t,(function(e){return e.value===i.value}))}));var o=e.map(t,(function(e){return e.value}));if(void 0!==o&&void 0!==o[0]){var a=e.map(t,(function(e){return e.label}));this._setDisplay(this.multiple?a:a[0]);this.inherited(arguments,[this.multiple?o:o[0],i]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var t=e.map([].concat(this.get("selectedOptions")),(function(e){return e&&"label"in e?e.label:e?e.value:null}),this);return this.multiple?t:t[0]},_setDisplayedValueAttr:function(e){this.set("value",this.getOptions("string"==typeof e?{label:e}:e))},_loadChildren:function(){if(!this._loadingStore){e.forEach(this._getChildren(),(function(e){e.destroyRecursive()}));e.forEach(this.options,this._addOptionItem,this);this._updateSelection()}},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var t=[].concat(this.value);if(t&&t[0]){var i=this;e.forEach(this._getChildren(),(function(n){var o=e.some(t,(function(e){return n.option&&e===n.option.value}));o&&!i.multiple&&(i.focusedChild=n);s.toggle(n.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),o);n.domNode.setAttribute("aria-selected",o?"true":"false")}),this)}},_getValueFromOpts:function(){var t=this.getOptions()||[];if(!this.multiple&&t.length){var i=e.filter(t,(function(e){return e.selected}))[0];if(i&&i.value)return i.value;t[0].selected=!0;return t[0].value}return this.multiple?e.map(e.filter(t,(function(e){return e.selected})),(function(e){return e.value}))||[]:""},_onNewItem:function(e,t){t&&t.parent||this._addOptionForItem(e)},_onDeleteItem:function(e){var t=this.store;this.removeOption({value:t.getIdentity(e)})},_onSetItem:function(e){this.updateOption(this._getOptionObjForItem(e))},_getOptionObjForItem:function(e){var t=this.store,i=this.labelAttr&&this.labelAttr in e?e[this.labelAttr]:t.getLabel(e);return{value:i?t.getIdentity(e):null,label:i,item:e}},_addOptionForItem:function(e){var t=this.store;if(!t.isItemLoaded||t.isItemLoaded(e)){var i=this._getOptionObjForItem(e);this.addOption(i)}else t.loadItem({item:e,onItem:function(e){this._addOptionForItem(e)},scope:this})},constructor:function(e){this._oValue=(e||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);a.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?d("> *",this.srcNodeRef).map((function(e){return"separator"===e.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:e.getAttribute("data-"+r._scopeName+"-value")||e.getAttribute("value"),label:String(e.innerHTML),selected:e.getAttribute("selected")||!1,disabled:e.getAttribute("disabled")||!1}}),this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);i.after(this,"onChange",l.hitch(this,"_updateSelection"));var e=this.store;if(e&&(e.getIdentity||e.getFeatures()["dojo.data.api.Identity"])){this.store=null;this._deprecatedSetStore(e,this._oValue,{query:this.query,queryOptions:this.queryOptions})}this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var e;e=this._notifyConnections.pop();)e.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null}this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}});return p}))},"dojo/data/util/sorter":function(){define(["../../_base/lang"],(function(e){var t={};e.setObject("dojo.data.util.sorter",t);t.basicComparator=function(e,t){var i=-1;null===e&&(e=void 0);null===t&&(t=void 0);e==t?i=0:(e>t||null==e)&&(i=1);return i};t.createSortFunction=function(e,i){var n,o=[];function a(e,t,i,n){return function(o,a){var s=n.getValue(o,e),r=n.getValue(a,e);return t*i(s,r)}}for(var s=i.comparatorMap,r=t.basicComparator,l=0;l<e.length;l++){var d=(n=e[l]).attribute;if(d){var c=n.descending?-1:1,h=r;if(s){"string"!=typeof d&&"toString"in d&&(d=d.toString());h=s[d]||r}o.push(a(d,c,h,i))}}return function(e,t){for(var i=0;i<o.length;){var n=o[i++](e,t);if(0!==n)return n}return 0}};return t}))},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],(function(e,t,i,n){return e("dijit.DropDownMenu",n,{templateString:i,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(e){this._moveToPopup(e);e.stopPropagation();e.preventDefault()},_onLeftArrow:function(e){if(this.parentMenu)this.parentMenu._isMenuBar?this.parentMenu.focusPrev():this.onCancel(!1);else{e.stopPropagation();e.preventDefault()}}})}))},"dijit/_MenuBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/lang","dojo/mouse","dojo/on","dojo/window","./a11yclick","./registry","./_Widget","./_CssStateMixin","./_KeyNavContainer","./_TemplatedMixin"],(function(e,t,i,n,o,a,s,r,l,d,c,h,u,p,m){return t("dijit._MenuBase",[h,m,p,u],{selected:null,_setSelectedAttr:function(e){if(this.selected!=e){if(this.selected){this.selected._setSelected(!1);this._onChildDeselect(this.selected)}e&&e._setSelected(!0);this._set("selected",e)}},activated:!1,_setActivatedAttr:function(e){o.toggle(this.domNode,"dijitMenuActive",e);o.toggle(this.domNode,"dijitMenuPassive",!e);this._set("activated",e)},parentMenu:null,popupDelay:500,passivePopupDelay:1/0,autoFocus:!1,childSelector:function(e){var t=c.byNode(e);return e.parentNode==this.containerNode&&t&&t.focus},postCreate:function(){var e=this,t="string"==typeof this.childSelector?this.childSelector:a.hitch(this,"childSelector");this.own(r(this.containerNode,r.selector(t,s.enter),(function(){e.onItemHover(c.byNode(this))})),r(this.containerNode,r.selector(t,s.leave),(function(){e.onItemUnhover(c.byNode(this))})),r(this.containerNode,r.selector(t,d),(function(t){e.onItemClick(c.byNode(this),t);t.stopPropagation()})),r(this.containerNode,r.selector(t,"focusin"),(function(){e._onItemFocus(c.byNode(this))})));this.inherited(arguments)},onKeyboardSearch:function(e,t,i,n){this.inherited(arguments);e&&(-1==n||e.popup&&1==n)&&this.onItemClick(e,t)},_keyboardSearchCompare:function(e,t){return e.shortcutKey?t==e.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(e){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,e);else{var t=this._getTopMenu();t&&t._isMenuBar&&t.focusNext()}},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(e){if(this.activated){this.set("selected",e);!e.popup||e.disabled||this.hover_timer||(this.hover_timer=this.defer((function(){this._openItemPopup(e)}),this.popupDelay))}else if(this.passivePopupDelay<1/0){this.passive_hover_timer&&this.passive_hover_timer.remove();this.passive_hover_timer=this.defer((function(){this.onItemClick(e,{type:"click"})}),this.passivePopupDelay)}this._hoveredChild=e;e._set("hovering",!0)},_onChildDeselect:function(e){this._stopPopupTimer();if(this.currentPopupItem==e){this._stopPendingCloseTimer();this._pendingClose_timer=this.defer((function(){this._pendingClose_timer=null;this.currentPopupItem=null;e._closePopup()}),this.popupDelay)}},onItemUnhover:function(e){this._hoveredChild==e&&(this._hoveredChild=null);if(this.passive_hover_timer){this.passive_hover_timer.remove();this.passive_hover_timer=null}e._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var e=this;e.parentMenu;e=e.parentMenu);return e},onItemClick:function(e,t){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(e);if(e.disabled)return!1;if(e.popup){this.set("selected",e);this.set("activated",!0);var i=/^key/.test(t._origType||t.type)||0==t.clientX&&0==t.clientY;this._openItemPopup(e,i)}else{this.onExecute();e._onClick?e._onClick(t):e.onClick(t)}},_openItemPopup:function(e,t){if(e!=this.currentPopupItem){if(this.currentPopupItem){this._stopPendingCloseTimer();this.currentPopupItem._closePopup()}this._stopPopupTimer();var i=e.popup;i.parentMenu=this;this.own(this._mouseoverHandle=r.once(i.domNode,"mouseover",a.hitch(this,"_onPopupHover")));var n=this;e._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){t&&n.focusChild(e);n._cleanUp()},onExecute:a.hitch(this,"_cleanUp",!0),onClose:function(){if(n._mouseoverHandle){n._mouseoverHandle.remove();delete n._mouseoverHandle}}},t);this.currentPopupItem=e}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopupItem){if(this.focused){n.set(this.selected.focusNode,"tabIndex",this.tabIndex);this.selected.focusNode.focus()}this.currentPopupItem._closePopup();this.currentPopupItem=null}},_onItemFocus:function(e){this._hoveredChild&&this._hoveredChild!=e&&this.onItemUnhover(this._hoveredChild);this.set("selected",e)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(e){this._closeChild();void 0===this.isShowingNow&&this.set("activated",!1);e&&this.set("selected",null)}})}))},"dijit/MenuItem":function(){define(["dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/kernel","dojo/sniff","dojo/_base/lang","./_Widget","./_TemplatedMixin","./_Contained","./_CssStateMixin","dojo/text!./templates/MenuItem.html"],(function(e,t,i,n,o,a,s,r,l,d,c,h){var u=e("dijit.MenuItem"+(a("dojo-bidi")?"_NoBidi":""),[r,l,d,c],{templateString:h,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(e){this._set("label",e);var t,i="",n=e.search(/{\S}/);if(n>=0){i=e.charAt(n+1);var o=e.substr(0,n),a=e.substr(n+3);t=o+i+a;e=o+'<span class="dijitMenuItemShortcutKey">'+i+"</span>"+a}else t=e;this.domNode.setAttribute("aria-label",t+" "+this.accelKey);this.containerNode.innerHTML=e;this._set("shortcutKey",i)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(e){e&&!("label"in this.params)&&this._set("label",e.innerHTML)},buildRendering:function(){this.inherited(arguments);var e=this.id+"_text";i.set(this.containerNode,"id",e);this.accelKeyNode&&i.set(this.accelKeyNode,"id",this.id+"_accel");t.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==a("ie")&&this.containerNode.focus();this.focusNode.focus()}catch(e){}},_setSelected:function(e){n.toggle(this.domNode,"dijitMenuItemSelected",e)},setLabel:function(e){o.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",e)},setDisabled:function(e){o.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",e)},_setDisabledAttr:function(e){this.focusNode.setAttribute("aria-disabled",e?"true":"false");this._set("disabled",e)},_setAccelKeyAttr:function(e){if(this.accelKeyNode){this.accelKeyNode.style.display=e?"":"none";this.accelKeyNode.innerHTML=e;i.set(this.containerNode,"colSpan",e?"1":"2")}this._set("accelKey",e)}});a("dojo-bidi")&&(u=e("dijit.MenuItem",u,{_setLabelAttr:function(e){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return u}))},"dijit/MenuSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_WidgetBase","./_TemplatedMixin","./_Contained","dojo/text!./templates/MenuSeparator.html"],(function(e,t,i,n,o,a){return e("dijit.MenuSeparator",[i,n,o],{templateString:a,buildRendering:function(){this.inherited(arguments);t.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})}))},"ebg/chatinput":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.chatinput",null,{constructor:function(){this.page=null;this.container_id=null;this.post_url="";this.default_content="";this.input_div=null;this.baseparams={};this.detachType=null;this.detachId=null;this.detachTypeGame=null;this.callbackBeforeChat=null;this.callbackAfterChat=null;this.callbackAfterChatError=null;this.writingNowChannel=null;this.bWritingNow=!1;this.writingNowTimeout=null;this.writingNowTimeoutDelay=8e3;this.lastTimeStartWriting=null;this.max_height=100;this.bIncreaseHeightToTop=!0},create:function(t,i,n,o){this.page=t;this.container_id=i;this.post_url=n;this.default_content=o;if(!$(this.container_id))return!1;e.empty(this.container_id);var a=this.container_id+"_input";this.detachType,this.detachId,this.detachType,this.detachId;"playtable"==this.detachType&&"onclick='window.open(\"/"+this.detachTypeGame+"?detachChatType="+this.detachType+"&table="+this.detachId+'", "notif'+this.detachType+this.detachId+'", "scrollbars=yes,width=280px,height=500px" );return false;\'';e.place("<div class='chatinputctrl'><textarea id='"+a+"' class='chatinput' value='' style='overflow:hidden;resize: none;' rows='1' maxlength='300'  style='resize:none'></textarea></div>",$(this.container_id));this.input_div=$(a);e.connect(this.input_div,"onkeyup",this,"onChatInputKeyUp");e.connect(this.input_div,"onkeypress",this,"onChatInputKeyPress");e.connect(this.input_div,"onfocus",this,"onChatInputFocus");this.input_div.placeholder=o},destroy:function(){$(this.container_id)&&e.empty(this.container_id)},sendMessage:function(){var t=e.clone(this.baseparams);t.msg=this.input_div.value;if(null===this.callbackBeforeChat||this.callbackBeforeChat(t,this.post_url)){void 0!==this.post_url_bis&&(t.no_notif=1);this.page.ajaxcall(this.post_url,t,this,(function(e){this.input_div.value="";this.readaptChatHeight();null!==this.callbackAfterChat&&this.callbackAfterChat(t)}),(function(e){e&&null!==this.callbackAfterChatError&&this.callbackAfterChatError(t)}),"post");if(void 0!==this.post_url_bis){delete t.no_notif;this.page.ajaxcall(this.post_url_bis,t,this,(function(e){}),(function(e){}),"post")}}},onChatInputKeyPress:function(t){t.keyCode==e.keys.ENTER&&e.stopEvent(t)},onChatInputKeyUp:function(t){if(t.keyCode==e.keys.ENTER){e.stopEvent(t);this.input_div.value=this.input_div.value.replace(/(\r\n|\n|\r)/gm,"");this.sendMessage();this.lastTimeStartWriting=null;return!0}var i=Math.floor(Date.now()/1e3);if(null===this.lastTimeStartWriting||i>=this.lastTimeStartWriting+5){void 0!==this.page.socket&&this.page.socket.emit("startWriting",this.writingNowChannel);this.lastTimeStartWriting=i}this.readaptChatHeight();return!1},readaptChatHeight:function(){var t=e.style(this.input_div,"top"),i=e.style(this.input_div,"height");e.style(this.input_div,"height","0px");var n=Math.max(20,Math.min(this.input_div.scrollHeight+1,this.max_height));e.style(this.input_div,"height",n+"px");if(this.bIncreaseHeightToTop){var o=t-(n-i);e.style(this.input_div,"top",o+"px")}},onChatInputFocus:function(e){},onChatInputBlur:function(e){},addContentToInput:function(e){this.input_div.value+=e}})}))},"ebg/thumb":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.thumb",null,{constructor:function(){this.page=null;this.div_id=null;this.div=null;this.value=0;this.target_player=null;this.staticControl=!1;this.bForceThumbDown=!1},create:function(t,i,n,o){this.page=t;this.div_id=i;this.div=$(this.div_id);this.value=toint(o);this.target_player=n;e.style(this.div,"display","inline-block");this.updateControl()},updateControl:function(){if(null!==$(this.div_id)){var t="<div>",i=!1;if(1==this.value||0==this.value&&!this.staticControl){t+='<div class="icon16 icon16_reputup givethumb" id="'+this.div_id+'_up"></div>';i=!0}if(-1==this.value||0==this.value&&!this.staticControl){i&&(t+="&nbsp;&nbsp;");t+='<div class="icon16 icon16_reputdown givethumb" id="'+this.div_id+'_down"></div>'}e.place(t,this.div_id,"only");if(1==this.value){this.page.addTooltip(this.div_id+"_up",__("lang_mainsite","I like and recommend to play with this player"),this.staticControl?"":__("lang_mainsite","Cancel"));this.staticControl||e.connect($(this.div_id+"_up"),"onclick",this,"onCancelOpinion")}else if(0!=this.value||this.staticControl){if(-1==this.value){this.page.addTooltip(this.div_id+"_down",__("lang_mainsite","I dislike to play with this player"),this.staticControl?"":__("lang_mainsite","Cancel"));this.staticControl||e.connect($(this.div_id+"_down"),"onclick",this,"onCancelOpinion")}}else{this.page.addTooltip(this.div_id+"_up","",__("lang_mainsite","I like and recommend to play with this player"));this.page.addTooltip(this.div_id+"_down","",__("lang_mainsite","I dislike to play with this player"));e.connect($(this.div_id+"_up"),"onclick",this,"onGiveThumbUp");e.connect($(this.div_id+"_down"),"onclick",this,"onGiveThumbDown")}}},onCancelOpinion:function(e){e.preventDefault();this.page.ajaxcall("/table/table/changeReputation.html",{player:this.target_player,value:0},this,(function(e){this.value=0;this.updateControl()}))},onGiveThumbUp:function(e){e.preventDefault();this.page.ajaxcall("/table/table/changeReputation.html",{player:this.target_player,value:1},this,(function(e){this.value=1;this.updateControl()}))},onGiveThumbDown:function(t){t.preventDefault();this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog");this.thumbdownDlg.setTitle(__("lang_mainsite","You are about to give a thumb down."));this.thumbdownDlg.setMaxWidth(600);var i='<div id="thumbdownDialog" class="midSizeDialog">';i+=__("lang_mainsite","You are about to give a red thumb.")+"<br/><br/>";i+=__("lang_mainsite","If you confirm BGA will make sure you won't play at the same table again.")+" ";i+=__("lang_mainsite","This player won't be able to send you a message (or speak as a spectator at your table).")+" ";i+="<p>";i+="<a class='bgabutton bgabutton_blue bgabutton_big' id='thumbdown_confirm' href='#'><span>"+__("lang_mainsite","I don't want to play with this player, ever")+"</span></a> ";i+="<a class='bgabutton bgabutton_gray bgabutton_big' id='thumbdown_cancel' href='#'><span>"+__("lang_mainsite","Cancel")+"</span></a>";i+="</p>";i+="</div>";this.thumbdownDlg.setContent(i);this.thumbdownDlg.show();e.connect($("thumbdown_cancel"),"onclick",e.hitch(this.thumbdownDlg,(function(e){e.preventDefault();this.destroy()})));e.connect($("thumbdown_confirm"),"onclick",e.hitch(this,(function(e){e.preventDefault();this.thumbdownDlg.destroy();this.onGiveThumbDownStep2()})))},onGiveThumbDownStep2:function(t){this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog2");this.thumbdownDlg.setTitle(__("lang_mainsite","You are about to give a thumb down."));this.thumbdownDlg.setMaxWidth(600);var i='<div id="thumbdownDialog2" class="midSizeDialog">';i+=__("lang_mainsite","Is this a personal opinion or should everyone avoid this player?")+"<br/><br/>";i+="<p>";i+="<a class='bgabutton bgabutton_blue bgabutton_big' id='thumbdown_personal' href='#'><span>"+__("lang_mainsite","This is my personal opinion")+"</span></a><br/>";i+="<a class='bgabutton bgabutton_blue bgabutton_big' id='thumbdown_community' href='#'><span>"+__("lang_mainsite","Everyone should avoid this person")+"</span></a><br/>";i+="<a class='bgabutton bgabutton_gray bgabutton_big' id='thumbdown_cancel2' href='#'><span>"+__("lang_mainsite","Cancel")+"</span></a>";i+="</p>";i+="</div>";this.thumbdownDlg.setContent(i);this.thumbdownDlg.show();e.connect($("thumbdown_personal"),"onclick",e.hitch(this,(function(e){e.preventDefault();this.thumbdownDlg.destroy();var t={player:this.target_player,value:-1,category:"personal"};this.bForceThumbDown&&(t.f=1);this.page.ajaxcall("/table/table/changeReputation.html",t,this,(function(e){this.value=-1;this.updateControl()}))})));e.connect($("thumbdown_cancel2"),"onclick",e.hitch(this,(function(e){e.preventDefault();this.thumbdownDlg.destroy()})));e.connect($("thumbdown_community"),"onclick",e.hitch(this,(function(e){e.preventDefault();this.thumbdownDlg.destroy();this.onGiveThumbDownStep3()})))},onGiveThumbDownStep3:function(t){this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog3");this.thumbdownDlg.setTitle(__("lang_mainsite","You are about to give a thumb down."));this.thumbdownDlg.setMaxWidth(600);var i='<div id="thumbdownDialog3" class="midSizeDialog">';i+=__("lang_mainsite","Please tell us why nobody should play with X?")+"<br/><br/>";i+="<p>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_chat' href='#'><span>"+__("lang_mainsite","This player is aggressive/insulting or said innapropriate things in the chat")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_slow'  href='#'><span>"+__("lang_mainsite","This player plays too slowly and/or has frequent disconnections")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_leave' href='#'><span>"+__("lang_mainsite","This player quits/abandoned the game on purpose")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_kingmaking' href='#'><span>"+__("lang_mainsite","This player is doing some Kingmaking / team play.")+"</span></a>";i+="<a class='bgabutton bgabutton_blue thumbdown_apply' id='thumbdown_other'  href='#'><span>"+__("lang_mainsite","This player should be avoided for another reason")+"</span></a>";i+="<a class='bgabutton bgabutton_gray thumbdown_apply' id='thumbdown_personal' href='#'><span>"+__("lang_mainsite","Nevermind, this is just my opinion finally")+"</span></a>";i+="</p>";i+="</div>";this.thumbdownDlg.setContent(i);this.thumbdownDlg.show();e.query(".thumbdown_apply").connect("onclick",e.hitch(this,(function(e){e.preventDefault();this.thumbdownDlg.destroy();var t=e.currentTarget.id.substr(10),i={player:this.target_player,value:-1,category:t};this.bForceThumbDown&&(i.f=1);this.page.ajaxcall("/table/table/changeReputation.html",i,this,(function(e){this.value=-1;this.updateControl();"personal"!=t&&this.onGiveThumbDownFinal()}))})))},onGiveThumbDownFinal:function(){this.thumbdownDlg=new ebg.popindialog;this.thumbdownDlg.create("thumbdownDialog4");this.thumbdownDlg.setTitle(__("lang_mainsite","Thank you"));this.thumbdownDlg.setMaxWidth(600);var t='<div id="thumbdownDialog4" class="midSizeDialog">';t+=e.string.substitute(__("lang_mainsite","Thanks. Eventually, if you think this player violated our Terms of Service (ex : insults / verbal aggression), you should ${action} to moderators in addition."),{action:'<a class="bga-link" href="/newreport?player='+this.target_player+'" id="thumbdown_report">'+__("lang_mainsite","Report this player")+"</a>"});t+="<p>";t+="<a class='bgabutton bgabutton_gray bgabutton_big' id='thumbdown_cancel' href='#'><span>"+__("lang_mainsite","Ok")+"</span></a>";t+="</p>";t+="</div>";this.thumbdownDlg.setContent(t);this.thumbdownDlg.show();e.connect($("thumbdown_cancel"),"onclick",e.hitch(this.thumbdownDlg,(function(e){e.preventDefault();this.destroy()})));e.connect($("thumbdown_report"),"onclick",e.hitch(this.thumbdownDlg,(function(t){e.destroy("thumbdownDialog4");this.destroy()})))}})}))},"ebg/playerlocation":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.playerlocation",null,{constructor:function(){this.page=null;this.board_div=null;this.board_div_id=null;this.board_uid="_";this.template='<div id="current_localization" style="display:${my_position_visibility}">${my_city}: ${position} <a href="#" id="modifycity" class="smalltext">[${LB_CHANGE}]</a></div><div id="current_localization_teasing" style="display:${MY_POSITION_TEASING}"><div>${POSITION_TEASING}</div>${MY_CITY}: <input type="text" id="cityinput"  size="30" value="${INITIAL_CITY}"></input> <a href="#" class="bgabutton bgabutton_blue" id="savecity"><span>${LB_OK}</span></a></div><form id="profileinfos" name="profileinfos" method="post"><input type="hidden" name="city" id="city" value=""></input><input type="hidden" name="lat" id="lat" value="0"></input><input type="hidden" name="lon" id="lon" value="0"></input><input type="hidden" name="loc_city" id="loc_city" value=""></input><input type="hidden" name="loc_area1" id="loc_area1" value=""></input><input type="hidden" name="loc_area2" id="loc_area2" value=""></input><input type="hidden" name="loc_country" id="loc_country" value=""></input><input type="hidden" name="loc_cityprivacy" id="loc_cityprivacy" value=""></input></form>';this.teasing="";this.googleApiLoaded=!1;this.jtpl_citychoice="<input type='radio' name='cityChoice' id='cityChoiceLink_${id}' class='cityChoiceLink' ${checked}>${description}</input><br/>";this.locationDialog=null;this.cityChoiceResult=null;this.callback_url=""},create:function(t,i,n,o,a){this.page=t;this.board_div=$(i);this.board_div_id=i;this.teasing=n;this.callback_url=a;var s={my_city:_("My city"),my_position_visibility:""!=$("initial_position").innerHTML?"block":"none",position:$("initial_position").innerHTML,LB_CHANGE:_("LB_CHANGE"),POSITION_TEASING:this.teasing,MY_POSITION_TEASING:""!=$("initial_position").innerHTML?"none":"block",MY_CITY:_("My city"),INITIAL_CITY:$("initial_city").innerHTML,LB_OK:_("LB_OK")},r=!1;$("upperrightmenu_loggedin")?"none"!=e.style("upperrightmenu_loggedin","display")&&(r=!0):$("disconnected_player_menu")&&"none"!=e.style("disconnected_player_menu")&&(r=!0);if(r){e.place(e.string.substitute(this.template,s),this.board_div);e.connect($("savecity"),"onclick",this,"onSaveCity");e.connect($("modifycity"),"onclick",this,"onModifyCity");if(o){var l=document.createElement("script");l.type="text/javascript";var d=dojoConfig.locale.substr(0,2);l.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCrPx3aUElpdWAGTyxd-t9w92er94Nfxjk&sensor=false&callback=initGoogleApi&language="+d;initGoogleApi=e.hitch(this,(function(){this.googleApiLoaded=!0}));document.body.appendChild(l)}}},onModifyCity:function(t){e.stopEvent(t);e.style("current_localization","display","none");e.style("current_localization_teasing","display","block")},onSaveCity:function(t){e.stopEvent(t);var i=$("cityinput").value,n=$("country").value;if(""!=i)if("undefined"!=typeof google&&void 0!==google.maps&&void 0!==google.maps.Geocoder){geocoder=new google.maps.Geocoder;geocoder.geocode({address:i,language:dojoConfig.locale.substr(0,2),region:n},e.hitch(this,(function(t,i){if(i==google.maps.GeocoderStatus.OK){this.cityChoiceResult=t;$("locationDialog_content")&&e.destroy("locationDialog_content");this.locationDialog=new ebg.popindialog;this.locationDialog.create("locationDialog");this.locationDialog.setTitle(_("Please confirm your city"));this.locationDialog.setMaxWidth(500);var n="<div id='locationDialog_content'>";for(var o in t){var a=t[o],s=getLocationDescriptionFromResult(a);n+=e.string.substitute(this.jtpl_citychoice,{id:o,description:s,checked:0==toint(o)?"checked='checked'":""})}n+="<br/>";n+="<input type='checkbox' id='cityprivacy' checked='checked'></input> "+_("Show my city to other players")+' ("'+$("cityinput").value+'")';n+="<br/>";n+="<br/><div style='text-align:center'><a id='validCityChoice' class='button'><span>"+_("Ok")+"</span></a></div>";n+="</div>";this.locationDialog.setContent(n);this.locationDialog.show();e.connect($("validCityChoice"),"onclick",this,"onCityChoiceConfirm")}else i==google.maps.GeocoderStatus.ZERO_RESULTS?this.showMessage("Sorry, we couldn't found your city","error"):this.showMessage("Google Maps error: "+i,"error")})))}else this.page.showMessage(_("Failed to load Google Maps"),"error")},onCityChoiceConfirm:function(t){e.stopEvent(t);var i=0;e.query(".cityChoiceLink").forEach((function(e){e.checked&&(i=e.id.substr(15))}));var n=this.cityChoiceResult[i],o=parseFloat(n.geometry.location.lat()),a=parseFloat(n.geometry.location.lng());$("lon").value=a;$("lat").value=o;var s=analyseLocationDescriptionFromResult(n);$("loc_city").value=s.city;$("loc_area1").value=s.area1;$("loc_area2").value=s.area2;$("loc_country").value=s.country;$("city").value=$("cityinput").value;$("loc_cityprivacy").value=$("cityprivacy").checked?0:1;this.locationDialog.destroy();"undefined"!=typeof mainsite?this.page.ajaxcall("/player/profile/updateCity.html",{form_id:"profileinfos"},this,(function(){this.page.showMessage(__("lang_mainsite","Profile informations updated !"),"info");mainsite.gotourl_forcereload(this.callback_url)}),(function(e){}),"post"):this.page.ajaxcall("/table/table/updateCity.html",{form_id:"profileinfos"},this,(function(){this.page.showMessage(__("lang_mainsite","Profile informations updated !"),"info");location.reload()}),(function(e){}),"post")}})}))},"ebg/pageheader":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.pageheader",null,{constructor:function(){this.page=null;this.div_id=null;this.adaptsubtrigger=null;this.bDisableAdaptMenu=!1;this.bUpdateQueryString=!1},create:function(t,i,n,o,a){this.page=t;this.div_id=i;this.buttons=n;this.bAllByDefault=o;this.bUpdateQueryString=void 0===a||a;o||this.hideAllSections();for(var s in n){var r=n[s];e.connect($(r.btn),"onclick",this,"onClickButton");void 0!==r.defaults&&r.defaults&&this.showSection(r.section,r.btn)}e.query("#"+i+" h2").connect("onclick",this,"onClickHeader");this.adaptsubtrigger=e.connect(window,"onresize",this,e.hitch(this,"adaptSubmenu"));this.adaptSubmenu()},destroy:function(){if(null!==this.adaptsubtrigger){e.disconnect(this.adaptsubtrigger);this.adaptsubtrigger=null}},adaptSubmenu:function(){if(!this.bDisableAdaptMenu&&$(this.div_id)){e.removeClass(this.div_id,"pageheader_menu_smallwidth");var t=null,i=!1;e.query("#"+this.div_id+" .pageheader_menuitem").forEach((function(n){if("none"!=e.style(n,"display")){var o=e.position(n);null===t?t=o.y:Math.abs(t-o.y)>10&&(i=!0)}}));i&&e.addClass(this.div_id,"pageheader_menu_smallwidth")}},getSelected:function(){var t=e.query("#"+this.div_id+" .pageheader_menuitemselected");return 1!=t.length?null:t[0].id},getNumberSelected:function(){return e.query("#"+this.div_id+" .pageheader_menuitemselected").length},hideAllSections:function(){for(var t in this.buttons){e.query("#"+this.div_id+" .pageheader_menuitemselected").removeClass("pageheader_menuitemselected");if("object"==typeof this.buttons[t].section)for(var i in this.buttons[t].section)$(this.buttons[t].section[i])&&e.style(this.buttons[t].section[i],"display","none");else $(this.buttons[t].section)&&e.style(this.buttons[t].section,"display","none")}e.query("#"+this.div_id+" .pageheader_hide_if_not_active").style("display","none")},showDefault:function(){if(this.bAllByDefault){for(var t in this.buttons){if("object"==typeof(i=this.buttons[t]).section)for(var t in i.section)$(i.section[t])&&e.style(i.section[t],"display","block");else e.style(i.section,"display","block")}e.query("#"+this.div_id+" .pageheader_menuitemselected").removeClass("pageheader_menuitemselected");e.query("#"+this.div_id+" .pageheader_hide_if_not_active").style("display","block");this.updateQueryString("")}else{this.hideAllSections();for(var t in this.buttons){var i;void 0!==(i=this.buttons[t]).defaults&&this.showSection(i.section,i.btn)}}},showSection:function(t,i){if(null!=t&&$(t))if("object"==typeof t)for(var n in t)e.style(t[n],"display","block");else e.style(t,"display","block");e.addClass(i,"pageheader_menuitemselected");this.updateQueryString(i);this.onSectionChanged()},onSectionChanged:function(){},onClickButton:function(t){e.stopEvent(t);this.showSectionFromButton(t.currentTarget.id)},showSectionFromButton:function(e){for(var t in this.buttons){var i=this.buttons[t];if(i.btn==e){this.hideAllSections();this.showSection(i.section,i.btn);void 0!==i.onShow&&i.onShow();void 0!==i.onHide&&i.onHide()}}},onClickHeader:function(e){this.showDefault()},updateQueryString:function(t){if(this.bUpdateQueryString){var i="",n=window.location.search,o=n.split("?");if(o.length>=2&&o[1].length>0){for(var a=1;a<o.length;a++){a>1&&(i+="%3F");i+=o[a]}module=o[0]}else module=n;var s=e.queryToObject(i);if(""===t||1!==this.getNumberSelected()){s.section=null;delete s.section}else s.section=t.substr(11);i=e.objectToQuery(s);var r=module;""!=i&&(r+="?"+i);if(window.location.search!=r&&"undefined"!=typeof mainsite){mainsite.disableNextHashChange=!0;history.pushState(null,"",window.location.pathname+r)}}}})}))},"ebg/tableresults":function(){define(["dojo","dojo/_base/declare","ebg/thumb","ebg/core/common"],(function(e,t){return t("ebg.tableresults",null,{constructor:function(){this.page=null;this.div=null;this.jstpl_template='<div class="game_abandonned" id="game_abandonned" style="display:none">                                        <h4 class="game_result_status_important">${LB_GAME_ABANDONNED}</h4>                                        <span id="game_abandonned_explanation"></span>                                        <br/>                                        <br/>                                    </div>                                    <div class="game_cancelled" id="game_cancelled" style="display:none">                                        <h4 class="game_result_status_important">${LB_GAME_RESULT_CANCELLED} (${LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END}) :</h4>                                        ${THE_PLAYER_WHO_LEFT}<br/>                                        ${THE_OTHERS_PLAYERS}                                        <br/>                                        <br/>                                    </div>                                    <div class="game_cancelled" id="game_unranked_cancelled" style="display:none">                                        <h4 class="game_result_status_important">${LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END}</h4>                                        <br/>                                    </div>                                    <h4 class="game_conceded" id="game_conceded" style="display:none">${LB_GAME_CONCEDED}</h4>                                    <h4 class="game_unranked" id="game_unranked" style="display:none"><span id="game_unranked_label">${label_unranked} <i class="fa fa-question-circle"></i></span></h4>                                    <div class="game_result" id="game_result"></div>                                    <div id="tiebreaker_explanation"></div>                                    <div class="publishresult_container">                                        <span class="publishresult_button">                                            <span class="publishresult bgabutton bgabutton_gray" id="publishresult">                                                <i class="fa fa-share-alt"></i> ${share}                                            </span>                                            <div id="publishresult_content">                                                <div class="fb-share-button" data-href="https://${LANGUAGE_SHORT}.boardgamearena.com/table?table=${TABLE_ID}" data-layout="button" data-size="large"></div>                                            </div>                                        </span>                                    </div>';this.jstpl_score_entry='<div class="score-entry" id="score_entry_${player_id}"><div class="rank">${rankstr}</div><div class="emblemwrap ${emblem_class} emblemwrap_l"><img id="emblem_${player_id}" src="${emblem}" alt="${name}" class="emblem"/><div class="emblempremium"></div></div><div class="name"><a href="${url_base}/player?id=${player_id}" id="player_${player_id}_name" class="playername">${name}</a></div><div class="score">${score} <i class="fa fa-lg fa-star"></i><span class="score_aux score_aux_${score} tttiebraker" id="score_aux_${index}"> (${score_aux}<i class="fa fa-star tiebreaker"></i>)</span></div><br class="clear" /><div class="adddetails adddetails_arena"><span class="rankdetails rankdetailsarena" style="display:${show_arena}"><div id="winpointsarena_${player_id}" class="winpoints"><span class="" id="winpointsarena_value_${player_id}">${arena_win_display}</span> &nbsp;&nbsp;<img alt="->" src="'+getStaticAssetUrl("img/common/arrow.png")+'" class="imgtext"/>&nbsp;&nbsp;</div><div id="newrankarena_${player_id}" class="newrank">${arena_after_display}</div></span></div><div id="adddetails_${player_id}" class="adddetails"><span class="rankdetails"><div id="winpoints_${player_id}" class="winpoints"><span id="leave_${player_id}" style="display:none;" class="leavepenalty">&nbsp;<span id="leavevalue_wrap_${player_id}"><div class="icon20 icon20_penaltyleave "></div> </span></span><span class="" id="winpoints_value_${player_id}">${point_win}</span> &nbsp;&nbsp;<img alt="->" src="'+getStaticAssetUrl("img/common/arrow.png")+'" class="imgtext"/>&nbsp;&nbsp;</div><div id="newrank_${player_id}" class="newrank">${rank_after_game}</div></span><div class="penalties"><span id="clock_${player_id}" style="display:none;" class="clockpenalty">&nbsp;<div class="icon20 icon20_penaltyclock"></div></span></div></div><div class="reputation_wrap" style="display:${reputation_display}"><p id="reputation_block_${player_id}"><div class="reputation" id="reput_${player_id}"></div></p><br/><p id="stickynote_wrap_${player_id}" class="stickynote_wrap"><a class="bga-link" href="#" id="stickynote_edit_${player_id}"><i class="fa fa-lg fa-sticky-note-o"></i>&nbsp; <span id="stickynote_ctrl_${player_id}"></span></a></p></div><br class="clear" /></div>';this.jstpl_trophy='<div class="trophy">                           <a id="award_${AWARD_ID}" href="${url_base}/award?game=${GAME_ID}&award=${AWARD_TYPE_ID}">                                <div class="trophyimg_wrap"><div class="trophyimg" id="awardimg_${AWARD_ID}" style="background-image:  url(\'${base_img}\')"></div></div>                                <div class="trophyname"><b>${TROPHY_NAME}</b><br/>${TROPHY_SPECIAL} <div class="xp_container">+${TROPHY_PRESTIGE} XP<div class="arrowback"></div><div class="arrow"></div><div class="arrowbackl"></div><div class="arrowl"></div></div></div><br class="clear"/>                            </a>                        </div>';this.jstpl_statistics='<p>${intro}</p><div id="table_stats" class="smalltext">                </div>                <div id="player_stats">                    <table class="statstable" id="player_stats_table">                        <tr id="player_stats_header">                            <th></th>                        </tr>                    </table>                </div>';this.jstpl_table_stat='<div class="row-data">                            <div class="row-label">${statname}</div>                            <div class="row-value">&nbsp;${value} ${unit}</div>                        </div>';this.jstpl_playerstatheader='<th id="playerstatheader_${ID}">${NAME}</th>';this.jstpl_playerstat="<tr>                                <th>${NAME}</th>                                ${PLAYER_STATS}                            </tr>";this.tableinfos=null;this.pma=!1},create:function(t,i,n,o,a){this.page=t;this.div=i;this.stats_div=n;this.tableinfos=o;this.pma=a;if($(this.div)){e.place(e.string.substitute(this.jstpl_template,{LANGUAGE_SHORT:e.config.locale.substr(0,2),TABLE_ID:o.id,LB_GAME_ABANDONNED:__("lang_mainsite","LB_GAME_ABANDONNED"),LB_GAME_CONCEDED:__("lang_mainsite","LB_GAME_CONCEDED"),label_unranked:__("lang_mainsite","Unranked game (Training mode)"),LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END:__("lang_mainsite","LB_SOMEONE_LEFT_THE_GAME_BEFORE_THE_END"),LB_GAME_RESULT_CANCELLED:__("lang_mainsite","LB_GAME_RESULT_CANCELLED"),THE_PLAYER_WHO_LEFT:__("lang_mainsite","The player who left (or was skipped) lost the game and got a %s penalty.").replace("%s","☯"),THE_OTHERS_PLAYERS:__("lang_mainsite","The other players won this game and get %s of normal ELO points (because %s of this game has been played before the incident).").replace("%s",this.tableinfos.progression+"%").replace("%s",this.tableinfos.progression+"%"),share:__("lang_mainsite","Share")}),this.div,"replace");this.playeropinion={};e.connect($("publishresult"),"onclick",this,"onPublishResult");this.update();this.updateStats()}},destroy:function(){},update:function(){var t=this.tableinfos;void 0!==t.thumbs&&(this.playeropinion=t.thumbs);if(void 0===i)var i=this.page.player_id;e.style("game_abandonned","display","block");e.style("publishresult","display","none");var n,o=!1;if("didntstart_cron_timeout"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Table closed automatically because not enough players joined the table after a while.");else if("didntstart_cron_init_timeout"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Table has been abandonned during initial configuration.");else if("didntstart_players_left"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","All players left the game before it begins.");else if("didntplay_cron_timeout"===t.result.endgame_reason)$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Game has been closed automatically because no move had been done on it during a long period of time.");else if("normal_end"===t.result.endgame_reason||"normal_concede_end"===t.result.endgame_reason){e.style("game_abandonned","display","none");e.style("publishresult","display","none");o=!0;"normal_concede_end"===t.result.endgame_reason&&e.style("game_conceded","display","block")}else if("neutralized_after_skipturn"===t.result.endgame_reason||"neutralized_after_skipturn_error"===t.result.endgame_reason){e.style($("game_cancelled"),"display","block");e.style("game_abandonned","display","none");e.style("publishresult","display","none");o=!0}else"abandon_by_decision"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","The game has been abandonned because all players (with a positive clock) decided it, or because all players left the game."):"abandon_by_tournamenttimeout"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Game has been abandonned automatically because players did not managed to finish it before the next round of the tournament. The player with the most remaining reflexion time wins the game."):"error_tournament_wrongnumber"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Some players of this tournament game did not show up, so we could not start the game (these players got a penalty on their profile)."):"synchro_error_corrupted"===t.result.endgame_reason||"synchro_error_finished_on_gs"===t.result.endgame_reason||"synchro_error_not_on_gs"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","Game has been closed automatically due to a technical error")+" ("+t.result.endgame_reason+")":"express_stop"===t.result.endgame_reason?$("game_abandonned_explanation").innerHTML="A developer cancel this game using Express Stop.":"abandon_sandbox_disagreement"==t.result.endgame_reason?$("game_abandonned_explanation").innerHTML=__("lang_mainsite","The players disagree on the game result of this game, so we cancelled it."):$("game_abandonned_explanation").innerHTML="Unknow endgame reason: "+t.result.endgame_reason;if(1==toint(t.unranked)){if("neutralized_after_skipturn"===t.result.endgame_reason||"neutralized_after_skipturn_error"===t.result.endgame_reason){e.style($("game_cancelled"),"display","none");e.style($("game_unranked_cancelled"),"display","block")}e.style($("game_unranked"),"display","block");this.page.addTooltip("game_unranked_label",__("lang_mainsite","The Training mode has been enabled for this table (no ranking points gain/loss for this game)."),"")}var a=null,s=[],r=null,l={},d=!1;for(var c in t.result.player){l[r=(n=t.result.player[c]).player_id]={rank_after_game:n.rank_after_game,elo_win:n.point_win,rank_before_game:n.rank_after_game-n.point_win,gamerank:n.gamerank,name:n.name,opponents:{}};1!=n.gamerank&&(d=!0)}for(var r in l){var h=0;for(var u in l)if(u!=r){var p=l[r].rank_before_game-l[u].rank_before_game;if(toint(l[r].gamerank)<toint(l[u].gamerank))var m=1;else if(l[r].gamerank==l[u].gamerank)m=.5;else m=0;var g=1/(1+Math.pow(10,-p/400)),_=m-g;h+=_;l[r].opponents[u]={gameresult:m,expectedResult:g,elo_delta_no_k:_}}l[r].k_factor=0!=h?Math.max(20,Math.round(l[r].elo_win/h)):60;if(1301==l[r].rank_after_game&&1300==l[r].rank_before_game){l[r].k_factor=60;l[r].particular_case=__("lang_mainsite","You always get at least 1 ELO point during your first game on BGA.")}else 1400==l[r].rank_after_game&&h<0?l[r].particular_case=__("lang_mainsite","Note: you can never go back under 100 ELO."):l[r].rank_after_game<1400&&h<0&&(l[r].particular_case=__("lang_mainsite","Note: you cannot lose ELO while your ELO has not reach 100."))}var f={};for(var c in t.result.player){r=(n=t.result.player[c]).player_id;n.index=c;n.rank_after_game,n.point_win;n.point_win_arena="";n.show_arena="none";n.arena_win_display="";n.arena_after_display="";if(n.score){t.result.losers_not_ranked&&!d?n.rankstr=__("lang_mainsite","Tie"):t.result.is_coop||t.result.is_solo?n.score>0?n.rankstr=__("lang_mainsite","Winner"):n.rankstr=__("lang_mainsite","Loser"):n.rankstr=this.page.getRankString(n.gamerank,t.result.losers_not_ranked);n.point_win=Math.round(l[r].rank_after_game)-Math.round(l[r].rank_before_game);n.point_win>=0&&(n.point_win="+"+n.point_win);n.rank_after_game=this.page.getEloLabel(n.rank_after_game);if(1==toint(t.unranked)){n.rank_after_game="";n.point_win=""}if(null!=n.arena_points_win){n.show_arena="block";var v=this.page.arenaPointsDetails(n.arena_after_game);if(5==v.league){var b=n.arena_points_win>=0?"+":"";n.arena_win_display=b+Math.round(n.arena_points_win%1*1e4);n.arena_after_display=Math.round(n.arena_after_game%1*1e4)+" "+__("lang_mainsite","pts")+" ";n.arena_after_display+='<div style="display:inline-block;position:relative;margin-top: -32px;margin-bottom: 26px;">';n.arena_after_display+='<div class="myarena_league league_'+v.league+'" style="position:relative;display:inline-block;top:21px;left:0px">';n.arena_after_display+='<div class="arena_label"></div>';n.arena_after_display+="</div>";n.arena_after_display+="</div>"}else{if(n.arena_points_win>100)n.arena_win_display="";else{b=n.arena_points_win>=0?"+":"";n.arena_win_display=b+Math.round(n.arena_points_win)%10+'<div class="icon20 icon_arena"></div>'}n.arena_after_display='<div style="display:inline-block;position:relative;margin-top: -29px;margin-bottom: 26px;">';n.arena_after_display+='<div class="myarena_league league_'+v.league+'" style="position:relative;display:inline-block;top:21px;">';n.arena_after_display+='<div class="arena_label">'+v.points+"</div>";n.arena_after_display+="</div>";n.arena_after_display+="</div>"}}}else{n.rank_mask="";n.point_win="";n.rank_after_game="";n.is_tie="";n.score="";n.score_aux="";n.rankstr=""}n.emblem=getPlayerAvatar(n.player_id,n.avatar,50);null===n.gender&&(n.gender="");n.flagx=n.country.flag_x;n.flagy=n.country.flag_y;n.table_id=t.id;n.emblem_class="";1==n.is_premium&&(n.emblem_class="is_premium");null!==a&&a==n.score&&null!==n.score_aux&&s.push(n.score);f[c]={score:n.score,score_aux:n.score_aux};a=n.score;null===n.score_aux&&(n.score_aux="");n.signal_player_label=__("lang_mainsite","Signal this player");n.reputation_display="block";r==i&&(n.reputation_display="none");n.url_base="";void 0!==this.page.metasiteurl&&(n.url_base=this.page.metasiteurl);e.place(this.page.format_string(this.jstpl_score_entry,n),"game_result");this.page.addTooltip("flag_"+r,n.country.name,"");if(this.playeropinion[r]&&1==this.playeropinion[r].n){this.page.ajaxcall("/table/table/loadStickyNote.html",{player:r},this,(function(e){$("stickynote_ctrl_"+e.player).innerHTML=e.note}));this.page.addTooltip("stickynote_edit_"+r,e.string.substitute(__("lang_mainsite","A personal note on ${player}, for your eyes only"),{player:n.name}),__("lang_mainsite","Modify"))}else{$("stickynote_ctrl_"+r).innerHTML=e.string.substitute(__("lang_mainsite","Write a personal note about ${name}"),{name:$("player_"+r+"_name").innerHTML});this.page.addTooltip("stickynote_edit_"+r,"",e.string.substitute(__("lang_mainsite","Write a personal note about ${player}, for your eyes only"),{player:n.name}))}e.connect($("stickynote_edit_"+r),"onclick",this,"onEditSticky");if(toint(t.result.penalties[r].clock)>=0){e.style("clock_"+r,"display","inline");if(void 0!==t.result.penalties[r].clock_cancelled){e.place("<span> ("+__("lang_mainsite","Penalty cancelled")+") </span>","clock_"+r);e.addClass("clock_"+r,"clockpenalty_cancelled")}}if(toint(t.result.penalties[r].leave)>=0){if(void 0!==t.result.penalties[r].leave_cancelled){e.place("<span> ("+__("lang_mainsite","Penalty cancelled")+") </span>","leave_"+r);e.addClass("leave_"+r,"leavepenalty_cancelled")}else $("winpoints_value_"+r).innerHTML+=" - "+t.result.penalties[r].leave;e.style("leave_"+r,"display","inline");e.style("leavevalue_wrap_"+r,"display","inline")}this.addPlayerEloTooltip(t,n,l);this.page.addTooltipToClass("adddetails_arena",__("lang_mainsite","Arena points won/loss during this game"),"");var y=0;this.playeropinion[r]?0==(y=toint(this.playeropinion[r].t))&&r!=i&&"none"!=e.style("reputation_block_"+r,"display")&&!0:r!=i&&"none"!=e.style("reputation_block_"+r,"display")&&!0;if(r==i)!0;else{(new ebg.thumb).create(this.page,"reput_"+r,r,y)}}null!==r&&e.addClass("score_entry_"+r,"last-score-entry");var w=null;null!==$("gametiebreaker")?w=$("gametiebreaker").innerHTML:void 0!==this.page.tiebreaker&&(w=__("lang_"+this.tableinfos.game_name,this.page.tiebreaker));if(""!=w&&1!=toint(t.cancelled)){for(var c in s){var C=s[c];e.query(".score_aux_"+C).style("display","inline")}this.page.addTooltipToClass("tttiebraker",__("lang_mainsite","Tie breaker")+": "+w,"");if(s.length>0){$("tiebreaker_explanation").innerHTML="<div class='smalltext'>(<i class='fa fa-star tiebreaker'></i>: "+__("lang_mainsite","Tie breaker")+": "+w+")</div><br/>";if($("gametiebreaker_split")&&""!=$("gametiebreaker_split").innerHTML){var k=$("gametiebreaker_split").innerHTML.split(","),x={};for(var c in f){var T=f[c].score,A=f[c].score_aux,j=[];j.push(parseInt(T));for(var S in k){var M=Math.floor(A/k[S]);A-=M*k[S];j.push(M)}x[c]={html:"",tie_step:0,score:j}}for(var c in x)for(var E in x)if(E!=c)for(var S in x[c].score){if(x[c].score[S]!=x[E].score[S])break;x[c].tie_step++}for(var c in x){var N="";if(x[c].tie_step>0){N=" (";for(S=1;S<=x[c].tie_step;S++)void 0!==x[c].score[S]&&(N+=x[c].score[S]+'<i class="fa fa-star tiebreaker"></i> &nbsp;');N=N.slice(0,-7);N+=")";$("score_aux_"+c).innerHTML=N}}}}}if(!o){e.query(".rankdetails").style("display","none");e.query(".score").style("display","none")}1==toint(t.unranked)&&e.query(".rankdetails").style("display","none");this.page.addTooltipToClass("clockpenalty",__("lang_mainsite","This player ran out of time during this game."),"");this.page.addTooltipToClass("leavepenalty",__("lang_mainsite","This player left this game before the end."),"");this.page.addTooltipToClass("leavepenalty_cancelled",__("lang_mainsite","This penalty has been cancelled because we judged that it was not this player fault (ex: technical error)."),"");this.page.addTooltipToClass("clockpenalty_cancelled",__("lang_mainsite","This penalty has been cancelled because we judged that it was not this player fault (ex: technical error)."),"");"undefined"!=typeof mainsite?mainsite.updatePremiumEmblemLinks():null!=typeof gameui&&gameui.updatePremiumEmblemLinks()},onEditSticky:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(16);e.destroy("stickEditDialog");var n=new ebg.popindialog;n.create("stickEditDialog");n.setTitle(e.string.substitute(__("lang_mainsite","Write a personal note about ${name}"),{name:$("player_"+i+"_name").innerHTML}));n.setMaxWidth(400);n.tableModule=this.page;var o="";$("stickynote_ctrl_"+i).innerHTML!=e.string.substitute(__("lang_mainsite","Write a personal note about ${name}"),{name:$("player_"+i+"_name").innerHTML})&&(o=$("stickynote_ctrl_"+i).innerHTML);var a='<div id="stickEditDialog">';a+="<textarea id='sticky_text' style='width: 100%'>"+o+"</textarea>";a+="<p><a class='bgabutton bgabutton_gray' id='stickyedit_cancel' href='#'><span>"+__("lang_mainsite","Cancel")+"</span></a> <a class='bgabutton bgabutton_blue' id='stickyedit_save' href='#'><span>"+__("lang_mainsite","Save")+"</span></a></p>";a+="</div>";n.setContent(a);n.show();e.connect($("stickyedit_cancel"),"onclick",e.hitch(n,(function(t){t.preventDefault();e.destroy("stickEditDialog");this.destroy()})));e.connect($("stickyedit_save"),"onclick",e.hitch(n,(function(e){e.preventDefault();var t=$("sticky_text").value;this.destroy();this.tableModule.ajaxcall("/table/table/updateText.html",{type:"stickynote",id:i,text:t},this,(function(e){}));$("stickynote_ctrl_"+i).innerHTML=t})))},updateStats:function(){var t="";if(this.tableinfos.result.stats){this.pma||"private"==this.tableinfos.game_status||(t='<p style="text-align:center;"><a href="/premium" class="bgabutton bgabutton_blue">'+__("lang_mainsite","Go Premium to see game statistics!")+"</a></p><br/><br/>");e.place(e.string.substitute(this.jstpl_statistics,{intro:t}),this.stats_div,"only");var i=1;if(this.pma||"private"==this.tableinfos.game_status){this.insertTableStat(__("lang_mainsite","Game duration"),Math.round(this.tableinfos.result.time_duration/60),__("lang_mainsite","mn"));i++;this.insertTableStat(__("lang_mainsite","Players average level"),this.page.getEloLabel(this.tableinfos.result.table_level));i++}else{this.insertTableStat(__("lang_mainsite","Game duration"),'<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />');i++;this.insertTableStat(__("lang_mainsite","Players average level"),'<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />');i++}for(var n in this.tableinfos.result.stats.table){i++;if(3==(c=this.tableinfos.result.stats.table[n]).id||1==c.id);else if(void 0!==c.value&&null!==c.value){if("*masked*"==c.value||!this.pma&&"private"!=this.tableinfos.game_status)c.value='<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />';else{"int"==c.type?c.value=Math.round(c.value):"bool"==c.type&&(c.value=0==c.value?__("lang_mainsite","no"):__("lang_mainsite","yes"));void 0!==c.valuelabel&&(c.value=__("lang_"+this.tableinfos.game_name,c.valuelabel))}this.insertTableStat(__("lang_"+this.tableinfos.game_name,c.name),c.value,c.unit)}}this.page.addTooltipToClass("statmasked",__("lang_mainsite","You must be a Premium member to see statistics"),"");var o={},a={};for(var n in this.tableinfos.result.player){var s=this.tableinfos.result.player[n];e.place(e.string.substitute(this.jstpl_playerstatheader,{ID:s.player_id,NAME:s.name}),"player_stats_header");o[s.player_id]=s.gamerank;a[s.player_id]=s.score}var r="";for(var n in this.tableinfos.result.player){var l=(s=this.tableinfos.result.player[n]).player_id;r+="<td>"+this.page.getRankString(o[l])+" ("+a[l]+'<i class="fa fa-lg fa-star"></i>)</td>'}e.place(e.string.substitute(this.jstpl_playerstat,{NAME:__("lang_mainsite","LB_GAME_RESULT"),PLAYER_STATS:r}),"player_stats_table");for(var d in this.tableinfos.result.stats.player)if("time_bonus_nbr"!=d&&"reflexion_time_sd"!=d||null!==$("go_to_table")){r="";var c,h=void 0===(c=this.tableinfos.result.stats.player[d]).unit?"":" "+c.unit,u=!1;for(var n in this.tableinfos.result.player){l=this.tableinfos.result.player[n].player_id;var p="-";void 0!==c.values[l]&&null!==c.values[l]&&(p=c.values[l]);i++;null!==p&&(u=!0);if("*masked*"==p||!this.pma&&"private"!=this.tableinfos.game_status)p='<img class="statmasked" id="statmasked_'+i+'" src="'+getStaticAssetUrl("img/common/rankmask.png")+'" alt="masked" />';else if("-"!=p){"int"==c.type?p=Math.round(p):"bool"==c.type&&(p=0==p?__("lang_mainsite","no"):__("lang_mainsite","yes"));void 0!==c.valuelabels[l]&&(p=__("lang_"+this.tableinfos.game_name,c.valuelabels[l]));if("reflexion_time"==d){p=this.page.formatReflexionTime(p).string;h=""}}r+="<td>"+p+h+"</td>"}u&&e.place(e.string.substitute(this.jstpl_playerstat,{NAME:__("lang_"+this.tableinfos.game_name,c.name),PLAYER_STATS:r}),"player_stats_table")}else;r="";for(var n in this.tableinfos.result.player){r+='<td class="smalltext"><div class="icon20 icon20_stat"></div> <a class="bga-link" href="/playerstat?id='+(l=(s=this.tableinfos.result.player[n]).player_id)+"&game="+this.tableinfos.game_id+'">'+__("lang_mainsite","%s`s statistics at this game").replace("%s",s.name)+"</a></td>"}e.place(e.string.substitute(this.jstpl_playerstat,{NAME:'<div class="icon20 icon20_stat"></div> '+__("lang_mainsite","All stats"),PLAYER_STATS:r}),"player_stats_table")}},insertTableStat:function(t,i,n){void 0===n&&(n="");e.place(e.string.substitute(this.jstpl_table_stat,{statname:t,value:i,unit:n}),"table_stats")},onPublishResult:function(t){e.stopEvent(t);e.style("publishresult","display","none");e.style("publishresult_content","display","block");FB.XFBML.parse()},addPlayerEloTooltip:function(t,i,n){player_id=i.player_id;var o="<h2>"+e.string.substitute(__("lang_mainsite","Details of the ELO computation for ${player}"),{player:i.name})+"</h2>";o+="<hr/>";o+="<table class='newbgatable'>";o+="<tr><td>"+__("lang_mainsite","ELO rank before this game")+"</td><td style='text-align:right'>"+this.page.getEloLabel(n[player_id].rank_before_game,!1,!1)+"</td>";if(t.result.is_coop)o+='<tr><td style="font-style: italic;">'+__("lang_mainsite","Details are not yet available for a cooperative game.")+"</td>";else{o+="<tr><td>"+__("lang_mainsite","K factor")+"</td><td style='text-align:right'>"+n[player_id].k_factor+"</td>";for(var a in n[player_id].opponents){if(1==n[player_id].opponents[a].gameresult)var s=e.string.substitute(__("lang_mainsite","Victory against ${player}"),{player:n[a].name});else if(.5==n[player_id].opponents[a].gameresult)s=e.string.substitute(__("lang_mainsite","Tie with ${player}"),{player:n[a].name});else s=e.string.substitute(__("lang_mainsite","Defeat against ${player}"),{player:n[a].name});s+="<br/>";s+=this.page.getEloLabel(n[a].rank_before_game,!0);o+="<tr><td>"+(s+=": "+__("lang_mainsite","Probability of a win")+": "+Math.round(100*n[player_id].opponents[a].expectedResult)+"%")+"</td><td style='text-align:right'>"+Math.round(n[player_id].opponents[a].elo_delta_no_k*n[player_id].k_factor*100)/100+"</td>"}void 0!==n[player_id].particular_case&&(o+="<tr><td colspan='2' style='text-align:center'>"+n[player_id].particular_case+"</td>");o+="<tr><td><b>"+__("lang_mainsite","Total ELO variation")+"</b></td><td style='text-align:right'><b>"+Math.round(100*n[player_id].elo_win)/100+"</b></td>"}o+="<tr><td>"+__("lang_mainsite","ELO rank after this game")+"</td><td style='text-align:right'>"+this.page.getEloLabel(n[player_id].rank_after_game,!1,!1)+"</td>";o+="</table>";this.page.addTooltipHtml("adddetails_"+player_id,o)}})}))},"ebg/paymentbuttons":function(){define(["dojo","dojo/_base/declare","svelte/index","ebg/expandablesection","ebg/comboajax"],(function(e,t,i){return t("ebg.paymentbuttons",null,{constructor:function(){this.page=null;this.div_id=null;this.sections={};this.btcDialog=null;this.bUseCreditCardElements=!0;this.rollGameBoxesTimeout=null},create:function(t){this.page=t;"#paymentcomplete"==location.hash&&i.bgaMessage({description:window._("Thanks for supporting this service!")});e.query(".payment_image").forEach((function(t){e.attr(t,"src",e.attr(t,"data-src"))}));"stripe"!=$("payment_method").innerHTML&&"wechat"!=$("payment_method").innerHTML||this.initStripe();"braintree"==$("payment_method").innerHTML&&this.initBraintree();if("wechat"==$("payment_method").innerHTML){this.page.register_subs(e.subscribe("weChatPaymentSuccess",this,"onWeChatPaymentSucceeded"));jQuery(document).ready((function(e){require([g_themeurl+"js/qrcode.min.js"],(function(){}))}))}if("paypal"==$("payment_method").innerHTML)if(window.paypal)this.loadPaypalButtons();else{let e=$("paypal_client_id").innerHTML;if(e){for(let e of[2,12])$("paypal_btn_holder_"+e+"months").innerHTML=window._("Loading...");let t=$("currency").innerHTML,i=document.createElement("script"),n=this;i.onload=function(){n.loadPaypalButtons()};i.src="https://www.paypal.com/sdk/js?client-id="+e+"&components=buttons&currency="+t.toUpperCase();document.head.appendChild(i)}}e.connect($("premium_btn_12months"),"onclick",this,(function(t){if(toint($("target_player").innerHTML)<0)this.page.showMessage(_("Please logged in or create an account to purchase or offer a membership."),"error");else if(e.query(".didnreceive_link_to_follow").length>0)this.page.showMessage(_("Please finish your registration before purchasing a membership."),"error");else if("paypal"==$("payment_method").innerHTML){$("premium_btn_12months").innerHTML=_("Please wait...");$("paypal_btn_12months").click()}else"wechat"==$("payment_method").innerHTML?this.onClickWechatButton($("plan_12months").innerHTML,t.currentTarget):this.onClickPaymentButton($("plan_12months").innerHTML)}));e.connect($("premium_btn_2months"),"onclick",this,(function(t){if(toint($("target_player").innerHTML)<0)this.page.showMessage(_("Please logged in or create an account to purchase or offer a membership."),"error");else if(e.query(".didnreceive_link_to_follow").length>0)this.page.showMessage(_("Please finish your registration before purchasing a membership."),"error");else if("paypal"==$("payment_method").innerHTML){$("premium_btn_2months").innerHTML=_("Please wait...");$("paypal_btn_2months").click()}else"wechat"==$("payment_method").innerHTML?this.onClickWechatButton($("plan_1month").innerHTML,t.currentTarget):this.onClickPaymentButton($("plan_1month").innerHTML)}));e.connect($("offer_submit"),"onclick",this,(function(e){"paypal"==$("payment_method").innerHTML?this.page.showMessage(_("Sorry, Paypal is not supported to offer membership. Please choose another payment option below."),"error"):this.onClickPaymentButton("offer")}));e.connect($("more_payment_option_btn"),"onclick",this,(function(t){e.stopEvent(t);if("undefined"!=typeof mainsite){e.style("more_payment_option_btn","display","none");e.style("more_payment_option","display","block")}else window.open(this.page.metasiteurl+"/premium?options","_blank")}));if("paypal"==$("payment_method").innerHTML){e.style("more_payment_option_btn","display","none");e.style("more_payment_option","display","block")}this.currentGameBox=0;this.rollGameBoxesTimeout=setTimeout(e.hitch(this,"rollGameBoxes"),2e3);$("automatic_renewal")&&e.connect($("automatic_renewal"),"onclick",this,(function(t){e.stopEvent(t);this.page.infoDialog(_("Note: you won't pay anything until the end of your current Premium period."),_("Please choose a subscription."));e.query(".payment_buttons_block").style("display","block")}));$("switch_to_annual")&&e.connect($("switch_to_annual"),"onclick",this,(function(t){e.stopEvent(t);this.page.infoDialog(_("You won't pay anything until the end of your current monthly Premium period.")+"<br/>"+_("After that, your membership will be extended by 1 year every year."),_("Upgrade to yearly subscription"));e.query(".payment_buttons_block").style("display","block");e.style("monthly_block","display","none");e.removeClass("yearly_block","col-md-6");e.addClass("yearly_block","col-md-12");$("premium_btn_12months").innerHTML=_("Upgrade to yearly subscription")}));"stripe"==$("payment_method").innerHTML&&this.loadStripeButtons();e.query(".btc_donate").connect("onclick",this,"onClickBtcDonate");this.sections.bitcoinpayment=new ebg.expandablesection;this.sections.bitcoinpayment.create(this,"expandable_bitcoinpayment");this.sections.offer=new ebg.expandablesection;this.sections.offer.create(this,"expandable_offer");if(toint($("target_player").innerHTML)<0){e.query(".player_notlogged_button").style("display","inline");e.query(".player_logged_button").style("display","none")}e.query(".paypal_payment_button").connect("onclick",this,"onPaypalBtnClick");$("cancel_stripe_subscription")&&e.connect($("cancel_stripe_subscription"),"onclick",this,"onCancelSubscription");$("cancel_stripe_subscription_trial")&&e.connect($("cancel_stripe_subscription_trial"),"onclick",this,"onCancelSubscription");"paypal"==$("payment_method").innerHTML?e.addClass("paymentmethod_paypal","current_selection"):"wechat"==$("payment_method").innerHTML?e.addClass("paymentmethod_wechat","current_selection"):e.addClass("paymentmethod_"+$("currency").innerHTML,"current_selection");e.query(".paymentmethod").connect("onclick",this,"onPaymentMethodChange");this.offerUpdatePrice();e.connect($("offer_nbr"),"onchange",this,"offerUpdatePrice");e.connect($("offer_type"),"onchange",this,"offerUpdatePrice");this.bOffer=1==$("offer_membership").innerHTML},destroy:function(){clearTimeout(this.rollGameBoxesTimeout)},offerUpdatePrice:function(){var e=toint($("offer_nbr").value);if(12==$("offer_type").value){var t=$("raw_price_12months").innerHTML;t*=12;t=Math.round(100*t)/100}else{t=tofloat($("raw_price_1month").innerHTML);t=Math.round(100*t)/100}var i=t*e;i=Math.round(100*i)/100;$("total_price").innerHTML=i},onPaypalBtnClick:function(e){},onClickBtcDonate:function(t){t.preventDefault();t.stopPropagation();var i=t.currentTarget.id.split("_")[3];this.page.ajaxcall("/account/account/blockchain_prepare_payment.html",{months:i,target:$("target_player").innerHTML,lock:!0},this,(function(t){this.btcDialog&&this.btcDialog.destroyRecursive();this.btcDialog=new dijit.Dialog({});this.btcDialog.autofocus=!1;this.btcDialog.refocus=!1;this.btcDialog.set("title",_("Pay with Bitcoin"));var i="<div class='btc_dialog_main'>&bull; "+_("Got a wallet configured with your brower? Click the link below:")+"<div class='btc_link' title='"+_("Click to pay")+"'><a id='btc_pay_link' href='"+t.btc_pay_uri+"'>Pay <em>"+t.btc_price+" BTC</em> to <em>Board Game Arena</em></a></div>&bull; "+_("Got a mobile phone wallet? Just scan the QR code:")+"<div class='btc_qrcode'><img id='btc_pay_qrcode' src='https://chart.googleapis.com/chart?chs=150x150&cht=qr&chl="+escape(t.btc_pay_uri)+"&choe=UTF-8' title='"+_("Scan to pay")+"' /></div>&bull; "+_("If you prefer to process your payment manually, please send exactly <em>%f BTC</em> to:").replace("%f",t.btc_price)+"<div class='btc_address'><span id='btc_pay_address'>"+t.btc_pay_address+"</span></div></div><div id='btc_dialog_footnotes'>"+_("This bitcoin payment address will be valid for the next 24 hours.")+"<br />"+_("Your payment may take some time to process. You'll get a confirmation email when we receive confirmation for the transaction.")+"<br />"+_("The rate used for converting the selected donation amount into bitcoins is updated on a regular basis.")+"</div><div id='btc_dialog_action'><a id='action_close' class='button' href='welcome'><span>"+_("Done!")+"</span></a></div>";this.btcDialog.set("content",i);e.connect($("action_close"),"onclick",this,(function(e){e.preventDefault();this.btcDialog.hide()}));this.btcDialog.show()}),(function(e){}))},rollGameBoxes:function(){if($("whypremium_catalog")){var t=!1,i=document.querySelectorAll(":hover"),n=e.query("#whypremium_catalog_list .game_box").length;for(var o in i)"whypremium_catalog"==i[o].id&&(t=!0);if(!t){if(this.currentGameBox>=n-1){this.currentGameBox=0;e.style("whypremium_catalog_list","left","0px")}this.currentGameBox++;var a=e.style("whypremium_catalog","width");this.page.slideToObjectPos("whypremium_catalog_list","whypremium_catalog",-a*this.currentGameBox,0).play()}clearTimeout(this.rollGameBoxesTimeout);this.rollGameBoxesTimeout=setTimeout(e.hitch(this,"rollGameBoxes"),2e3)}},loadPaypalButtons:function(){for(let e of[2,12]){let t=this;$("paypal_btn_holder_"+e+"months").innerHTML="";paypal.Buttons({fundingSource:paypal.FUNDING.PAYPAL,style:{tagline:!1,layout:"horizontal"},createOrder:function(n,o){return new Promise((function(n,o){try{t.page.ajaxcall("/premium/premium/createPaypalOrder.html",{months:e,currency:$("currency").innerHTML,lock:!0},t,(function(e){n(e.id)}),(function(e){o(e)}))}catch(a){i.bgaMessage({type:"error",description:window._("Unable to create PayPal order")});o("Unable to create PayPal order")}}))},onApprove:function(e,i){return new Promise((function(i,n){t.page.ajaxcall("/premium/premium/capturePaypalOrder.html",{order_id:e.orderID},t,(function(){i();location.hash="#paymentcomplete";location.reload()}),n)}))},onCancel:function(e){},onError:function(e){i.bgaMessage({type:"error",description:window._("Unable to complete PayPal order")+" ("+e+")"})}}).render("#paypal_btn_holder_"+e+"months")}},loadStripeButtons:function(){},initStripe:function(){if(this.bUseCreditCardElements){if(void 0===this.bStripeIsLoading){this.bStripeIsLoading=!0;(i=document.createElement("script")).setAttribute("src","https://js.stripe.com/v3/");$("stripe_script").appendChild(i)}if("undefined"==typeof Stripe)setTimeout(e.hitch(this,"initStripe"),100);else{this.stripe=Stripe($("stripe_key").innerHTML);this.stripeElements=this.stripe.elements();var t={base:{fontSize:"14px",fontWeight:500,color:"black","::placeholder":{color:"#a1a1a7"}}};this.card=this.stripeElements.create("cardNumber",{style:t,placeholder:_("Card number")});this.card.mount("#bga_payment_card_placeholder");this.card.addEventListener("change",e.hitch(this,(function(e){var t=document.getElementById("card-errors");if(e.error){t.textContent=e.error.message;this.shakePaymentWindow()}else t.textContent="";e.brand&&this.setBrandIcon(e.brand)})));this.cardExpire=this.stripeElements.create("cardExpiry",{style:t});this.cardExpire.mount("#bga_payment_expire");this.cardCVV=this.stripeElements.create("cardCvc",{style:t});this.cardCVV.mount("#bga_payment_cvv");document.getElementById("payment-form").addEventListener("submit",e.hitch(this,(function(t){t.preventDefault();bOneTimePayment=!1;"undefined"!=typeof current_player_id&&$("target_player").innerHTML!=current_player_id&&(bOneTimePayment=!0);this.bOffer&&(bOneTimePayment=!0);if(e.hasClass("bga_payment_button_wrap","Button--disableClick")||e.hasClass("bga_payment_button_wrap","Button--success"))this.page.showMessage(_("Please wait, a payment is already in progress..."),"error");else if(0!=$("accept_tos").innerHTML&&1!=$("agree_tos").checked){$("card-errors").textContent=_("You must agree with Term of Sales");this.shakePaymentWindow()}else{e.addClass("bga_payment_button_wrap","Button--disableClick");this.latest_bga_button_label=$("bga_payment_button").innerHTML;$("bga_payment_button").innerHTML='<i class="fa fa-spinner fa-pulse fa-lg" aria-hidden="true" style="position:relative;top:8px;"></i>';if(bOneTimePayment){if(null===this.paymentIntent_secret){this.page.showMessage("Error during payment initialization","Error");return}this.stripe.handleCardPayment(this.paymentIntent_secret,this.card).then(e.hitch(this,"stripePaymentResultHandler"))}else this.stripe.createToken(this.card).then(e.hitch(this,"stripePaymentResultHandler"))}})));e.connect($("bga_payment_close"),"onclick",this,(function(){e.style("bga_payment_layout","display","none")}));e.connect(this.card,"focus",e.hitch(this,(function(t){e.addClass("bga_card_field","Fieldset-child--focused")})));e.connect(this.card,"blur",e.hitch(this,(function(t){e.removeClass("bga_card_field","Fieldset-child--focused")})));e.connect(this.cardExpire,"focus",e.hitch(this,(function(t){e.addClass("bga_cardexpiry_field","Fieldset-child--focused")})));e.connect(this.cardExpire,"blur",e.hitch(this,(function(t){e.removeClass("bga_cardexpiry_field","Fieldset-child--focused")})));e.connect(this.cardCVV,"focus",e.hitch(this,(function(t){e.addClass("bga_cardcvc_field","Fieldset-child--focused")})));e.connect(this.cardCVV,"blur",e.hitch(this,(function(t){e.removeClass("bga_cardcvc_field","Fieldset-child--focused")})));e.connect($("security_infos"),"onclick",this,e.hitch(this,(function(){alert(_("Your payment data are NEVER collected, transmitted or stored by Board Game Arena.")+"\n"+_("Your infos are collected and processed exclusively by our payment service Stripe.com.")+"\n"+_("We are going to redirect you to Stripe.com privacy policy."))})))}}else{if(void 0===this.bStripeIsLoading){this.bStripeIsLoading=!0;var i;(i=document.createElement("script")).setAttribute("src","https://checkout.stripe.com/checkout.js");$("stripe_script").appendChild(i)}if("undefined"==typeof StripeCheckout)setTimeout(e.hitch(this,"initStripe"),100);else{this.stripeHandler=StripeCheckout.configure({key:$("stripe_key").innerHTML,image:getStaticAssetUrl("/img/logo/logo.png"),locale:dojoConfig.locale,token:e.hitch(this,"payWithStripe")});window.addEventListener("popstate",e.hitch(this,(function(){this.stripeHandler.close()})))}}},stripePaymentResultHandler:function(t){bOneTimePayment=!1;"undefined"!=typeof current_player_id&&$("target_player").innerHTML!=current_player_id&&(bOneTimePayment=!0);this.bOffer&&(bOneTimePayment=!0);if(t.error){document.getElementById("card-errors").textContent=t.error.message;this.shakePaymentWindow();e.removeClass("bga_payment_button_wrap","Button--disableClick");$("bga_payment_button").innerHTML=this.latest_bga_button_label}else{e.removeClass("bga_payment_button_wrap","Button--disableClick");e.addClass("bga_payment_button_wrap","Button--success");$("bga_payment_button").innerHTML='<i class="fa fa-check-circle-o fa-lg" aria-hidden="true" style="position:relative;top:8px;"></i>';this.bOffer?gotourl("premium?confirmpayment&offer"):bOneTimePayment?gotourl("premium?confirmpayment"):this.stripeTokenHandler(t.token)}},initBraintree:function(){e.connect($("bga_payment_close"),"onclick",this,(function(){e.style("bga_payment_layout","display","none")}));require(["https://js.braintreegateway.com/web/dropin/1.16.0/js/dropin.min.js"],e.hitch(this,(function(t){t.create({authorization:$("braintree_key").innerHTML,container:"#braintree-dropin",vaultManager:!0},e.hitch(this,(function(t,i){if(!t){document.getElementById("braintree-payment-form").addEventListener("submit",e.hitch(this,(function(t){t.preventDefault();bOneTimePayment=!1;("undefined"!=typeof current_player_id&&$("target_player").innerHTML!=current_player_id||this.bOffer)&&(bOneTimePayment=!0);if(e.hasClass("bga_braintree_payment_button_wrap","Button--disableClick")||e.hasClass("bga_braintree_payment_button_wrap","Button--success"))this.page.showMessage(_("Please wait, a payment is already in progress..."),"error");else if(0!=$("braintree_accept_tos").innerHTML&&1!=$("braintree_agree_tos").checked){$("braintree-card-errors").textContent=_("You must agree with Term of Sales");this.shakePaymentWindow()}else{e.addClass("bga_payment_button_wrap","Button--disableClick");i.requestPaymentMethod(e.hitch(this,"braintreePaymentResultHandler"))}})))}})))})))},braintreePaymentResultHandler:function(t,i){this.latest_bga_button_label=$("bga_braintree_payment_button").innerHTML;$("bga_braintree_payment_button").innerHTML='<i class="fa fa-spinner fa-pulse fa-lg" aria-hidden="true" style="position:relative;top:8px;"></i>';if(t){$("card-errors").textContent=t;this.shakePaymentWindow();$("bga_braintree_payment_button").innerHTML=this.latest_bga_button_label}else{this.page.showMessage(_("Please wait few seconds while we are upgrading up your account ..."),"info");var n={paymentToken:i.nonce,paymentMethod:$("payment_method").innerHTML,email:$("target_player_email").innerHTML,target:$("target_player").innerHTML,plan:this.currentPaymentPlan,currency:$("currency").innerHTML};this.page.ajaxcall("/premium/premium/doPayment.html",n,this,e.hitch(this,(function(t){if("undefined"!=typeof gotourl)gotourl("premium?confirmpayment");else{this.page.showMessage(_("You are awesome! Starting next game you'll enjoy your Premium membership!"),"info");e.style("bga_payment_layout","display","none")}})),(function(t){setTimeout((function(){e.style("bga_payment_layout","display","none")}),1e3)}))}},setBrandIcon:function(t){document.getElementById("brand-icon");if(t in{visa:"fa-cc-visa",mastercard:"fa-cc-mastercard",amex:"fa-cc-amex",discover:"fa-cc-discover",diners:"fa-cc-dinners-club",jcb:"fa-cc-jcb"}){$("brand-icon").src=getStaticAssetUrl("img/common/cc_"+t+".png");e.style("brand-icon","display","block")}else e.style("brand-icon","display","none")},onClickWechatButton:function(t,i){var n=2400;n=t%100==12?2400:800;this.saveWeChatButtonContent=i.innerHTML;i.innerHTML='<i class="fa fa-spinner fa-spin fa-fw"></i>';this.stripe.createSource({type:"wechat",amount:n,currency:"eur",statement_descriptor:"Player "+$("target_player").innerHTML}).then(e.hitch(this,(function(e){i.innerHTML=this.saveWeChatButtonContent;if(e.source){this.wechatDlg=new ebg.popindialog;this.wechatDlg.create("wechatDlg");this.wechatDlg.setTitle(__("lang_mainsite","Please use your WeChat app to confirm the payment"));var t='<div id="wechatContent">';t+="<p>"+_("Note: because WeChat is doing its own currency conversion, the amount displayed below may be slightly different that our price. Sorry about this.")+"</p>";t+='<div id="qrcode" style="margin:auto;width:256px;height:256px;margin-top: 50px;margin-bottom: 50px;"></div>';t+="<p style='text-align:center'><a href='"+e.source.wechat.qr_code_url+"' target='_blank'>"+_("... or click here to open your WeChap app")+"</a></p>";t+="</div>";this.wechatDlg.setContent(t);this.wechatDlg.show();new QRCode(document.getElementById("qrcode"),{text:e.source.wechat.qr_code_url,width:256,height:256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})}else this.page.showMessage("Error during wechat source creation","error")})))},onWeChatPaymentSucceeded:function(){if(this.wechatDlg){this.wechatDlg.destroy();"undefined"!=typeof gotourl?gotourl("premium?confirmpayment"):this.page.showMessage(_("You are awesome! Starting next game you'll enjoy your Premium membership!"),"info")}},onClickPaymentButton:function(t){var i="",n="",o=!1,a=_("Subscribe");"stripe"===$("payment_method").innerHTML&&e.style("payment-form","display","block");if("braintree"===$("payment_method").innerHTML){e.style("braintree-payment-form","display","block");$("planId").value=t}1==$("accept_tos").innerHTML&&(t%100==2?a=e.string.substitute(_("Subscribe for ${price}"),{price:$("price_1month").innerHTML}):t%100==12&&(a=e.string.substitute(_("Subscribe for ${price}"),{price:$("price_12months").innerHTML})));if("undefined"!=typeof current_player_id&&$("target_player").innerHTML!=current_player_id){a=_("Offer membership");o=!0}if("offer"==t){a=_("Buy Premium codes");o=!0}this.page.ajaxcall("/premium/premium/paymentTrack.html",{track:"CLICKED "+t+" "+$("currency").innerHTML+" "+$("payment_method").innerHTML},this,e.hitch(this,(function(e){})));dataLayer&&dataLayer.push({event:"addToCart",ecommerce:{currencyCode:$("currency").innerHTML,add:{products:[{id:t,name:a,price:0,quantity:"1"}]}}});var s=this.bUseCreditCardElements;if(o){this.paymentIntent_secret=null;var r={plan:t,currency:$("currency").innerHTML,email:$("target_player_email").innerHTML,target:$("target_player").innerHTML};if("offer"==t){r.plan=0;r.nbr=toint($("offer_nbr").value);r.type=toint($("offer_type").value)}this.page.ajaxcall("/premium/premium/paymentIntent.html",r,this,e.hitch(this,(function(e){this.paymentIntent_secret=e.client_secret})))}if(t%100==2){i=_("Monthly membership");n=$("price_1month").innerHTML;o&&(i=_("1 month membership"))}else if(t%100==6){i=_("6 month membership");n=$("price_6months").innerHTML}else if(t%100==12){i=_("Yearly membership");n=$("price_12months").innerHTML+" "+$("premium_save_12_months").innerHTML;o&&(i=_("1 year membership"))}else if("offer"==t){12==$("offer_type").value?i=_("1 year membership"):1==$("offer_type").value&&(i=_("1 month membership"));i+=" x"+toint($("offer_nbr").value);n=_("Total price")+": "+$("total_price_currency").innerHTML}if(s){$("bga_payment_name").innerHTML=i;$("bga_payment_descr").innerHTML=n;$("bga_payment_email").innerHTML=_("Account")+": "+$("target_player_username").innerHTML;$("bga_payment_email").title=$("target_player_email").innerHTML;$("bga_payment_button").innerHTML=a;$("bga_braintree_payment_button").innerHTML=a;e.removeClass("bga_payment_button_wrap","Button--success");e.removeClass("bga_braintree_payment_button_wrap","Button--success");var l=e.window.getBox(),d=Math.max(0,(l.h-400)/2-30);"braintree"==$("payment_method").innerHTML&&(d=Math.max(0,(l.h-650)/2-30));e.style("bga_payment_window","marginTop",d+"px");if(0==$("accept_tos").innerHTML){e.style("accept_tos_block","display","none");e.style("braintree_accept_tos_block","display","none")}else{e.style("accept_tos_block","display","block");e.style("braintree_accept_tos_block","display","block")}"offer"==t&&($("bga_payment_email").innerHTML=_("BGA Premium codes"));e.style("bga_payment_layout","display","block");void 0!==this.card?this.card.focus():"braintree"===$("payment_method").innerHTML&&scroll(0,0)}else this.stripeHandler.open({name:i,description:n,zipCode:!1,email:$("target_player_email").innerHTML,bitcoin:!1,allowRememberMe:!1,panelLabel:a});this.currentPaymentPlan=t},stripeTokenHandler:function(t){this.bOffer?this.page.showMessage(_("Please wait few seconds while we checking your payment ..."),"info"):this.page.showMessage(_("Please wait few seconds while we are upgrading up your account ..."),"info");var i={paymentToken:t.id,paymentMethod:$("payment_method").innerHTML,email:$("target_player_email").innerHTML,target:$("target_player").innerHTML,plan:this.currentPaymentPlan,currency:$("currency").innerHTML};$("agree_tos").checked&&(i.tos_agreed=!0);this.page.ajaxcall("/premium/premium/paymentTrack.html",{track:"ATTEMPT "+this.currentPaymentPlan+" "+$("currency").innerHTML+" "+$("payment_method").innerHTML},this,e.hitch(this,(function(e){})));this.page.ajaxcall("/premium/premium/doPayment.html",i,this,e.hitch(this,(function(t){if(void 0!==t.requires_action&&t.requires_action){var i=t.client_secret;this.page.showMessage(_("We are redirecting you to your bank to confirm the payment..."),"info");e.style("bga_payment_layout","display","none");this.stripe.handleCardPayment(i).then(e.hitch(this,(function(e){e.error?this.page.showMessage(_("Sorry, the payment have failed :(")+" "+e.error,"error"):"undefined"!=typeof gotourl?gotourl("premium?confirmpayment"):this.page.showMessage(_("You are awesome! Starting next game you'll enjoy your Premium membership!"),"info")})))}else if("undefined"!=typeof gotourl)gotourl("premium?confirmpayment");else{this.page.showMessage(_("You are awesome! Starting next game you'll enjoy your Premium membership!"),"info");e.style("bga_payment_layout","display","none")}})),(function(t){setTimeout((function(){e.style("bga_payment_layout","display","none")}),1e3)}))},payWithStripe:function(e){this.page.showMessage(_("Please wait few seconds while we are upgrading up your account ..."),"info");this.page.ajaxcall("/premium/premium/doPayment.html",{paymentToken:e.id,paymentMethod:$("payment_method").innerHTML,email:$("target_player_email").innerHTML,target:$("target_player").innerHTML,plan:this.currentPaymentPlan,currency:$("currency").innerHTML},this,(function(e){"undefined"!=typeof gotourl?gotourl("premium?confirmpayment"):this.page.showMessage(_("You are awesome! Starting next game you'll enjoy your Premium membership!"),"info")}))},onCancelSubscription:function(t){e.stopEvent(t);"cancel_stripe_subscription_trial"==t.currentTarget.id?this.page.confirmationDialog(_("If you end your Premium trial, your account will imediately be downgraded to Standard. The automatic membership renewal for your account will be cancelled, and you will not be charged."),e.hitch(this,(function(){this.page.ajaxcall("/premium/premium/cancelSubscription.html",{},this,(function(e){mainsite.gotourl_forcereload("premium");this.page.showMessage(_("Done! The automatic membership renewal has been removed, and your account is not Premium anymore."),"info")}))}))):this.page.confirmationDialog(_("Your account will remains Premium until the end of the current period, then there will be no automatic renewal."),e.hitch(this,(function(){this.page.ajaxcall("/premium/premium/cancelSubscription.html",{},this,(function(e){mainsite.gotourl_forcereload("premium");this.page.showMessage(_("Done! The automatic membership renewal has been removed. Your account will be downgraded to Standard at the end of the current period."),"info")}))})))},onPaymentMethodChange:function(t){e.stopEvent(t);var i=t.currentTarget.id.substr(14),n="premium?";this.bOffer&&(n+="offer&");if("btc"==i){mainsite.gotourl_forcereload(n+"paymentmethod=bitcoin");this.page.showMessage(_("Done! Please choose a payment button."),"info")}else if("paypal"==i){mainsite.gotourl_forcereload(n+"paymentmethod=paypal");this.page.showMessage(_("Done! Please choose a payment button."),"info")}else if("wechat"==i){mainsite.gotourl_forcereload(n+"paymentmethod=wechat");this.page.showMessage(_("Done! Please choose a payment button."),"info")}else"eur"==i?mainsite.gotourl_forcereload(n+"country=DE"):"usd"==i?mainsite.gotourl_forcereload(n+"country=US"):"gbp"==i?mainsite.gotourl_forcereload(n+"country=GB"):"cad"==i?mainsite.gotourl_forcereload(n+"country=CA"):"jpy"==i&&mainsite.gotourl_forcereload(n+"country=JP")},shakePaymentWindow:function(){e.addClass("bga_payment_window","ModalContainer--animating");e.addClass("bga_payment_window_content","Modal-animationWrapper Modal-animationWrapper--shake");setTimeout(e.hitch(this,(function(){e.removeClass("bga_payment_window","ModalContainer--animating");e.removeClass("bga_payment_window_content","Modal-animationWrapper Modal-animationWrapper--shake")})),500)}})}))},"ebg/expandablesection":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.expandablesection",null,{constructor:function(){this.page=null;this.div_id=null},create:function(t,i){this.page=t;this.div_id=i;e.query("#"+this.div_id+" .expandabletoggle").connect("onclick",this,"toggle")},destroy:function(){},toggle:function(t){void 0!==t&&t.preventDefault();var i=e.query("#"+this.div_id+" .expandablecontent")[0];"none"==e.style(i,"display")?this.expand():this.collapse()},expand:function(){var t=e.query("#"+this.div_id+" .expandablecontent")[0],i=e.query("#"+this.div_id+" .expandablearrow div")[0];e.style(t,"display","block");e.removeClass(i,"icon20_expand");e.addClass(i,"icon20_collapse")},collapse:function(){var t=e.query("#"+this.div_id+" .expandablecontent")[0],i=e.query("#"+this.div_id+" .expandablearrow div")[0];e.style(t,"display","none");e.removeClass(i,"icon20_collapse");e.addClass(i,"icon20_expand")}})}))},"ebg/comboajax":function(){define(["dojo","dojo/_base/declare","dijit/form/FilteringSelect","dojox/data/QueryReadStore"],(function(e,t){return t("ebg.comboajax",null,{constructor:function(){this.div_id=null;this.div=null;this.query_url="";this.stateStore=null;this.filteringSelect=null;this.currentSelection=null;this.disableNextOnChange=!1},create:function(t,i,n,o){this.div_id=t;this.div=$(t);this.div;this.query_url=i;this.stateStore=new dojox.data.QueryReadStore({url:this.query_url});void 0===n&&(n=__("lang_mainsite","Start typing..."));void 0===o&&(o="");this.filteringSelect=new dijit.form.FilteringSelect({id:t,name:t,store:this.stateStore,searchAttr:"q",value:o,queryExpr:"${0}",hasDownArrow:!1,invalidMessage:n},t);this.div=$(t);this.div.value=n;e.connect(this.div,"onfocus",this,(function(e){this.div.value="";this.filteringSelect.loadAndOpenDropDown()}));e.connect(dijit.byId(this.div_id),"onChange",this,(function(e){var i=dijit.byId(t);if(null!==i&&null!==i.item&&i.item){var n=i.item.i.id;this.currentSelection=n;this.disableNextOnChange||this.onChange(n)}this.disableNextOnChange=!1}));e.connect(this.div,"onkeyup",this,"onKeyUp")},onKeyUp:function(e){var t=dijit.byId(this.div_id);if(13==e.keyCode&&null!==t.item){var i=t.item.i.id;this.currentSelection=i;this.onChange(i)}},setValue:function(e){this.filteringSelect.attr("displayedValue",e)},onChange:function(e){},destroy:function(e){dijit.byId(this.div_id).destroy()},getSelection:function(){return this.filteringSelect.item&&this.filteringSelect.item.i&&this.filteringSelect.item.i.id?this.filteringSelect.item.i.id:null},setSelection:function(e,t){this.disableNextOnChange=t;this.stateStore.url=this.query_url+"?q="+e;this.stateStore.close();this.filteringSelect.set("displayedValue",e)}})}))},"dojox/data/QueryReadStore":function(){define(["dojo","dojox","dojo/data/util/sorter","dojo/string"],(function(e,t){return e.declare("dojox.data.QueryReadStore",null,{url:"",requestMethod:"get",_className:"dojox.data.QueryReadStore",_items:[],_lastServerQuery:null,_numRows:-1,lastRequestHash:null,doClientPaging:!1,doClientSorting:!1,_itemsByIdentity:null,_identifier:null,_features:{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0},_labelAttr:"label",constructor:function(t){e.mixin(this,t)},getValue:function(t,i,n){this._assertIsItem(t);if(!e.isString(i))throw new Error(this._className+".getValue(): Invalid attribute, string expected!");return!this.hasAttribute(t,i)&&n?n:t.i[i]},getValues:function(e,t){this._assertIsItem(e);var i=[];this.hasAttribute(e,t)&&i.push(e.i[t]);return i},getAttributes:function(e){this._assertIsItem(e);var t=[];for(var i in e.i)t.push(i);return t},hasAttribute:function(e,t){return this.isItem(e)&&void 0!==e.i[t]},containsValue:function(e,t,i){for(var n=this.getValues(e,t),o=n.length,a=0;a<o;a++)if(n[a]==i)return!0;return!1},isItem:function(e){return!!e&&(void 0!==e.r&&e.r==this)},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this.isItemLoaded(e.item)},fetch:function(t){(t=t||{}).store||(t.store=this);var i=this;this._fetchItems(t,(function(t,n,o){var a=n.abort||null,s=!1,r=n.start?n.start:0;0==i.doClientPaging&&(r=0);var l=n.count?r+n.count:t.length;n.abort=function(){s=!0;a&&a.call(n)};var d=n.scope||e.global;n.store||(n.store=i);n.onBegin&&n.onBegin.call(d,o,n);n.sort&&i.doClientSorting&&t.sort(e.data.util.sorter.createSortFunction(n.sort,i));if(n.onItem)for(var c=r;c<t.length&&c<l;++c){var h=t[c];s||n.onItem.call(d,h,n)}if(n.onComplete&&!s){var u=null;n.onItem||(u=t.slice(r,l));n.onComplete.call(d,u,n)}}),(function(t,i){if(i.onError){var n=i.scope||e.global;i.onError.call(n,t,i)}}));return t},getFeatures:function(){return this._features},close:function(e){},getLabel:function(e){if(this._labelAttr&&this.isItem(e))return this.getValue(e,this._labelAttr)},getLabelAttributes:function(e){return this._labelAttr?[this._labelAttr]:null},_xhrFetchHandler:function(t,i,n,o){(t=this._filterResponse(t)).label&&(this._labelAttr=t.label);var a=t.numRows||-1;this._items=[];e.forEach(t.items,(function(e){this._items.push({i:e,r:this})}),this);var s=t.identifier;this._itemsByIdentity={};if(s){this._identifier=s;var r;for(r=0;r<this._items.length;++r){var l=this._items[r].i,d=l[s];if(this._itemsByIdentity[d])throw new Error(this._className+":  The json data as specified by: ["+this.url+"] is malformed.  Items within the list have identifier: ["+s+"].  Value collided: ["+d+"]");this._itemsByIdentity[d]=l}}else{this._identifier=Number;for(r=0;r<this._items.length;++r)this._items[r].n=r}a=this._numRows=-1===a?this._items.length:a;n(this._items,i,a);this._numRows=a},_fetchItems:function(t,i,n){var o=t.serverQuery||t.query||{};if(!this.doClientPaging){o.start=t.start||0;t.count&&(o.count=t.count)}if(!this.doClientSorting&&t.sort){var a=[];e.forEach(t.sort,(function(e){e&&e.attribute&&a.push((e.descending?"-":"")+e.attribute)}));o.sort=a.join(",")}if(this.doClientPaging&&null!==this._lastServerQuery&&e.toJson(o)==e.toJson(this._lastServerQuery)){this._numRows=-1===this._numRows?this._items.length:this._numRows;i(this._items,t,this._numRows)}else{var s=("post"==this.requestMethod.toLowerCase()?e.xhrPost:e.xhrGet)({url:this.url,handleAs:"json-comment-optional",content:o,failOk:!0});t.abort=function(){s.cancel()};s.addCallback(e.hitch(this,(function(e){this._xhrFetchHandler(e,t,i,n)})));s.addErrback((function(e){n(e,t)}));this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=e.mixin({},o)}},_filterResponse:function(e){return e},_assertIsItem:function(e){if(!this.isItem(e))throw new Error(this._className+": Invalid item argument.")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error(this._className+": Invalid attribute argument ('"+e+"').")},fetchItemByIdentity:function(t){if(this._itemsByIdentity){var i=this._itemsByIdentity[t.identity];if(void 0!==i){if(t.onItem){var n=t.scope?t.scope:e.global;t.onItem.call(n,{i:i,r:this})}return}}var o={serverQuery:{id:t.identity}};this._fetchItems(o,(function(i,n){var o=t.scope?t.scope:e.global;try{var a=null;i&&1==i.length&&(a=i[0]);t.onItem&&t.onItem.call(o,a)}catch(s){t.onError&&t.onError.call(o,s)}}),(function(i,n){var o=t.scope?t.scope:e.global;t.onError&&t.onError.call(o,i)}))},getIdentity:function(e){return this._identifier===Number?e.n:e.i[this._identifier]},getIdentityAttributes:function(e){return[this._identifier]}})}))},"dojox/main":function(){define(["dojo/_base/kernel"],(function(e){return e.dojox}))},"ebg/counter":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.counter",null,{constructor:function(){this.span=null;this.current_value=0;this.target_value=0;this.speed=100},create:function(e){"string"==typeof e&&(e=$(e));this.span=e;this.span.innerHTML=this.current_value},getValue:function(){return this.target_value},setValue:function(e){this.current_value=toint(e);this.target_value=toint(e);this.span.innerHTML=this.current_value},toValue:function(t){this.target_value=toint(t);this.current_value!=this.target_value&&e.addClass(this.span,"counter_in_progress");setTimeout(e.hitch(this,this.makeCounterProgress),this.speed)},incValue:function(e){this.toValue(parseInt(this.target_value,10)+parseInt(toint(e),10));return this.target_value},disable:function(){this.span.innerHTML="-"},makeCounterProgress:function(){if(this.current_value!=this.target_value){var t=Math.ceil(Math.abs(this.target_value-this.current_value)/5);this.current_value<this.target_value?this.current_value+=t:this.current_value-=t;this.span.innerHTML=this.current_value;setTimeout(e.hitch(this,this.makeCounterProgress),this.speed)}else setTimeout(e.hitch(this,this.finishCounterMove),1e3)},finishCounterMove:function(){this.current_value==this.target_value&&e.removeClass(this.span,"counter_in_progress")}})}))},"ebg/scrollmap":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.scrollmap",null,{constructor:function(){this.container_div=null;this.scrollable_div=null;this.surface_div=null;this.onsurface_div=null;this.isdragging=!1;this.dragging_offset_x=0;this.dragging_offset_y=0;this.dragging_handler=null;this.dragging_handler_touch=null;this.board_x=0;this.board_y=0;this.bEnableScrolling=!0},create:function(t,i,n,o){this.container_div=t;this.scrollable_div=i;this.surface_div=n;this.onsurface_div=o;e.connect(this.surface_div,"onmousedown",this,"onMouseDown");e.connect(this.surface_div,"ontouchstart",this,"onMouseDown");e.connect($("ebd-body"),"onmouseup",this,"onMouseUp");e.connect($("ebd-body"),"ontouchend",this,"onMouseUp");this.scrollto(0,0)},onMouseDown:function(t){if(this.bEnableScrolling){this.isdragging=!0;var i=e.position(this.scrollable_div),n=e.position(this.container_div);this.dragging_offset_x=t.pageX-(i.x-n.x);this.dragging_offset_y=t.pageY-(i.y-n.y);this.dragging_handler=e.connect($("ebd-body"),"onmousemove",this,"onMouseMove");this.dragging_handler_touch=e.connect($("ebd-body"),"ontouchmove",this,"onMouseMove")}},onMouseUp:function(t){if(!0===this.isdragging){this.isdragging=!1;e.disconnect(this.dragging_handler);e.disconnect(this.dragging_handler_touch)}},onMouseMove:function(t){if(!0===this.isdragging){var i=e.style(this.container_div,"width"),n=e.style(this.container_div,"height"),o=t.pageX-this.dragging_offset_x;e.style(this.scrollable_div,"left",o+"px");e.style(this.onsurface_div,"left",o+"px");var a=t.pageY-this.dragging_offset_y;e.style(this.scrollable_div,"top",a+"px");e.style(this.onsurface_div,"top",a+"px");this.board_x=o-i/2;this.board_y=a-n/2;e.style(e.body(),"backgroundPosition",o+"px "+a+"px");e.stopEvent(t)}},scroll:function(e,t,i,n){void 0===i&&(i=350);void 0===n&&(n=0);this.scrollto(toint(this.board_x)+e,toint(this.board_y)+t,i,n)},scrollto:function(t,i,n,o){void 0===n&&(n=350);void 0===o&&(o=0);var a=t+e.style(this.container_div,"width")/2,s=i+e.style(this.container_div,"height")/2;this.board_x=t;this.board_y=i;e.fx.combine([e.fx.slideTo({node:this.scrollable_div,top:s,left:a,unit:"px",duration:n,delay:o}),e.fx.slideTo({node:this.onsurface_div,top:s,left:a,unit:"px",duration:n,delay:o})]).play()},scrollToCenter:function(t){var i=0,n=0,o=0,a=0,s="#"+this.scrollable_div.id+" > *";void 0!==t&&(s=t);e.query(s).forEach(e.hitch(this,(function(t){i=Math.max(i,e.style(t,"left")+e.style(t,"width"));o=Math.min(o,e.style(t,"left"));n=Math.max(n,e.style(t,"top")+e.style(t,"height"));a=Math.min(a,e.style(t,"top"))})));this.scrollto(-(o+i)/2,-(a+n)/2)},getMapCenter:function(t){var i=0,n=0,o=0,a=0,s="#"+this.scrollable_div.id+" > *";void 0!==t&&(s=t);e.query(s).forEach(e.hitch(this,(function(t){i=Math.max(i,e.style(t,"left")+e.style(t,"width"));o=Math.min(o,e.style(t,"left"));n=Math.max(n,e.style(t,"top")+e.style(t,"height"));a=Math.min(a,e.style(t,"top"))})));return{x:(o+i)/2,y:(a+n)/2}},setupOnScreenArrows:function(t){this.scrollDelta=t;$("movetop")&&e.connect($("movetop"),"onclick",this,"onMoveTop");$("moveleft")&&e.connect($("moveleft"),"onclick",this,"onMoveLeft");$("moveright")&&e.connect($("moveright"),"onclick",this,"onMoveRight");$("movedown")&&e.connect($("movedown"),"onclick",this,"onMoveDown");e.query("#"+this.container_div.id+" .movetop").connect("onclick",this,"onMoveTop").style("cursor","pointer");e.query("#"+this.container_div.id+" .movedown").connect("onclick",this,"onMouseDown").style("cursor","pointer");e.query("#"+this.container_div.id+" .moveleft").connect("onclick",this,"onMoveLeft").style("cursor","pointer");e.query("#"+this.container_div.id+" .moveright").connect("onclick",this,"onMoveRight").style("cursor","pointer")},onMoveTop:function(e){e.preventDefault();this.scroll(0,this.scrollDelta)},onMoveLeft:function(e){e.preventDefault();this.scroll(this.scrollDelta,0)},onMoveRight:function(e){e.preventDefault();this.scroll(-this.scrollDelta,0)},onMoveDown:function(e){e.preventDefault();this.scroll(0,-this.scrollDelta)},isVisible:function(t,i){var n=e.style(this.container_div,"width"),o=e.style(this.container_div,"height");return t>=-this.board_x-n/2&&t<=-this.board_x+n/2&&i>=-this.board_y-o/2&&i<-this.board_y+o/2},enableScrolling:function(){if(!this.bEnableScrolling){this.bEnableScrolling=!0;e.query("#"+this.container_div.id+" .movetop").style("display","block");e.query("#"+this.container_div.id+" .moveleft").style("display","block");e.query("#"+this.container_div.id+" .moveright").style("display","block");e.query("#"+this.container_div.id+" .movedown").style("display","block")}},disableScrolling:function(){if(this.bEnableScrolling){this.bEnableScrolling=!1;e.query("#"+this.container_div.id+" .movetop").style("display","none");e.query("#"+this.container_div.id+" .moveleft").style("display","none");e.query("#"+this.container_div.id+" .moveright").style("display","none");e.query("#"+this.container_div.id+" .movedown").style("display","none")}}})}))},"ebg/stock":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.stock",null,{constructor:function(){this.page=null;this.container_div=null;this.item_height=null;this.item_width=null;this.backgroundSize=null;this.item_type={};this.items=[];this.item_selected={};this.next_item_id=1;this.control_name=null;this.selectable=2;this.selectionApparance="border";this.apparenceBorderWidth="1px";this.selectionClass="stockitem_selected";this.extraClasses="";this.centerItems=!1;this.item_margin=5;this.autowidth=!1;this.order_items=!0;this.horizontal_overlap=0;this.vertical_overlap=0;this.use_vertical_overlap_as_offset=!0;this.onItemCreate=null;this.onItemDelete=null;this.jstpl_stock_item='<div id="${id}" class="stockitem ${extra_classes}" style="top:${top}px;left:${left}px;width:${width}px;height:${height}px;${position};background-image:url(\'${image}\');${additional_style}"></div>';this.image_items_per_row=null;this.image_in_vertical_row=!1;this.hResize=null;this.duration=1e3},create:function(t,i,n,o){this.page=t;this.container_div=i;this.item_width=n;this.item_height=o;this.control_name=i.id;"absolute"!=e.style(this.container_div,"position")&&e.style(this.container_div,"position","relative");this.hResize=e.connect(window,"onresize",this,e.hitch(this,(function(e){this.updateDisplay()})));t.registerEbgControl(this)},destroy:function(){null!==this.hResize&&e.disconnect(this.hResize);this.items={};this.page=null;this.container_div=null;this.control_name=null},count:function(){return this.items.length},addItemType:function(e,t,i,n){n||(n=0);this.item_type[e]={weight:toint(t),image:i,image_position:n}},addToStock:function(e,t){var i=this.next_item_id;this.next_item_id++;this.addToStockWithId(e,i,t)},addToStockWithId:function(t,i,n,o){var a={id:i,type:t},s=!0;void 0!==o&&(":first"==o?s=!1:a.loc=o);if($(this.getItemDivId(i))){for(var r in this.items){this.items[r].id==i&&this._removeFromStockItemInPosition(r)}e.destroy(this.getItemDivId(i))}s?this.items.push(a):this.items.unshift(a);if(this.order_items){this.sortItems()}this.updateDisplay(n)},removeFromStock:function(e,t,i){for(var n in this.items){if(this.items[n].type==e){this._removeFromStockItemInPosition(n,t,i);return!0}}return!1},removeFromStockById:function(e,t,i){for(var n in this.items){if(this.items[n].id==e){this._removeFromStockItemInPosition(n,t,i);return!0}}return!1},_removeFromStockItemInPosition:function(t,i,n){var o=function(t){e.destroy(t)},a=this.items[t];this.onItemDelete&&this.onItemDelete(this.getItemDivId(a.id),a.type,a.id);this.items.splice(t,1);var s=this.getItemDivId(a.id);this.unselectItem(a.id);item_div=$(s);if(void 0!==i)e.fx.chain([this.page.slideToObject(item_div,i),e.fadeOut({node:item_div,onEnd:o})]).play();else e.fadeOut({node:item_div,onEnd:o}).play();e.addClass(item_div,"to_be_destroyed");!0!==n&&this.updateDisplay()},removeAll:function(){for(var t in this.items){var i=this.items[t];this.onItemDelete&&this.onItemDelete(this.getItemDivId(i.id),i.type,i.id)}this.items=[];this.item_selected={};this.next_item_id=1;e.empty(this.control_name)},removeAllTo:function(e){var t=[];for(var i in this.items)t.push(this.items[i].id);for(var i in t)this.removeFromStockById(t[i],e,!0);this.updateDisplay()},getPresentTypeList:function(){var e={};for(var t in this.items){e[this.items[t].type]=1}return e},getItemDivId:function(e){return this.control_name+"_item_"+e},updateDisplay:function(t){if($(this.control_name)){var i=e.marginBox(this.control_name),n=this.item_width,o=0,a="auto";if(0!=this.horizontal_overlap){n=Math.round(this.item_width*this.horizontal_overlap/100);o=this.item_width-n;a=1}var s=0;0!=this.vertical_overlap&&(s=Math.round(this.item_height*this.vertical_overlap/100)*(this.use_vertical_overlap_as_offset?1:-1));var r=i.w;if(this.autowidth){r=e.marginBox($("page-content")).w}var l=0,d=0,c=Math.max(1,Math.floor((r-o)/(n+this.item_margin))),h=0,u=0,p=0;for(var m in this.items){var g=this.items[m],_=this.getItemDivId(g.id);"auto"!=a&&a++;if(void 0===g.loc){var f=Math.floor(p/c);l=(h=Math.max(h,f))*(this.item_height+s+this.item_margin);d=(p-h*c)*(n+this.item_margin);u=Math.max(u,d+n);0!=this.vertical_overlap&&p%2==0&&this.use_vertical_overlap_as_offset&&(l+=s);if(this.centerItems){d+=(r-(f==Math.floor(this.count()/c)?this.count()%c:c)*(n+this.item_margin))/2}p++}var v=$(_);if(v){void 0===g.loc?e.fx.slideTo({node:v,top:l,left:d,duration:this.duration,unit:"px"}).play():this.page.slideToObject(v,g.loc,this.duration).play();"auto"!=a&&e.style(v,"zIndex",a)}else{var b=this.item_type[g.type];additional_style="";null!==this.backgroundSize&&(additional_style+="background-size:"+this.backgroundSize);var y=e.trim(e.string.substitute(this.jstpl_stock_item,{id:_,width:this.item_width,height:this.item_height,top:l,left:d,image:b.image,position:"auto"==a?"":"z-index:"+a,extra_classes:this.extraClasses,additional_style:additional_style}));e.place(y,this.control_name);v=$(_);void 0!==g.loc&&this.page.placeOnObject(v,g.loc);0==this.selectable&&e.addClass(v,"stockitem_unselectable");e.connect(v,"onclick",this,"onClickOnItem");if(0!==toint(b.image_position)){var w=0,C=0;if(this.image_items_per_row){var k=Math.floor(b.image_position/this.image_items_per_row);if(this.image_in_vertical_row){C=100*(b.image_position-k*this.image_items_per_row);w=100*k}else{w=100*(b.image_position-k*this.image_items_per_row);C=100*k}e.style(v,"backgroundPosition","-"+w+"% -"+C+"%")}else{w=100*b.image_position;e.style(v,"backgroundPosition","-"+w+"% 0%")}}this.onItemCreate&&this.onItemCreate(v,g.type,_);if(void 0!==t){this.page.placeOnObject(v,t);if(void 0===g.loc){var x=e.fx.slideTo({node:v,top:l,left:d,duration:this.duration,unit:"px"});(x=this.page.transformSlideAnimTo3d(x,v,this.duration,null)).play()}else this.page.slideToObject(v,g.loc,this.duration).play()}else{e.style(v,"opacity",0);e.fadeIn({node:v}).play()}}}var T=(h+1)*(this.item_height+s+this.item_margin);e.style(this.control_name,"height",T+"px");if(this.autowidth){u>0&&(u+=this.item_width-n);e.style(this.control_name,"width",u+"px")}}},resetItemsPosition:function(){this.updateDisplay()},changeItemsWeight:function(e){for(var t in e){var i=e[t];this.item_type[t]&&(this.item_type[t].weight=i)}this.sortItems();this.updateDisplay()},sortItems:function(){var t=e.hitch(this,(function(e,t){return this.item_type[e.type].weight>this.item_type[t.type].weight?1:this.item_type[e.type].weight<this.item_type[t.type].weight?-1:0}));this.items.sort(t)},setSelectionMode:function(t){if(t!=this.selectable){this.unselectAll();this.selectable=t;0==t?e.query("#"+this.control_name+" .stockitem").addClass("stockitem_unselectable"):e.query("#"+this.control_name+" .stockitem_unselectable").removeClass("stockitem_unselectable")}},setSelectionAppearance:function(e){this.unselectAll();this.selectionApparance=e},isSelected:function(e){return!(!this.item_selected[e]||1!=this.item_selected[e])},selectItem:function(t){var i=$(this.getItemDivId(t));"border"==this.selectionApparance?e.style(i,"borderWidth",this.apparenceBorderWidth):"disappear"==this.selectionApparance?e.fadeOut({node:i}).play():"class"==this.selectionApparance&&e.addClass(i,this.selectionClass);this.item_selected[t]=1},unselectItem:function(t){var i=$(this.getItemDivId(t));"border"==this.selectionApparance?e.style(i,"borderWidth","0px"):"disappear"==this.selectionApparance?e.fadeIn({node:i}).play():"class"==this.selectionApparance&&e.removeClass(i,this.selectionClass);this.item_selected[t]=0},selectAll:function(){var e=!1;for(var t in this.items)if(!this.isSelected(this.items[t].id)){this.selectItem(this.items[t].id);e=!0}e&&this.onChangeSelection(this.control_name)},unselectAll:function(){var e=!1;for(var t in this.items)if(this.isSelected(this.items[t].id)){this.unselectItem(this.items[t].id);e=!0}e&&this.onChangeSelection(this.control_name)},onClickOnItem:function(e){e.stopPropagation();if(0!==this.selectable){var t=(this.control_name+"_item_").length,i=e.currentTarget.id.substr(t);if(this.isSelected(i))this.unselectItem(i);else{1===this.selectable&&this.unselectAll();this.selectItem(i)}this.onChangeSelection(this.control_name,i)}},onChangeSelection:function(e,t){},getSelectedItems:function(){var e=[];for(var t in this.items){var i=this.items[t];this.isSelected(i.id)&&e.push(i)}return e},getUnselectedItems:function(){var e=[];for(var t in this.items){var i=this.items[t];this.isSelected(i.id)||e.push(i)}return e},getItemNumber:function(){return this.items.length},getAllItems:function(){var e=[];for(var t in this.items)e.push(this.items[t]);return e},getItemsByType:function(e){var t=[];for(var i in this.items)this.items[i].type===e&&t.push(this.items[i]);return t},getFirstItemOfType:function(e){for(var t in this.items)if(this.items[t].type===e)return this.items[t];return null},getItemsByWeight:function(e){var t=[];for(var i in this.items)this.item_type[this.items[i].type].weight===e&&t.push(this.items[i]);return t},getFirstItemWithWeight:function(e){for(var t in this.items)if(this.item_type[this.items[t].type].weight===e)return this.items[t];return null},getItemById:function(e){for(var t in this.items)if(this.items[t].id==e)return this.items[t];return null},getItemTypeById:function(e){for(var t in this.items)if(this.items[t].id==e)return this.items[t].type;return null},getItemWeightById:function(e){for(var t in this.items)if(this.items[t].id==e)return this.item_type[this.items[t].type].weight;return null},selectItemsByType:function(e){for(var t in this.items)this.items[t].type!=e||this.isSelected(this.items[t].id)||this.selectItem(this.items[t].id)},unselectItemsByType:function(e){for(var t in this.items)this.items[t].type==e&&this.isSelected(this.items[t].id)&&this.unselectItem(this.items[t].id)},setOverlap:function(e,t){this.horizontal_overlap=e;this.vertical_overlap=void 0===t?0:t;this.updateDisplay()},resizeItems:function(t,i,n,o){this.item_height=i;this.item_width=t;e.query("#"+this.control_name+" .stockitem").style("width",t+"px");e.query("#"+this.control_name+" .stockitem").style("height",i+"px");if(void 0!==n&&void 0!==o){e.query("#"+this.control_name+" .stockitem").style("backgroundSize",n+"px "+o+"px");this.backgroundSize=n+"px "+o+"px"}this.updateDisplay()}})}))},"ebg/dices":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.dices",null,{constructor:function(){this.div_id=null;this.div=null;this.dice_nbr=2;this.dice_type=6},create:function(t,i,n){this.div_id=t;this.div=$(t);this.div;this.dice_nbr=i;this.dice_type=n;var o="dice"+this.dice_nbr+"d"+this.dice_type;e.addClass(this.div,o);for(var a=0;a<this.dice_nbr;a++)e.place("<div class='dice_inner_wrap'><div id='"+this.div_id+"_"+a+"' class='"+o+"_inner'></div></div>",this.div)},setValue:function(t){var i=e.position(this.div).h;for(var n in t){var o=(t[n]*this.dice_nbr+toint(n)-(this.dice_nbr-1))*i;e.style($(this.div_id+"_"+n),"backgroundPosition","0px -"+o+"px")}}})}))},"ebg/premiumpanel":function(){define(["dojo","dojo/_base/declare","dojox/fx"],(function(e,t){return t("ebg.premiumpanel",null,{constructor:function(){this.page=null;this.currentpanel=null},create:function(t){this.page=t;e.query(".premiummenuitem").connect("onclick",this,"onMenuItemClick");this.switchToPanel(0)},panel_id_to_name:function(e){return 0===toint(e)?"premiumtime":-1===toint(e)?"premiumconfig":"premiumplayer_"+e},switchToPanel:function(t){var i;if(null!==this.currentpanel){i=this.panel_id_to_name(this.currentpanel);e.style(i+"_title","display","none")}this.currentpanel=t;i=this.panel_id_to_name(this.currentpanel);e.style(i+"_title","display","inline-block");e.query(".premiuminfopanel").style("display","none");if(0===toint(t))e.style("premiumtimepanel","display","block");else if(-1===toint(t))e.style("premiumconfigpanel","display","block");else{e.style("premiumplayerpanel","display","block");if(!this.page.gamedatas.players[t])return;$("pr_seeplayerstat").href="/playerstat?id="+t+"&gamename="+this.page.game_name}},onMenuItemClick:function(e){e.preventDefault();if("premiumtime"==e.currentTarget.id)this.switchToPanel(0);else if("premiumconfig"==e.currentTarget.id)this.switchToPanel(-1);else{var t=e.currentTarget.id.substr(14);this.switchToPanel(t)}},seePlayerStats:function(e){e.preventDefault();this.currentpanel,this.page.game_name}})}))},"dojox/fx":function(){define(["./fx/_base"],(function(e){return e}))},"dojox/fx/_base":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/_base/fx","dojo/fx","dojo/dom","dojo/dom-style","dojo/dom-geometry","dojo/_base/connect","dojo/_base/html"],(function(e,t,i,n,o,a,s,r,l){var d=t.getObject("dojox.fx",!0);t.mixin(d,{anim:i.anim,animateProperty:i.animateProperty,fadeTo:i._fade,fadeIn:i.fadeIn,fadeOut:i.fadeOut,combine:n.combine,chain:n.chain,slideTo:n.slideTo,wipeIn:n.wipeIn,wipeOut:n.wipeOut});d.sizeTo=function(e){var s=e.node=o.byId(e.node),r="absolute",l=e.method||"chain";e.duration||(e.duration=500);"chain"==l&&(e.duration=Math.floor(e.duration/2));var d,c,h,u,p,m,g=null,_=(m=s,function(){var t=a.getComputedStyle(m),i=t.position,n=t.width,o=t.height;d=i==r?m.offsetTop:parseInt(t.top)||0;h=i==r?m.offsetLeft:parseInt(t.left)||0;p="auto"==n?0:parseInt(n);g="auto"==o?0:parseInt(o);u=h-Math.floor((e.width-p)/2);c=d-Math.floor((e.height-g)/2);if(i!=r&&"relative"!=i){var s=a.coords(m,!0);d=s.y;h=s.x;m.style.position=r;m.style.top=d+"px";m.style.left=h+"px"}}),f=i.animateProperty(t.mixin({properties:{height:function(){_();return{end:e.height||0,start:g}},top:function(){return{start:d,end:c}}}},e)),v=i.animateProperty(t.mixin({properties:{width:function(){return{start:p,end:e.width||0}},left:function(){return{start:h,end:u}}}},e));return n["combine"==e.method?"combine":"chain"]([f,v])};d.slideBy=function(e){var n,l,d,c=e.node=o.byId(e.node),h=(d=c,function(){var e=a.getComputedStyle(d),t=e.position;n="absolute"==t?d.offsetTop:parseInt(e.top)||0;l="absolute"==t?d.offsetLeft:parseInt(e.left)||0;if("absolute"!=t&&"relative"!=t){var i=s.coords(d,!0);n=i.y;l=i.x;d.style.position="absolute";d.style.top=n+"px";d.style.left=l+"px"}});h();var u=i.animateProperty(t.mixin({properties:{top:n+(e.top||0),left:l+(e.left||0)}},e));r.connect(u,"beforeBegin",u,h);return u};d.crossFade=function(e){var a=e.nodes[0]=o.byId(e.nodes[0]),s=l.style(a,"opacity"),r=e.nodes[1]=o.byId(e.nodes[1]);l.style(r,"opacity");return n.combine([i[0==s?"fadeIn":"fadeOut"](t.mixin({node:a},e)),i[0==s?"fadeOut":"fadeIn"](t.mixin({node:r},e))])};d.highlight=function(e){var n=e.node=o.byId(e.node);e.duration=e.duration||400;var a=e.color||"#ffff99",s=l.style(n,"backgroundColor");"rgba(0, 0, 0, 0)"==s&&(s="transparent");var d=i.animateProperty(t.mixin({properties:{backgroundColor:{start:a,end:s}}},e));"transparent"==s&&r.connect(d,"onEnd",d,(function(){n.style.backgroundColor=s}));return d};d.wipeTo=function(e){e.node=o.byId(e.node);var n=e.node,a=n.style,s=e.width?"width":"height",r=e[s],d={};d[s]={start:function(){a.overflow="hidden";if("hidden"==a.visibility||"none"==a.display){a[s]="1px";a.display="";a.visibility="";return 1}var e=l.style(n,s);return Math.max(e,1)},end:r};return i.animateProperty(t.mixin({properties:d},e))};return d}))},"ebg/wrapper":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.wrapper",null,{constructor:function(){this.page=null;this.container_div=null;this.container_id=null;this.container_inner_div=null;this.container_inner_id=null;this.item_size=95},create:function(t,i,n){this.page=t;this.container_div=i;this.container_id=i.id;this.container_inner_div=n;this.container_inner_id=n.id;"absolute"!=e.style(this.container_div,"position")&&e.style(this.container_div,"position","relative");e.style(this.container_inner_div,"position","absolute");e.style(this.container_inner_div,"top","0px");e.style(this.container_inner_div,"left","0px")},rewrap:function(){var t=null,i=null,n=null,o=null;e.query("#"+this.container_inner_id+" .building_tile").forEach(e.hitch(this,(function(a){var s=e.style(a,"left"),r=e.style(a,"top");if(null===t){t=s;i=r;n=toint(s)+toint(this.item_size);o=toint(r)+toint(this.item_size)}else{t=Math.min(t,s);i=Math.min(i,r);n=Math.max(n,toint(s)+toint(this.item_size));o=Math.max(o,toint(r)+toint(this.item_size))}})));e.style(this.container_div,"width",n-t+"px");e.style(this.container_div,"height",o-i+"px");var a=-t,s=-i;e.style(this.container_inner_div,"top",s+"px");e.style(this.container_inner_div,"left",a+"px")}})}))},"ebg/zone":function(){define(["dojo","dojo/_base/declare"],(function(e,t){return t("ebg.zone",null,{constructor:function(){this.page=null;this.container_div=null;this.item_height=null;this.item_width=null;this.instantaneous=!1;this.items=[];this.control_name=null;this.item_margin=5;this.autowidth=!1;this.autoheight=!0;this.item_pattern="grid"},create:function(t,i,n,o){this.page=t;this.container_div=i;this.item_width=n;this.item_height=o;this.control_name=i.id;"absolute"!=e.style(this.container_div,"position")&&e.style(this.container_div,"position","relative")},setFluidWidth:function(){e.connect(window,"onresize",this,"updateDisplay")},setPattern:function(e){switch(e){case"grid":case"diagonal":this.autoheight=!0;this.item_pattern=e;break;case"verticalfit":case"horizontalfit":case"ellipticalfit":this.autoheight=!1;this.item_pattern=e}},isInZone:function(e){for(var t in this.items){if(this.items[t].id==e)return!0}return!1},placeInZone:function(e,t){void 0===t&&(t=0);if(!this.isInZone(e)){this.items.push({id:e,weight:t});this.page.attachToNewParent($(e),this.container_div);this.items.sort((function(e,t){return e.weight>t.weight?1:e.weight<t.weight?-1:0}));this.updateDisplay()}},removeFromZone:function(t,i,n){var o=function(t){e.destroy(t)};for(var a in this.items){var s=this.items[a];if(s.id==t){var r=null;if(n){var l=500;this.instantaneous&&(l=1);r=this.page.slideToObject($(s.id),n,l).play();!0===i&&e.connect(r,"onEnd",o);r.play()}else if(!0===i){l=500;(this.page.instantaneousMode||this.instantaneous)&&(l=1);(r=e.fadeOut({node:$(s.id),duration:l,onEnd:o})).play()}this.items.splice(a,1);this.updateDisplay();return}}},removeAll:function(){var t=function(t){e.destroy(t)};for(var i in this.items){var n=this.items[i];anim=e.fadeOut({node:$(n.id),onEnd:t});anim.play()}this.items=[];this.updateDisplay()},updateDisplay:function(){var t=e.position(this.container_div),i=t.w;if(this.autowidth){i=e.position($("page-content")).w}var n=0,o=0,a=0;for(var s in this.items){var r=this.items[s].id,l=$(r);if(l){var d=this.itemIdToCoords(a,i,t.h,this.items.length);a++;n=Math.max(n,d.x+d.w);o=Math.max(o,d.y+d.h);var c=1e3;(this.page.instantaneousMode||this.instantaneous)&&(c=2);var h=e.fx.slideTo({node:l,top:d.y,left:d.x,duration:c,unit:"px"});(h=this.page.transformSlideAnimTo3d(h,l,c,null)).play()}}this.autoheight&&e.style(this.container_div,"height",o+"px");this.autowidth&&e.style(this.container_div,"width",n+"px")},itemIdToCoords:function(e,t,i,n){switch(this.item_pattern){case"grid":return this.itemIdToCoordsGrid(e,t,i,n);case"diagonal":return this.itemIdToCoordsDiagonal(e,t,i,n);case"verticalfit":return this.itemIdToCoordsVerticalFit(e,t,i,n);case"horizontalfit":return this.itemIdToCoordsHorizontalFit(e,t,i,n);case"ellipticalfit":return this.itemIdToCoordsEllipticalFit(e,t,i,n)}},itemIdToCoordsGrid:function(e,t){var i=Math.max(1,Math.floor(t/(this.item_width+this.item_margin))),n=Math.floor(e/i),o={};o.y=n*(this.item_height+this.item_margin);o.x=(e-n*i)*(this.item_width+this.item_margin);o.w=this.item_width;o.h=this.item_height;return o},itemIdToCoordsDiagonal:function(e,t){var i={};i.y=e*this.item_margin;i.x=e*this.item_margin;i.w=this.item_width;i.h=this.item_height;return i},itemIdToCoordsVerticalFit:function(e,t,i,n){var o={};o.w=this.item_width;o.h=this.item_height;var a=n*this.item_height;if(a<=i)var s=this.item_height,r=(i-a)/2;else s=(i-this.item_height)/(n-1),r=0;o.y=Math.round(e*s+r);o.x=0;return o},itemIdToCoordsHorizontalFit:function(e,t,i,n){var o={};o.w=this.item_width;o.h=this.item_height;var a=n*this.item_width;if(a<=t)var s=this.item_width,r=(t-a)/2;else s=(t-this.item_width)/(n-1),r=0;o.x=Math.round(e*s+r);o.y=0;return o},itemIdToCoordsEllipticalFit:function(e,t,i,n){var o=t/2,a=i/2,s=3.1415927,r={};r.w=this.item_width;r.h=this.item_height;var l=n-(e+1);if(l<=4){var d=r.w,c=r.h*a/o,h=s+l*(2*s/5);r.x=o+d*Math.cos(h)-r.w/2;r.y=a+c*Math.sin(h)-r.h/2}else if(l>4){d=2*r.w,c=2*r.h*a/o,h=s-s/2+(l-4)*(2*s/Math.max(10,n-5));r.x=o+d*Math.cos(h)-r.w/2;r.y=a+c*Math.sin(h)-r.h/2}return r},getItemNumber:function(){return this.items.length},getAllItems:function(){var e=[];for(var t in this.items)e.push(this.items[t].id);return e}})}))},"dojo/selector/acme":function(){define(["../dom","../sniff","../_base/array","../_base/lang","../_base/window"],(function(e,t,i,n,o){var a=n.trim,s=i.forEach,r=function(){return o.doc},l="BackCompat"==r().compatMode,d=">~+",c=!1,h=function(){return!0},u=function(e){d.indexOf(e.slice(-1))>=0?e+=" * ":e+=" ";for(var t,i,n=function(t,i){return a(e.slice(t,i))},o=[],s=-1,r=-1,l=-1,h=-1,u=-1,p=-1,m=-1,g="",_="",f=0,v=e.length,b=null,y=null,w=function(){!function(){if(p>=0){b.id=n(p,f).replace(/\\/g,"");p=-1}}();!function(){if(m>=0){var e=m==f?null:n(m,f);b[d.indexOf(e)<0?"tag":"oper"]=e;m=-1}}();!function(){if(u>=0){b.classes.push(n(u+1,f).replace(/\\/g,""));u=-1}}()},C=function(){w();h>=0&&b.pseudos.push({name:n(h+1,f)});b.loops=b.pseudos.length||b.attrs.length||b.classes.length;b.oquery=b.query=n(i,f);b.otag=b.tag=b.oper?null:b.tag||"*";b.tag&&(b.tag=b.tag.toUpperCase());if(o.length&&o[o.length-1].oper){b.infixOper=o.pop();b.query=b.infixOper.query+" "+b.query}o.push(b);b=null};g=_,_=e.charAt(f),f<v;f++)if("\\"!=g){if(!b){i=f;b={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return c?this.otag:this.tag}};m=f}if(t)_==t&&(t=null);else if("'"!=_&&'"'!=_)if(s>=0){if("]"==_){y.attr?y.matchFor=n(l||s+1,f):y.attr=n(s+1,f);var k=y.matchFor;k&&('"'!=k.charAt(0)&&"'"!=k.charAt(0)||(y.matchFor=k.slice(1,-1)));y.matchFor&&(y.matchFor=y.matchFor.replace(/\\/g,""));b.attrs.push(y);y=null;s=l=-1}else if("="==_){var x="|~^$*".indexOf(g)>=0?g:"";y.type=x+_;y.attr=n(s+1,f-x.length);l=f+1}}else if(r>=0){if(")"==_){h>=0&&(y.value=n(r+1,f));h=r=-1}}else if("#"==_){w();p=f+1}else if("."==_){w();u=f}else if(":"==_){w();h=f}else if("["==_){w();s=f;y={}}else if("("==_){if(h>=0){y={name:n(h+1,f),value:null};b.pseudos.push(y)}r=f}else" "==_&&g!=_&&C();else t=_}return o},p=function(e,t){return e?t?function(){return e.apply(window,arguments)&&t.apply(window,arguments)}:e:t},m=function(e,t){var i=t||[];e&&i.push(e);return i},g=function(e){return 1==e.nodeType},_=function(e,t){return e?"class"==t?e.className||"":"for"==t?e.htmlFor||"":"style"==t?e.style.cssText||"":(c?e.getAttribute(t):e.getAttribute(t,2))||"":""},f={"*=":function(e,t){return function(i){return _(i,e).indexOf(t)>=0}},"^=":function(e,t){return function(i){return 0==_(i,e).indexOf(t)}},"$=":function(e,t){return function(i){var n=" "+_(i,e),o=n.lastIndexOf(t);return o>-1&&o==n.length-t.length}},"~=":function(e,t){var i=" "+t+" ";return function(t){return(" "+_(t,e)+" ").indexOf(i)>=0}},"|=":function(e,t){var i=t+"-";return function(n){var o=_(n,e);return o==t||0==o.indexOf(i)}},"=":function(e,t){return function(i){return _(i,e)==t}}},v=r().documentElement,b=!(v.nextElementSibling||"nextElementSibling"in v),y=b?"nextSibling":"nextElementSibling",w=b?"previousSibling":"previousElementSibling",C=b?g:h,k=function(e){for(;e=e[w];)if(C(e))return!1;return!0},x=function(e){for(;e=e[y];)if(C(e))return!1;return!0},T=function(e){var i=e.parentNode,n=0,o=(i=7!=i.nodeType?i:i.nextSibling).children||i.childNodes,a=e._i||e.getAttribute("_i")||-1,s=i._l||(void 0!==i.getAttribute?i.getAttribute("_l"):-1);if(!o)return-1;var r=o.length;if(s==r&&a>=0&&s>=0)return a;t("ie")&&void 0!==i.setAttribute?i.setAttribute("_l",r):i._l=r;a=-1;for(var l=i.firstElementChild||i.firstChild;l;l=l[y])if(C(l)){t("ie")?l.setAttribute("_i",++n):l._i=++n;e===l&&(a=n)}return a},A=function(e){return!(T(e)%2)},j=function(e){return T(e)%2},S={checked:function(e,t){return function(e){return!!("checked"in e?e.checked:e.selected)}},disabled:function(e,t){return function(e){return e.disabled}},enabled:function(e,t){return function(e){return!e.disabled}},"first-child":function(){return k},"last-child":function(){return x},"only-child":function(e,t){return function(e){return k(e)&&x(e)}},empty:function(e,t){return function(e){for(var t=e.childNodes,i=e.childNodes.length-1;i>=0;i--){var n=t[i].nodeType;if(1===n||3==n)return!1}return!0}},contains:function(e,t){var i=t.charAt(0);'"'!=i&&"'"!=i||(t=t.slice(1,-1));return function(e){return e.innerHTML.indexOf(t)>=0}},not:function(e,t){var i=u(t)[0],n={el:1};"*"!=i.tag&&(n.tag=1);i.classes.length||(n.classes=1);var o=E(i,n);return function(e){return!o(e)}},"nth-child":function(e,t){var i=parseInt;if("odd"==t)return j;if("even"==t)return A;if(-1!=t.indexOf("n")){var n=t.split("n",2),o=n[0]?"-"==n[0]?-1:i(n[0]):1,a=n[1]?i(n[1]):0,s=0,r=-1;if(o>0){if(a<0)a=a%o&&o+a%o;else if(a>0){a>=o&&(s=a-a%o);a%=o}}else if(o<0){o*=-1;if(a>0){r=a;a%=o}}if(o>0)return function(e){var t=T(e);return t>=s&&(r<0||t<=r)&&t%o==a};t=a}var l=i(t);return function(e){return T(e)==l}}},M=t("ie")<9||9==t("ie")&&t("quirks")?function(e){var t=e.toLowerCase();"class"==t&&(e="className");return function(i){return c?i.getAttribute(e):i[e]||i[t]}}:function(e){return function(t){return t&&t.getAttribute&&t.hasAttribute(e)}},E=function(e,t){if(!e)return h;var i=null;"el"in(t=t||{})||(i=p(i,g));"tag"in t||"*"!=e.tag&&(i=p(i,(function(t){return t&&(c?t.tagName:t.tagName.toUpperCase())==e.getTag()})));"classes"in t||s(e.classes,(function(e,t,n){var o=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)");(i=p(i,(function(e){return o.test(e.className)}))).count=t}));"pseudos"in t||s(e.pseudos,(function(e){var t=e.name;S[t]&&(i=p(i,S[t](t,e.value)))}));"attrs"in t||s(e.attrs,(function(e){var t,n=e.attr;e.type&&f[e.type]?t=f[e.type](n,e.matchFor):n.length&&(t=M(n));t&&(i=p(i,t))}));"id"in t||e.id&&(i=p(i,(function(t){return!!t&&t.id==e.id})));i||"default"in t||(i=h);return i},N=function(e,t){var n=function(e){var t=[];try{t=Array.prototype.slice.call(e)}catch(o){for(var i=0,n=e.length;i<n;i++)t.push(e[i])}return t};e=e||h;return function(o,a,s){var r,l=0,d=[];d=n(o.children||o.childNodes);t&&i.forEach(d,(function(e){1===e.nodeType&&(d=d.concat(n(e.getElementsByTagName("*"))))}));for(;r=d[l++];)C(r)&&(!s||K(r,s))&&e(r,l)&&a.push(r);return a}},D=function(e,t){for(var i=e.parentNode;i&&i!=t;)i=i.parentNode;return!!i},I={},L=function(t){var n=I[t.query];if(n)return n;var o=t.infixOper,a=o?o.oper:"",s=E(t,{el:1}),d="*"==t.tag,c=r().getElementsByClassName;if(a){var u={el:1};d&&(u.tag=1);s=E(t,u);"+"==a?n=function(e){return function(t,i,n){for(;t=t[y];)if(!b||g(t)){n&&!K(t,n)||!e(t)||i.push(t);break}return i}}(s):"~"==a?n=function(e){return function(t,i,n){for(var o=t[y];o;){if(C(o)){if(n&&!K(o,n))break;e(o)&&i.push(o)}o=o[y]}return i}}(s):">"==a&&(n=N(s))}else if(t.id){s=!t.loops&&d?h:E(t,{el:1,id:1});n=function(n,o){var a=e.byId(t.id,n.ownerDocument||n);if(n.ownerDocument&&!D(n,n.ownerDocument)){var r=11===n.nodeType?n.childNodes:[n];i.some(r,(function(e){var i=N((function(e){return e.id===t.id}),!0)(e,[]);if(i.length){a=i[0];return!1}}))}if(a&&s(a))return 9==n.nodeType||D(a,n)?m(a,o):void 0}}else if(c&&/\{\s*\[native code\]\s*\}/.test(String(c))&&t.classes.length&&!l){s=E(t,{el:1,classes:1,id:1});var p=t.classes.join(" ");n=function(e,t,i){for(var n,o=m(0,t),a=0,r=e.getElementsByClassName(p);n=r[a++];)s(n,e)&&K(n,i)&&o.push(n);return o}}else if(d||t.loops){s=E(t,{el:1,tag:1,id:1});n=function(e,i,n){for(var o,a=m(0,i),r=0,l=t.getTag(),d=l?e.getElementsByTagName(l):[];o=d[r++];)s(o,e)&&K(o,n)&&a.push(o);return a}}else n=function(e,i,n){for(var o,a=m(0,i),s=0,r=t.getTag(),l=r?e.getElementsByTagName(r):[];o=l[s++];)K(o,n)&&a.push(o);return a};return I[t.query]=n},$={},P={},R=function(e){var t=u(a(e));if(1==t.length){var i=L(t[0]);return function(e){var t=i(e,[]);t&&(t.nozip=!0);return t}}return function(e){return function(e,t){for(var i,n,o,a,s=m(e),r=t.length,l=0;l<r;l++){a=[];i=t[l];if(s.length-1>0){o={};a.nozip=!0}for(var d=L(i),c=0;n=s[c];c++)d(n,a,o);if(!a.length)break;s=a}return a}(e,t)}},O=t("ie")?"commentStrip":"nozip",B="querySelectorAll",H=!!r()[B],F=/\\[>~+]|n\+\d|([^ \\])?([>~+])([^ =])?/g,z=function(e,t,i,n){return i?(t?t+" ":"")+i+(n?" "+n:""):e},q=/([^[]*)([^\]]*])?/g,W=function(e,t,i){return t.replace(F,z)+(i||"")},U=function(e,i){e=e.replace(q,W);if(H){var n=P[e];if(n&&!i)return n}var o=$[e];if(o)return o;var a=e.charAt(0),s=-1==e.indexOf(" ");e.indexOf("#")>=0&&s&&(i=!0);if(H&&!i&&-1==d.indexOf(a)&&(!t("ie")||-1==e.indexOf(":"))&&!(l&&e.indexOf(".")>=0)&&-1==e.indexOf(":contains")&&-1==e.indexOf(":checked")&&-1==e.indexOf("|=")){var r=d.indexOf(e.charAt(e.length-1))>=0?e+" *":e;return P[e]=function(t){if(9==t.nodeType||s)try{var i=t[B](r);i[O]=!0;return i}catch(n){}return U(e,!0)(t)}}var c=e.match(/([^\s,](?:"(?:\\.|[^"])+"|'(?:\\.|[^'])+'|[^,])*)/g);return $[e]=c.length<2?R(e):function(e){for(var t,i=0,n=[];t=c[i++];)n=n.concat(R(t)(e));return n}},V=0,G=t("ie")?function(e){return c?e.getAttribute("_uid")||e.setAttribute("_uid",++V)||V:e.uniqueID}:function(e){return e._uid||(e._uid=++V)},K=function(e,t){if(!t)return 1;var i=G(e);return t[i]?0:t[i]=1},Y="_zipIdx",Z=function(e,i){var n=(i=i||r()).ownerDocument||i;c="div"===n.createElement("div").tagName;var o=U(e)(i);return o&&o.nozip?o:function(e){if(e&&e.nozip)return e;if(!e||!e.length)return[];if(e.length<2)return[e[0]];var i,n,o=[];V++;if(t("ie")&&c){var a=V+"";for(i=0;i<e.length;i++)if((n=e[i])&&n.getAttribute(Y)!=a){o.push(n);n.setAttribute(Y,a)}}else if(t("ie")&&e.commentStrip)try{for(i=0;i<e.length;i++)(n=e[i])&&g(n)&&o.push(n)}catch(s){}else for(i=0;i<e.length;i++)if((n=e[i])&&n._zipIdx!=V){o.push(n);n._zipIdx=V}return o}(o)};Z.filter=function(t,n,o){for(var a,s=[],r=u(n),l=1!=r.length||/[^\w#\.]/.test(n)?function(t){return-1!=i.indexOf(Z(n,e.byId(o)),t)}:E(r[0]),d=0;a=t[d];d++)l(a)&&s.push(a);return s};return Z}))},"url:dijit/templates/Dialog.html":'<div class="dijitDialog" role="dialog" aria-labelledby="${id}_title">\n\t<div data-dojo-attach-point="titleBar" class="dijitDialogTitleBar">\n\t\t<span data-dojo-attach-point="titleNode" class="dijitDialogTitle" id="${id}_title"\n\t\t\t\trole="heading" level="1"></span>\n\t\t<span data-dojo-attach-point="closeButtonNode" class="dijitDialogCloseIcon" data-dojo-attach-event="ondijitclick: onCancel" title="${buttonCancel}" role="button" tabindex="-1">\n\t\t\t<span data-dojo-attach-point="closeText" class="closeText" title="${buttonCancel}">x</span>\n\t\t</span>\n\t</div>\n\t<div data-dojo-attach-point="containerNode" class="dijitDialogPaneContent"></div>\n\t${!actionBarTemplate}\n</div>\n\n',"url:dijit/templates/Tooltip.html":'<div class="dijitTooltip dijitTooltipLeft" id="dojoTooltip" data-dojo-attach-event="mouseenter:onMouseEnter,mouseleave:onMouseLeave"\n\t><div class="dijitTooltipConnector" data-dojo-attach-point="connectorNode"></div\n\t><div class="dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point="containerNode" role=\'alert\'></div\n></div>\n',"url:dijit/form/templates/TextBox.html":'<div class="dijit dijitReset dijitInline dijitLeft" id="widget_${id}" role="presentation"\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class="dijitReset dijitInputInner" data-dojo-attach-point=\'textbox,focusNode\' autocomplete="off"\n\t\t\t${!nameAttrSetting} type=\'${type}\'\n\t/></div\n></div>\n',"url:dijit/form/templates/ValidationTextBox.html":'<div class="dijit dijitReset dijitInline dijitLeft"\n\tid="widget_${id}" role="presentation"\n\t><div class=\'dijitReset dijitValidationContainer\'\n\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t/></div\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class="dijitReset dijitInputInner" data-dojo-attach-point=\'textbox,focusNode\' autocomplete="off"\n\t\t\t${!nameAttrSetting} type=\'${type}\'\n\t/></div\n></div>\n',"url:dijit/form/templates/DropDownBox.html":'<div class="dijit dijitReset dijitInline dijitLeft"\n\tid="widget_${id}"\n\trole="combobox"\n\taria-haspopup="true"\n\tdata-dojo-attach-point="_popupStateNode"\n\t><div class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\n\t\tdata-dojo-attach-point="_buttonNode" role="presentation"\n\t\t><input class="dijitReset dijitInputField dijitArrowButtonInner" value="&#9660; " type="text" tabIndex="-1" readonly="readonly" role="button presentation" aria-hidden="true"\n\t\t\t${_buttonInputDisabled}\n\t/></div\n\t><div class=\'dijitReset dijitValidationContainer\'\n\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t/></div\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class=\'dijitReset dijitInputInner\' ${!nameAttrSetting} type="${type}" autocomplete="off"\n\t\t\tdata-dojo-attach-point="textbox,focusNode" role="textbox"\n\t/></div\n></div>\n',"url:dijit/form/templates/Button.html":'<span class="dijit dijitReset dijitInline" role="presentation"\n\t><span class="dijitReset dijitInline dijitButtonNode"\n\t\tdata-dojo-attach-event="ondijitclick:__onClick" role="presentation"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdata-dojo-attach-point="titleNode,focusNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon" data-dojo-attach-point="iconNode"></span\n\t\t\t><span class="dijitReset dijitToggleButtonIconChar">&#x25CF;</span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tid="${id}_label"\n\t\t\t\tdata-dojo-attach-point="containerNode"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdata-dojo-attach-event="onclick:_onClick"\n\t\ttabIndex="-1" aria-hidden="true" data-dojo-attach-point="valueNode"\n/></span>\n',"url:dijit/form/templates/DropDownButton.html":'<span class="dijit dijitReset dijitInline"\n\t><span class=\'dijitReset dijitInline dijitButtonNode\'\n\t\tdata-dojo-attach-event="ondijitclick:__onClick" data-dojo-attach-point="_buttonNode"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdata-dojo-attach-point="focusNode,titleNode,_arrowWrapperNode,_popupStateNode"\n\t\t\trole="button" aria-haspopup="true" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon"\n\t\t\t\tdata-dojo-attach-point="iconNode"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tdata-dojo-attach-point="containerNode"\n\t\t\t\tid="${id}_label"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonInner"></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonChar">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen" tabIndex="-1"\n\t\tdata-dojo-attach-event="onclick:_onClick" data-dojo-attach-point="valueNode" aria-hidden="true"\n/></span>\n',"url:dijit/templates/TooltipDialog.html":'<div role="alertdialog" tabIndex="-1">\n\t<div class="dijitTooltipContainer" role="presentation">\n\t\t<div data-dojo-attach-point="contentsNode" class="dijitTooltipContents dijitTooltipFocusNode">\n\t\t\t<div data-dojo-attach-point="containerNode"></div>\n\t\t\t${!actionBarTemplate}\n\t\t</div>\n\t</div>\n\t<div class="dijitTooltipConnector" role="presentation" data-dojo-attach-point="connectorNode"></div>\n</div>\n',"url:dijit/templates/Menu.html":'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}"\n\t   cellspacing="0">\n\t<tbody class="dijitReset" data-dojo-attach-point="containerNode"></tbody>\n</table>\n',"url:dijit/templates/MenuItem.html":'<tr class="dijitReset" data-dojo-attach-point="focusNode" role="menuitem" tabIndex="-1">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<span role="presentation" class="dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point="iconNode"></span>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" data-dojo-attach-point="containerNode,textDirNode"\n\t\trole="presentation"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" data-dojo-attach-point="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<span data-dojo-attach-point="arrowWrapper" style="visibility: hidden">\n\t\t\t<span class="dijitInline dijitIcon dijitMenuExpand"></span>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</span>\n\t</td>\n</tr>\n',"url:dijit/templates/MenuSeparator.html":'<tr class="dijitMenuSeparator" role="separator">\n\t<td class="dijitMenuSeparatorIconCell">\n\t\t<div class="dijitMenuSeparatorTop"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n\t<td colspan="3" class="dijitMenuSeparatorLabelCell">\n\t\t<div class="dijitMenuSeparatorTop dijitMenuSeparatorLabel"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n</tr>\n',"url:dijit/form/templates/Select.html":'<table class="dijit dijitReset dijitInline dijitLeft"\n\tdata-dojo-attach-point="_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing=\'0\' cellpadding=\'0\'\n\trole="listbox" aria-haspopup="true"\n\t><tbody role="presentation"><tr role="presentation"\n\t\t><td class="dijitReset dijitStretch dijitButtonContents" role="presentation"\n\t\t\t><div class="dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point="containerNode,textDirNode" role="presentation"></div\n\t\t\t><div class="dijitReset dijitValidationContainer"\n\t\t\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t\t\t/></div\n\t\t\t><input type="hidden" ${!nameAttrSetting} data-dojo-attach-point="valueNode" value="${value}" aria-hidden="true"\n\t\t/></td\n\t\t><td class="dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\n\t\t\tdata-dojo-attach-point="titleNode" role="presentation"\n\t\t\t><input class="dijitReset dijitInputField dijitArrowButtonInner" value="&#9660; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n',"*now":function(e){e(['dojo/i18n!*preload*ebg/layer/nls/ly_studio*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])}}});define("ebg/layer/ly_studio",["dojo/_base/fx","dijit/Dialog","dojox/html/entities","dojo/string","dojo/fx","dojo/parser","dojo/io/iframe","dijit/Tooltip","dojox/uuid/generateRandomUuid","dojo/back","dojo/hash","dojox/dtl/filter/strings","dojo/i18n","dijit/form/FilteringSelect","dijit/Editor","dijit/_editor/plugins/FontChoice","dijit/_editor/plugins/TextColor","dijit/_editor/plugins/LinkDialog","dijit/_editor/plugins/ViewSource","ebg/core/core","ebg/core/i18n","ebg/gamenotif","ebg/core/gamegui","ebg/counter","ebg/scrollmap","ebg/stock","ebg/chatinput","ebg/dices","ebg/draggable","ebg/expandablesection","ebg/premiumpanel","ebg/scrollmap","ebg/wrapper","ebg/zone"],(function(e,t){return t("ebg.layer.ly_studio",null,{})}));